!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).firebase=e()}(this,function(){"use strict";!function(t){if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,a="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),r="FormData"in t,i="ArrayBuffer"in t;if(i)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(t){return t&&DataView.prototype.isPrototypeOf(t)},u=ArrayBuffer.isView||function(t){return t&&-1<o.indexOf(Object.prototype.toString.call(t))};d.prototype.append=function(t,e){t=l(t),e=f(e);var n=this.map[t];this.map[t]=n?n+","+e:e},d.prototype.delete=function(t){delete this.map[l(t)]},d.prototype.get=function(t){return t=l(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(l(t))},d.prototype.set=function(t,e){this.map[l(t)]=f(e)},d.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},d.prototype.keys=function(){var n=[];return this.forEach(function(t,e){n.push(e)}),p(n)},d.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),p(e)},d.prototype.entries=function(){var n=[];return this.forEach(function(t,e){n.push([e,t])}),p(n)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},E.error=function(){var t=new E(null,{status:0,statusText:""});return t.type="error",t};var h=[301,302,303,307,308];E.redirect=function(t,e){if(-1===h.indexOf(e))throw new RangeError("Invalid status code");return new E(null,{status:e,headers:{location:t}})},t.Headers=d,t.Request=w,t.Response=E,t.fetch=function(i,o){return new Promise(function(n,t){var e=new w(i,o),r=new XMLHttpRequest;r.onload=function(){var t={status:r.status,statusText:r.statusText,headers:function(t){var i=new d;return t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var e=t.split(":"),n=e.shift().trim();if(n){var r=e.join(":").trim();i.append(n,r)}}),i}(r.getAllResponseHeaders()||"")};t.url="responseURL"in r?r.responseURL:t.headers.get("X-Request-URL");var e="response"in r?r.response:r.responseText;n(new E(e,t))},r.onerror=function(){t(new TypeError("Network request failed"))},r.ontimeout=function(){t(new TypeError("Network request failed"))},r.open(e.method,e.url,!0),"include"===e.credentials?r.withCredentials=!0:"omit"===e.credentials&&(r.withCredentials=!1),"responseType"in r&&a&&(r.responseType="blob"),e.headers.forEach(function(t,e){r.setRequestHeader(e,t)}),r.send(void 0===e._bodyInit?null:e._bodyInit)})},t.fetch.polyfill=!0}function l(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach(function(t,e){this.append(e,t)},this):Array.isArray(e)?e.forEach(function(t){this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function y(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function m(n){return new Promise(function(t,e){n.onload=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function v(t){var e=new FileReader,n=m(e);return e.readAsArrayBuffer(t),n}function g(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(a&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(r&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(i&&a&&s(t))this._bodyArrayBuffer=g(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!i||!ArrayBuffer.prototype.isPrototypeOf(t)&&!u(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=g(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(v)}),this.text=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,n=m(e);return e.readAsText(t),n}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(t,e){var n=(e=e||{}).body;if(t instanceof w){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=function(t){var e=t.toUpperCase();return-1<c.indexOf(e)?e:t}(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function _(t){var i=new FormData;return t.trim().split("&").forEach(function(t){if(t){var e=t.split("="),n=e.shift().replace(/\+/g," "),r=e.join("=").replace(/\+/g," ");i.append(decodeURIComponent(n),decodeURIComponent(r))}}),i}function E(t,e){e=e||{},this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}function n(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})}var r=setTimeout;function u(t){return Boolean(t&&void 0!==t.length)}function i(){}function o(t){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(t,this)}function a(n,r){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,o._immediateFn(function(){var t=1===n._state?r.onFulfilled:r.onRejected;if(null!==t){var e;try{e=t(n._value)}catch(t){return void c(r.promise,t)}s(r.promise,e)}else(1===n._state?s:c)(r.promise,n._value)})):n._deferreds.push(r)}function s(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof o)return e._state=3,e._value=t,void h(e);if("function"==typeof n)return void f(function(t,e){return function(){t.apply(e,arguments)}}(n,t),e)}e._state=1,e._value=t,h(e)}catch(t){c(e,t)}}function c(t,e){t._state=2,t._value=e,h(t)}function h(t){2===t._state&&0===t._deferreds.length&&o._immediateFn(function(){t._handled||o._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)a(t,t._deferreds[e]);t._deferreds=null}function l(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function f(t,e){var n=!1;try{t(function(t){n||(n=!0,s(e,t))},function(t){n||(n=!0,c(e,t))})}catch(t){if(n)return;n=!0,c(e,t)}}o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var n=new this.constructor(i);return a(this,new l(t,e,n)),n},o.prototype.finally=n,o.all=function(e){return new o(function(r,i){if(!u(e))return i(new TypeError("Promise.all accepts an array"));var o=Array.prototype.slice.call(e);if(0===o.length)return r([]);var a=o.length;function s(e,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void n.call(t,function(t){s(e,t)},i)}o[e]=t,0==--a&&r(o)}catch(t){i(t)}}for(var t=0;t<o.length;t++)s(t,o[t])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(t){t(e)})},o.reject=function(n){return new o(function(t,e){e(n)})},o.race=function(i){return new o(function(t,e){if(!u(i))return e(new TypeError("Promise.race accepts an array"));for(var n=0,r=i.length;n<r;n++)o.resolve(i[n]).then(t,e)})},o._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){r(t,0)},o._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var p=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")}();"Promise"in p?p.Promise.prototype.finally||(p.Promise.prototype.finally=n):p.Promise=o;function d(t){return t&&t.Math==Math&&t}function m(t){try{return!!t()}catch(t){return!0}}function v(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}function y(t){return F.call(t).slice(8,-1)}function g(t){if(null==t)throw TypeError("Can't call method on "+t);return t}function b(t){return q(g(t))}function w(t){return"object"==typeof t?null!==t:"function"==typeof t}function _(t,e){if(!w(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!w(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!w(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!w(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}function E(t,e){return V.call(t,e)}function T(t){return j?B.createElement(t):{}}function S(t){if(!w(t))throw TypeError(String(t)+" is not an object");return t}function I(e,n){try{z(O,e,n)}catch(t){O[e]=n}return n}function C(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++tt+et).toString(36)}function N(t){return nt[t]||(nt[t]=C(t))}var A,k,D,R="object",O=d(typeof globalThis==R&&globalThis)||d(typeof window==R&&window)||d(typeof self==R&&self)||d(typeof t==R&&t)||Function("return this")(),P=!m(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),M={}.propertyIsEnumerable,x=Object.getOwnPropertyDescriptor,L={f:x&&!M.call({1:2},1)?function(t){var e=x(this,t);return!!e&&e.enumerable}:M},F={}.toString,U="".split,q=m(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==y(t)?U.call(t,""):Object(t)}:Object,V={}.hasOwnProperty,B=O.document,j=w(B)&&w(B.createElement),W=!P&&!m(function(){return 7!=Object.defineProperty(T("div"),"a",{get:function(){return 7}}).a}),Q=Object.getOwnPropertyDescriptor,K={f:P?Q:function(t,e){if(t=b(t),e=_(e,!0),W)try{return Q(t,e)}catch(t){}if(E(t,e))return v(!L.f.call(t,e),t[e])}},H=Object.defineProperty,G={f:P?H:function(t,e,n){if(S(t),e=_(e,!0),S(n),W)try{return H(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},z=P?function(t,e,n){return G.f(t,e,v(1,n))}:function(t,e,n){return t[e]=n,t},Y=!1,X=e(function(t){var e="__core-js_shared__",n=O[e]||I(e,{});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.2.1",mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})}),J=X("native-function-to-string",Function.toString),$=O.WeakMap,Z="function"==typeof $&&/native code/.test(J.call($)),tt=0,et=Math.random(),nt=X("keys"),rt={},it=O.WeakMap;if(Z){var ot=new it,at=ot.get,st=ot.has,ut=ot.set;A=function(t,e){return ut.call(ot,t,e),e},k=function(t){return at.call(ot,t)||{}},D=function(t){return st.call(ot,t)}}else{var ct=N("state");rt[ct]=!0,A=function(t,e){return z(t,ct,e),e},k=function(t){return E(t,ct)?t[ct]:{}},D=function(t){return E(t,ct)}}function ht(t){return"function"==typeof t?t:void 0}function lt(t,e){return arguments.length<2?ht(At[t])||ht(O[t]):At[t]&&At[t][e]||O[t]&&O[t][e]}function ft(t){return isNaN(t=+t)?0:(0<t?Dt:kt)(t)}function pt(t){return 0<t?Rt(ft(t),9007199254740991):0}function dt(s){return function(t,e,n){var r,i=b(t),o=pt(i.length),a=function(t,e){var n=ft(t);return n<0?Ot(n+e,0):Pt(n,e)}(n,o);if(s&&e!=e){for(;a<o;)if((r=i[a++])!=r)return!0}else for(;a<o;a++)if((s||a in i)&&i[a]===e)return s||a||0;return!s&&-1}}function yt(t,e){var n,r=b(t),i=0,o=[];for(n in r)!E(rt,n)&&E(r,n)&&o.push(n);for(;e.length>i;)E(r,n=e[i++])&&(~Mt(o,n)||o.push(n));return o}function mt(t,e){for(var n=qt(e),r=G.f,i=K.f,o=0;o<n.length;o++){var a=n[o];E(t,a)||r(t,a,i(e,a))}}function vt(t,e){var n=jt[Bt(t)];return n==Qt||n!=Wt&&("function"==typeof e?m(e):!!e)}function gt(t,e){var n,r,i,o,a,s=t.target,u=t.global,c=t.stat;if(n=u?O:c?O[s]||I(s,{}):(O[s]||{}).prototype)for(r in e){if(o=e[r],i=t.noTargetGet?(a=Ht(n,r))&&a.value:n[r],!Kt(u?r:s+(c?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;mt(o,i)}(t.sham||i&&i.sham)&&z(o,"sham",!0),Nt(n,r,o,t)}}function bt(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}function wt(r,i,t){if(bt(r),void 0===i)return r;switch(t){case 0:return function(){return r.call(i)};case 1:return function(t){return r.call(i,t)};case 2:return function(t,e){return r.call(i,t,e)};case 3:return function(t,e,n){return r.call(i,t,e,n)}}return function(){return r.apply(i,arguments)}}function _t(t){return Object(g(t))}function Et(t){return Xt[t]||(Xt[t]=zt&&Yt[t]||(zt?Yt:C)("Symbol."+t))}function Tt(t,e){var n;return Gt(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!Gt(n.prototype)?w(n)&&null===(n=n[Jt])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)}function St(p){var d=1==p,y=2==p,m=3==p,v=4==p,g=6==p,b=5==p||g;return function(t,e,n,r){for(var i,o,a=_t(t),s=q(a),u=wt(e,n,3),c=pt(s.length),h=0,l=r||Tt,f=d?l(t,c):y?l(t,0):void 0;h<c;h++)if((b||h in s)&&(o=u(i=s[h],h,a),p))if(d)f[h]=o;else if(o)switch(p){case 3:return!0;case 5:return i;case 6:return h;case 2:$t.call(f,i)}else if(v)return!1;return g?-1:m||v?v:f}}function It(){}var Ct={set:A,get:k,has:D,enforce:function(t){return D(t)?k(t):A(t,{})},getterFor:function(n){return function(t){var e;if(!w(t)||(e=k(t)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return e}}},Nt=e(function(t){var e=Ct.get,s=Ct.enforce,u=String(J).split("toString");X("inspectSource",function(t){return J.call(t)}),(t.exports=function(t,e,n,r){var i=!!r&&!!r.unsafe,o=!!r&&!!r.enumerable,a=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof e||E(n,"name")||z(n,"name",e),s(n).source=u.join("string"==typeof e?e:"")),t!==O?(i?!a&&t[e]&&(o=!0):delete t[e],o?t[e]=n:z(t,e,n)):o?t[e]=n:I(e,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||J.call(this)})}),At=O,kt=Math.ceil,Dt=Math.floor,Rt=Math.min,Ot=Math.max,Pt=Math.min,Mt={includes:dt(!0),indexOf:dt(!1)}.indexOf,xt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Lt=xt.concat("length","prototype"),Ft={f:Object.getOwnPropertyNames||function(t){return yt(t,Lt)}},Ut={f:Object.getOwnPropertySymbols},qt=lt("Reflect","ownKeys")||function(t){var e=Ft.f(S(t)),n=Ut.f;return n?e.concat(n(t)):e},Vt=/#|\.prototype\./,Bt=vt.normalize=function(t){return String(t).replace(Vt,".").toLowerCase()},jt=vt.data={},Wt=vt.NATIVE="N",Qt=vt.POLYFILL="P",Kt=vt,Ht=K.f,Gt=Array.isArray||function(t){return"Array"==y(t)},zt=!!Object.getOwnPropertySymbols&&!m(function(){return!String(Symbol())}),Yt=O.Symbol,Xt=X("wks"),Jt=Et("species"),$t=[].push,Zt={forEach:St(0),map:St(1),filter:St(2),some:St(3),every:St(4),find:St(5),findIndex:St(6)},te=Object.keys||function(t){return yt(t,xt)},ee=P?Object.defineProperties:function(t,e){S(t);for(var n,r=te(e),i=r.length,o=0;o<i;)G.f(t,n=r[o++],e[n]);return t},ne=lt("document","documentElement"),re=N("IE_PROTO"),ie="prototype",oe=function(){var t,e=T("iframe"),n=xt.length,r="script";for(e.style.display="none",ne.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object</"+r+">"),t.close(),oe=t.F;n--;)delete oe[ie][xt[n]];return oe()},ae=Object.create||function(t,e){var n;return null!==t?(It[ie]=S(t),n=new It,It[ie]=null,n[re]=t):n=oe(),void 0===e?n:ee(n,e)};rt[re]=!0;var se=Et("unscopables"),ue=Array.prototype;null==ue[se]&&z(ue,se,ae(null));function ce(t){ue[se][t]=!0}var he=Zt.find,le="find",fe=!0;le in[]&&Array(1)[le](function(){fe=!1}),gt({target:"Array",proto:!0,forced:fe},{find:function(t,e){return he(this,t,1<arguments.length?e:void 0)}}),ce(le);function pe(t,e,n){return wt(de,O[t].prototype[e],n)}var de=Function.call,ye=(pe("Array","find"),Zt.findIndex),me="findIndex",ve=!0;me in[]&&Array(1)[me](function(){ve=!1}),gt({target:"Array",proto:!0,forced:ve},{findIndex:function(t,e){return ye(this,t,1<arguments.length?e:void 0)}}),ce(me);function ge(s){return function(t,e){var n,r,i=String(g(t)),o=ft(e),a=i.length;return o<0||a<=o?s?"":void 0:(n=i.charCodeAt(o))<55296||56319<n||o+1===a||(r=i.charCodeAt(o+1))<56320||57343<r?s?i.charAt(o):n:s?i.slice(o,o+2):r-56320+(n-55296<<10)+65536}}pe("Array","findIndex");var be,we,_e,Ee={codeAt:ge(!1),charAt:ge(!0)},Te=!m(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Se=N("IE_PROTO"),Ie=Object.prototype,Ce=Te?Object.getPrototypeOf:function(t){return t=_t(t),E(t,Se)?t[Se]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Ie:null},Ne=Et("iterator"),Ae=!1;[].keys&&("next"in(_e=[].keys())?(we=Ce(Ce(_e)))!==Object.prototype&&(be=we):Ae=!0),null==be&&(be={}),E(be,Ne)||z(be,Ne,function(){return this});function ke(t,e,n){t&&!E(t=n?t:t.prototype,xe)&&Me(t,xe,{configurable:!0,value:e})}function De(){return this}function Re(){return this}function Oe(t,e,n,r,i,o,a){function s(t){if(t===i&&y)return y;if(!Ve&&t in p)return p[t];switch(t){case"keys":case je:case We:return function(){return new n(this,t)}}return function(){return new n(this)}}!function(t,e,n){var r=e+" Iterator";t.prototype=ae(Fe,{next:v(1,n)}),ke(t,r,!1),Le[r]=De}(n,e,r);var u,c,h,l=e+" Iterator",f=!1,p=t.prototype,d=p[Be]||p["@@iterator"]||i&&p[i],y=!Ve&&d||s(i),m="Array"==e&&p.entries||d;if(m&&(u=Ce(m.call(new t)),qe!==Object.prototype&&u.next&&(Ce(u)!==qe&&(Ue?Ue(u,qe):"function"!=typeof u[Be]&&z(u,Be,Re)),ke(u,l,!0))),i==je&&d&&d.name!==je&&(f=!0,y=function(){return d.call(this)}),p[Be]!==y&&z(p,Be,y),Le[e]=y,i)if(c={values:s(je),keys:o?y:s("keys"),entries:s(We)},a)for(h in c)!Ve&&!f&&h in p||Nt(p,h,c[h]);else gt({target:e,proto:!0,forced:Ve||f},c);return c}var Pe={IteratorPrototype:be,BUGGY_SAFARI_ITERATORS:Ae},Me=G.f,xe=Et("toStringTag"),Le={},Fe=Pe.IteratorPrototype,Ue=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,t={};try{(n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(t,[]),r=t instanceof Array}catch(t){}return function(t,e){return S(t),function(t){if(!w(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(e),r?n.call(t,e):t.__proto__=e,t}}():void 0),qe=Pe.IteratorPrototype,Ve=Pe.BUGGY_SAFARI_ITERATORS,Be=Et("iterator"),je="values",We="entries",Qe=Ee.charAt,Ke="String Iterator",He=Ct.set,Ge=Ct.getterFor(Ke);Oe(String,"String",function(t){He(this,{type:Ke,string:String(t),index:0})},function(){var t,e=Ge(this),n=e.string,r=e.index;return r>=n.length?{value:void 0,done:!0}:(t=Qe(n,r),e.index+=t.length,{value:t,done:!1})});function ze(e,t,n,r){try{return r?t(S(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&S(i.call(e)),t}}function Ye(t){return void 0!==t&&(Le.Array===t||tn[Ze]===t)}function Xe(t,e,n){var r=_(e);r in t?G.f(t,r,v(0,n)):t[r]=n}function Je(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),en))?n:nn?y(e):"Object"==(r=y(e))&&"function"==typeof e.callee?"Arguments":r}function $e(t){if(null!=t)return t[rn]||t["@@iterator"]||Le[Je(t)]}var Ze=Et("iterator"),tn=Array.prototype,en=Et("toStringTag"),nn="Arguments"==y(function(){return arguments}()),rn=Et("iterator"),on=Et("iterator"),an=!1;try{var sn=0,un={next:function(){return{done:!!sn++}},return:function(){an=!0}};un[on]=function(){return this},Array.from(un,function(){throw 2})}catch(No){}function cn(t,e){if(!e&&!an)return!1;var n=!1;try{var r={};r[on]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n}var hn=!cn(function(t){Array.from(t)});gt({target:"Array",stat:!0,forced:hn},{from:function(t,e,n){var r,i,o,a,s=_t(t),u="function"==typeof this?this:Array,c=arguments.length,h=1<c?e:void 0,l=void 0!==h,f=0,p=$e(s);if(l&&(h=wt(h,2<c?n:void 0,2)),null==p||u==Array&&Ye(p))for(i=new u(r=pt(s.length));f<r;f++)Xe(i,f,l?h(s[f],f):s[f]);else for(a=p.call(s),i=new u;!(o=a.next()).done;f++)Xe(i,f,l?ze(a,h,[o.value,f],!0):o.value);return i.length=f,i}});At.Array.from;var ln,fn,pn,dn=Zt.some;gt({target:"Array",proto:!0,forced:(ln="some",pn=[][ln],!pn||!m(function(){pn.call(null,fn||function(){throw 1},1)}))},{some:function(t,e){return dn(this,t,1<arguments.length?e:void 0)}});pe("Array","some");var yn=Object.assign,mn=!yn||m(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=yn({},t)[n]||te(yn({},e)).join("")!=r})?function(t,e){for(var n=_t(t),r=arguments.length,i=1,o=Ut.f,a=L.f;i<r;)for(var s,u=q(arguments[i++]),c=o?te(u).concat(o(u)):te(u),h=c.length,l=0;l<h;)s=c[l++],P&&!a.call(u,s)||(n[s]=u[s]);return n}:yn;gt({target:"Object",stat:!0,forced:Object.assign!==mn},{assign:mn});At.Object.assign;function vn(s){return function(t){for(var e,n=b(t),r=te(n),i=r.length,o=0,a=[];o<i;)e=r[o++],P&&!gn.call(n,e)||a.push(s?[e,n[e]]:n[e]);return a}}var gn=L.f,bn={entries:vn(!0),values:vn(!1)},wn=bn.entries;gt({target:"Object",stat:!0},{entries:function(t){return wn(t)}});At.Object.entries;var _n=bn.values;gt({target:"Object",stat:!0},{values:function(t){return _n(t)}});At.Object.values;function En(t){if(function(t){var e;return w(t)&&(void 0!==(e=t[Tn])?!!e:"RegExp"==y(t))}(t))throw TypeError("The method doesn't accept regular expressions");return t}var Tn=Et("match"),Sn=Et("match"),In="".startsWith,Cn=Math.min;gt({target:"String",proto:!0,forced:!function(e){var n=/./;try{"/./"[e](n)}catch(t){try{return n[Sn]=!1,"/./"[e](n)}catch(t){}}return!1}("startsWith")},{startsWith:function(t,e){var n=String(g(this));En(t);var r=pt(Cn(1<arguments.length?e:void 0,n.length)),i=String(t);return In?In.call(n,i,r):n.slice(r,r+i.length)===i}});pe("String","startsWith");gt({target:"String",proto:!0},{repeat:"".repeat||function(t){var e=String(g(this)),n="",r=ft(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}});pe("String","repeat");function Nn(t){if(!w(t))return!1;var e=t[Dn];return void 0!==e?!!e:Gt(t)}var An,kn=Et("species"),Dn=Et("isConcatSpreadable"),Rn=9007199254740991,On="Maximum allowed index exceeded",Pn=!m(function(){var t=[];return t[Dn]=!1,t.concat()[0]!==t}),Mn=(An="concat",!m(function(){var t=[];return(t.constructor={})[kn]=function(){return{foo:1}},1!==t[An](Boolean).foo}));gt({target:"Array",proto:!0,forced:!Pn||!Mn},{concat:function(t){var e,n,r,i,o,a=_t(this),s=Tt(a,0),u=0;for(e=-1,r=arguments.length;e<r;e++)if(Nn(o=-1===e?a:arguments[e])){if(i=pt(o.length),Rn<u+i)throw TypeError(On);for(n=0;n<i;n++,u++)n in o&&Xe(s,u,o[n])}else{if(Rn<=u)throw TypeError(On);Xe(s,u++,o)}return s.length=u,s}});var xn={};xn[Et("toStringTag")]="z";var Ln="[object z]"!==String(xn)?function(){return"[object "+Je(this)+"]"}:xn.toString,Fn=Object.prototype;Ln!==Fn.toString&&Nt(Fn,"toString",Ln,{unsafe:!0});function Un(t){var e=At.Symbol||(At.Symbol={});E(e,t)||zn(e,t,{value:Gn.f(t)})}function qn(t,e){var n=hr[t]=ae(rr[$n]);return tr(n,{type:Jn,tag:t,description:e}),P||(n.description=e),n}function Vn(e,t){S(e);var n=b(t),r=te(n).concat(_r(n));return Yn(r,function(t){P&&!wr.call(n,t)||br(e,t,n[t])}),e}function Bn(t,e){var n=b(t),r=_(e,!0);if(n!==nr||!E(hr,r)||E(lr,r)){var i=ar(n,r);return!i||!E(hr,r)||E(n,Xn)&&n[Xn][r]||(i.enumerable=!0),i}}function jn(t){var e=ur(b(t)),n=[];return Yn(e,function(t){E(hr,t)||E(rt,t)||n.push(t)}),n}var Wn=Ft.f,Qn={}.toString,Kn="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Hn={f:function(t){return Kn&&"[object Window]"==Qn.call(t)?function(t){try{return Wn(t)}catch(t){return Kn.slice()}}(t):Wn(b(t))}},Gn={f:Et},zn=G.f,Yn=Zt.forEach,Xn=N("hidden"),Jn="Symbol",$n="prototype",Zn=Et("toPrimitive"),tr=Ct.set,er=Ct.getterFor(Jn),nr=Object[$n],rr=O.Symbol,ir=O.JSON,or=ir&&ir.stringify,ar=K.f,sr=G.f,ur=Hn.f,cr=L.f,hr=X("symbols"),lr=X("op-symbols"),fr=X("string-to-symbol-registry"),pr=X("symbol-to-string-registry"),dr=X("wks"),yr=O.QObject,mr=!yr||!yr[$n]||!yr[$n].findChild,vr=P&&m(function(){return 7!=ae(sr({},"a",{get:function(){return sr(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=ar(nr,e);r&&delete nr[e],sr(t,e,n),r&&t!==nr&&sr(nr,e,r)}:sr,gr=zt&&"symbol"==typeof rr.iterator?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof rr},br=function(t,e,n){t===nr&&br(lr,e,n),S(t);var r=_(e,!0);return S(n),E(hr,r)?(n.enumerable?(E(t,Xn)&&t[Xn][r]&&(t[Xn][r]=!1),n=ae(n,{enumerable:v(0,!1)})):(E(t,Xn)||sr(t,Xn,v(1,{})),t[Xn][r]=!0),vr(t,r,n)):sr(t,r,n)},wr=function(t){var e=_(t,!0),n=cr.call(this,e);return!(this===nr&&E(hr,e)&&!E(lr,e))&&(!(n||!E(this,e)||!E(hr,e)||E(this,Xn)&&this[Xn][e])||n)},_r=function(t){var e=t===nr,n=ur(e?lr:b(t)),r=[];return Yn(n,function(t){!E(hr,t)||e&&!E(nr,t)||r.push(hr[t])}),r};zt||(Nt((rr=function(t){if(this instanceof rr)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==t?String(t):void 0,n=C(e),r=function(t){this===nr&&r.call(lr,t),E(this,Xn)&&E(this[Xn],n)&&(this[Xn][n]=!1),vr(this,n,v(1,t))};return P&&mr&&vr(nr,n,{configurable:!0,set:r}),qn(n,e)})[$n],"toString",function(){return er(this).tag}),L.f=wr,G.f=br,K.f=Bn,Ft.f=Hn.f=jn,Ut.f=_r,P&&(sr(rr[$n],"description",{configurable:!0,get:function(){return er(this).description}}),Nt(nr,"propertyIsEnumerable",wr,{unsafe:!0})),Gn.f=function(t){return qn(Et(t),t)}),gt({global:!0,wrap:!0,forced:!zt,sham:!zt},{Symbol:rr}),Yn(te(dr),function(t){Un(t)}),gt({target:Jn,stat:!0,forced:!zt},{for:function(t){var e=String(t);if(E(fr,e))return fr[e];var n=rr(e);return fr[e]=n,pr[n]=e,n},keyFor:function(t){if(!gr(t))throw TypeError(t+" is not a symbol");if(E(pr,t))return pr[t]},useSetter:function(){mr=!0},useSimple:function(){mr=!1}}),gt({target:"Object",stat:!0,forced:!zt,sham:!P},{create:function(t,e){return void 0===e?ae(t):Vn(ae(t),e)},defineProperty:br,defineProperties:Vn,getOwnPropertyDescriptor:Bn}),gt({target:"Object",stat:!0,forced:!zt},{getOwnPropertyNames:jn,getOwnPropertySymbols:_r}),gt({target:"Object",stat:!0,forced:m(function(){Ut.f(1)})},{getOwnPropertySymbols:function(t){return Ut.f(_t(t))}}),ir&&gt({target:"JSON",stat:!0,forced:!zt||m(function(){var t=rr();return"[null]"!=or([t])||"{}"!=or({a:t})||"{}"!=or(Object(t))})},{stringify:function(t){for(var e,n,r=[t],i=1;i<arguments.length;)r.push(arguments[i++]);if(n=e=r[1],(w(e)||void 0!==t)&&!gr(t))return Gt(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!gr(e))return e}),r[1]=e,or.apply(ir,r)}}),rr[$n][Zn]||z(rr[$n],Zn,rr[$n].valueOf),ke(rr,Jn),rt[Xn]=!0,Un("asyncIterator");var Er=G.f,Tr=O.Symbol;if(!(!P||"function"!=typeof Tr||"description"in Tr.prototype&&void 0===Tr().description)){var Sr={},Ir=function(t){var e=arguments.length<1||void 0===t?void 0:String(t),n=this instanceof Ir?new Tr(e):void 0===e?Tr():Tr(e);return""===e&&(Sr[n]=!0),n};mt(Ir,Tr);var Cr=Ir.prototype=Tr.prototype;Cr.constructor=Ir;var Nr=Cr.toString,Ar="Symbol(test)"==String(Tr("test")),kr=/^Symbol\((.*)\)[^)]+$/;Er(Cr,"description",{configurable:!0,get:function(){var t=w(this)?this.valueOf():this,e=Nr.call(t);if(E(Sr,t))return"";var n=Ar?e.slice(7,-1):e.replace(kr,"$1");return""===n?void 0:n}}),gt({global:!0,forced:!0},{Symbol:Ir})}Un("hasInstance"),Un("isConcatSpreadable"),Un("iterator"),Un("match"),Un("matchAll"),Un("replace"),Un("search"),Un("species"),Un("split"),Un("toPrimitive"),Un("toStringTag"),Un("unscopables"),ke(Math,"Math",!0),ke(O.JSON,"JSON",!0);At.Symbol;Un("asyncDispose"),Un("dispose"),Un("observable"),Un("patternMatch"),Un("replaceAll");var Dr={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Rr="Array Iterator",Or=Ct.set,Pr=Ct.getterFor(Rr),Mr=Oe(Array,"Array",function(t,e){Or(this,{type:Rr,target:b(t),index:0,kind:e})},function(){var t=Pr(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?{value:t.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}},"values");Le.Arguments=Le.Array,ce("keys"),ce("values"),ce("entries");var xr=Et("iterator"),Lr=Et("toStringTag"),Fr=Mr.values;for(var Ur in Dr){var qr=O[Ur],Vr=qr&&qr.prototype;if(Vr){if(Vr[xr]!==Fr)try{z(Vr,xr,Fr)}catch(No){Vr[xr]=Fr}if(Vr[Lr]||z(Vr,Lr,Ur),Dr[Ur])for(var Br in Mr)if(Vr[Br]!==Mr[Br])try{z(Vr,Br,Mr[Br])}catch(No){Vr[Br]=Mr[Br]}}}Gn.f("iterator");function jr(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t}function Wr(r,t,e,i,o){function n(t){var n=s[t];Nt(s,t,"add"==t?function(t){return n.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!w(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return o&&!w(t)?void 0:n.call(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!w(t))&&n.call(this,0===t?0:t)}:function(t,e){return n.call(this,0===t?0:t,e),this})}var a=O[r],s=a&&a.prototype,u=a,c=i?"set":"add",h={};if(Kt(r,"function"!=typeof a||!(o||s.forEach&&!m(function(){(new a).entries().next()}))))u=e.getConstructor(t,r,i,c),Gr.REQUIRED=!0;else if(Kt(r,!0)){var l=new u,f=l[c](o?{}:-0,1)!=l,p=m(function(){l.has(1)}),d=cn(function(t){new a(t)}),y=!o&&m(function(){for(var t=new a,e=5;e--;)t[c](e,e);return!t.has(-0)});d||(((u=t(function(t,e){jr(t,u,r);var n=function(t,e,n){var r,i;return Ue&&"function"==typeof(r=e.constructor)&&r!==n&&w(i=r.prototype)&&i!==n.prototype&&Ue(t,i),t}(new a,t,u);return null!=e&&zr(e,n[c],n,i),n})).prototype=s).constructor=u),(p||y)&&(n("delete"),n("has"),i&&n("get")),(y||f)&&n(c),o&&s.clear&&delete s.clear}return h[r]=u,gt({global:!0,forced:u!=a},h),ke(u,r),o||e.setStrong(u,r,i),u}function Qr(t,e,n){for(var r in e)Nt(t,r,e[r],n);return t}function Kr(t,e,n){var r,i,o,a,s=arguments.length,u=1<s?e:void 0;return bt(this),(r=void 0!==u)&&bt(u),null==t?new this:(i=[],r?(o=0,a=wt(u,2<s?n:void 0,2),zr(t,function(t){i.push(a(t,o++))})):zr(t,i.push,i),new this(i))}var Hr=!m(function(){return Object.isExtensible(Object.preventExtensions({}))}),Gr=e(function(t){function n(t){e(t,r,{value:{objectID:"O"+ ++i,weakData:{}}})}var e=G.f,r=C("meta"),i=0,o=Object.isExtensible||function(){return!0},a=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!w(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!E(t,r)){if(!o(t))return"F";if(!e)return"E";n(t)}return t[r].objectID},getWeakData:function(t,e){if(!E(t,r)){if(!o(t))return!0;if(!e)return!1;n(t)}return t[r].weakData},onFreeze:function(t){return Hr&&a.REQUIRED&&o(t)&&!E(t,r)&&n(t),t}};rt[r]=!0}),zr=(Gr.REQUIRED,Gr.fastKey,Gr.getWeakData,Gr.onFreeze,e(function(t){function f(t,e){this.stopped=t,this.result=e}(t.exports=function(t,e,n,r,i){var o,a,s,u,c,h,l=wt(e,n,r?2:1);if(i)o=t;else{if("function"!=typeof(a=$e(t)))throw TypeError("Target is not iterable");if(Ye(a)){for(s=0,u=pt(t.length);s<u;s++)if((c=r?l(S(h=t[s])[0],h[1]):l(t[s]))&&c instanceof f)return c;return new f(!1)}o=a.call(t)}for(;!(h=o.next()).done;)if((c=ze(o,l,h.value,r))&&c instanceof f)return c;return new f(!1)}).stop=function(t){return new f(!0,t)}})),Yr=Et("species"),Xr=G.f,Jr=Gr.fastKey,$r=Ct.set,Zr=Ct.getterFor,ti={getConstructor:function(t,n,r,i){function o(t,e,n){var r,i,o=s(t),a=u(t,e);return a?a.value=n:(o.last=a={index:i=Jr(e,!0),key:e,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=a),r&&(r.next=a),P?o.size++:t.size++,"F"!==i&&(o.index[i]=a)),t}var a=t(function(t,e){jr(t,a,n),$r(t,{type:n,index:ae(null),first:void 0,last:void 0,size:0}),P||(t.size=0),null!=e&&zr(e,t[i],t,r)}),s=Zr(n),u=function(t,e){var n,r=s(t),i=Jr(e);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==e)return n};return Qr(a.prototype,{clear:function(){for(var t=s(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,P?t.size=0:this.size=0},delete:function(t){var e=s(this),n=u(this,t);if(n){var r=n.next,i=n.previous;delete e.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),e.first==n&&(e.first=r),e.last==n&&(e.last=i),P?e.size--:this.size--}return!!n},forEach:function(t,e){for(var n,r=s(this),i=wt(t,1<arguments.length?e:void 0,3);n=n?n.next:r.first;)for(i(n.value,n.key,this);n&&n.removed;)n=n.previous},has:function(t){return!!u(this,t)}}),Qr(a.prototype,r?{get:function(t){var e=u(this,t);return e&&e.value},set:function(t,e){return o(this,0===t?0:t,e)}}:{add:function(t){return o(this,t=0===t?0:t,t)}}),P&&Xr(a.prototype,"size",{get:function(){return s(this).size}}),a},setStrong:function(t,e,n){var r=e+" Iterator",i=Zr(e),o=Zr(r);Oe(t,e,function(t,e){$r(this,{type:r,target:t,state:i(t),kind:e,last:void 0})},function(){for(var t=o(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:t.target=void 0,done:!0}},n?"entries":"values",!n,!0),function(t){var e=lt(t),n=G.f;P&&e&&!e[Yr]&&n(e,Yr,{configurable:!0,get:function(){return this}})}(e)}};Wr("Map",function(e){return function(t){return e(this,arguments.length?t:void 0)}},ti,!0),At.Map;gt({target:"Map",stat:!0},{from:Kr});function ei(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}gt({target:"Map",stat:!0},{of:ei});function ni(){for(var t,e=S(this),n=bt(e.delete),r=!0,i=0,o=arguments.length;i<o;i++)t=n.call(e,arguments[i]),r=r&&t;return!!r}gt({target:"Map",proto:!0,real:!0,forced:Y},{deleteAll:function(){return ni.apply(this,arguments)}});function ri(t){return Map.prototype.entries.call(t)}gt({target:"Map",proto:!0,real:!0,forced:Y},{every:function(t,e){var n=S(this),r=ri(n),i=wt(t,1<arguments.length?e:void 0,3);return!zr(r,function(t,e){if(!i(e,t,n))return zr.stop()},void 0,!0,!0).stopped}});function ii(t,e){var n,r=S(t).constructor;return void 0===r||null==(n=S(r)[oi])?e:bt(n)}var oi=Et("species");gt({target:"Map",proto:!0,real:!0,forced:Y},{filter:function(t,e){var n=S(this),r=ri(n),i=wt(t,1<arguments.length?e:void 0,3),o=new(ii(n,lt("Map"))),a=bt(o.set);return zr(r,function(t,e){i(e,t,n)&&a.call(o,t,e)},void 0,!0,!0),o}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{find:function(t,e){var n=S(this),r=ri(n),i=wt(t,1<arguments.length?e:void 0,3);return zr(r,function(t,e){if(i(e,t,n))return zr.stop(e)},void 0,!0,!0).result}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{findKey:function(t,e){var n=S(this),r=ri(n),i=wt(t,1<arguments.length?e:void 0,3);return zr(r,function(t,e){if(i(e,t,n))return zr.stop(t)},void 0,!0,!0).result}}),gt({target:"Map",stat:!0},{groupBy:function(t,n){var r=new this;bt(n);var i=bt(r.has),o=bt(r.get),a=bt(r.set);return zr(t,function(t){var e=n(t);i.call(r,e)?o.call(r,e).push(t):a.call(r,e,[t])}),r}});gt({target:"Map",proto:!0,real:!0,forced:Y},{includes:function(n){return zr(ri(S(this)),function(t,e){if(function(t,e){return t===e||t!=t&&e!=e}(e,n))return zr.stop()},void 0,!0,!0).stopped}}),gt({target:"Map",stat:!0},{keyBy:function(t,e){var n=new this;bt(e);var r=bt(n.set);return zr(t,function(t){r.call(n,e(t),t)}),n}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{keyOf:function(n){return zr(ri(S(this)),function(t,e){if(e===n)return zr.stop(t)},void 0,!0,!0).result}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{mapKeys:function(t,e){var n=S(this),r=ri(n),i=wt(t,1<arguments.length?e:void 0,3),o=new(ii(n,lt("Map"))),a=bt(o.set);return zr(r,function(t,e){a.call(o,i(e,t,n),e)},void 0,!0,!0),o}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{mapValues:function(t,e){var n=S(this),r=ri(n),i=wt(t,1<arguments.length?e:void 0,3),o=new(ii(n,lt("Map"))),a=bt(o.set);return zr(r,function(t,e){a.call(o,t,i(e,t,n))},void 0,!0,!0),o}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{merge:function(t){for(var e=S(this),n=bt(e.set),r=0;r<arguments.length;)zr(arguments[r++],n,e,!0);return e}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{reduce:function(n,t){var r,e,i=S(this),o=ri(i);if(bt(n),1<arguments.length)r=t;else{if((e=o.next()).done)throw TypeError("Reduce of empty map with no initial value");r=e.value[1]}return zr(o,function(t,e){r=n(r,e,t,i)},void 0,!0,!0),r}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{some:function(t,e){var n=S(this),r=ri(n),i=wt(t,1<arguments.length?e:void 0,3);return zr(r,function(t,e){if(i(e,t,n))return zr.stop()},void 0,!0,!0).stopped}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{update:function(t,e,n){var r=S(this),i=arguments.length;bt(e);var o=r.has(t);if(!o&&i<3)throw TypeError("Updating absent value");var a=o?r.get(t):bt(2<i?n:void 0)(t,r);return r.set(t,e(a,t,r)),r}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{updateOrInsert:function(t,e,n){var r=S(this);bt(e),bt(n);var i=r.has(t)?e(r.get(t)):n();return r.set(t,i),i}});Wr("Set",function(e){return function(t){return e(this,arguments.length?t:void 0)}},ti),At.Set;gt({target:"Set",stat:!0},{from:Kr}),gt({target:"Set",stat:!0},{of:ei});gt({target:"Set",proto:!0,real:!0,forced:Y},{addAll:function(){return function(){for(var t=S(this),e=bt(t.add),n=0,r=arguments.length;n<r;n++)e.call(t,arguments[n]);return t}.apply(this,arguments)}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{deleteAll:function(){return ni.apply(this,arguments)}});function ai(t){return Set.prototype.values.call(t)}gt({target:"Set",proto:!0,real:!0,forced:Y},{every:function(t,e){var n=S(this),r=ai(n),i=wt(t,1<arguments.length?e:void 0,3);return!zr(r,function(t){if(!i(t,t,n))return zr.stop()},void 0,!1,!0).stopped}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{difference:function(t){var e=S(this),n=new(ii(e,lt("Set")))(e),r=bt(n.delete);return zr(t,function(t){r.call(n,t)}),n}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{filter:function(t,e){var n=S(this),r=ai(n),i=wt(t,1<arguments.length?e:void 0,3),o=new(ii(n,lt("Set"))),a=bt(o.add);return zr(r,function(t){i(t,t,n)&&a.call(o,t)},void 0,!1,!0),o}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{find:function(t,e){var n=S(this),r=ai(n),i=wt(t,1<arguments.length?e:void 0,3);return zr(r,function(t){if(i(t,t,n))return zr.stop(t)},void 0,!1,!0).result}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{intersection:function(t){var e=S(this),n=new(ii(e,lt("Set"))),r=bt(e.has),i=bt(n.add);return zr(t,function(t){r.call(e,t)&&i.call(n,t)}),n}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{isDisjointFrom:function(t){var e=S(this),n=bt(e.has);return!zr(t,function(t){if(!0===n.call(e,t))return zr.stop()}).stopped}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{isSubsetOf:function(t){var e=function(t){var e=$e(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return S(e.call(t))}(this),n=S(t),r=n.has;return"function"!=typeof r&&(n=new(lt("Set"))(t),r=bt(n.has)),!zr(e,function(t){if(!1===r.call(n,t))return zr.stop()},void 0,!1,!0).stopped}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{isSupersetOf:function(t){var e=S(this),n=bt(e.has);return!zr(t,function(t){if(!1===n.call(e,t))return zr.stop()}).stopped}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{join:function(t){var e=S(this),n=ai(e),r=void 0===t?",":String(t),i=[];return zr(n,i.push,i,!1,!0),i.join(r)}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{map:function(t,e){var n=S(this),r=ai(n),i=wt(t,1<arguments.length?e:void 0,3),o=new(ii(n,lt("Set"))),a=bt(o.add);return zr(r,function(t){a.call(o,i(t,t,n))},void 0,!1,!0),o}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{reduce:function(e,t){var n,r,i=S(this),o=ai(i);if(bt(e),1<arguments.length)n=t;else{if((r=o.next()).done)throw TypeError("Reduce of empty set with no initial value");n=r.value}return zr(o,function(t){n=e(n,t,t,i)},void 0,!1,!0),n}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{some:function(t,e){var n=S(this),r=ai(n),i=wt(t,1<arguments.length?e:void 0,3);return zr(r,function(t){if(i(t,t,n))return zr.stop()},void 0,!1,!0).stopped}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{symmetricDifference:function(t){var e=S(this),n=new(ii(e,lt("Set")))(e),r=bt(n.delete),i=bt(n.add);return zr(t,function(t){r.call(n,t)||i.call(n,t)}),n}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{union:function(t){var e=S(this),n=new(ii(e,lt("Set")))(e);return zr(t,bt(n.add),n),n}});var si=function(t,e){return(si=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function ui(t,e){function n(){this.constructor=t}si(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var ci=function(){return(ci=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function hi(o,a,s,u){return new(s=s||Promise)(function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})}function li(n,r){var i,o,a,t,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&e[0]?o.return:e[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,e[1])).done)return a;switch(o=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=r.call(n,s)}catch(t){e=[6,t],o=0}finally{i=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function fi(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function pi(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function di(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(pi(arguments[e]));return t}function yi(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}function mi(t){try{return wi.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}var vi={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},gi=function(t,e){if(!t)throw bi(e)},bi=function(t){return new Error("Firebase Database ("+vi.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},wi={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|s>>4,f=(15&s)<<2|c>>6,p=63&c;u||(p=64,a||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(yi(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(191<i&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(239<i&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();var c=o<<2|a>>4;if(r.push(c),64!==s){var h=a<<4&240|s>>2;if(r.push(h),64!==u){var l=s<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function _i(t){return Ei(void 0,t)}function Ei(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=Ei(t[n],e[n]));return t}var Ti=(Si.prototype.wrapCallback=function(n){var r=this;return function(t,e){t?r.reject(t):r.resolve(e),"function"==typeof n&&(r.promise.catch(function(){}),1===n.length?n(t):n(t,e))}},Si);function Si(){var n=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}function Ii(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Ci(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ii())}function Ni(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Ai(){return!0===vi.NODE_ADMIN}var ki,Di=(ui(Ri,ki=Error),Ri);function Ri(t,e){var n=ki.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,Ri.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,Oi.prototype.create),n}var Oi=(Pi.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,r){return t.replace(Mi,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})}(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new Di(i,s),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},Pi);function Pi(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var Mi=/\{\$([^}]+)}/g;function xi(t){return JSON.parse(t)}function Li(t){return JSON.stringify(t)}function Fi(t){var e={},n={},r={},i="";try{var o=t.split(".");e=xi(mi(o[0])||""),n=xi(mi(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}}function Ui(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function qi(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function Vi(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Bi(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}var ji=(Wi.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},Wi.prototype.compress_=function(t,e){e=e||0;var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)a=r<40?r<20?(o=h^u&(c^h),1518500249):(o=u^c^h,1859775393):r<60?(o=u&c|h&(u|c),2400959708):(o=u^c^h,3395469782),i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i;this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},Wi.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},Wi.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},Wi);function Wi(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}function Qi(t,e){var n=new Ki(t,e);return n.subscribe.bind(n)}var Ki=(Hi.prototype.next=function(e){this.forEachObserver(function(t){t.next(e)})},Hi.prototype.error=function(e){this.forEachObserver(function(t){t.error(e)}),this.close(e)},Hi.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},Hi.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=Gi),void 0===r.error&&(r.error=Gi),void 0===r.complete&&(r.complete=Gi);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},Hi.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},Hi.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},Hi.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},Hi.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},Hi);function Hi(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}function Gi(){}function zi(t,e,n,r){var i;if(r<e?i="at least "+e:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")}function Yi(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=t+" failed: ";return i+=r+" argument "}function Xi(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Yi(t,e,r)+"must be a valid function.")}function Ji(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Yi(t,e,r)+"must be a valid context object.")}function $i(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:55296<=r&&r<=56319?(e+=4,n++):e+=3}return e}var Zi,to;(to=Zi=Zi||{})[to.DEBUG=0]="DEBUG",to[to.VERBOSE=1]="VERBOSE",to[to.INFO=2]="INFO",to[to.WARN=3]="WARN",to[to.ERROR=4]="ERROR",to[to.SILENT=5]="SILENT";function eo(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case Zi.DEBUG:case Zi.VERBOSE:console.log.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Zi.INFO:console.info.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Zi.WARN:console.warn.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Zi.ERROR:console.error.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}var no,ro=Zi.INFO,io=(Object.defineProperty(oo.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in Zi))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(oo.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),oo.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Zi.DEBUG].concat(t))},oo.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Zi.VERBOSE].concat(t))},oo.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Zi.INFO].concat(t))},oo.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Zi.WARN].concat(t))},oo.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Zi.ERROR].concat(t))},oo);function oo(t){this.name=t,this._logLevel=ro,this._logHandler=eo}var ao=((no={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",no["bad-app-name"]="Illegal App name: '{$appName}",no["duplicate-app"]="Firebase App named '{$appName}' already exists",no["app-deleted"]="Firebase App named '{$appName}' already deleted",no["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",no),so=new Oi("app","Firebase",ao),uo="[DEFAULT]",co=[],ho=(Object.defineProperty(lo.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(lo.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(lo.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),lo.prototype.delete=function(){var s=this;return new Promise(function(t){s.checkDestroyed_(),t()}).then(function(){s.firebase_.INTERNAL.removeApp(s.name_);for(var t=[],e=0,n=Object.keys(s.services_);e<n.length;e++)for(var r=n[e],i=0,o=Object.keys(s.services_[r]);i<o.length;i++){var a=o[i];t.push(s.services_[r][a])}return Promise.all(t.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))}).then(function(){s.isDeleted_=!0,s.services_={}})},lo.prototype._getService=function(t,e){if(void 0===e&&(e=uo),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==uo?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},lo.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=uo),this.services_[t]&&this.services_[t][e]&&delete this.services_[t][e]},lo.prototype.extendApp=function(t){var e=this;Ei(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(co.forEach(function(t){e.INTERNAL.addAuthTokenListener(t)}),co=[])},lo.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw so.create("app-deleted",{appName:this.name_})},lo);function lo(t,e,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=_i(t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){co.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(e){co=co.filter(function(t){return t!==e})}}}ho.prototype.name&&ho.prototype.options||ho.prototype.delete||console.log("dc");var fo="6.6.1",po=new io("@firebase/app");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){po.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var yo=self.firebase.SDK_VERSION;yo&&0<=yo.indexOf("LITE")&&po.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var mo=function t(){var e=function(a){var o={},s={},u={},c={__esModule:!0,initializeApp:function(t,e){void 0===e&&(e={}),"object"==typeof e&&null!==e||(e={name:e});var n=e;void 0===n.name&&(n.name=uo);var r=n.name;if("string"!=typeof r||!r)throw so.create("bad-app-name",{appName:String(r)});if(Ui(o,r))throw so.create("duplicate-app",{appName:r});var i=new a(t,n,c);return f(o[r]=i,"create"),i},app:h,apps:null,SDK_VERSION:fo,INTERNAL:{registerService:function(n,t,e,r,i){if(void 0===i&&(i=!1),s[n])return po.debug("There were multiple attempts to register service "+n+"."),c[n];function o(t){if(void 0===t&&(t=h()),"function"!=typeof t[n])throw so.create("invalid-app-argument",{appName:n});return t[n]()}return s[n]=t,r&&(u[n]=r,l().forEach(function(t){r("create",t)})),void 0!==e&&Ei(o,e),c[n]=o,a.prototype[n]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._getService.bind(this,n).apply(this,i?t:[])},o},removeApp:function(t){f(o[t],"delete"),delete o[t]},factories:s,useAsService:p}};function h(t){if(!Ui(o,t=t||uo))throw so.create("no-app",{appName:t});return o[t]}function l(){return Object.keys(o).map(function(t){return o[t]})}function f(t,e){for(var n=0,r=Object.keys(s);n<r.length;n++){var i=p(0,r[n]);if(null===i)return;u[i]&&u[i](e,t)}}function p(t,e){return"serverAuth"===e?null:e}return c.default=c,Object.defineProperty(c,"apps",{get:l}),h.App=a,c}(ho);return e.INTERNAL=ci({},e.INTERNAL,{createFirebaseNamespace:t,extendNamespace:function(t){Ei(e,t)},createSubscribe:Qi,ErrorFactory:Oi,deepExtend:Ei}),e}(),vo=mo.initializeApp;mo.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&po.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),vo.apply(void 0,t)};var fl=mo;(function(){var t,o="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},a="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function c(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:function(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}(t)}}!function(t,e){if(e){var n=a;t=t.split(".");for(var r=0;r<t.length-1;r++){var i=t[r];i in n||(n[i]={}),n=n[i]}(e=e(r=n[t=t[t.length-1]]))!=r&&null!=e&&o(n,t,{configurable:!0,writable:!0,value:e})}}("Promise",function(t){function s(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function e(){this.a=null}function u(e){return e instanceof s?e:new s(function(t){t(e)})}if(t)return t;e.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c(function(){e.g()})}this.a.push(t)};var n=a.setTimeout;e.prototype.c=function(t){n(t,0)},e.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},e.prototype.f=function(t){this.c(function(){throw t})},s.prototype.f=function(){function t(e){return function(t){r||(r=!0,e.call(n,t))}}var n=this,r=!1;return{resolve:t(this.m),reject:t(this.g)}},s.prototype.m=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof s)this.o(t);else{t:switch(typeof t){case"object":var e=null!=t;break t;case"function":e=!0;break t;default:e=!1}e?this.u(t):this.h(t)}},s.prototype.u=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.v(e,t):this.h(t)},s.prototype.g=function(t){this.i(2,t)},s.prototype.h=function(t){this.i(1,t)},s.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.l()},s.prototype.l=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)i.b(this.a[t]);this.a=null}};var i=new e;return s.prototype.o=function(t){var e=this.f();t.Ja(e.resolve,e.reject)},s.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},s.prototype.then=function(t,e){function n(e,t){return"function"==typeof e?function(t){try{r(e(t))}catch(t){i(t)}}:t}var r,i,o=new s(function(t,e){r=t,i=e});return this.Ja(n(t,r),n(e,i)),o},s.prototype.catch=function(t){return this.then(void 0,t)},s.prototype.Ja=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?i.b(n):this.a.push(n)},s.resolve=u,s.reject=function(n){return new s(function(t,e){e(n)})},s.race=function(i){return new s(function(t,e){for(var n=c(i),r=n.next();!r.done;r=n.next())u(r.value).Ja(t,e)})},s.all=function(t){var o=c(t),a=o.next();return a.done?u([]):new s(function(n,t){function e(e){return function(t){r[e]=t,0==--i&&n(r)}}for(var r=[],i=0;r.push(void 0),i++,u(a.value).Ja(e(r.length-1),t),!(a=o.next()).done;);})},s});var u=u||{},l=this||self;function h(t){return"string"==typeof t}function n(t){return"boolean"==typeof t}var s=/^[\w+/_-]+[=]{0,2}$/,f=null;function p(){}function r(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function i(t){return null===t}function d(t){return"array"==r(t)}function y(t){var e=r(t);return"array"==e||"object"==e&&"number"==typeof t.length}function m(t){return"function"==r(t)}function v(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var e="closure_uid_"+(1e9*Math.random()>>>0),g=0;function b(t,e,n){return t.call.apply(t.bind,arguments)}function w(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function _(t,e,n){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?b:w).apply(null,arguments)}function E(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var T=Date.now||function(){return+new Date};function S(t,o){function e(){}e.prototype=o.prototype,t.qb=o.prototype,t.prototype=new e,(t.prototype.constructor=t).fd=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function I(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function C(t){if(Error.captureStackTrace)Error.captureStackTrace(this,C);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function N(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");C.call(this,n+t[r])}function A(t,e){throw new N("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function k(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function D(t,e){t.f(e),t.b<100&&(t.b++,e.next=t.a,t.a=e)}function R(){this.b=this.a=null}S(C,Error),C.prototype.name="CustomError",S(N,C),N.prototype.name="AssertionError",k.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var O=new k(function(){return new P},function(t){t.reset()});function P(){this.next=this.b=this.a=null}function M(t,e){t:{try{var n=t&&t.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||l).Element&&r.Location){var i=r;break t}}catch(t){}i=null}if(i&&void 0!==i[e]&&(!t||!(t instanceof i[e])&&(t instanceof i.Location||t instanceof i.Element))){if(v(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(t){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;A("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}R.prototype.add=function(t,e){var n=O.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},P.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},P.prototype.reset=function(){this.next=this.b=this.a=null};var x=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(h(t))return h(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},L=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=h(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};var F=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=h(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},U=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=h(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function q(t,e){return 0<=x(t,e)}function V(t,e){var n;return(n=0<=(e=x(t,e)))&&Array.prototype.splice.call(t,e,1),n}function B(n,r){!function(t,e){for(var n=h(t)?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(n,function(t,e){r.call(void 0,t,e,n)&&1==Array.prototype.splice.call(n,e,1).length&&0})}function j(t){return Array.prototype.concat.apply([],arguments)}function W(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Q(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function K(t){for(var e in t)return!1;return!0}function H(t){var e,n={};for(e in t)n[e]=t[e];return n}var G="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function z(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<G.length;o++)n=G[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Y(t,e){this.a=t===$&&e||"",this.b=J}function X(t){return t instanceof Y&&t.constructor===Y&&t.b===J?t.a:(A("expected object of type Const, got '"+t+"'"),"type_error:Const")}Y.prototype.qa=!0,Y.prototype.pa=function(){return this.a},Y.prototype.toString=function(){return"Const{"+this.a+"}"};var J={},$={},Z=new Y($,"");function tt(){this.a="",this.b=ot}function et(t){return t instanceof tt&&t.constructor===tt&&t.b===ot?t.a:(A("expected object of type TrustedResourceUrl, got '"+t+"' of type "+r(t)),"type_error:TrustedResourceUrl")}function nt(t,n){var r=X(t);if(!it.test(r))throw Error("Invalid TrustedResourceUrl format: "+r);return at(t=r.replace(rt,function(t,e){if(!Object.prototype.hasOwnProperty.call(n,e))throw Error('Found marker, "'+e+'", in format string, "'+r+'", but no valid label mapping found in args: '+JSON.stringify(n));return(t=n[e])instanceof Y?X(t):encodeURIComponent(String(t))}))}tt.prototype.qa=!0,tt.prototype.pa=function(){return this.a.toString()},tt.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var rt=/%{(\w+)}/g,it=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,ot={};function at(t){var e=new tt;return e.a=t,e}var st=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},ut=/&/g,ct=/</g,ht=/>/g,lt=/"/g,ft=/'/g,pt=/\x00/g,dt=/[\x00&<>"']/;function yt(t,e){return-1!=t.indexOf(e)}function mt(t,e){return t<e?-1:e<t?1:0}function vt(){this.a="",this.b=Et}function gt(t){return t instanceof vt&&t.constructor===vt&&t.b===Et?t.a:(A("expected object of type SafeUrl, got '"+t+"' of type "+r(t)),"type_error:SafeUrl")}vt.prototype.qa=!0,vt.prototype.pa=function(){return this.a.toString()},vt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var bt=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function wt(t){return t instanceof vt?t:(t="object"==typeof t&&t.qa?t.pa():String(t),bt.test(t)||(t="about:invalid#zClosurez"),Tt(t))}var _t,Et={};function Tt(t){var e=new vt;return e.a=t,e}Tt("about:blank");t:{var St=l.navigator;if(St){var It=St.userAgent;if(It){_t=It;break t}}_t=""}function Ct(t){return yt(_t,t)}function Nt(){this.a="",this.b=kt}function At(t){return t instanceof Nt&&t.constructor===Nt&&t.b===kt?t.a:(A("expected object of type SafeHtml, got '"+t+"' of type "+r(t)),"type_error:SafeHtml")}Nt.prototype.qa=!0,Nt.prototype.pa=function(){return this.a.toString()},Nt.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var kt={};function Dt(t){var e=new Nt;return e.a=t,e}Dt("<!DOCTYPE html>");var Rt,Ot,Pt=Dt("");function Mt(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function xt(t){return dt.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(ut,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(ct,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(ht,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(lt,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(ft,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(pt,"&#0;"))),t}function Lt(t){l.setTimeout(function(){throw t},0)}function Ft(){var t=l.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Ct("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",function(t){var e=at(X(Z));M(t,"HTMLIFrameElement"),t.src=et(e).toString()}(t),document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(At(Pt)),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=_(function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0===t||Ct("Trident")||Ct("MSIE"))return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){l.setTimeout(t,0)};var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).yb;n.yb=null,t()}},function(t){r.next={yb:t},r=r.next,e.port2.postMessage(0)}}function Ut(t,e){Ot||function(){if(l.Promise&&l.Promise.resolve){var t=l.Promise.resolve(void 0);Ot=function(){t.then(Bt)}}else Ot=function(){var t=Bt;!m(l.setImmediate)||l.Window&&l.Window.prototype&&!Ct("Edge")&&l.Window.prototype.setImmediate==l.setImmediate?(Rt=Rt||Ft())(t):l.setImmediate(t)}}(),qt||(Ot(),qt=!0),Vt.add(t,e)}Dt("<br>");var qt=!1,Vt=new R;function Bt(){for(var t;n=e=void 0,n=null,(e=Vt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){Lt(t)}D(O,t)}var e,n;qt=!1}function jt(t,e){if(this.a=Wt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=p)try{var n=this;t.call(e,function(t){ee(n,Qt,t)},function(t){if(!(t instanceof ue))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}ee(n,Kt,t)})}catch(t){ee(this,Kt,t)}}var Wt=0,Qt=2,Kt=3;function Ht(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Ht.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Gt=new k(function(){return new Ht},function(t){t.reset()});function zt(t,e,n){var r=Gt.get();return r.g=t,r.b=e,r.f=n,r}function Yt(t){if(t instanceof jt)return t;var e=new jt(p);return ee(e,Qt,t),e}function Xt(n){return new jt(function(t,e){e(n)})}function Jt(t,e,n){ne(t,e,n,null)||Ut(E(e,t))}function $t(n){return new jt(function(r){var i=n.length,o=[];if(i)for(var t=function(t,e,n){i--,o[t]=e?{Gb:!0,value:n}:{Gb:!1,reason:n},0==i&&r(o)},e=0;e<n.length;e++)Jt(n[e],E(t,e,!0),E(t,e,!1));else r(o)})}function Zt(t,e){t.b||t.a!=Qt&&t.a!=Kt||re(t),t.f?t.f.next=e:t.b=e,t.f=e}function te(t,i,o,a){var e=zt(null,null,null);return e.a=new jt(function(n,r){e.g=i?function(t){try{var e=i.call(a,t);n(e)}catch(t){r(t)}}:n,e.b=o?function(t){try{var e=o.call(a,t);void 0===e&&t instanceof ue?r(t):n(e)}catch(t){r(t)}}:r}),Zt(e.a.c=t,e),e.a}function ee(t,e,n){t.a==Wt&&(t===n&&(e=Kt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,ne(n,t.Oc,t.Pc,t)||(t.i=n,t.a=e,t.c=null,re(t),e!=Kt||n instanceof ue||function(t,e){t.g=!0,Ut(function(){t.g&&se.call(null,e)})}(t,n)))}function ne(t,e,n,r){if(t instanceof jt)return Zt(t,zt(e||p,n||null,r)),!0;if(I(t))return t.then(e,n,r),!0;if(v(t))try{var i=t.then;if(m(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function re(t){t.h||(t.h=!0,Ut(t.Zb,t))}function ie(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function oe(t,e,n,r){if(n==Kt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,ae(e,n,r);else try{e.c?e.g.call(e.f):ae(e,n,r)}catch(t){se.call(null,t)}D(Gt,e)}function ae(t,e,n){e==Qt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}jt.prototype.then=function(t,e,n){return te(this,m(t)?t:null,m(e)?e:null,n)},jt.prototype.$goog_Thenable=!0,(t=jt.prototype).ka=function(t,e){return(t=zt(t,t,e)).c=!0,Zt(this,t),this},t.s=function(t,e){return te(this,null,t,e)},t.cancel=function(t){this.a==Wt&&Ut(function(){!function t(e,n){if(e.a==Wt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==Wt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):ie(r),oe(r,o,Kt,n)))}e.c=null}else ee(e,Kt,n)}(this,new ue(t))},this)},t.Oc=function(t){this.a=Wt,ee(this,Qt,t)},t.Pc=function(t){this.a=Wt,ee(this,Kt,t)},t.Zb=function(){for(var t;t=ie(this);)oe(this,t,this.a,this.i);this.h=!1};var se=Lt;function ue(t){C.call(this,t)}function ce(){this.ta=this.ta,this.la=this.la}S(ue,C);var he=0;function le(t){if(!t.ta&&(t.ta=!0,t.xa(),0!=he))t[e]||(t[e]=++g)}function fe(t){return fe[" "](t),t}ce.prototype.ta=!(ue.prototype.name="cancel"),ce.prototype.xa=function(){if(this.la)for(;this.la.length;)this.la.shift()()},fe[" "]=p;var pe,de,ye=Ct("Opera"),me=Ct("Trident")||Ct("MSIE"),ve=Ct("Edge"),ge=ve||me,be=Ct("Gecko")&&!(yt(_t.toLowerCase(),"webkit")&&!Ct("Edge"))&&!(Ct("Trident")||Ct("MSIE"))&&!Ct("Edge"),we=yt(_t.toLowerCase(),"webkit")&&!Ct("Edge");function _e(){var t=l.document;return t?t.documentMode:void 0}t:{var Ee="",Te=(de=_t,be?/rv:([^\);]+)(\)|;)/.exec(de):ve?/Edge\/([\d\.]+)/.exec(de):me?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(de):we?/WebKit\/(\S+)/.exec(de):ye?/(?:Version)[ \/]?(\S+)/.exec(de):void 0);if(Te&&(Ee=Te?Te[1]:""),me){var Se=_e();if(null!=Se&&Se>parseFloat(Ee)){pe=String(Se);break t}}pe=Ee}var Ie,Ce={};function Ne(s){return function(t,e){var n=Ce;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(s,function(){for(var t=0,e=st(String(pe)).split("."),n=st(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=mt(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||mt(0==o[2].length,0==a[2].length)||mt(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t})}Ie=l.document&&me?_e():void 0;var Ae=Object.freeze||function(t){return t},ke=!me||9<=Number(Ie),De=me&&!Ne("9"),Re=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{l.addEventListener("test",p,e),l.removeEventListener("test",p,e)}catch(t){}return t}();function Oe(t,e){this.type=t,this.b=this.target=e,this.Mb=!0}function Pe(t,e){if(Oe.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(be){t:{try{fe(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=h(t.pointerType)?t.pointerType:Me[t.pointerType]||"",(this.a=t).defaultPrevented&&this.preventDefault()}}Oe.prototype.preventDefault=function(){this.Mb=!1},S(Pe,Oe);var Me=Ae({2:"touch",3:"pen",4:"mouse"});Pe.prototype.preventDefault=function(){Pe.qb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,De)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}},Pe.prototype.f=function(){return this.a};var xe="closure_listenable_"+(1e6*Math.random()|0),Le=0;function Fe(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Na=i,this.key=++Le,this.ra=this.Ia=!1}function Ue(t){t.ra=!0,t.listener=null,t.proxy=null,t.src=null,t.Na=null}function qe(t){this.src=t,this.a={},this.b=0}function Ve(t,e){var n=e.type;n in t.a&&V(t.a[n],e)&&(Ue(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function Be(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ra&&o.listener==e&&o.capture==!!n&&o.Na==r)return i}return-1}qe.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Be(t,e,r,i);return-1<a?(e=t[a],n||(e.Ia=!1)):((e=new Fe(e,this.src,o,!!r,i)).Ia=n,t.push(e)),e};var je="closure_lm_"+(1e6*Math.random()|0),We={};function Qe(t,e,n,r,i){if(r&&r.once)He(t,e,n,r,i);else if(d(e))for(var o=0;o<e.length;o++)Qe(t,e[o],n,r,i);else n=en(n),t&&t[xe]?rn(t,e,n,v(r)?!!r.capture:!!r,i):Ke(t,e,n,!1,r,i)}function Ke(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=v(i)?!!i.capture:!!i,s=Ze(t);if(s||(t[je]=s=new qe(t)),!(n=s.add(e,n,r,a,o)).proxy)if(r=function(){var e=$e,n=ke?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)Re||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ye(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function He(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)He(t,e[o],n,r,i);else n=en(n),t&&t[xe]?on(t,e,n,v(r)?!!r.capture:!!r,i):Ke(t,e,n,!0,r,i)}function Ge(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)Ge(t,e[o],n,r,i);else r=v(r)?!!r.capture:!!r,n=en(n),t&&t[xe]?(t=t.u,(e=String(e).toString())in t.a&&(-1<(n=Be(o=t.a[e],n,r,i))&&(Ue(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):(t=t&&Ze(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Be(e,n,r,i)),(n=-1<t?e[t]:null)&&ze(n))}function ze(t){if("number"!=typeof t&&t&&!t.ra){var e=t.src;if(e&&e[xe])Ve(e.u,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ye(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ze(e))?(Ve(n,t),0==n.b&&(n.src=null,e[je]=null)):Ue(t)}}}function Ye(t){return t in We?We[t]:We[t]="on"+t}function Xe(t,e,n,r){var i=!0;if((t=Ze(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.ra&&(o=Je(o,r),i=i&&!1!==o)}return i}function Je(t,e){var n=t.listener,r=t.Na||t.src;return t.Ia&&ze(t),n.call(r,e)}function $e(t,e){if(t.ra)return!0;if(ke)return Je(t,new Pe(e,this));if(!e)t:{e=["window","event"];for(var n=l,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new Pe(r=e,this),n=!0,!(r.keyCode<0||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}!i&&null!=r.returnValue||(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=Xe(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=Xe(r[i],t,!1,e),n=n&&o}return n}function Ze(t){return(t=t[je])instanceof qe?t:null}var tn="__closure_events_fn_"+(1e9*Math.random()>>>0);function en(e){return m(e)?e:(e[tn]||(e[tn]=function(t){return e.handleEvent(t)}),e[tn])}function nn(){ce.call(this),this.u=new qe(this),(this.Sb=this).Wa=null}function rn(t,e,n,r,i){t.u.add(String(e),n,!1,r,i)}function on(t,e,n,r,i){t.u.add(String(e),n,!0,r,i)}function an(t,e,n,r){if(!(e=t.u.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.ra&&a.capture==n){var s=a.listener,u=a.Na||a.src;a.Ia&&Ve(t.u,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Mb}function sn(t,e,n){if(m(t))n&&(t=_(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=_(t.handleEvent,t)}return 2147483647<Number(e)?-1:l.setTimeout(t,e||0)}function un(n){var r=null;return new jt(function(t,e){-1==(r=sn(function(){t(void 0)},n))&&e(Error("Failed to schedule timer."))}).s(function(t){throw l.clearTimeout(r),t})}function cn(t){if(t.U&&"function"==typeof t.U)return t.U();if(h(t))return t.split("");if(y(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function hn(t){if(t.X&&"function"==typeof t.X)return t.X();if(!t.U||"function"!=typeof t.U){if(y(t)||h(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function ln(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ln)for(n=t.X(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function fn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];pn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)pn(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function pn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}S(nn,ce),nn.prototype[xe]=!0,nn.prototype.addEventListener=function(t,e,n,r){Qe(this,t,e,n,r)},nn.prototype.removeEventListener=function(t,e,n,r){Ge(this,t,e,n,r)},nn.prototype.dispatchEvent=function(t){var e,n=this.Wa;if(n)for(e=[];n;n=n.Wa)e.push(n);n=this.Sb;var r=t.type||t;if(h(t))t=new Oe(t,n);else if(t instanceof Oe)t.target=t.target||n;else{var i=t;z(t=new Oe(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];i=an(a,r,!0,t)&&i}if(i=an(a=t.b=n,r,!0,t)&&i,i=an(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=an(a=t.b=e[o],r,!1,t)&&i;return i},nn.prototype.xa=function(){if(nn.qb.xa.call(this),this.u){var t,e=this.u;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Ue(n[r]);delete e.a[t],e.b--}}this.Wa=null},(t=ln.prototype).U=function(){fn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.X=function(){return fn(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return pn(this.b,t)?this.b[t]:e},t.set=function(t,e){pn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.X(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var dn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function yn(t,e){var n;this.b=this.i=this.f="",this.l=null,this.g=this.c="",this.h=!1,t instanceof yn?(this.h=void 0!==e?e:t.h,mn(this,t.f),this.i=t.i,this.b=t.b,vn(this,t.l),this.c=t.c,gn(this,Fn(t.a)),this.g=t.g):t&&(n=String(t).match(dn))?(this.h=!!e,mn(this,n[1]||"",!0),this.i=Tn(n[2]||""),this.b=Tn(n[3]||"",!0),vn(this,n[4]),this.c=Tn(n[5]||"",!0),gn(this,n[6]||"",!0),this.g=Tn(n[7]||"")):(this.h=!!e,this.a=new Rn(null,this.h))}function mn(t,e,n){t.f=n?Tn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function vn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.l=e}else t.l=null}function gn(t,e,n){e instanceof Rn?(t.a=e,function(t,e){e&&!t.f&&(On(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Mn(this,e),Ln(this,n,t))},t)),t.f=e}(t.a,t.h)):(n||(e=Sn(e,kn)),t.a=new Rn(e,t.h))}function bn(t,e,n){t.a.set(e,n)}function wn(t,e){return t.a.get(e)}function _n(t){return t instanceof yn?new yn(t):new yn(t,void 0)}function En(t,e){var n=new yn(null,void 0);return mn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function Tn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Sn(t,e,n){return h(t)?(t=encodeURI(t).replace(e,In),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function In(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}yn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Sn(e,Cn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.i)&&t.push(Sn(e,Cn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.l)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Sn(n,"/"==n.charAt(0)?An:Nn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Sn(n,Dn)),t.join("")},yn.prototype.resolve=function(t){var e=new yn(this),n=!!t.f;n?mn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.l;var r=t.c;if(n)vn(e,t.l);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(yt(i,"./")||yt(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?gn(e,Fn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var Cn=/[#\/\?@]/g,Nn=/[#\?:]/g,An=/[#\?]/g,kn=/[#\?@]/g,Dn=/#/g;function Rn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function On(n){n.a||(n.a=new ln,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function Pn(t){var e=hn(t);if(void 0===e)throw Error("Keys are undefined");var n=new Rn(null,void 0);t=cn(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];d(o)?Ln(n,i,o):n.add(i,o)}return n}function Mn(t,e){On(t),e=Un(t,e),pn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,pn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&fn(t)))}function xn(t,e){return On(t),e=Un(t,e),pn(t.a.b,e)}function Ln(t,e,n){Mn(t,e),0<n.length&&(t.c=null,t.a.set(Un(t,e),W(n)),t.b+=n.length)}function Fn(t){var e=new Rn;return e.c=t.c,t.a&&(e.a=new ln(t.a),e.b=t.b),e}function Un(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=Rn.prototype).add=function(t,e){On(this),this.c=null,t=Un(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(n,r){On(this),this.a.forEach(function(t,e){L(t,function(t){n.call(r,t,e,this)},this)},this)},t.X=function(){On(this);for(var t=this.a.U(),e=this.a.X(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.U=function(t){On(this);var e=[];if(h(t))xn(this,t)&&(e=j(e,this.a.get(Un(this,t))));else{t=this.a.U();for(var n=0;n<t.length;n++)e=j(e,t[n])}return e},t.set=function(t,e){return On(this),this.c=null,xn(this,t=Un(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.U(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.X(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.U(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var qn=!me||9<=Number(Ie);function Vn(t){var e=document;return h(t)?e.getElementById(t):t}function Bn(n,t){Q(t,function(t,e){t&&"object"==typeof t&&t.qa&&(t=t.pa()),"style"==e?n.style.cssText=t:"class"==e?n.className=t:"for"==e?n.htmlFor=t:jn.hasOwnProperty(e)?n.setAttribute(jn[e],t):0==e.lastIndexOf("aria-",0)||0==e.lastIndexOf("data-",0)?n.setAttribute(e,t):n[e]=t})}var jn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Wn(t,e,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!qn&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',xt(a.name),'"'),a.type){o.push(' type="',xt(a.type),'"');var s={};z(s,a),delete s.type,a=s}o.push(">"),o=o.join("")}return o=i.createElement(o),a&&(h(a)?o.className=a:d(a)?o.className=a.join(" "):Bn(o,a)),2<r.length&&function(e,n,t){function r(t){t&&n.appendChild(h(t)?e.createTextNode(t):t)}for(var i=2;i<t.length;i++){var o=t[i];!y(o)||v(o)&&0<o.nodeType?r(o):L(Qn(o)?W(o):o,r)}}(i,o,r),o}function Qn(t){if(t&&"number"==typeof t.length){if(v(t))return"function"==typeof t.item||"string"==typeof t.item;if(m(t))return"function"==typeof t.item}return!1}function Kn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(d(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&("function"!=typeof(a=n[i])&&(r.push(o),Yn(i,r),r.push(":"),t(e,a,r),o=","));return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":Yn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Hn,t,e),e.join("")}function Hn(){}var Gn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},zn=/\uffff/.test("￿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function Yn(t,e){e.push('"',t.replace(zn,function(t){var e=Gn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Gn[t]=e),e}),'"')}function Xn(){var t=yr();return me&&!!Ie&&11==Ie||/Edge\/\d+/.test(t)}function Jn(){return l.window&&l.window.location.href||self&&self.location&&self.location.href||""}function $n(t,e){e=e||l.window;var n="about:blank";t&&(n=gt(wt(t)).toString()),e.location.href=n}function Zn(t){return!!((t=(t||yr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function tr(t){t=t||l.window;try{t.close()}catch(t){}}function er(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=yr().toLowerCase(),r&&(e.target=r,yt(n,"crios/")&&(e.target="_blank")),fr(yr())==hr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof vt?n:wt(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((Ct("iPhone")&&!Ct("iPod")&&!Ct("iPad")||Ct("iPad")||Ct("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(M(a=r.document.createElement("A"),"HTMLAnchorElement"),e instanceof vt||e instanceof vt||(e="object"==typeof e&&e.qa?e.pa():String(e),bt.test(e)||(e="about:invalid#zClosurez"),e=Tt(e)),a.href=gt(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=gt(e).toString(),a&&(ge&&yt(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=Dt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+xt(t)+'">'),a.document.write(At(t)),a.document.close())):(a=r.open(gt(e).toString(),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var nr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,rr=/^[^@]+@[^@]+$/;function ir(){var e=null;return new jt(function(t){"complete"==l.document.readyState?t():(e=function(){t()},He(window,"load",e))}).s(function(t){throw Ge(window,"load",e),t})}function or(t){return t=t||yr(),!("file:"!==wr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function ar(){var t=l.window;try{return!(!t||t==t.top)}catch(t){return!1}}function sr(){return void 0!==l.WorkerGlobalScope&&"function"==typeof l.importScripts}function ur(){return fl.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":fl.INTERNAL.hasOwnProperty("node")?"Node":sr()?"Worker":"Browser"}function cr(){var t=ur();return"ReactNative"===t||"Node"===t}var hr="Firefox",lr="Chrome";function fr(t){var e=t.toLowerCase();return yt(e,"opera/")||yt(e,"opr/")||yt(e,"opios/")?"Opera":yt(e,"iemobile")?"IEMobile":yt(e,"msie")||yt(e,"trident/")?"IE":yt(e,"edge/")?"Edge":yt(e,"firefox/")?hr:yt(e,"silk/")?"Silk":yt(e,"blackberry")?"Blackberry":yt(e,"webos")?"Webos":!yt(e,"safari/")||yt(e,"chrome/")||yt(e,"crios/")||yt(e,"android")?!yt(e,"chrome/")&&!yt(e,"crios/")||yt(e,"edge/")?yt(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":lr:"Safari"}var pr={Vc:"FirebaseCore-web",Xc:"FirebaseUI-web"};function dr(t,e){e=e||[];var n,r=[],i={};for(n in pr)i[pr[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=ur())?r=fr(i=yr()):"Worker"===r&&(r=fr(i=yr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function yr(){return l.navigator&&l.navigator.userAgent||""}function mr(t,e){t=t.split("."),e=e||l;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function vr(){try{var t=l.localStorage,e=Ir();if(t)return t.setItem(e,"1"),t.removeItem(e),!Xn()||!!l.indexedDB}catch(t){return sr()&&!!l.indexedDB}return!1}function gr(){return(br()||"chrome-extension:"===wr()||or())&&!cr()&&vr()&&!sr()}function br(){return"http:"===wr()||"https:"===wr()}function wr(){return l.location&&l.location.protocol||null}function _r(t){return!Zn(t=t||yr())&&fr(t)!=hr}function Er(t){return void 0===t?null:Kn(t)}function Tr(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function Sr(t){if(null!==t)return JSON.parse(t)}function Ir(t){return t||Math.floor(1e9*Math.random()).toString()}function Cr(t){return"Safari"!=fr(t=t||yr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function Nr(){var t=l.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Ar(t,e){if(e<t)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=yr(),e=ur(),this.b=Zn(t)||"ReactNative"===e}function kr(){var t=l.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Dr(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Rr(){return!(!mr("fireauth.oauthhelper",l)&&!mr("fireauth.iframe",l))}Ar.prototype.get=function(){var t=l.navigator;return!t||"boolean"!=typeof t.onLine||!br()&&"chrome-extension:"!==wr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Or,Pr={};function Mr(t){Pr[t]||(Pr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var xr={};Object.defineProperty(xr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(xr,"abcd",{configurable:!0,enumerable:!0,value:2}),Or=2==xr.abcd}catch(t){Or=!1}function Lr(t,e,n){Or?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Fr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Lr(t,n,e[n])}function Ur(t){var e={};return Fr(e,t),e}function qr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Lr(e,n,qr(t[n]));return e}function Vr(t){var e={},n=t[jr],r=t[Wr];if(!(t=t[Qr])||t!=Br&&!n)throw Error("Invalid provider user info!");e[Hr]=r||null,e[Kr]=n||null,Lr(this,zr,t),Lr(this,Gr,qr(e))}var Br="EMAIL_SIGNIN",jr="email",Wr="newEmail",Qr="requestType",Kr="email",Hr="fromEmail",Gr="data",zr="operation";function Yr(t,e){this.code=Jr+t,this.message=e||$r[t]||""}function Xr(t){var e=t&&t.code;return e?new Yr(e.substring(Jr.length),t.message):null}S(Yr,Error),Yr.prototype.A=function(){return{code:this.code,message:this.message}},Yr.prototype.toJSON=function(){return this.A()};var Jr="auth/",$r={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The OIDC ID token requires a valid unhashed nonce.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function Zr(t){var e=wn(t=_n(t),ti)||null,n=wn(t,ei)||null,r=wn(t,ii)||null;if(r=r&&ai[r]||null,!e||!n||!r)throw new Yr("argument-error",ti+", "+ei+"and "+ii+" are required in a valid action code URL.");Fr(this,{apiKey:e,operation:r,code:n,continueUrl:wn(t,ni)||null,languageCode:wn(t,ri)||null,tenantId:wn(t,oi)||null})}var ti="apiKey",ei="oobCode",ni="continueUrl",ri="languageCode",ii="mode",oi="tenantId",ai={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",signIn:Br,verifyEmail:"VERIFY_EMAIL"};function si(t){try{return new Zr(t)}catch(t){return null}}function ui(t){var e=t[pi];if(void 0===e)throw new Yr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new Yr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[ci];if(n&&"object"==typeof n){e=n[mi];var r=n[di];if(n=n[yi],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new Yr("argument-error",di+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new Yr("argument-error",yi+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new Yr("argument-error",mi+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new Yr("missing-android-pkg-name")}}else if(void 0!==n)throw new Yr("argument-error",ci+" property must be a non null object when specified.");if(this.f=null,(e=t[fi])&&"object"==typeof e){if("string"==typeof(e=e[vi])&&e.length)this.f=e;else if(void 0!==e)throw new Yr("argument-error",vi+" property must be a non empty string when specified.")}else if(void 0!==e)throw new Yr("argument-error",fi+" property must be a non null object when specified.");if(void 0!==(e=t[li])&&"boolean"!=typeof e)throw new Yr("argument-error",li+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[hi])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new Yr("argument-error",hi+" property must be a non empty string when specified.");this.i=t||null}var ci="android",hi="dynamicLinkDomain",li="handleCodeInApp",fi="iOS",pi="url",di="installApp",yi="minimumVersion",mi="packageName",vi="bundleId";function gi(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var bi=null,wi=null;function _i(t){var e="";return function(r,t){function e(t){for(;i<r.length;){var e=r.charAt(i++),n=wi[e];if(null!=n)return n;if(!/^[\s\xa0]*$/.test(e))throw Error("Unknown base64 encoding at char: "+e)}return t}!function(){if(!bi){bi={},wi={};for(var t=0;t<65;t++)bi[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),62<=(wi[bi[t]]=t)&&(wi["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var i=0;;){var n=e(-1),o=e(0),a=e(64),s=e(64);if(64===s&&-1===n)break;t(n<<2|o>>4),64!=a&&(t(o<<4&240|a>>2),64!=s&&t(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}function Ei(t){this.f=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.c=t.firebase&&t.firebase.tenant||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function Ti(t){return(t=Si(t))&&t.sub&&t.iss&&t.aud&&t.exp?new Ei(t):null}function Si(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(_i(t))}catch(t){}return null}Ei.prototype.R=function(){return this.c},Ei.prototype.g=function(){return this.b};var Ii,Ci={ad:{bb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://securetoken.googleapis.com/v1/token",id:"p"},cd:{bb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},dd:{bb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",ib:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function Ni(t){for(var e in Ci)if(Ci[e].id===t)return{firebaseEndpoint:(t=Ci[e]).bb,secureTokenEndpoint:t.ib};return null}Ii=Ni("__EID__")?"__EID__":void 0;var Ai="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),ki=["client_id","response_type","scope","redirect_uri","state"],Di={Wc:{Oa:"locale",Da:500,Ca:600,Pa:"facebook.com",hb:ki},Yc:{Oa:null,Da:500,Ca:620,Pa:"github.com",hb:ki},Zc:{Oa:"hl",Da:515,Ca:680,Pa:"google.com",hb:ki},ed:{Oa:"lang",Da:485,Ca:705,Pa:"twitter.com",hb:Ai}};function Ri(t){for(var e in Di)if(Di[e].Pa==t)return Di[e];return null}function Oi(t){var e={};e["facebook.com"]=Fi,e["google.com"]=qi,e["github.com"]=Ui,e["twitter.com"]=Vi;var n=t&&t[Mi];try{if(n)return e[n]?new e[n](t):new Li(t);if(void 0!==t[Pi])return new xi(t)}catch(t){}return null}var Pi="idToken",Mi="providerId";function xi(t){var e=t[Mi];if(!e&&t[Pi]){var n=Ti(t[Pi]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Lr(this,"providerId",e),Lr(this,"isNewUser",n)}function Li(t){xi.call(this,t),Lr(this,"profile",qr((t=Sr(t.rawUserInfo||"{}"))||{}))}function Fi(t){if(Li.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ui(t){if(Li.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Lr(this,"username",this.profile&&this.profile.login||null)}function qi(t){if(Li.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function Vi(t){if(Li.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Lr(this,"username",t.screenName||null)}function Bi(t){var e=_n(t),n=wn(e,"link"),r=wn(_n(n),"link");return wn(_n(e=wn(e,"deep_link_id")),"link")||e||r||n||t}function ji(){}function Wi(t,n){return t.then(function(t){if(t[Oa]){var e=Ti(t[Oa]);if(!e||n!=e.f)throw new Yr("user-mismatch");return t}throw new Yr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==Jr+"user-not-found"?new Yr("user-mismatch"):t})}function Qi(t,e){if(!e)throw new Yr("internal-error","failed to construct a credential");this.a=e,Lr(this,"providerId",t),Lr(this,"signInMethod",t)}function Ki(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Hi(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new Qi(t.providerId,t.pendingToken)}catch(t){}return null}function Gi(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Lr(this,"idToken",e.idToken),e.accessToken&&Lr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Lr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new Yr("internal-error","failed to construct a credential");Lr(this,"accessToken",e.oauthToken),Lr(this,"secret",e.oauthTokenSecret)}Lr(this,"providerId",t),Lr(this,"signInMethod",n)}function zi(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:Pn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Yi(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new Gi(t.providerId,e,t.signInMethod)}catch(t){}}return null}function Xi(t,e){this.Fc=e||[],Fr(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.cb=(Ri(t)||{}).Oa||null,this.ab=null}function Ji(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new Yr("argument-error",'SAML provider IDs must be prefixed with "saml."');Xi.call(this,t,[])}function $i(t){Xi.call(this,t,ki),this.a=[]}function Zi(){$i.call(this,"facebook.com")}function to(t){if(!t)throw new Yr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new Zi).credential({accessToken:e})}function eo(){$i.call(this,"github.com")}function no(t){if(!t)throw new Yr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new eo).credential({accessToken:e})}function ro(){$i.call(this,"google.com"),this.wa("profile")}function io(t,e){var n=t;return v(t)&&(n=t.idToken,e=t.accessToken),(new ro).credential({idToken:n,accessToken:e})}function oo(){Xi.call(this,"twitter.com",Ai)}function ao(t,e){var n=t;if(v(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new Yr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Gi("twitter.com",n,"twitter.com")}function so(t,e,n){this.a=t,this.c=e,Lr(this,"providerId","password"),Lr(this,"signInMethod",n===co.EMAIL_LINK_SIGN_IN_METHOD?co.EMAIL_LINK_SIGN_IN_METHOD:co.EMAIL_PASSWORD_SIGN_IN_METHOD)}function uo(t){return t&&t.email&&t.password?new so(t.email,t.password,t.signInMethod):null}function co(){Fr(this,{providerId:"password",isOAuthProvider:!1})}function ho(t,e){if(!(e=lo(e)))throw new Yr("argument-error","Invalid email link!");return new so(t,e.code,co.EMAIL_LINK_SIGN_IN_METHOD)}function lo(t){return(t=si(t=Bi(t)))&&t.operation===Br?t:null}function fo(t){if(!(t.Ua&&t.Ta||t.Fa&&t.ba))throw new Yr("internal-error");this.a=t,Lr(this,"providerId","phone"),Lr(this,"signInMethod","phone")}function po(e){if(e&&"phone"===e.providerId&&(e.verificationId&&e.verificationCode||e.temporaryProof&&e.phoneNumber)){var n={};return L(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(t){e[t]&&(n[t]=e[t])}),new fo(n)}return null}function yo(t){return t.a.Fa&&t.a.ba?{temporaryProof:t.a.Fa,phoneNumber:t.a.ba}:{sessionInfo:t.a.Ua,code:t.a.Ta}}function mo(t){try{this.a=t||fl.auth()}catch(t){throw new Yr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Fr(this,{providerId:"phone",isOAuthProvider:!1})}function vo(t,e){if(!t)throw new Yr("missing-verification-id");if(!e)throw new Yr("missing-verification-code");return new fo({Ua:t,Ta:e})}function go(t){if(t.temporaryProof&&t.phoneNumber)return new fo({Fa:t.temporaryProof,ba:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return io(o,n);case"facebook.com":return to(n);case"github.com":return no(n);case"twitter.com":return ao(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new Qi(e,a):new Gi(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new $i(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(t){return null}}function bo(t){if(!t.isOAuthProvider)throw new Yr("invalid-oauth-provider")}function wo(t,e,n,r,i,o,a){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.i=o||null,this.h=a||null,this.a=i||null,!this.g&&!this.a)throw new Yr("invalid-auth-event");if(this.g&&this.a)throw new Yr("invalid-auth-event");if(this.g&&!this.f)throw new Yr("invalid-auth-event")}function _o(t){return(t=t||{}).type?new wo(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Xr(t.error),t.postBody,t.tenantId):null}function Eo(){this.b=null,this.a=[]}S(Li,xi),S(Fi,Li),S(Ui,Li),S(qi,Li),S(Vi,Li),Qi.prototype.na=function(t){return Xa(t,Ki(this))},Qi.prototype.b=function(t,e){var n=Ki(this);return n.idToken=e,Ja(t,n)},Qi.prototype.f=function(t,e){return Wi($a(t,Ki(this)),e)},Qi.prototype.A=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},Gi.prototype.na=function(t){return Xa(t,zi(this))},Gi.prototype.b=function(t,e){var n=zi(this);return n.idToken=e,Ja(t,n)},Gi.prototype.f=function(t,e){return Wi($a(t,zi(this)),e)},Gi.prototype.A=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},Xi.prototype.Ea=function(t){return this.zb=H(t),this},S(Ji,Xi),S($i,Xi),$i.prototype.wa=function(t){return q(this.a,t)||this.a.push(t),this},$i.prototype.Hb=function(){return W(this.a)},$i.prototype.credential=function(t,e){var n;if(!(n=v(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new Yr("argument-error","credential failed: must provide the ID token and/or the access token.");return new Gi(this.providerId,n,this.providerId)},S(Zi,$i),Lr(Zi,"PROVIDER_ID","facebook.com"),Lr(Zi,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),S(eo,$i),Lr(eo,"PROVIDER_ID","github.com"),Lr(eo,"GITHUB_SIGN_IN_METHOD","github.com"),S(ro,$i),Lr(ro,"PROVIDER_ID","google.com"),Lr(ro,"GOOGLE_SIGN_IN_METHOD","google.com"),S(oo,Xi),Lr(oo,"PROVIDER_ID","twitter.com"),Lr(oo,"TWITTER_SIGN_IN_METHOD","twitter.com"),so.prototype.na=function(t){return this.signInMethod==co.EMAIL_LINK_SIGN_IN_METHOD?Ns(t,as,{email:this.a,oobCode:this.c}):Ns(t,Ts,{email:this.a,password:this.c})},so.prototype.b=function(t,e){return this.signInMethod==co.EMAIL_LINK_SIGN_IN_METHOD?Ns(t,ss,{idToken:e,email:this.a,oobCode:this.c}):Ns(t,vs,{idToken:e,email:this.a,password:this.c})},so.prototype.f=function(t,e){return Wi(this.na(t),e)},so.prototype.A=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Fr(co,{PROVIDER_ID:"password"}),Fr(co,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Fr(co,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),fo.prototype.na=function(t){return t.Va(yo(this))},fo.prototype.b=function(t,e){var n=yo(this);return n.idToken=e,Ns(t,Is,n)},fo.prototype.f=function(t,e){var n=yo(this);return n.operation="REAUTH",Wi(t=Ns(t,Cs,n),e)},fo.prototype.A=function(){var t={providerId:"phone"};return this.a.Ua&&(t.verificationId=this.a.Ua),this.a.Ta&&(t.verificationCode=this.a.Ta),this.a.Fa&&(t.temporaryProof=this.a.Fa),this.a.ba&&(t.phoneNumber=this.a.ba),t},mo.prototype.Va=function(e,n){var r=this.a.b;return Yt(n.verify()).then(function(t){if(!h(t))throw new Yr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(n.type){case"recaptcha":return function(t,e){return Ns(t,ys,e)}(r,{phoneNumber:e,recaptchaToken:t}).then(function(t){return"function"==typeof n.reset&&n.reset(),t},function(t){throw"function"==typeof n.reset&&n.reset(),t});default:throw new Yr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},Fr(mo,{PROVIDER_ID:"phone"}),Fr(mo,{PHONE_SIGN_IN_METHOD:"phone"}),wo.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.h&&t.push(this.h),t.join("-")},wo.prototype.R=function(){return this.h},wo.prototype.A=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.A()}};var To,So=null;function Io(t){var e="unauthorized-domain",n=void 0,r=_n(t);t=r.b,"chrome-extension"==(r=r.f)?n=Mt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=Mt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",Yr.call(this,e,n)}function Co(t,e,n){Yr.call(this,t,n),(t=e||{}).Ab&&Lr(this,"email",t.Ab),t.ba&&Lr(this,"phoneNumber",t.ba),t.credential&&Lr(this,"credential",t.credential),t.Qb&&Lr(this,"tenantId",t.Qb)}function No(t){if(t.code){var e=t.code||"";0==e.indexOf(Jr)&&(e=e.substring(Jr.length));var n={credential:go(t),Qb:t.tenantId};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.ba=t.phoneNumber;else if(!n.credential)return new Yr(e,t.message||void 0);return new Co(e,n,t.message)}return null}function Ao(){}function ko(t){return t.c||(t.c=t.b())}function Do(){}function Ro(t){if(t.f||"undefined"!=typeof XMLHttpRequest||"undefined"==typeof ActiveXObject)return t.f;for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}function Oo(){}function Po(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=_(this.fc,this),this.a.onerror=_(this.Ib,this),this.a.onprogress=_(this.gc,this),this.a.ontimeout=_(this.kc,this)}function Mo(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function xo(t,e,n){this.reset(t,e,n,void 0,void 0)}function Lo(t){this.f=t,this.b=this.c=this.a=null}function Fo(t,e){this.name=t,this.value=e}S(Io,Yr),S(Co,Yr),Co.prototype.A=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber),this.tenantId&&(t.tenantId=this.tenantId);var e=this.credential&&this.credential.A();return e&&z(t,e),t},Co.prototype.toJSON=function(){return this.A()},Ao.prototype.c=null,S(Do,Ao),Do.prototype.a=function(){var t=Ro(this);return t?new ActiveXObject(t):new XMLHttpRequest},Do.prototype.b=function(){var t={};return Ro(this)&&(t[0]=!0,t[1]=!0),t},To=new Do,S(Oo,Ao),Oo.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new Po;throw Error("Unsupported browser")},Oo.prototype.b=function(){return{}},(t=Po.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.fc=function(){this.status=200,this.response=this.responseText=this.a.responseText,Mo(this,4)},t.Ib=function(){this.status=500,this.response=this.responseText="",Mo(this,4)},t.kc=function(){this.Ib()},t.gc=function(){this.status=200,Mo(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},xo.prototype.a=null,xo.prototype.reset=function(t,e,n,r,i){delete this.a},Fo.prototype.toString=function(){return this.name};var Uo=new Fo("SEVERE",1e3),qo=new Fo("WARNING",900),Vo=new Fo("CONFIG",700),Bo=new Fo("FINE",500);Lo.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(A("Root logger has no level set."),null)}(this).value)for(m(e)&&(e=e()),t=new xo(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var jo,Wo={},Qo=null;function Ko(t){var e;if(Qo||(Qo=new Lo(""),(Wo[""]=Qo).c=Vo),!(e=Wo[t])){e=new Lo(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Ko(t.substr(0,n))).b||(n.b={}),(n.b[r]=e).a=n,Wo[t]=e}return e}function Ho(t,e){t&&t.log(Bo,e,void 0)}function Go(t){this.f=t}function zo(t){nn.call(this),this.o=t,this.readyState=Yo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=Ko("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}S(Go,Ao),Go.prototype.a=function(){return new zo(this.f)},Go.prototype.b=(jo={},function(){return jo}),S(zo,nn);var Yo=0;function Xo(t){t.c.read().then(t.ec.bind(t)).catch(t.Ma.bind(t))}function Jo(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,$o(t)}function $o(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Zo(t){nn.call(this),this.headers=new ln,this.B=t||null,this.c=!1,this.w=this.a=null,this.h=this.O=this.l="",this.f=this.J=this.i=this.I=!1,this.g=0,this.o=null,this.m=ta,this.v=this.P=!1}(t=zo.prototype).open=function(t,e){if(this.readyState!=Yo)throw this.abort(),Error("Error reopening a connection");this.m=t,this.g=e,this.readyState=1,$o(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.m,credentials:void 0,cache:void 0};t&&(e.body=t),this.o.fetch(new Request(this.g,e)).then(this.jc.bind(this),this.Ma.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Jo(this,!1)),this.readyState=Yo},t.jc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,$o(this)),this.a&&(this.readyState=3,$o(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.hc.bind(this),this.Ma.bind(this)):void 0!==l.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,Xo(this)):t.text().then(this.ic.bind(this),this.Ma.bind(this)))))},t.ec=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?Jo(this,!0):$o(this),3==this.readyState&&Xo(this)}},t.ic=function(t){this.a&&(this.response=this.responseText=t,Jo(this,!0))},t.hc=function(t){this.a&&(this.response=t,Jo(this,!0))},t.Ma=function(t){var e=this.h;e&&e.log(qo,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&Jo(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(qo,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(qo,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},S(Zo,nn);var ta="";Zo.prototype.b=Ko("goog.net.XhrIo");var ea=/^https?$/i,na=["POST","PUT"];function ra(e,t,n,r,i){if(e.a)throw Error("[goog.net.XhrIo] Object is active with another request="+e.l+"; newUri="+t);n=n?n.toUpperCase():"GET",e.l=t,e.h="",e.O=n,e.I=!1,e.c=!0,e.a=e.B?e.B.a():To.a(),e.w=e.B?ko(e.B):ko(To),e.a.onreadystatechange=_(e.Lb,e);try{Ho(e.b,fa(e,"Opening Xhr")),e.J=!0,e.a.open(n,String(t),!0),e.J=!1}catch(t){return Ho(e.b,fa(e,"Error opening Xhr: "+t.message)),void oa(e,t)}t=r||"";var o=new ln(e.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(y(t)||h(t))L(t,e,void 0);else for(var n=hn(t),r=cn(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,function(t,e){o.set(e,t)}),i=function(t){t:{for(var e=ia,n=t.length,r=h(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:h(t)?t.charAt(e):t[e]}(o.X()),r=l.FormData&&t instanceof l.FormData,!q(na,n)||i||r||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},e),e.m&&(e.a.responseType=e.m),"withCredentials"in e.a&&e.a.withCredentials!==e.P&&(e.a.withCredentials=e.P);try{ca(e),0<e.g&&(e.v=function(t){return me&&Ne(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(e.a),Ho(e.b,fa(e,"Will abort after "+e.g+"ms if incomplete, xhr2 "+e.v)),e.v?(e.a.timeout=e.g,e.a.ontimeout=_(e.Ga,e)):e.o=sn(e.Ga,e.g,e)),Ho(e.b,fa(e,"Sending request")),e.i=!0,e.a.send(t),e.i=!1}catch(t){Ho(e.b,fa(e,"Send error: "+t.message)),oa(e,t)}}function ia(t){return"content-type"==t.toLowerCase()}function oa(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,aa(t),ua(t)}function aa(t){t.I||(t.I=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function sa(e){if(e.c&&void 0!==u)if(e.w[1]&&4==ha(e)&&2==la(e))Ho(e.b,fa(e,"Local request error detected and ignored"));else if(e.i&&4==ha(e))sn(e.Lb,0,e);else if(e.dispatchEvent("readystatechange"),4==ha(e)){Ho(e.b,fa(e,"Request complete")),e.c=!1;try{var t,n=la(e);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(t=r)){var i;if(i=0===n){var o=String(e.l).match(dn)[1]||null;if(!o&&l.self&&l.self.location){var a=l.self.location.protocol;o=a.substr(0,a.length-1)}i=!ea.test(o?o.toLowerCase():"")}t=i}if(t)e.dispatchEvent("complete"),e.dispatchEvent("success");else{try{var s=2<ha(e)?e.a.statusText:""}catch(t){Ho(e.b,"Can not get status: "+t.message),s=""}e.h=s+" ["+la(e)+"]",aa(e)}}finally{ua(e)}}}function ua(e,t){if(e.a){ca(e);var n=e.a,r=e.w[0]?p:null;e.a=null,e.w=null,t||e.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){(e=e.b)&&e.log(Uo,"Problem encountered resetting onreadystatechange: "+t.message,void 0)}}}function ca(t){t.a&&t.v&&(t.a.ontimeout=null),t.o&&(l.clearTimeout(t.o),t.o=null)}function ha(t){return t.a?t.a.readyState:0}function la(t){try{return 2<ha(t)?t.a.status:-1}catch(t){return-1}}function fa(t,e){return e+" ["+t.O+" "+t.l+" "+la(t)+"]"}function pa(t){var e=Sa;this.g=[],this.v=e,this.o=t||null,this.f=this.a=!1,this.c=void 0,this.u=this.w=this.i=!1,this.h=0,this.b=null,this.l=0}function da(t,e,n){t.a=!0,t.c=n,t.f=!e,ga(t)}function ya(t){if(t.a){if(!t.u)throw new ba(t);t.u=!1}}function ma(t,e,n,r){t.g.push([e,n,r]),t.a&&ga(t)}function va(t){return U(t.g,function(t){return m(t[1])})}function ga(e){if(e.h&&e.a&&va(e)){var n=e.h,r=Ea[n];r&&(l.clearTimeout(r.a),delete Ea[n]),e.h=0}e.b&&(e.b.l--,delete e.b),n=e.c;for(var t=r=!1;e.g.length&&!e.i;){var i=e.g.shift(),o=i[0],a=i[1];if(i=i[2],o=e.f?a:o)try{var s=o.call(i||e.o,n);void 0!==s&&(e.f=e.f&&(s==n||s instanceof Error),e.c=n=s),(I(n)||"function"==typeof l.Promise&&n instanceof l.Promise)&&(t=!0,e.i=!0)}catch(t){n=t,e.f=!0,va(e)||(r=!0)}}e.c=n,t&&(s=_(e.m,e,!0),t=_(e.m,e,!1),n instanceof pa?(ma(n,s,t),n.w=!0):n.then(s,t)),r&&(n=new _a(n),Ea[n.a]=n,e.h=n.a)}function ba(){C.call(this)}function wa(){C.call(this)}function _a(t){this.a=l.setTimeout(_(this.c,this),0),this.b=t}(t=Zo.prototype).Ga=function(){void 0!==u&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Ho(this.b,fa(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(Ho(this.b,fa(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),ua(this))},t.xa=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),ua(this,!0)),Zo.qb.xa.call(this)},t.Lb=function(){this.ta||(this.J||this.i||this.f?sa(this):this.yc())},t.yc=function(){sa(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case ta:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(Uo,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(t){return Ho(this.b,"Can not get response: "+t.message),null}},pa.prototype.cancel=function(t){if(this.a)this.c instanceof pa&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.l--,e.l<=0&&e.cancel())}this.v?this.v.call(this.o,this):this.u=!0,this.a||(t=new wa(this),ya(this),da(this,!1,t))}},pa.prototype.m=function(t,e){this.i=!1,da(this,t,e)},pa.prototype.then=function(t,e,n){var r,i,o=new jt(function(t,e){r=t,i=e});return ma(this,r,function(t){t instanceof wa?o.cancel():i(t)}),o.then(t,e,n)},pa.prototype.$goog_Thenable=!0,S(ba,C),ba.prototype.message="Deferred has already fired",ba.prototype.name="AlreadyCalledError",S(wa,C),wa.prototype.message="Deferred was canceled",wa.prototype.name="CanceledError",_a.prototype.c=function(){throw delete Ea[this.a],this.b};var Ea={};function Ta(t){var e,n=document,r=et(t).toString(),i=document.createElement("SCRIPT"),o={Nb:i,Ga:void 0},a=new pa(o);return e=window.setTimeout(function(){Ia(i,!0);var t=new Aa(Na,"Timeout reached for loading script "+r);ya(a),da(a,!1,t)},5e3),o.Ga=e,i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(Ia(i,!1,e),ya(a),da(a,!0,null))},i.onerror=function(){Ia(i,!0,e);var t=new Aa(Ca,"Error while loading script "+r);ya(a),da(a,!1,t)},z(o={},{type:"text/javascript",charset:"UTF-8"}),Bn(i,o),function(t,e){M(t,"HTMLScriptElement"),t.src=et(e),null===f&&(f=(e=(e=l.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&s.test(e)?e:""),(e=f)&&t.setAttribute("nonce",e)}(i,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),a}function Sa(){if(this&&this.Nb){var t=this.Nb;t&&"SCRIPT"==t.tagName&&Ia(t,!0,this.Ga)}}function Ia(t,e,n){null!=n&&l.clearTimeout(n),t.onload=p,t.onerror=p,t.onreadystatechange=p,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var Ca=0,Na=1;function Aa(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),C.call(this,n),this.code=t}function ka(t){this.f=t}function Da(t,e,n){if(this.c=t,t=e||{},this.l=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.u=t.secureTokenTimeout||Pa,this.g=H(t.secureTokenHeaders||Ma),this.h=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.i=t.firebaseTimeout||xa,this.a=H(t.firebaseHeaders||La),n&&(this.a["X-Client-Version"]=n,this.g["X-Client-Version"]=n),n="Node"==ur(),!(n=l.XMLHttpRequest||n&&fl.INTERNAL.node&&fl.INTERNAL.node.XMLHttpRequest)&&!sr())throw new Yr("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,sr()?this.f=new Go(self):cr()?this.f=new ka(n):this.f=new Oo,this.b=null}S(Aa,C),S(ka,Ao),ka.prototype.a=function(){return new this.f},ka.prototype.b=function(){return{}};var Ra,Oa="idToken",Pa=new Ar(3e4,6e4),Ma={"Content-Type":"application/x-www-form-urlencoded"},xa=new Ar(3e4,6e4),La={"Content-Type":"application/json"};function Fa(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function Ua(t,e){e?(t.a["X-Client-Version"]=e,t.g["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.g["X-Client-Version"])}function qa(t,e,n,r,i,o,a){(t=function(){var t=yr();return!((t=fr(t)!=lr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&t<30)&&(!me||!Ie||9<Ie)}()||sr()?_(t.o,t):(Ra=Ra||new jt(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{l[Ba]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))},function(t,e){ma(t,null,e,void 0)}(Ta(nt(Va,{onload:Ba})),function(){e(Error("CORS_UNSUPPORTED"))})}}(t,e)}),_(t.m,t)))(e,n,r,i,o,a)}Da.prototype.R=function(){return this.b},Da.prototype.o=function(t,n,e,r,i,o){if(sr()&&(void 0===l.fetch||void 0===l.Headers||void 0===l.Request))throw new Yr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var a=new Zo(this.f);if(o){a.g=Math.max(0,o);var s=setTimeout(function(){a.dispatchEvent("timeout")},o)}rn(a,"complete",function(){s&&clearTimeout(s);var e=null;try{e=JSON.parse(function(e){try{return e.a?e.a.responseText:""}catch(t){return Ho(e.b,"Can not get responseText: "+t.message),""}}(this))||null}catch(t){e=null}n&&n(e)}),on(a,"ready",function(){s&&clearTimeout(s),le(this)}),on(a,"timeout",function(){s&&clearTimeout(s),le(this),n&&n(null)}),ra(a,t,e,r,i)};var Va=new Y($,"https://apis.google.com/js/client.js?onload=%{onload}"),Ba="__fcb"+Math.floor(1e6*Math.random()).toString();function ja(t){if(!h(t=t.email)||!rr.test(t))throw new Yr("invalid-email")}function Wa(t){"email"in t&&ja(t)}function Qa(t){if(!t[Oa])throw new Yr("internal-error")}function Ka(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new Yr("internal-error")}else{if(!t.sessionInfo)throw new Yr("missing-verification-id");if(!t.code)throw new Yr("missing-verification-code")}}Da.prototype.m=function(t,n,r,i,o){var a=this;Ra.then(function(){window.gapi.client.setApiKey(a.c);var e=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:r,body:i,headers:o,authType:"none",callback:function(t){window.gapi.auth.setToken(e),n&&n(t)}})}).s(function(t){n&&n({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},Da.prototype.ob=function(){return Ns(this,gs,{})},Da.prototype.rb=function(t,e){return Ns(this,ms,{idToken:t,email:e})},Da.prototype.sb=function(t,e){return Ns(this,vs,{idToken:t,password:e})};var Ha={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function Ga(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new Yr("internal-error")}function za(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(xn(t=new Rn(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function Ya(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=No(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=No(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=No(t)):t.errorMessage&&(e=As(t.errorMessage)),e)throw e;if(!t[Oa])throw new Yr("internal-error")}function Xa(t,e){return e.returnIdpCredential=!0,Ns(t,bs,e)}function Ja(t,e){return e.returnIdpCredential=!0,Ns(t,_s,e)}function $a(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,Ns(t,ws,e)}function Za(t){if(!t.oobCode)throw new Yr("invalid-action-code")}(t=Da.prototype).tb=function(t,r){var i={idToken:t},o=[];return Q(Ha,function(t,e){var n=r[e];null===n?o.push(t):e in r&&(i[e]=n)}),o.length&&(i.deleteAttribute=o),Ns(this,ms,i)},t.kb=function(t,e){return z(t={requestType:"PASSWORD_RESET",email:t},e),Ns(this,ls,t)},t.lb=function(t,e){return z(t={requestType:"EMAIL_SIGNIN",email:t},e),Ns(this,cs,t)},t.jb=function(t,e){return z(t={requestType:"VERIFY_EMAIL",idToken:t},e),Ns(this,hs,t)},t.Va=function(t){return Ns(this,Ss,t)},t.$a=function(t,e){return Ns(this,ds,{oobCode:t,newPassword:e})},t.Ka=function(t){return Ns(this,es,{oobCode:t})},t.Xa=function(t){return Ns(this,ts,{oobCode:t})};var ts={endpoint:"setAccountInfo",D:Za,fa:"email",F:!0},es={endpoint:"resetPassword",D:Za,K:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new Yr("internal-error")},F:!0},ns={endpoint:"signupNewUser",D:function(t){if(ja(t),!t.password)throw new Yr("weak-password")},K:Qa,T:!0,F:!0},rs={endpoint:"createAuthUri",F:!0},is={endpoint:"deleteAccount",V:["idToken"]},os={endpoint:"setAccountInfo",V:["idToken","deleteProvider"],D:function(t){if(!d(t.deleteProvider))throw new Yr("internal-error")}},as={endpoint:"emailLinkSignin",V:["email","oobCode"],D:ja,K:Qa,T:!0,F:!0},ss={endpoint:"emailLinkSignin",V:["idToken","email","oobCode"],D:ja,K:Qa,T:!0},us={endpoint:"getAccountInfo"},cs={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new Yr("internal-error");ja(t)},fa:"email",F:!0},hs={endpoint:"getOobConfirmationCode",V:["idToken","requestType"],D:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new Yr("internal-error")},fa:"email",F:!0},ls={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("PASSWORD_RESET"!=t.requestType)throw new Yr("internal-error");ja(t)},fa:"email",F:!0},fs={wb:!0,endpoint:"getProjectConfig",Kb:"GET"},ps={wb:!0,endpoint:"getRecaptchaParam",Kb:"GET",K:function(t){if(!t.recaptchaSiteKey)throw new Yr("internal-error")}},ds={endpoint:"resetPassword",D:Za,fa:"email",F:!0},ys={endpoint:"sendVerificationCode",V:["phoneNumber","recaptchaToken"],fa:"sessionInfo",F:!0},ms={endpoint:"setAccountInfo",V:["idToken"],D:Wa,T:!0},vs={endpoint:"setAccountInfo",V:["idToken"],D:function(t){if(Wa(t),!t.password)throw new Yr("weak-password")},K:Qa,T:!0},gs={endpoint:"signupNewUser",K:Qa,T:!0,F:!0},bs={endpoint:"verifyAssertion",D:Ga,Qa:za,K:Ya,T:!0,F:!0},ws={endpoint:"verifyAssertion",D:Ga,Qa:za,K:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new Yr("user-not-found");if(t.errorMessage)throw As(t.errorMessage);if(!t[Oa])throw new Yr("internal-error")},T:!0,F:!0},_s={endpoint:"verifyAssertion",D:function(t){if(Ga(t),!t.idToken)throw new Yr("internal-error")},Qa:za,K:Ya,T:!0},Es={endpoint:"verifyCustomToken",D:function(t){if(!t.token)throw new Yr("invalid-custom-token")},K:Qa,T:!0,F:!0},Ts={endpoint:"verifyPassword",D:function(t){if(ja(t),!t.password)throw new Yr("wrong-password")},K:Qa,T:!0,F:!0},Ss={endpoint:"verifyPhoneNumber",D:Ka,K:Qa,F:!0},Is={endpoint:"verifyPhoneNumber",D:function(t){if(!t.idToken)throw new Yr("internal-error");Ka(t)},K:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",No(t);Qa(t)}},Cs={Yb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",D:Ka,K:Qa,F:!0};function Ns(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.V))return Xt(new Yr("internal-error"));var r,i=e.Kb||"POST";return Yt(n).then(e.D).then(function(){return e.T&&(n.returnSecureToken=!0),e.F&&t.b&&void 0===n.tenantId&&(n.tenantId=t.b),function(t,e,r,i,o,n){var a=_n(t.h+e);bn(a,"key",t.c),n&&bn(a,"cb",T().toString());var s="GET"==r;if(s)for(var u in i)i.hasOwnProperty(u)&&bn(a,u,i[u]);return new jt(function(e,n){qa(t,a.toString(),function(t){t?t.error?n(ks(t,o||{})):e(t):n(new Yr("network-request-failed"))},r,s?void 0:Kn(Tr(i)),t.a,t.i.get())})}(t,e.endpoint,i,n,e.Yb,e.wb||!1)}).then(function(t){return r=t,e.Qa?e.Qa(n,r):r}).then(e.K).then(function(){if(!e.fa)return r;if(!(e.fa in r))throw new Yr("internal-error");return r[e.fa]})}function As(t){return ks({error:{errors:[{message:t}],code:400,message:t}})}function ks(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new Yr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",z(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*(.*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new Yr(r[i],e);return!e&&t&&(e=Er(t)),new Yr("internal-error",e)}function Ds(t){this.b=t,this.a=null,this.fb=function(o){return(Ms=Ms||new jt(function(t,e){function n(){Nr(),mr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){Nr(),e(Error("Network Error"))},timeout:Os.get()})}if(mr("gapi.iframes.Iframe"))t();else if(mr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();l[r]=function(){mr("gapi.load")?n():e(Error("Network Error"))},Yt(Ta(r=nt(Rs,{onload:r}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw Ms=null,t})).then(function(){return new jt(function(r,i){mr("gapi.iframes.getContext")().open({where:document.body,url:o.b,messageHandlersFilter:mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(t){function e(){clearTimeout(n),r()}o.a=t,o.a.restyle({setHideOnLeave:!1});var n=setTimeout(function(){i(Error("Network Error"))},Ps.get());t.ping(e).then(e,function(){i(Error("Network Error"))})})})})}(this)}var Rs=new Y($,"https://apis.google.com/js/api.js?onload=%{onload}"),Os=new Ar(3e4,6e4),Ps=new Ar(5e3,15e3),Ms=null;function xs(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=En(this.i,"/__/auth/iframe"),bn(this.a,"apiKey",this.g),bn(this.a,"appName",this.h),this.b=null,this.c=[]}function Ls(t,e,n,r,i){this.o=t,this.m=e,this.c=n,this.u=r,this.i=this.g=this.l=null,this.a=i,this.h=this.f=null}function Fs(t){try{return fl.app(t).auth().Aa()}catch(t){return[]}}function Us(t,e,n,r,i){this.u=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.m=this.o=this.v=null,this.g=[],this.l=this.a=null}function qs(t){var s=Jn();return function(t){return Ns(t,fs,{}).then(function(t){return t.authorizedDomains||[]})}(t).then(function(t){t:{var e=_n(s),n=e.f;e=e.b;for(var r=0;r<t.length;r++){var i=t[r],o=e,a=n;if(o=0==i.indexOf("chrome-extension://")?_n(i).b==o&&"chrome-extension"==a:("http"==a||"https"==a)&&(nr.test(i)?o==i:(i=i.split(".").join("\\."),new RegExp("^(.+\\."+i+"|"+i+")$","i").test(o)))){t=!0;break t}}t=!1}if(!t)throw new Io(Jn())})}function Vs(i){return i.l||(i.l=ir().then(function(){if(!i.o){var t=i.c,e=i.h,n=Fs(i.b),r=new xs(i.u,i.f,i.b);r.f=t,r.b=e,r.c=W(n||[]),i.o=r.toString()}i.i=new Ds(i.o),function(r){if(!r.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.fb.then(function(){t.a.register("authEvent",e,mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(r.i,function(t){var e={};if(t&&t.authEvent){var n=!1;for(t=_o(t.authEvent),e=0;e<r.g.length;e++)n=r.g[e](t)||n;return(e={}).status=n?"ACK":"ERROR",Yt(e)}return e.status="ERROR",Yt(e)})}(i)})),i.l}function Bs(t){return t.m||(t.v=t.c?dr(t.c,Fs(t.b)):null,t.m=new Da(t.f,Ni(t.h),t.v)),t.m}function js(t,e,n,r,i,o,a,s,u,c,h){return(t=new Ls(t,e,n,r,i)).l=o,t.g=a,t.i=s,t.b=H(u||null),t.f=c,t.nb(h).toString()}function Ws(t){if(this.a=t||fl.INTERNAL.reactNative&&fl.INTERNAL.reactNative.AsyncStorage,!this.a)throw new Yr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Qs(t){this.b=t,this.a={},this.f=_(this.c,this)}xs.prototype.toString=function(){return this.f?bn(this.a,"v",this.f):Mn(this.a.a,"v"),this.b?bn(this.a,"eid",this.b):Mn(this.a.a,"eid"),this.c.length?bn(this.a,"fw",this.c.join(",")):Mn(this.a.a,"fw"),this.a.toString()},Ls.prototype.nb=function(t){return this.h=t,this},Ls.prototype.toString=function(){var t=En(this.o,"/__/auth/handler");if(bn(t,"apiKey",this.m),bn(t,"appName",this.c),bn(t,"authType",this.u),this.a.isOAuthProvider){var e=this.a;try{var n=fl.app(this.c).auth().ha()}catch(t){n=null}for(var r in e.ab=n,bn(t,"providerId",this.a.providerId),n=Tr((e=this.a).zb))n[r]=n[r].toString();r=e.Fc,n=H(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.cb&&e.ab&&!n[e.cb]&&(n[e.cb]=e.ab),K(n)||bn(t,"customParameters",Er(n))}if("function"==typeof this.a.Hb&&((e=this.a.Hb()).length&&bn(t,"scopes",e.join(","))),this.l?bn(t,"redirectUrl",this.l):Mn(t.a,"redirectUrl"),this.g?bn(t,"eventId",this.g):Mn(t.a,"eventId"),this.i?bn(t,"v",this.i):Mn(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!wn(t,a)&&bn(t,a,this.b[a]);return this.h?bn(t,"tid",this.h):Mn(t.a,"tid"),this.f?bn(t,"eid",this.f):Mn(t.a,"eid"),(a=Fs(this.c)).length&&bn(t,"fw",a.join(",")),t.toString()},(t=Us.prototype).Fb=function(e,n,t){var r=new Yr("popup-closed-by-user"),i=new Yr("web-storage-unsupported"),o=this,a=!1;return this.ia().then(function(){(function(t){var e={type:"webStorageSupport"};return Vs(t).then(function(){return function(e,n){return e.fb.then(function(){return new jt(function(t){e.a.send(n.type,n,t,mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}(t.i,e)}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})})(o).then(function(t){t||(e&&tr(e),n(i),a=!0)})}).s(function(){}).then(function(){if(!a)return function(n){return new jt(function(e){return function t(){un(2e3).then(function(){if(n&&!n.closed)return t();e()})}()})}(e)}).then(function(){if(!a)return un(t).then(function(){n(r)})})},t.Ob=function(){var t=yr();return!_r(t)&&!Cr(t)},t.Jb=function(){return!1},t.Db=function(e,t,n,r,i,o,a,s){if(!e)return Xt(new Yr("popup-blocked"));if(a&&!_r())return this.ia().s(function(t){tr(e),i(t)}),r(),Yt();this.a||(this.a=qs(Bs(this)));var u=this;return this.a.then(function(){var t=u.ia().s(function(t){throw tr(e),i(t),t});return r(),t}).then(function(){bo(n),a||$n(js(u.u,u.f,u.b,t,n,null,o,u.c,void 0,u.h,s),e)}).s(function(t){throw"auth/network-request-failed"==t.code&&(u.a=null),t})},t.Eb=function(t,e,n,r){this.a||(this.a=qs(Bs(this)));var i=this;return this.a.then(function(){bo(e),$n(js(i.u,i.f,i.b,t,e,Jn(),n,i.c,void 0,i.h,r))}).s(function(t){throw"auth/network-request-failed"==t.code&&(i.a=null),t})},t.ia=function(){var t=this;return Vs(this).then(function(){return t.i.fb}).s(function(){throw t.a=null,new Yr("network-request-failed")})},t.Rb=function(){return!0},t.ya=function(t){this.g.push(t)},t.La=function(e){B(this.g,function(t){return t==e})},(t=Ws.prototype).get=function(t){return Yt(this.a.getItem(t)).then(function(t){return t&&Sr(t)})},t.set=function(t,e){return Yt(this.a.setItem(t,Er(e)))},t.S=function(t){return Yt(this.a.removeItem(t))},t.$=function(){},t.ea=function(){};var Ks,Hs=[];function Gs(t,e,n){K(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function zs(t){this.a=t}function Ys(t){this.c=t,this.b=!1,this.a=[]}function Xs(r,t,e,n){var i,o,a,s,u=e||{},c=null;if(r.b)return Xt(Error("connection_unavailable"));var h=n?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new jt(function(e,n){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){n(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){n(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?e(t.data.response):n(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),n(Error("invalid_response"))))}},r.a.push(c),l.port1.addEventListener("message",o),r.c.postMessage({eventType:t,eventId:i,data:u},[l.port2])):n(Error("connection_unavailable"))}).then(function(t){return Js(r,c),t}).s(function(t){throw Js(r,c),t})}function Js(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),B(t.a,function(t){return t==e})}}function $s(){if(!eu())throw new Yr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.u=l.indexedDB,this.type="indexedDB",this.g=this.l=this.f=this.i=null,this.o=!1,this.h=null;var r=this;sr()&&self?(this.l=function(){var e=sr()?self:null;if(L(Hs,function(t){t.b==e&&(n=t)}),!n){var n=new Qs(e);Hs.push(n)}return n}(),Gs(this.l,"keyChanged",function(t,n){return au(r).then(function(e){return 0<e.length&&L(r.a,function(t){t(e)}),{keyProcessed:q(e,n.key)}})}),Gs(this.l,"ping",function(){return Yt(["keyChanged"])})):function(){var t=l.navigator;return t&&t.serviceWorker?Yt().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):Yt(null)}().then(function(t){(r.h=t)&&(r.g=new Ys(new zs(t)),Xs(r.g,"ping",null,!0).then(function(t){t[0].fulfilled&&q(t[0].value,"keyChanged")&&(r.o=!0)}).s(function(){}))})}function Zs(r){return new jt(function(e,n){var t=r.u.open("firebaseLocalStorageDb",1);t.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},t.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},t.onsuccess=function(t){(t=t.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(t):function(r){return new jt(function(t,e){var n=r.u.deleteDatabase("firebaseLocalStorageDb");n.onsuccess=function(){t()},n.onerror=function(t){e(Error(t.target.error))}})}(r).then(function(){return Zs(r)}).then(function(t){e(t)}).s(function(t){n(t)})}})}function tu(t){return t.m||(t.m=Zs(t)),t.m}function eu(){try{return!!l.indexedDB}catch(t){return!1}}function nu(t){return t.objectStore("firebaseLocalStorage")}function ru(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function iu(t){return new jt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function ou(t,e){return t.g&&t.h&&function(){var t=l.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?Xs(t.g,"keyChanged",{key:e},t.o).then(function(){}).s(function(){}):Yt()}function au(r){return tu(r).then(function(t){var i=nu(ru(t,!1));return i.getAll?iu(i.getAll()):new jt(function(e,n){var r=[],t=i.openCursor();t.onsuccess=function(t){(t=t.target.result)?(r.push(t.value),t.continue()):e(r)},t.onerror=function(t){n(t.target.error)}})}).then(function(t){var e={},n=[];if(0==r.b){for(n=0;n<t.length;n++)e[t[n].fbase_key]=t[n].value;n=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(r.c,e),r.c=e}return n})}function su(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function uu(t){var r=this,i=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Yt().then(function(){if(eu()){var e=Ir(),n="__sak"+e;return Ks=Ks||new $s,(i=Ks).set(n,e).then(function(){return i.get(n)}).then(function(t){if(t!==e)throw Error("indexedDB not supported!");return i.S(n)}).then(function(){return i}).s(function(){return r.c})}return r.c}).then(function(t){return r.type=t.type,t.$(function(e){L(r.a,function(t){t(e)})}),t})}function cu(){this.a={},this.type="inMemory"}function hu(){if(!function(){var t="Node"==ur();if(!(t=lu()||t&&fl.INTERNAL.node&&fl.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ur())throw new Yr("internal-error","The LocalStorage compatibility library was not found.");throw new Yr("web-storage-unsupported")}this.a=lu()||fl.INTERNAL.node.localStorage,this.type="localStorage"}function lu(){try{var t=l.localStorage,e=Ir();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function fu(){this.type="nullStorage"}function pu(){if(!function(){var t="Node"==ur();if(!(t=du()||t&&fl.INTERNAL.node&&fl.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ur())throw new Yr("internal-error","The SessionStorage compatibility library was not found.");throw new Yr("web-storage-unsupported")}this.a=du()||fl.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function du(){try{var t=l.sessionStorage,e=Ir();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function yu(){var t={};t.Browser=gu,t.Node=bu,t.ReactNative=wu,t.Worker=_u,this.a=t[ur()]}Qs.prototype.c=function(n){var r=n.data.eventType,i=n.data.eventId,t=this.a[r];if(t&&0<t.length){n.ports[0].postMessage({status:"ack",eventId:i,eventType:r,response:null});var e=[];L(t,function(t){e.push(Yt().then(function(){return t(n.origin,n.data.data)}))}),$t(e).then(function(t){var e=[];L(t,function(t){e.push({fulfilled:t.Gb,value:t.value,reason:t.reason?t.reason.message:void 0})}),L(e,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),n.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:e})})}},zs.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Ys.prototype.close=function(){for(;0<this.a.length;)Js(this,this.a[0]);this.b=!0},(t=$s.prototype).set=function(n,r){var i,o=!1,a=this;return tu(this).then(function(t){return iu((t=nu(ru(i=t,!0))).get(n))}).then(function(t){var e=nu(ru(i,!0));return t?(t.value=r,iu(e.put(t))):(a.b++,o=!0,(t={}).fbase_key=n,t.value=r,iu(e.add(t)))}).then(function(){return a.c[n]=r,ou(a,n)}).ka(function(){o&&a.b--})},t.get=function(e){return tu(this).then(function(t){return iu(nu(ru(t,!1)).get(e))}).then(function(t){return t&&t.value})},t.S=function(e){var n=!1,r=this;return tu(this).then(function(t){return n=!0,r.b++,iu(nu(ru(t,!0)).delete(e))}).then(function(){return delete r.c[e],ou(r,e)}).ka(function(){n&&r.b--})},t.$=function(t){0==this.a.length&&function(t){su(t),function e(){t.f=setTimeout(function(){t.i=au(t).then(function(e){0<e.length&&L(t.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()}(this),this.a.push(t)},t.ea=function(e){B(this.a,function(t){return t==e}),0==this.a.length&&su(this)},(t=uu.prototype).get=function(e){return this.b.then(function(t){return t.get(e)})},t.set=function(e,n){return this.b.then(function(t){return t.set(e,n)})},t.S=function(e){return this.b.then(function(t){return t.S(e)})},t.$=function(t){this.a.push(t)},t.ea=function(e){B(this.a,function(t){return t==e})},(t=cu.prototype).get=function(t){return Yt(this.a[t])},t.set=function(t,e){return this.a[t]=e,Yt()},t.S=function(t){return delete this.a[t],Yt()},t.$=function(){},t.ea=function(){},(t=hu.prototype).get=function(t){var e=this;return Yt().then(function(){return Sr(e.a.getItem(t))})},t.set=function(e,n){var r=this;return Yt().then(function(){var t=Er(n);null===t?r.S(e):r.a.setItem(e,t)})},t.S=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.$=function(t){l.window&&Qe(l.window,"storage",t)},t.ea=function(t){l.window&&Ge(l.window,"storage",t)},(t=fu.prototype).get=function(){return Yt(null)},t.set=function(){return Yt()},t.S=function(){return Yt()},t.$=function(){},t.ea=function(){},(t=pu.prototype).get=function(t){var e=this;return Yt().then(function(){return Sr(e.a.getItem(t))})},t.set=function(e,n){var r=this;return Yt().then(function(){var t=Er(n);null===t?r.S(e):r.a.setItem(e,t)})},t.S=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.$=function(){},t.ea=function(){};var mu,vu,gu={C:hu,Sa:pu},bu={C:hu,Sa:pu},wu={C:Ws,Sa:fu},_u={C:hu,Sa:fu},Eu={$c:"local",NONE:"none",bd:"session"};function Tu(){var t=!(Cr(yr())||!ar()),e=_r(),n=vr();this.m=t,this.h=e,this.l=n,this.a={},t=mu=mu||new yu;try{this.g=!Xn()&&Rr()||!l.indexedDB?new t.a.C:new uu(sr()?new cu:new t.a.C)}catch(t){this.g=new cu,this.h=!0}try{this.i=new t.a.Sa}catch(t){this.i=new cu}this.u=new cu,this.f=_(this.Pb,this),this.b={}}function Su(){return vu=vu||new Tu}function Iu(t,e){switch(e){case"session":return t.i;case"none":return t.u;default:return t.g}}function Cu(t,e){return"firebase:"+t.name+(e?":"+e:"")}function Nu(t,e,n){return n=Cu(e,n),"local"==e.C&&(t.b[n]=null),Iu(t,e.C).S(n)}function Au(t){t.c&&(clearInterval(t.c),t.c=null)}function ku(t){this.a=t,this.b=Su()}(t=Tu.prototype).get=function(t,e){return Iu(this,t.C).get(Cu(t,e))},t.set=function(e,t,n){var r=Cu(e,n),i=this,o=Iu(this,e.C);return o.set(r,t).then(function(){return o.get(r)}).then(function(t){"local"==e.C&&(i.b[r]=t)})},t.addListener=function(t,e,n){t=Cu(t,e),this.l&&(this.b[t]=l.localStorage.getItem(t)),K(this.a)&&(Iu(this,"local").$(this.f),this.h||(Xn()||!Rr())&&l.indexedDB||!this.l||function(r){Au(r),r.c=setInterval(function(){for(var t in r.a){var e=l.localStorage.getItem(t),n=r.b[t];e!=n&&(r.b[t]=e,e=new Pe({type:"storage",key:t,target:window,oldValue:n,newValue:e,a:!0}),r.Pb(e))}},1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=Cu(t,e),this.a[t]&&(B(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),K(this.a)&&(Iu(this,"local").ea(this.f),Au(this))},t.Pb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=l.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.Za(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?Iu(this,"local").ea(this.f):Au(this),this.m)if(n=l.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?l.localStorage.setItem(e,r):l.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===l.localStorage.getItem(e)||(o.b[e]=l.localStorage.getItem(e),o.Za(e))},me&&Ie&&10==Ie&&l.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else L(t,_(this.Za,this))},t.Za=function(t){this.a[t]&&L(this.a[t],function(t){t()})};var Du,Ru={name:"authEvent",C:"local"};function Ou(){this.a=Su()}function Pu(t,e){this.b=Mu,this.f=l.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.l=l.Int32Array?new Int32Array(64):Array(64),void 0!==Du||(Du=l.Int32Array?new Int32Array(Bu):Bu),this.reset()}S(Pu,function(){this.b=-1});for(var Mu=64,xu=Mu-1,Lu=[],Fu=0;Fu<xu;Fu++)Lu[Fu]=0;var Uu=j(128,Lu);function qu(t){for(var e=t.f,n=t.l,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;e<64;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;e<64;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|Du[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function Vu(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(h(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(qu(t),i=0);else{if(!y(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&o<=255&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(qu(t),i=0)}}t.c=i,t.g+=n}Pu.prototype.reset=function(){this.g=this.c=0,this.a=l.Int32Array?new Int32Array(this.h):W(this.h)};var Bu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function ju(){Pu.call(this,8,Wu)}S(ju,Pu);var Wu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Qu(t,e,n,r,i){this.u=t,this.i=e,this.l=n,this.m=r||null,this.o=i||null,this.h=e+":"+n,this.v=new Ou,this.g=new ku(this.h),this.f=null,this.b=[],this.a=this.c=null}function Ku(t){return new Yr("invalid-cordova-configuration",t)}function Hu(t){var e=new ju;Vu(e,t),t=[];var n=8*e.g;e.c<56?Vu(e,Uu,56-e.c):Vu(e,Uu,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(qu(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return F(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}(t)}function Gu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function zu(r){return r.f||(r.f=r.ia().then(function(){return new jt(function(n){r.ya(function t(e){return n(e),r.La(t),!1}),function(i){function e(r){t=!0,n&&n.cancel(),Yu(i).then(function(t){var e=o;if(t&&r&&r.url){var n=null;-1!=(e=Bi(r.url)).indexOf("/__/auth/callback")&&(n=(n="object"==typeof(n=Sr(wn(n=_n(e),"firebaseError")||null))?Xr(n):null)?new wo(t.c,t.b,null,null,n,null,t.R()):new wo(t.c,t.b,e,t.f,null,null,t.R())),e=n||o}Gu(i,e)})}var o=new wo("unknown",null,null,null,new Yr("no-auth-event")),t=!1,n=un(500).then(function(){return Yu(i).then(function(){t||Gu(i,o)})}),r=l.handleOpenURL;l.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(mr("BuildInfo.packageName",l).toLowerCase()+"://")&&e({url:t}),"function"==typeof r)try{r(t)}catch(t){console.error(t)}},So=So||new Eo,function(t){var n=So;n.a.push(t),n.b||(n.b=function(t){for(var e=0;e<n.a.length;e++)n.a[e](t)},"function"==typeof(t=mr("universalLinks.subscribe",l))&&t(null,n.b))}(e)}(r)})})),r.f}function Yu(e){var n=null;return function(t){return t.b.get(Ru,t.a).then(function(t){return _o(t)})}(e.g).then(function(t){return n=t,Nu((t=e.g).b,Ru,t.a)}).then(function(){return n})}function Xu(t){this.a=t,this.b=Su()}(t=Qu.prototype).ia=function(){return this.Ba?this.Ba:this.Ba=(or(void 0)?ir().then(function(){return new jt(function(t,e){var n=l.document,r=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(r),t()},!1)})}):Xt(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof mr("universalLinks.subscribe",l))throw Ku("cordova-universal-links-plugin-fix is not installed");if(void 0===mr("BuildInfo.packageName",l))throw Ku("cordova-plugin-buildinfo is not installed");if("function"!=typeof mr("cordova.plugins.browsertab.openUrl",l))throw Ku("cordova-plugin-browsertab is not installed");if("function"!=typeof mr("cordova.InAppBrowser.open",l))throw Ku("cordova-plugin-inappbrowser is not installed")},function(){throw new Yr("cordova-not-ready")})},t.Fb=function(t,e){return e(new Yr("operation-not-supported-in-this-environment")),Yt()},t.Db=function(){return Xt(new Yr("operation-not-supported-in-this-environment"))},t.Rb=function(){return!1},t.Ob=function(){return!0},t.Jb=function(){return!0},t.Eb=function(t,e,n,r){if(this.c)return Xt(new Yr("redirect-operation-pending"));var i=this,o=l.document,a=null,s=null,u=null,c=null;return this.c=Yt().then(function(){return bo(e),zu(i)}).then(function(){return function(n,t,e,r,i){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),a=new wo(t,r,null,o,new Yr("no-auth-event"),null,i),s=mr("BuildInfo.packageName",l);if("string"!=typeof s)throw new Yr("invalid-cordova-configuration");var u=mr("BuildInfo.displayName",l),c={};if(yr().toLowerCase().match(/iphone|ipad|ipod/))c.ibi=s;else{if(!yr().toLowerCase().match(/android/))return Xt(new Yr("operation-not-supported-in-this-environment"));c.apn=s}u&&(c.appDisplayName=u),o=Hu(o),c.sessionId=o;var h=js(n.u,n.i,n.l,t,e,null,r,n.m,c,n.o,i);return n.ia().then(function(){var t=n.h;return n.v.a.set(Ru,a.A(),t)}).then(function(){var t=mr("cordova.plugins.browsertab.isAvailable",l);if("function"!=typeof t)throw new Yr("invalid-cordova-configuration");var e=null;t(function(t){if(t){if("function"!=typeof(e=mr("cordova.plugins.browsertab.openUrl",l)))throw new Yr("invalid-cordova-configuration");e(h)}else{if("function"!=typeof(e=mr("cordova.InAppBrowser.open",l)))throw new Yr("invalid-cordova-configuration");t=yr(),n.a=e(h,t.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||t.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}(i,t,e,n,r)}).then(function(){return new jt(function(e,t){s=function(){var t=mr("cordova.plugins.browsertab.close",l);return e(),"function"==typeof t&&t(),i.a&&"function"==typeof i.a.close&&(i.a.close(),i.a=null),!1},i.ya(s),u=function(){a=a||un(2e3).then(function(){t(new Yr("redirect-cancelled-by-user"))})},c=function(){kr()&&u()},o.addEventListener("resume",u,!1),yr().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",c,!1)}).s(function(t){return Yu(i).then(function(){throw t})})}).ka(function(){u&&o.removeEventListener("resume",u,!1),c&&o.removeEventListener("visibilitychange",c,!1),a&&a.cancel(),s&&i.La(s),i.c=null})},t.ya=function(e){this.b.push(e),zu(this).s(function(t){"auth/invalid-cordova-configuration"===t.code&&(t=new wo("unknown",null,null,null,new Yr("no-auth-event")),e(t))})},t.La=function(e){B(this.b,function(t){return t==e})};var Ju={name:"pendingRedirect",C:"session"};function $u(t){return Nu(t.b,Ju,t.a)}function Zu(t,e,n){this.i={},this.v=0,this.B=t,this.u=e,this.m=n,this.h=[],this.f=!1,this.l=_(this.o,this),this.b=new pc,this.w=new gc,this.g=new Xu(this.u+":"+this.m),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.w,this.c.linkViaPopup=this.w,this.c.reauthViaPopup=this.w,this.a=tc(this.B,this.u,this.m,Ii)}function tc(t,e,n,r){var i=fl.SDK_VERSION||null;return or()?new Qu(t,e,n,i,r):new Us(t,e,n,i,r)}function ec(e){e.f||(e.f=!0,e.a.ya(e.l));var n=e.a;return e.a.ia().s(function(t){throw e.a==n&&e.reset(),t})}function nc(n){n.a.Ob()&&ec(n).s(function(t){var e=new wo("unknown",null,null,null,new Yr("operation-not-supported-in-this-environment"));uc(t)&&n.o(e)}),n.a.Jb()||dc(n.b)}function rc(n,t){q(n.h,t)||n.h.push(t),n.f||function(t){return t.b.get(Ju,t.a).then(function(t){return"pending"==t})}(n.g).then(function(t){t?$u(n.g).then(function(){ec(n).s(function(t){var e=new wo("unknown",null,null,null,new Yr("operation-not-supported-in-this-environment"));uc(t)&&n.o(e)})}):nc(n)}).s(function(){nc(n)})}function ic(t,e){B(t.h,function(t){return t==e})}Zu.prototype.reset=function(){this.f=!1,this.a.La(this.l),this.a=tc(this.B,this.u,this.m),this.i={}},Zu.prototype.o=function(t){if(!t)throw new Yr("invalid-auth-event");if(6e5<=T()-this.v&&(this.i={},this.v=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.xb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.v=T())),e=!0;break}}return dc(this.b),e};var oc=new Ar(2e3,1e4),ac=new Ar(3e4,6e4);function sc(t,e,n,r,i,o,a){return t.a.Db(e,n,r,function(){t.f||(t.f=!0,t.a.ya(t.l))},function(){t.reset()},i,o,a)}function uc(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function cc(e,t,n,r,i){var o;return function(t){return t.b.set(Ju,"pending",t.a)}(e.g).then(function(){return e.a.Eb(t,n,r,i).s(function(t){if(uc(t))throw new Yr("operation-not-supported-in-this-environment");return o=t,$u(e.g).then(function(){throw o})}).then(function(){return e.a.Rb()?new jt(function(){}):$u(e.g).then(function(){return e.oa()}).then(function(){}).s(function(){})})})}function hc(t,e,n,r,i){return t.a.Fb(r,function(t){e.ja(n,null,t,i)},oc.get())}Zu.prototype.oa=function(){return this.b.oa()};var lc={};function fc(t,e,n){var r=e+":"+n;return lc[r]||(lc[r]=new Zu(t,e,n)),lc[r]}function pc(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function dc(t){t.g||(t.g=!0,vc(t,!1,null,null))}function yc(t){t.g&&!t.i&&vc(t,!1,null,null)}function mc(t,e){if(t.b=function(){return Yt(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function vc(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Xt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):mc(t,n):mc(t,{user:null}),t.f=[],t.c=[]}function gc(){}function bc(){this.vb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.vb},set:function(t){this.vb=t},enumerable:!1})}function wc(t,e){this.a=e,Lr(this,"verificationId",t)}function _c(t,e,n,r){return new mo(t).Va(e,n).then(function(t){return new wc(t,r)})}function Ec(t){var e=Si(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new Yr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Fr(this,{token:t,expirationTime:Dr(1e3*e.exp),authTime:Dr(1e3*e.auth_time),issuedAtTime:Dr(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function Tc(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function Sc(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}function Ic(t){this.f=t,this.b=this.a=null,this.c=0}function Cc(t,e){var n=e[Oa],r=e.refreshToken;e=Nc(e.expiresIn),t.b=n,t.c=e,t.a=r}function Nc(t){return T()+1e3*parseInt(t,10)}function Ac(e,t){return function(t,r){return new jt(function(e,n){"refresh_token"==r.grant_type&&r.refresh_token||"authorization_code"==r.grant_type&&r.code?qa(t,t.l+"?key="+encodeURIComponent(t.c),function(t){t?t.error?n(ks(t)):t.access_token&&t.refresh_token?e(t):n(new Yr("internal-error")):n(new Yr("network-request-failed"))},"POST",Pn(r).toString(),t.g,t.u.get()):n(new Yr("internal-error"))})}(e.f,t).then(function(t){return e.b=t.access_token,e.c=Nc(t.expires_in),e.a=t.refresh_token,{accessToken:e.b,expirationTime:e.c,refreshToken:e.a}}).s(function(t){throw"auth/user-token-expired"==t.code&&(e.a=null),t})}function kc(t,e){this.a=t||null,this.b=e||null,Fr(this,{lastSignInTime:Dr(e||null),creationTime:Dr(t||null)})}function Dc(t,e,n,r,i,o){Fr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function Rc(t,e){for(var n in Oe.call(this,t),e)this[n]=e[n]}function Oc(t,e,n){this.I=[],this.l=t.apiKey,this.m=t.appName,this.o=t.authDomain||null,t=fl.SDK_VERSION?dr(fl.SDK_VERSION):null,this.a=new Da(this.l,Ni(Ii),t),this.b=new Ic(this.a),qc(this,e[Oa]),Cc(this.b,e),Lr(this,"refreshToken",this.b.a),jc(this,n||{}),nn.call(this),this.J=!1,this.o&&gr()&&(this.i=fc(this.o,this.l,this.m)),this.O=[],this.h=null,this.w=function(e){return new Tc(function(){return e.G(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var t=e.b.c-T()-3e5;return 0<t?t:0})}(this),this.W=_(this.Ha,this);var r=this;this.ga=null,this.va=function(t){r.sa(t.g)},this.Z=null,this.P=[],this.ua=function(t){Mc(r,t.c)},this.Y=null}function Pc(t,e){t.Z&&Ge(t.Z,"languageCodeChanged",t.va),(t.Z=e)&&Qe(e,"languageCodeChanged",t.va)}function Mc(t,e){t.P=e,Ua(t.a,fl.SDK_VERSION?dr(fl.SDK_VERSION,t.P):null)}function xc(t,e){t.Y&&Ge(t.Y,"frameworkChanged",t.ua),(t.Y=e)&&Qe(e,"frameworkChanged",t.ua)}function Lc(e){try{return fl.app(e.m).auth()}catch(t){throw new Yr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+e.m+"'!")}}function Fc(t){t.B||t.w.b||(t.w.start(),Ge(t,"tokenChanged",t.W),Qe(t,"tokenChanged",t.W))}function Uc(t){Ge(t,"tokenChanged",t.W),t.w.stop()}function qc(t,e){t.ma=e,Lr(t,"_lat",e)}function Vc(t){for(var e=[],n=0;n<t.O.length;n++)e.push(t.O[n](t));return $t(e).then(function(){return t})}function Bc(t){t.i&&!t.J&&(t.J=!0,rc(t.i,t))}function jc(t,e){Fr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,tenantId:e.tenantId||null,metadata:new kc(e.createdAt,e.lastLoginAt),providerData:[]}),t.a.b=t.tenantId}function Wc(){}function Qc(t){return Yt().then(function(){if(t.B)throw new Yr("app-deleted")})}function Kc(t){return F(t.providerData,function(t){return t.providerId})}function Hc(t,e){e&&(Gc(t,e.providerId),t.providerData.push(e))}function Gc(t,e){B(t.providerData,function(t){return t.providerId==e})}function zc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Lr(t,e,n)}function Yc(e,t){e!=t&&(Fr(e,{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,email:t.email,emailVerified:t.emailVerified,phoneNumber:t.phoneNumber,isAnonymous:t.isAnonymous,tenantId:t.tenantId,providerData:[]}),t.metadata?Lr(e,"metadata",function(t){return new kc(t.a,t.b)}(t.metadata)):Lr(e,"metadata",new kc),L(t.providerData,function(t){Hc(e,t)}),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(e.b,t.b),Lr(e,"refreshToken",e.b.a))}function Xc(n){return n.G().then(function(t){var e=n.isAnonymous;return function(t,e){return Ns(t.a,us,{idToken:e}).then(_(t.zc,t))}(n,t).then(function(){return e||zc(n,"isAnonymous",!1),t})})}function Jc(t,e){e[Oa]&&t.ma!=e[Oa]&&(Cc(t.b,e),t.dispatchEvent(new Rc("tokenChanged")),qc(t,e[Oa]),zc(t,"refreshToken",t.b.a))}function $c(t,e){return Xc(t).then(function(){if(q(Kc(t),e))return Vc(t).then(function(){throw new Yr("provider-already-linked")})})}function Zc(t,e,n){return Ur({user:t,credential:go(e),additionalUserInfo:e=Oi(e),operationType:n})}function th(t,e){return Jc(t,e),t.reload().then(function(){return t})}function eh(n,r,t,e,i){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));if(n.h&&!i)return Xt(n.h);var o=Ri(t.providerId),a=Ir(n.uid+":::"),s=null;(!_r()||ar())&&n.o&&t.isOAuthProvider&&(s=js(n.o,n.l,n.m,r,t,null,a,fl.SDK_VERSION||null,null,null,n.tenantId));var u=er(s,o&&o.Da,o&&o.Ca);return e=e().then(function(){if(rh(n),!i)return n.G().then(function(){})}).then(function(){return sc(n.i,u,r,t,a,!!s,n.tenantId)}).then(function(){return new jt(function(t,e){n.ja(r,null,new Yr("cancelled-popup-request"),n.g||null),n.f=t,n.v=e,n.g=a,n.c=hc(n.i,n,r,u,a)})}).then(function(t){return u&&tr(u),t?Ur(t):null}).s(function(t){throw u&&tr(u),t}),ih(n,e,i)}function nh(e,t,n,r,i){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));if(e.h&&!i)return Xt(e.h);var o=null,a=Ir(e.uid+":::");return r=r().then(function(){if(rh(e),!i)return e.G().then(function(){})}).then(function(){return e.ca=a,Vc(e)}).then(function(t){return e.da&&(t=(t=e.da).b.set(sh,e.A(),t.a)),t}).then(function(){return cc(e.i,t,n,a,e.tenantId)}).s(function(t){if(o=t,e.da)return uh(e.da);throw o}).then(function(){if(o)throw o}),ih(e,r,i)}function rh(t){if(!t.i||!t.J){if(t.i&&!t.J)throw new Yr("internal-error");throw new Yr("auth-domain-config-required")}}function ih(t,e,n){var r=function(e,t,n){return e.h&&!n?(t.cancel(),Xt(e.h)):t.s(function(t){throw!t||"auth/user-disabled"!=t.code&&"auth/user-token-expired"!=t.code||(e.h||e.dispatchEvent(new Rc("userInvalidated")),e.h=t),t})}(t,e,n);return t.I.push(r),r.ka(function(){V(t.I,r)}),r}function oh(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[Oa]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-T())/1e3;var r=new Oc(e,n,t);return t.providerData&&L(t.providerData,function(t){t&&Hc(r,Ur(t))}),t.redirectEventId&&(r.ca=t.redirectEventId),r}function ah(t){this.a=t,this.b=Su()}pc.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},pc.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(vc(this,!0,null,t.a),Yt()):e.za(n,r)?function(e,t,n){n=n.za(t.c,t.b);var r=t.g,i=t.f,o=t.i,a=t.R(),s=!!t.c.match(/Redirect$/);n(r,i,a,o).then(function(t){vc(e,s,t,null)}).s(function(t){vc(e,s,null,t)})}(this,t,e):Xt(new Yr("invalid-auth-event")):(vc(this,!1,null,null),Yt())}else Xt(new Yr("invalid-auth-event"))},pc.prototype.oa=function(){var n=this;return new jt(function(t,e){n.b?n.b().then(t,e):(n.f.push(t),n.c.push(e),function(t){var e=new Yr("timeout");t.a&&t.a.cancel(),t.a=un(ac.get()).then(function(){t.b||(t.g=!0,vc(t,!0,null,e))})}(n))})},gc.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ja(t.c,null,t.a,t.b),Yt()):e.za(n,r)?function(t,e){var n=t.b,r=t.c;e.za(r,n)(t.g,t.f,t.R(),t.i).then(function(t){e.ja(r,t,null,n)}).s(function(t){e.ja(r,null,t,n)})}(t,e):Xt(new Yr("invalid-auth-event"))}else Xt(new Yr("invalid-auth-event"))},wc.prototype.confirm=function(t){return t=vo(this.verificationId,t),this.a(t)},Tc.prototype.start=function(){this.a=this.c,function e(n,t){n.stop();n.b=un(Sc(n,t)).then(function(){return e=l.document,n=null,kr()||!e?Yt():new jt(function(t){n=function(){kr()&&(e.removeEventListener("visibilitychange",n,!1),t())},e.addEventListener("visibilitychange",n,!1)}).s(function(t){throw e.removeEventListener("visibilitychange",n,!1),t});var e,n}).then(function(){return n.h()}).then(function(){e(n,!0)}).s(function(t){n.i(t)&&e(n,!1)})}(this,!0)},Tc.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},Ic.prototype.A=function(){return{apiKey:this.f.c,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},Ic.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Xt(new Yr("user-token-expired")):t||!this.b||T()>this.c-3e4?this.a?Ac(this,{grant_type:"refresh_token",refresh_token:this.a}):Yt(null):Yt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},kc.prototype.A=function(){return{lastLoginAt:this.b,createdAt:this.a}},S(Rc,Oe),S(Oc,nn),Oc.prototype.sa=function(t){this.ga=t,Fa(this.a,t)},Oc.prototype.ha=function(){return this.ga},Oc.prototype.Aa=function(){return W(this.P)},Oc.prototype.Ha=function(){this.w.b&&(this.w.stop(),this.w.start())},Lr(Oc.prototype,"providerId","firebase"),(t=Oc.prototype).reload=function(){var t=this;return ih(this,Qc(this).then(function(){return Xc(t).then(function(){return Vc(t)}).then(Wc)}))},t.dc=function(t){return this.G(t).then(function(t){return new Ec(t)})},t.G=function(t){var e=this;return ih(this,Qc(this).then(function(){return e.b.getToken(t)}).then(function(t){if(!t)throw new Yr("internal-error");return t.accessToken!=e.ma&&(qc(e,t.accessToken),e.dispatchEvent(new Rc("tokenChanged"))),zc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.zc=function(t){if(!(t=t.users)||!t.length)throw new Yr("internal-error");jc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt,tenantId:t.tenantId});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?F(t,function(t){return new Dc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[]}(t),n=0;n<e.length;n++)Hc(this,e[n]);zc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.Ac=function(t){return Mr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.gb(t)},t.gb=function(t){var e=this,n=null;return ih(this,t.f(this.a,this.uid).then(function(t){return Jc(e,t),n=Zc(e,t,"reauthenticate"),e.h=null,e.reload()}).then(function(){return n}),!0)},t.rc=function(t){return Mr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.eb(t)},t.eb=function(e){var n=this,r=null;return ih(this,$c(this,e.providerId).then(function(){return n.G()}).then(function(t){return e.b(n.a,t)}).then(function(t){return r=Zc(n,t,"link"),th(n,t)}).then(function(){return r}))},t.sc=function(t,e){var n=this;return ih(this,$c(this,"phone").then(function(){return _c(Lc(n),t,e,_(n.eb,n))}))},t.Bc=function(t,e){var n=this;return ih(this,Yt().then(function(){return _c(Lc(n),t,e,_(n.gb,n))}),!0)},t.rb=function(e){var n=this;return ih(this,this.G().then(function(t){return n.a.rb(t,e)}).then(function(t){return Jc(n,t),n.reload()}))},t.Sc=function(e){var n=this;return ih(this,this.G().then(function(t){return e.b(n.a,t)}).then(function(t){return Jc(n,t),n.reload()}))},t.sb=function(e){var n=this;return ih(this,this.G().then(function(t){return n.a.sb(t,e)}).then(function(t){return Jc(n,t),n.reload()}))},t.tb=function(e){if(void 0===e.displayName&&void 0===e.photoURL)return Qc(this);var n=this;return ih(this,this.G().then(function(t){return n.a.tb(t,{displayName:e.displayName,photoUrl:e.photoURL})}).then(function(t){return Jc(n,t),zc(n,"displayName",t.displayName||null),zc(n,"photoURL",t.photoUrl||null),L(n.providerData,function(t){"password"===t.providerId&&(Lr(t,"displayName",n.displayName),Lr(t,"photoURL",n.photoURL))}),Vc(n)}).then(Wc))},t.Qc=function(e){var n=this;return ih(this,Xc(this).then(function(t){return q(Kc(n),e)?function(t,e,n){return Ns(t,os,{idToken:e,deleteProvider:n})}(n.a,t,[e]).then(function(t){var e={};return L(t.providerUserInfo||[],function(t){e[t.providerId]=!0}),L(Kc(n),function(t){e[t]||Gc(n,t)}),e[mo.PROVIDER_ID]||Lr(n,"phoneNumber",null),Vc(n)}):Vc(n).then(function(){throw new Yr("no-such-provider")})}))},t.delete=function(){var e=this;return ih(this,this.G().then(function(t){return Ns(e.a,is,{idToken:t})}).then(function(){e.dispatchEvent(new Rc("userDeleted"))})).then(function(){for(var t=0;t<e.I.length;t++)e.I[t].cancel("app-deleted");Pc(e,null),xc(e,null),e.I=[],e.B=!0,Uc(e),Lr(e,"refreshToken",null),e.i&&ic(e.i,e)})},t.xb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.ca||null)==e||"reauthViaRedirect"==t&&(this.ca||null)==e)},t.ja=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.za=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?_(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?_(this.Cb,this):"linkViaRedirect"==t&&(this.ca||null)==e?_(this.Bb,this):"reauthViaRedirect"==t&&(this.ca||null)==e?_(this.Cb,this):null},t.tc=function(t){var e=this;return eh(this,"linkViaPopup",t,function(){return $c(e,t.providerId).then(function(){return Vc(e)})},!1)},t.Cc=function(t){return eh(this,"reauthViaPopup",t,function(){return Yt()},!0)},t.uc=function(t){var e=this;return nh(this,"linkViaRedirect",t,function(){return $c(e,t.providerId)},!1)},t.Dc=function(t){return nh(this,"reauthViaRedirect",t,function(){return Yt()},!0)},t.Bb=function(e,n,t,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return t=this.G().then(function(t){return Ja(i.a,{requestUri:e,postBody:r,sessionId:n,idToken:t})}).then(function(t){return o=Zc(i,t,"link"),th(i,t)}).then(function(){return o}),ih(this,t)},t.Cb=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return ih(this,Yt().then(function(){return Wi($a(i.a,{requestUri:t,sessionId:e,postBody:r,tenantId:n}),i.uid)}).then(function(t){return o=Zc(i,t,"reauthenticate"),Jc(i,t),i.h=null,i.reload()}).then(function(){return o}),!0)},t.jb=function(e){var n=this,r=null;return ih(this,this.G().then(function(t){return r=t,void 0===e||K(e)?{}:gi(new ui(e))}).then(function(t){return n.a.jb(r,t)}).then(function(t){if(n.email!=t)return n.reload()}).then(function(){}))},t.toJSON=function(){return this.A()},t.A=function(){var e={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.o,stsTokenManager:this.b.A(),redirectEventId:this.ca||null};return this.metadata&&z(e,this.metadata.A()),L(this.providerData,function(t){e.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(t))}),e};var sh={name:"redirectUser",C:"session"};function uh(t){return Nu(t.b,sh,t.a)}function ch(t){this.a=t,this.b=Su(),this.c=null,this.f=function(e){var n=fh("local"),r=fh("session"),i=fh("none");return function(n,r,i){var o=Cu(r,i),a=Iu(n,r.C);return n.get(r,i).then(function(t){var e=null;try{e=Sr(l.localStorage.getItem(o))}catch(t){}if(e&&!t)return l.localStorage.removeItem(o),n.set(r,e,i);e&&t&&"localStorage"!=a.type&&l.localStorage.removeItem(o)})}(e.b,n,e.a).then(function(){return e.b.get(r,e.a)}).then(function(t){return t?r:e.b.get(i,e.a).then(function(t){return t?i:e.b.get(n,e.a).then(function(t){return t?n:e.b.get(lh,e.a).then(function(t){return t?fh(t):n})})})}).then(function(t){return e.c=t,hh(e,t.C)}).s(function(){e.c||(e.c=n)})}(this),this.b.addListener(fh("local"),this.a,_(this.g,this))}function hh(t,e){var n,r=[];for(n in Eu)Eu[n]!==e&&r.push(Nu(t.b,fh(Eu[n]),t.a));return r.push(Nu(t.b,lh,t.a)),function(s){return new jt(function(n,e){var r=s.length,i=[];if(r)for(var t=function(t,e){r--,i[t]=e,0==r&&n(i)},o=function(t){e(t)},a=0;a<s.length;a++)Jt(s[a],E(t,a),o);else n(i)})}(r)}ch.prototype.g=function(){var e=this,n=fh("local");mh(this,function(){return Yt().then(function(){return e.c&&"local"!=e.c.C?e.b.get(n,e.a):null}).then(function(t){if(t)return hh(e,"local").then(function(){e.c=n})})})};var lh={name:"persistence",C:"session"};function fh(t){return{name:"authUser",C:t}}function ph(t,e){return mh(t,function(){return t.b.set(t.c,e.A(),t.a)})}function dh(t){return mh(t,function(){return Nu(t.b,t.c,t.a)})}function yh(t,e){return mh(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),oh(t||{})})})}function mh(t,e){return t.f=t.f.then(e,e),t.f}function vh(t){if(this.l=!1,Lr(this,"settings",new bc),Lr(this,"app",t),!Ih(this).options||!Ih(this).options.apiKey)throw new Yr("invalid-api-key");t=fl.SDK_VERSION?dr(fl.SDK_VERSION):null,this.b=new Da(Ih(this).options&&Ih(this).options.apiKey,Ni(Ii),t),this.O=[],this.m=[],this.J=[],this.Ub=fl.INTERNAL.createSubscribe(_(this.oc,this)),this.W=void 0,this.Vb=fl.INTERNAL.createSubscribe(_(this.pc,this)),Th(this,null),this.h=new ch(Ih(this).options.apiKey+":"+Ih(this).name),this.w=new ah(Ih(this).options.apiKey+":"+Ih(this).name),this.Y=kh(this,function(n){var t=Ih(n).options.authDomain,e=function(e){var t=function(t,e){return t.b.get(sh,t.a).then(function(t){return t&&e&&(t.authDomain=e),oh(t||{})})}(e.w,Ih(e).options.authDomain).then(function(t){return(e.B=t)&&(t.da=e.w),uh(e.w)});return kh(e,t)}(n).then(function(){return yh(n.h,t)}).then(function(e){return e?(e.da=n.w,n.B&&(n.B.ca||null)==(e.ca||null)?e:e.reload().then(function(){return ph(n.h,e).then(function(){return e})}).s(function(t){return"auth/network-request-failed"==t.code?e:dh(n.h)})):null}).then(function(t){Th(n,t||null)});return kh(n,e)}(this)),this.i=kh(this,function(e){return e.Y.then(function(){return _h(e)}).s(function(){}).then(function(){if(!e.l)return e.ma()}).s(function(){}).then(function(){if(!e.l){e.ga=!0;var t=e.h;t.b.addListener(fh("local"),t.a,e.ma)}})}(this)),this.ga=!1,this.ma=_(this.Nc,this),this.ub=_(this.aa,this),this.ua=_(this.bc,this),this.va=_(this.mc,this),this.Ha=_(this.nc,this),this.a=null,function(e){var n=Ih(e).options.authDomain,r=Ih(e).options.apiKey;n&&gr()&&(e.Tb=e.Y.then(function(){if(!e.l){if(e.a=fc(n,r,Ih(e).name),rc(e.a,e),Ch(e)&&Bc(Ch(e)),e.B){Bc(e.B);var t=e.B;t.sa(e.ha()),Pc(t,e),Mc(t=e.B,e.I),xc(t,e),e.B=null}return e.a}}))}(this),this.INTERNAL={},this.INTERNAL.delete=_(this.delete,this),this.INTERNAL.logFramework=_(this.vc,this),this.o=0,nn.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ha()},set:function(t){this.sa(t)},enumerable:!1}),t.Z=null,Object.defineProperty(t,"ti",{get:function(){return this.R()},set:function(t){this.nb(t)},enumerable:!1}),t.P=null}(this),this.I=[]}function gh(t){Oe.call(this,"languageCodeChanged"),this.g=t}function bh(t){Oe.call(this,"frameworkChanged"),this.c=t}function wh(t){return t.Tb||Xt(new Yr("auth-domain-config-required"))}function _h(t){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));var e=wh(t).then(function(){return t.a.oa()}).then(function(t){return t?Ur(t):null});return kh(t,e)}function Eh(e,t){var n={};return n.apiKey=Ih(e).options.apiKey,n.authDomain=Ih(e).options.authDomain,n.appName=Ih(e).name,e.Y.then(function(){return function(t,e,n,r){var i=new Oc(t,e);return n&&(i.da=n),r&&Mc(i,r),i.reload().then(function(){return i})}(n,t,e.w,e.Aa())}).then(function(t){return Ch(e)&&t.uid==Ch(e).uid?Yc(Ch(e),t):(Th(e,t),Bc(t)),e.aa(t)}).then(function(){Ah(e)})}function Th(t,e){Ch(t)&&(function(t,e){B(t.O,function(t){return t==e})}(Ch(t),t.ub),Ge(Ch(t),"tokenChanged",t.ua),Ge(Ch(t),"userDeleted",t.va),Ge(Ch(t),"userInvalidated",t.Ha),Uc(Ch(t))),e&&(e.O.push(t.ub),Qe(e,"tokenChanged",t.ua),Qe(e,"userDeleted",t.va),Qe(e,"userInvalidated",t.Ha),0<t.o&&Fc(e)),Lr(t,"currentUser",e),e&&(e.sa(t.ha()),Pc(e,t),Mc(e,t.I),xc(e,t))}function Sh(e,t){var n=null,r=null;return kh(e,t.then(function(t){return n=go(t),r=Oi(t),Eh(e,t)}).then(function(){return Ur({user:Ch(e),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function Ih(t){return t.app}function Ch(t){return t.currentUser}function Nh(t){return Ch(t)&&Ch(t)._lat||null}function Ah(t){if(t.ga){for(var e=0;e<t.m.length;e++)t.m[e]&&t.m[e](Nh(t));if(t.W!==t.getUid()&&t.J.length)for(t.W=t.getUid(),e=0;e<t.J.length;e++)t.J[e]&&t.J[e](Nh(t))}}function kh(t,e){return t.O.push(e),e.ka(function(){V(t.O,e)}),e}function Dh(){}function Rh(){this.a={},this.b=1e12}ch.prototype.mb=function(e){var n=null,r=this;return function(t){var e=new Yr("invalid-persistence-type"),n=new Yr("unsupported-persistence-type");t:{for(r in Eu)if(Eu[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(ur()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!vr()&&"none"!==t)throw n}}(e),mh(this,function(){return e!=r.c.C?r.b.get(r.c,r.a).then(function(t){return n=t,hh(r,e)}).then(function(){if(r.c=fh(e),n)return r.b.set(r.c,n,r.a)}):Yt()})},S(vh,nn),S(gh,Oe),S(bh,Oe),(t=vh.prototype).mb=function(t){return t=this.h.mb(t),kh(this,t)},t.sa=function(t){this.Z===t||this.l||(this.Z=t,Fa(this.b,this.Z),this.dispatchEvent(new gh(this.ha())))},t.ha=function(){return this.Z},t.Tc=function(){var t=l.navigator;this.sa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.vc=function(t){this.I.push(t),Ua(this.b,fl.SDK_VERSION?dr(fl.SDK_VERSION,this.I):null),this.dispatchEvent(new bh(this.I))},t.Aa=function(){return W(this.I)},t.nb=function(t){this.P===t||this.l||(this.P=t,this.b.b=this.P)},t.R=function(){return this.P},t.toJSON=function(){return{apiKey:Ih(this).options.apiKey,authDomain:Ih(this).options.authDomain,appName:Ih(this).name,currentUser:Ch(this)&&Ch(this).A()}},t.xb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ja=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.za=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?_(this.ac,this):null},t.ac=function(t,e,n,r){var i=this;t={requestUri:t,postBody:r,sessionId:e,tenantId:n},this.c&&(this.c.cancel(),this.c=null);var o=null,a=null,s=Xa(i.b,t).then(function(t){return o=go(t),a=Oi(t),t});return kh(this,t=i.Y.then(function(){return s}).then(function(t){return Eh(i,t)}).then(function(){return Ur({user:Ch(i),credential:o,additionalUserInfo:a,operationType:"signIn"})}))},t.Lc=function(e){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));var n=this,t=Ri(e.providerId),r=Ir(),i=null;(!_r()||ar())&&Ih(this).options.authDomain&&e.isOAuthProvider&&(i=js(Ih(this).options.authDomain,Ih(this).options.apiKey,Ih(this).name,"signInViaPopup",e,null,r,fl.SDK_VERSION||null,null,null,this.R()));var o=er(i,t&&t.Da,t&&t.Ca);return kh(this,t=wh(this).then(function(t){return sc(t,o,"signInViaPopup",e,r,!!i,n.R())}).then(function(){return new jt(function(t,e){n.ja("signInViaPopup",null,new Yr("cancelled-popup-request"),n.g),n.f=t,n.v=e,n.g=r,n.c=hc(n.a,n,"signInViaPopup",o,r)})}).then(function(t){return o&&tr(o),t?Ur(t):null}).s(function(t){throw o&&tr(o),t}))},t.Mc=function(t){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));var e=this;return kh(this,wh(this).then(function(){return function(t){return mh(t,function(){return t.b.set(lh,t.c.C,t.a)})}(e.h)}).then(function(){return cc(e.a,"signInViaRedirect",t,void 0,e.R())}))},t.oa=function(){var e=this;return _h(this).then(function(t){return e.a&&yc(e.a.b),t}).s(function(t){throw e.a&&yc(e.a.b),t})},t.Rc=function(t){if(!t)return Xt(new Yr("null-user"));if(this.P!=t.tenantId)return Xt(new Yr("tenant-id-mismatch"));var e=this,n={};n.apiKey=Ih(this).options.apiKey,n.authDomain=Ih(this).options.authDomain,n.appName=Ih(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.o,appName:t.m};var i=t.b,o={};return o[Oa]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-T())/1e3,e=new Oc(e,o),n&&(e.da=n),r&&Mc(e,r),Yc(e,t),e}(t,n,e.w,e.Aa());return kh(this,this.i.then(function(){if(Ih(e).options.apiKey!=t.l)return r.reload()}).then(function(){return Ch(e)&&t.uid==Ch(e).uid?(Yc(Ch(e),t),e.aa(t)):(Th(e,r),Bc(r),e.aa(r))}).then(function(){Ah(e)}))},t.pb=function(){var t=this,e=this.i.then(function(){return t.a&&yc(t.a.b),Ch(t)?(Th(t,null),dh(t.h).then(function(){Ah(t)})):Yt()});return kh(this,e)},t.Nc=function(){var r=this;return yh(this.h,Ih(this).options.authDomain).then(function(t){if(!r.l){var e;if(e=Ch(r)&&t){e=Ch(r).uid;var n=t.uid;e=null!=e&&""!==e&&null!=n&&""!==n&&e==n}if(e)return Yc(Ch(r),t),Ch(r).G();(Ch(r)||t)&&(Th(r,t),t&&(Bc(t),t.da=r.w),r.a&&rc(r.a,r),Ah(r))}})},t.aa=function(t){return ph(this.h,t)},t.bc=function(){Ah(this),this.aa(Ch(this))},t.mc=function(){this.pb()},t.nc=function(){this.pb()},t.oc=function(t){var e=this;this.addAuthTokenListener(function(){t.next(Ch(e))})},t.pc=function(t){var e=this;!function(t,e){t.J.push(e),kh(t,t.i.then(function(){!t.l&&q(t.J,e)&&t.W!==t.getUid()&&(t.W=t.getUid(),e(Nh(t)))}))}(this,function(){t.next(Ch(e))})},t.xc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then(function(){m(t)?t(Ch(r)):m(t.next)&&t.next(Ch(r))}),this.Ub(t,e,n)},t.wc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then(function(){r.W=r.getUid(),m(t)?t(Ch(r)):m(t.next)&&t.next(Ch(r))}),this.Vb(t,e,n)},t.cc=function(t){var e=this,n=this.i.then(function(){return Ch(e)?Ch(e).G(t).then(function(t){return{accessToken:t}}):null});return kh(this,n)},t.Hc=function(t){var n=this;return this.i.then(function(){return Sh(n,Ns(n.b,Es,{token:t}))}).then(function(t){var e=t.user;return zc(e,"isAnonymous",!1),n.aa(e),t})},t.Ic=function(t,e){var n=this;return this.i.then(function(){return Sh(n,Ns(n.b,Ts,{email:t,password:e}))})},t.Xb=function(t,e){var n=this;return this.i.then(function(){return Sh(n,Ns(n.b,ns,{email:t,password:e}))})},t.Ra=function(t){var e=this;return this.i.then(function(){return Sh(e,t.na(e.b))})},t.Gc=function(t){return Mr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Ra(t)},t.ob=function(){var n=this;return this.i.then(function(){var t=Ch(n);return t&&t.isAnonymous?Ur({user:t,credential:null,additionalUserInfo:Ur({providerId:null,isNewUser:!1}),operationType:"signIn"}):Sh(n,n.b.ob()).then(function(t){var e=t.user;return zc(e,"isAnonymous",!0),n.aa(e),t})})},t.getUid=function(){return Ch(this)&&Ch(this).uid||null},t.Wb=function(t){this.addAuthTokenListener(t),this.o++,0<this.o&&Ch(this)&&Fc(Ch(this))},t.Ec=function(e){var n=this;L(this.m,function(t){t==e&&n.o--}),this.o<0&&(this.o=0),0==this.o&&Ch(this)&&Uc(Ch(this)),this.removeAuthTokenListener(e)},t.addAuthTokenListener=function(t){var e=this;this.m.push(t),kh(this,this.i.then(function(){e.l||q(e.m,t)&&t(Nh(e))}))},t.removeAuthTokenListener=function(e){B(this.m,function(t){return t==e})},t.delete=function(){this.l=!0;for(var t=0;t<this.O.length;t++)this.O[t].cancel("app-deleted");return this.O=[],this.h&&(t=this.h).b.removeListener(fh("local"),t.a,this.ma),this.a&&(ic(this.a,this),yc(this.a.b)),Promise.resolve()},t.$b=function(t){return kh(this,function(t,e){return Ns(t,rs,{identifier:e,continueUri:br()?Jn():"http://localhost"}).then(function(t){return t.signinMethods||[]})}(this.b,t))},t.qc=function(t){return!!lo(t)},t.lb=function(e,n){var r=this;return kh(this,Yt().then(function(){var t=new ui(n);if(!t.c)throw new Yr("argument-error",li+" must be true when sending sign in link to email");return gi(t)}).then(function(t){return r.b.lb(e,t)}).then(function(){}))},t.Uc=function(t){return this.Ka(t).then(function(t){return t.data.email})},t.$a=function(t,e){return kh(this,this.b.$a(t,e).then(function(){}))},t.Ka=function(t){return kh(this,this.b.Ka(t).then(function(t){return new Vr(t)}))},t.Xa=function(t){return kh(this,this.b.Xa(t).then(function(){}))},t.kb=function(e,t){var n=this;return kh(this,Yt().then(function(){return void 0===t||K(t)?{}:gi(new ui(t))}).then(function(t){return n.b.kb(e,t)}).then(function(){}))},t.Kc=function(t,e){return kh(this,_c(this,t,e,_(this.Ra,this)))},t.Jc=function(n,r){var i=this;return kh(this,Yt().then(function(){var t=r||Jn(),e=ho(n,t);if(!(t=lo(t)))throw new Yr("argument-error","Invalid email link!");if(t.tenantId!==i.R())throw new Yr("tenant-id-mismatch");return i.Ra(e)}))},Dh.prototype.render=function(){},Dh.prototype.reset=function(){},Dh.prototype.getResponse=function(){},Dh.prototype.execute=function(){};var Oh=null;function Ph(t,e){return(e=Mh(e))&&t.a[e]||null}function Mh(t){return(t=void 0===t?1e12:t)?t.toString():null}function xh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=Vn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():Qe(this.f,"click",this.i)}function Lh(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function Fh(){}Rh.prototype.render=function(t,e){return this.a[this.b.toString()]=new xh(t,e),this.b++},Rh.prototype.reset=function(t){var e=Ph(this,t);t=Mh(t),e&&t&&(e.delete(),delete this.a[t])},Rh.prototype.getResponse=function(t){return(t=Ph(this,t))?t.getResponse():null},Rh.prototype.execute=function(t){(t=Ph(this,t))&&t.execute()},xh.prototype.getResponse=function(){return Lh(this),this.b},xh.prototype.execute=function(){Lh(this);var n=this;this.a||(this.a=setTimeout(function(){n.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var t=n.c.callback,e=n.c["expired-callback"];if(t)try{t(n.b)}catch(t){}n.a=setTimeout(function(){if(n.a=null,n.b=null,e)try{e()}catch(t){}n.h&&n.execute()},6e4)},500))},xh.prototype.delete=function(){Lh(this),this.g=!0,clearTimeout(this.a),this.a=null,Ge(this.f,"click",this.i)},Fh.prototype.g=function(){return Yt(Oh=Oh||new Rh)},Fh.prototype.c=function(){};var Uh=null;function qh(){this.b=l.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Vh=new Y($,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Bh=new Ar(3e4,6e4);qh.prototype.g=function(i){var o=this;return new jt(function(t,e){var r=setTimeout(function(){e(new Yr("network-request-failed"))},Bh.get());!l.grecaptcha||i!==o.f&&!o.b?(l[o.a]=function(){if(l.grecaptcha){o.f=i;var n=l.grecaptcha.render;l.grecaptcha.render=function(t,e){return t=n(t,e),o.b++,t},clearTimeout(r),t(l.grecaptcha)}else clearTimeout(r),e(new Yr("internal-error"));delete l[o.a]},Yt(Ta(nt(Vh,{onload:o.a,hl:i||""}))).s(function(){clearTimeout(r),e(new Yr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(r),t(l.grecaptcha))})},qh.prototype.c=function(){this.b--};var jh=null;function Wh(t,e,n,r,i,o,a){if(Lr(this,"type","recaptcha"),this.c=this.f=null,this.B=!1,this.u=e,this.g=null,a=a?Uh=Uh||new Fh:jh=jh||new qh,this.m=a,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Hh])throw new Yr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Gh],!l.document)throw new Yr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!Vn(e)||!this.i&&Vn(e).hasChildNodes())throw new Yr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.o=new Da(t,o||null,i||null),this.v=r||function(){return null};var s=this;this.l=[];var u=this.a[Qh];this.a[Qh]=function(t){if(zh(s,t),"function"==typeof u)u(t);else if("string"==typeof u){var e=mr(u,l);"function"==typeof e&&e(t)}};var c=this.a[Kh];this.a[Kh]=function(){if(zh(s,null),"function"==typeof c)c();else if("string"==typeof c){var t=mr(c,l);"function"==typeof t&&t()}}}var Qh="callback",Kh="expired-callback",Hh="sitekey",Gh="size";function zh(t,e){for(var n=0;n<t.l.length;n++)try{t.l[n](e)}catch(t){}}function Yh(t,e){return t.h.push(e),e.ka(function(){V(t.h,e)}),e}function Xh(t){if(t.B)throw new Yr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Jh(t,e,n){var r=!1;try{this.b=n||fl.app()}catch(t){throw new Yr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new Yr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().Aa()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=fl.SDK_VERSION?dr(fl.SDK_VERSION,o):null,Wh.call(this,n,t,e,function(){try{var e=i.b.auth().ha()}catch(t){e=null}return e},o,Ni(Ii),r)}function $h(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new Yr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].N(n[i])&&!o){if(e=e[i],i<0||i>=Zh.length)throw new Yr("internal-error","Argument validator received an unsupported number of arguments.");n=Zh[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.M+".";break t}r=null}}if(r)throw new Yr("argument-error",t+" failed: "+r)}(t=Wh.prototype).Ba=function(){var e=this;return this.f?this.f:this.f=Yh(this,Yt().then(function(){if(br()&&!sr())return ir();throw new Yr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return e.m.g(e.v())}).then(function(t){return e.g=t,Ns(e.o,ps,{})}).then(function(t){e.a[Hh]=t.recaptchaSiteKey}).s(function(t){throw e.f=null,t}))},t.render=function(){Xh(this);var n=this;return Yh(this,this.Ba().then(function(){if(null===n.c){var t=n.u;if(!n.i){var e=Vn(t);t=Wn("DIV"),e.appendChild(t)}n.c=n.g.render(t,n.a)}return n.c}))},t.verify=function(){Xh(this);var i=this;return Yh(this,this.render().then(function(r){return new jt(function(e){var t=i.g.getResponse(r);if(t)e(t);else{var n=function(t){t&&(function(t,e){B(t.l,function(t){return t==e})}(i,n),e(t))};i.l.push(n),i.i&&i.g.execute(i.c)}})}))},t.reset=function(){Xh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){Xh(this),this.B=!0,this.m.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=Vn(this.u);for(var e;e=t.firstChild;)t.removeChild(e)}},S(Jh,Wh);var Zh="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function tl(t,e){return{name:t||"",M:"a valid string",optional:!!e,N:h}}function el(t,e){return{name:t||"",M:"a boolean",optional:!!e,N:n}}function nl(t,e){return{name:t||"",M:"a valid object",optional:!!e,N:v}}function rl(t,e){return{name:t||"",M:"a function",optional:!!e,N:m}}function il(t,e){return{name:t||"",M:"null",optional:!!e,N:i}}function ol(n){return{name:n?n+"Credential":"credential",M:n?"a valid "+n+" credential":"a valid credential",optional:!1,N:function(t){if(!t)return!1;var e=!n||t.providerId===n;return!(!t.na||!e)}}}function al(){return{name:"applicationVerifier",M:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,N:function(t){return!!(t&&h(t.type)&&m(t.verify))}}}function sl(e,n,t,r){return{name:t||"",M:e.M+" or "+n.M,optional:!!r,N:function(t){return e.N(t)||n.N(t)}}}function ul(t,e){for(var n in e){var r=e[n].name;t[r]=ll(r,t[n],e[n].j)}}function cl(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:E(function(t){return this[t]},n),set:E(function(t,e,n,r){$h(t,[n],[r],!0),this[e]=r},r,n,e[n].Ya),enumerable:!0})}}function hl(t,e,n,r){t[e]=ll(e,n,r)}function ll(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return $h(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}ul(vh.prototype,{Xa:{name:"applyActionCode",j:[tl("code")]},Ka:{name:"checkActionCode",j:[tl("code")]},$a:{name:"confirmPasswordReset",j:[tl("code"),tl("newPassword")]},Xb:{name:"createUserWithEmailAndPassword",j:[tl("email"),tl("password")]},$b:{name:"fetchSignInMethodsForEmail",j:[tl("email")]},oa:{name:"getRedirectResult",j:[]},qc:{name:"isSignInWithEmailLink",j:[tl("emailLink")]},wc:{name:"onAuthStateChanged",j:[sl(nl(),rl(),"nextOrObserver"),rl("opt_error",!0),rl("opt_completed",!0)]},xc:{name:"onIdTokenChanged",j:[sl(nl(),rl(),"nextOrObserver"),rl("opt_error",!0),rl("opt_completed",!0)]},kb:{name:"sendPasswordResetEmail",j:[tl("email"),sl(nl("opt_actionCodeSettings",!0),il(null,!0),"opt_actionCodeSettings",!0)]},lb:{name:"sendSignInLinkToEmail",j:[tl("email"),nl("actionCodeSettings")]},mb:{name:"setPersistence",j:[tl("persistence")]},Gc:{name:"signInAndRetrieveDataWithCredential",j:[ol()]},ob:{name:"signInAnonymously",j:[]},Ra:{name:"signInWithCredential",j:[ol()]},Hc:{name:"signInWithCustomToken",j:[tl("token")]},Ic:{name:"signInWithEmailAndPassword",j:[tl("email"),tl("password")]},Jc:{name:"signInWithEmailLink",j:[tl("email"),tl("emailLink",!0)]},Kc:{name:"signInWithPhoneNumber",j:[tl("phoneNumber"),al()]},Lc:{name:"signInWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Mc:{name:"signInWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Rc:{name:"updateCurrentUser",j:[sl({name:"user",M:"an instance of Firebase User",optional:!1,N:function(t){return!!(t&&t instanceof Oc)}},il(),"user")]},pb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[tl(null,!0)]},Tc:{name:"useDeviceLanguage",j:[]},Uc:{name:"verifyPasswordResetCode",j:[tl("code")]}}),cl(vh.prototype,{lc:{name:"languageCode",Ya:sl(tl(),il(),"languageCode")},ti:{name:"tenantId",Ya:sl(tl(),il(),"tenantId")}}),(vh.Persistence=Eu).LOCAL="local",vh.Persistence.SESSION="session",vh.Persistence.NONE="none",ul(Oc.prototype,{delete:{name:"delete",j:[]},dc:{name:"getIdTokenResult",j:[el("opt_forceRefresh",!0)]},G:{name:"getIdToken",j:[el("opt_forceRefresh",!0)]},rc:{name:"linkAndRetrieveDataWithCredential",j:[ol()]},eb:{name:"linkWithCredential",j:[ol()]},sc:{name:"linkWithPhoneNumber",j:[tl("phoneNumber"),al()]},tc:{name:"linkWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},uc:{name:"linkWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Ac:{name:"reauthenticateAndRetrieveDataWithCredential",j:[ol()]},gb:{name:"reauthenticateWithCredential",j:[ol()]},Bc:{name:"reauthenticateWithPhoneNumber",j:[tl("phoneNumber"),al()]},Cc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Dc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},jb:{name:"sendEmailVerification",j:[sl(nl("opt_actionCodeSettings",!0),il(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[tl(null,!0)]},Qc:{name:"unlink",j:[tl("provider")]},rb:{name:"updateEmail",j:[tl("email")]},sb:{name:"updatePassword",j:[tl("password")]},Sc:{name:"updatePhoneNumber",j:[ol("phone")]},tb:{name:"updateProfile",j:[nl("profile")]}}),ul(Rh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),ul(Dh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),ul(jt.prototype,{ka:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),cl(bc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",Ya:el("appVerificationDisabledForTesting")}}),ul(wc.prototype,{confirm:{name:"confirm",j:[tl("verificationCode")]}}),hl(ji,"fromJSON",function(t){t=h(t)?JSON.parse(t):t;for(var e,n=[Yi,uo,po,Hi],r=0;r<n.length;r++)if(e=n[r](t))return e;return null},[sl(tl(),nl(),"json")]),hl(co,"credential",function(t,e){return new so(t,e)},[tl("email"),tl("password")]),ul(so.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),ul(Zi.prototype,{wa:{name:"addScope",j:[tl("scope")]},Ea:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(Zi,"credential",to,[sl(tl(),nl(),"token")]),hl(co,"credentialWithLink",ho,[tl("email"),tl("emailLink")]),ul(eo.prototype,{wa:{name:"addScope",j:[tl("scope")]},Ea:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(eo,"credential",no,[sl(tl(),nl(),"token")]),ul(ro.prototype,{wa:{name:"addScope",j:[tl("scope")]},Ea:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(ro,"credential",io,[sl(tl(),sl(nl(),il()),"idToken"),sl(tl(),il(),"accessToken",!0)]),ul(oo.prototype,{Ea:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(oo,"credential",ao,[sl(tl(),nl(),"token"),tl("secret",!0)]),ul($i.prototype,{wa:{name:"addScope",j:[tl("scope")]},credential:{name:"credential",j:[sl(tl(),sl(nl(),il()),"optionsOrIdToken"),sl(tl(),il(),"accessToken",!0)]},Ea:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),ul(Gi.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),ul(Qi.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),hl(mo,"credential",vo,[tl("verificationId"),tl("verificationCode")]),ul(mo.prototype,{Va:{name:"verifyPhoneNumber",j:[tl("phoneNumber"),al()]}}),ul(fo.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),ul(Yr.prototype,{toJSON:{name:"toJSON",j:[tl(null,!0)]}}),ul(Co.prototype,{toJSON:{name:"toJSON",j:[tl(null,!0)]}}),ul(Io.prototype,{toJSON:{name:"toJSON",j:[tl(null,!0)]}}),ul(Jh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),hl(Zr,"parseLink",si,[tl("link")]),function(){if(void 0===fl||!fl.INTERNAL||!fl.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Br,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:vh,AuthCredential:ji,Error:Yr};hl(t,"EmailAuthProvider",co,[]),hl(t,"FacebookAuthProvider",Zi,[]),hl(t,"GithubAuthProvider",eo,[]),hl(t,"GoogleAuthProvider",ro,[]),hl(t,"TwitterAuthProvider",oo,[]),hl(t,"OAuthProvider",$i,[tl("providerId")]),hl(t,"SAMLAuthProvider",Ji,[tl("providerId")]),hl(t,"PhoneAuthProvider",mo,[{name:"auth",M:"an instance of Firebase Auth",optional:!0,N:function(t){return!!(t&&t instanceof vh)}}]),hl(t,"RecaptchaVerifier",Jh,[sl(tl(),{name:"",M:"an HTML element",optional:!1,N:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),nl("recaptchaParameters",!0),{name:"app",M:"an instance of Firebase App",optional:!0,N:function(t){return!!(t&&t instanceof fl.app.App)}}]),hl(t,"ActionCodeURL",Zr,[]),fl.INTERNAL.registerService("auth",function(t,e){return e({INTERNAL:{getUid:_((t=new vh(t)).getUid,t),getToken:_(t.cc,t),addAuthTokenListener:_(t.Wb,t),removeAuthTokenListener:_(t.Ec,t)}}),t},t,function(t,e){if("create"===t)try{e.auth()}catch(t){}}),fl.INTERNAL.extendNamespace({User:Oc})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var go=(bo.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Li(e))},bo.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:xi(e)},bo.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},bo.prototype.prefixedName_=function(t){return this.prefix_+t},bo.prototype.toString=function(){return this.domStorage_.toString()},bo);function bo(t){this.domStorage_=t,this.prefix_="firebase:"}var wo=(_o.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},_o.prototype.get=function(t){return Ui(this.cache_,t)?this.cache_[t]:null},_o.prototype.remove=function(t){delete this.cache_[t]},_o);function _o(){this.cache_={},this.isInMemoryStorage=!0}function Eo(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new go(e)}}catch(t){}return new wo}function To(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(55296<=i&&i<=56319){var o=i-55296;gi(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}(t),n=new ji;n.update(e);var r=n.digest();return wi.encodeByteArray(r)}function So(t,e){gi(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(Fo.logLevel=Zi.VERBOSE,Bo=Fo.log.bind(Fo),e&&Lo.set("logging_enabled",!0)):"function"==typeof t?Bo=t:(Bo=null,Lo.remove("logging_enabled"))}function Io(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===jo&&(jo=!1,null===Bo&&!0===Lo.get("logging_enabled")&&So(!0)),Bo){var n=Vo.apply(null,t);Bo(n)}}function Co(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Io.apply(void 0,di([n],t))}}function No(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+Vo.apply(void 0,di(t));Fo.error(n)}function Ao(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+Vo.apply(void 0,di(t));throw Fo.error(n),new Error(n)}function ko(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+Vo.apply(void 0,di(t));Fo.warn(n)}function Do(t){return"number"==typeof t&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)}function Ro(t,e){return t===e?0:t<e?-1:1}function Oo(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Li(e))}function Po(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)n<i+e?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r}var Mo,xo=Eo("localStorage"),Lo=Eo("sessionStorage"),Fo=new io("@firebase/database"),Uo="FIREBASE_DATABASE_EMULATOR_HOST",qo=(Mo=1,function(){return Mo++}),Vo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++)Array.isArray(t[r])||t[r]&&"object"==typeof t[r]&&"number"==typeof t[r].length?n+=Vo.apply(null,t[r]):"object"==typeof t[r]?n+=Li(t[r]):n+=t[r],n+=" ";return n},Bo=null,jo=!0,Wo="[MIN_NAME]",Qo="[MAX_NAME]",Ko=function(t,e){if(t===e)return 0;if(t===Wo||e===Qo)return-1;if(e===Wo||t===Qo)return 1;var n=$o(t),r=$o(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},Ho=function(t){if("object"!=typeof t||null===t)return Li(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=Li(e[i]),r+=":",r+=Ho(t[e[i]]);return r+="}"};function Go(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}function zo(t){var e,n,r,i,o,a,s;for(gi(!Do(t),"Invalid JSON number"),0===t?e=1/t==-1/(r=n=0)?1:0:(e=t<0,r=(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(t/Math.pow(2,-1074)))),a=[],o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse(),s=a.join("");var u="";for(o=0;o<64;o+=8){var c=parseInt(s.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()}function Yo(t){try{t()}catch(e){setTimeout(function(){var t=e.stack||"";throw ko("Exception was thrown by user callback.",t),e},Math.floor(0))}}function Xo(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n}var Jo=new RegExp("^-?\\d{1,10}$"),$o=function(t){if(Jo.test(t)){var e=Number(t);if(-2147483648<=e&&e<=2147483647)return e}return null},Zo=(Object.defineProperty(ta,"Empty",{get:function(){return new ta("")},enumerable:!0,configurable:!0}),ta.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},ta.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},ta.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new ta(this.pieces_,t)},ta.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},ta.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},ta.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},ta.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},ta.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],e=this.pieceNum_;e<this.pieces_.length-1;e++)t.push(this.pieces_[e]);return new ta(t,0)},ta.prototype.child=function(t){for(var e=[],n=this.pieceNum_;n<this.pieces_.length;n++)e.push(this.pieces_[n]);if(t instanceof ta)for(n=t.pieceNum_;n<t.pieces_.length;n++)e.push(t.pieces_[n]);else{var r=t.split("/");for(n=0;n<r.length;n++)0<r[n].length&&e.push(r[n])}return new ta(e,0)},ta.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},ta.relativePath=function(t,e){var n=t.getFront(),r=e.getFront();if(null===n)return e;if(n===r)return ta.relativePath(t.popFront(),e.popFront());throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")},ta.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=Ko(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},ta.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},ta.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},ta);function ta(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}var ea=(Object.defineProperty(na,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(na,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),na.prototype.push=function(t){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=$i(t),this.checkValid_()},na.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=$i(t),0<this.parts_.length&&(this.byteLength_-=1)},na.prototype.checkValid_=function(){if(this.byteLength_>na.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+na.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>na.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+na.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},na.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},na);function na(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=$i(this.parts_[n]);this.checkValid_()}var ra="firebaseio.com",ia="websocket",oa="long_polling",aa=(sa.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},sa.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},sa.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},sa.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},sa.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&xo.set("host:"+this.host,this.internalHost))},sa.prototype.connectionURL=function(t,e){var n;if(gi("string"==typeof t,"typeof type must == string"),gi("object"==typeof e,"typeof params must == object"),t===ia)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==oa)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return Go(e,function(t,e){r.push(t+"="+e)}),n+r.join("&")},sa.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},sa.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},sa);function sa(t,e,n,r,i,o){void 0===i&&(i=""),void 0===o&&(o=!1),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=xo.get("host:"+t)||this.host}function ua(t){var e=wa(t),n=e.namespace;"firebase"===e.domain&&Ao(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===e.domain||Ao("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&ko("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new aa(e.host,e.secure,n,r,"",n!=e.subdomain),path:new Zo(e.pathString)}}function ca(t){return"string"==typeof t&&0!==t.length&&!_a.test(t)}function ha(t){return"string"==typeof t&&0!==t.length&&!Ea.test(t)}function la(t){return null===t||"string"==typeof t||"number"==typeof t&&!Do(t)||t&&"object"==typeof t&&Ui(t,".sv")}function fa(t,e,n,r,i){i&&void 0===n||Sa(Yi(t,e,i),n,r)}function pa(t,e,n,r,i){if(!i||void 0!==n){var o=Yi(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];Go(n,function(t,e){var n=new Zo(t);if(Sa(o,e,r.child(n)),".priority"===n.getBack()&&!la(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!ca(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(Zo.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}}function da(t,e,n,r){if(!r||void 0!==n){if(Do(n))throw new Error(Yi(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!la(n))throw new Error(Yi(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function ya(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Yi(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}function ma(t,e,n,r){if(!(r&&void 0===n||ca(n)))throw new Error(Yi(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function va(t,e,n,r){if(!(r&&void 0===n||ha(n)))throw new Error(Yi(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')}function ga(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")}function ba(t,e,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!ca(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return t=t&&t.replace(/^\/*\.info(\/|$)/,"/"),ha(t)}(r))throw new Error(Yi(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')}var wa=function(t){var e="",n="",r="",i="",o="",a=!0,s="https",u=443;if("string"==typeof t){var c=t.indexOf("//");0<=c&&(s=t.substring(0,c-1),t=t.substring(c+2));var h=t.indexOf("/");-1===h&&(h=t.length);var l=t.indexOf("?");-1===l&&(l=t.length),e=t.substring(0,Math.min(h,l)),h<l&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(h,l)));var f=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var i=fi(t.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var s=a.split("=");2===s.length?r[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):ko("Invalid query segment '"+a+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,l)));0<=(c=e.indexOf(":"))?(a="https"===s||"wss"===s,u=parseInt(e.substring(c+1),10)):c=t.length;var p=e.split(".");3===p.length?(n=p[1],o=r=p[0].toLowerCase()):2===p.length?n=p[0]:"localhost"===p[0].slice(0,c).toLowerCase()&&(n="localhost"),"ns"in f&&(o=f.ns)}return{host:e,port:u,domain:n,subdomain:r,secure:a,scheme:s,pathString:i,namespace:o}},_a=/[\[\].#$\/\u0000-\u001F\u007F]/,Ea=/[\[\].#$\u0000-\u001F\u007F]/,Ta=10485760,Sa=function(n,t,e){var r=e instanceof Zo?new ea(e,n):e;if(void 0===t)throw new Error(n+"contains undefined "+r.toErrorString());if("function"==typeof t)throw new Error(n+"contains a function "+r.toErrorString()+" with contents = "+t.toString());if(Do(t))throw new Error(n+"contains "+t.toString()+" "+r.toErrorString());if("string"==typeof t&&t.length>Ta/3&&$i(t)>Ta)throw new Error(n+"contains a string greater than "+Ta+" utf8 bytes "+r.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(Go(t,function(t,e){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!ca(t)))throw new Error(n+" contains an invalid key ("+t+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(t),Sa(n,e,r),r.pop()}),i&&o)throw new Error(n+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},Ia=(Ca.prototype.cancel=function(t){zi("OnDisconnect.cancel",0,1,arguments.length),Xi("OnDisconnect.cancel",1,t,!0);var e=new Ti;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},Ca.prototype.remove=function(t){zi("OnDisconnect.remove",0,1,arguments.length),ga("OnDisconnect.remove",this.path_),Xi("OnDisconnect.remove",1,t,!0);var e=new Ti;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},Ca.prototype.set=function(t,e){zi("OnDisconnect.set",1,2,arguments.length),ga("OnDisconnect.set",this.path_),fa("OnDisconnect.set",1,t,this.path_,!1),Xi("OnDisconnect.set",2,e,!0);var n=new Ti;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},Ca.prototype.setWithPriority=function(t,e,n){zi("OnDisconnect.setWithPriority",2,3,arguments.length),ga("OnDisconnect.setWithPriority",this.path_),fa("OnDisconnect.setWithPriority",1,t,this.path_,!1),da("OnDisconnect.setWithPriority",2,e,!1),Xi("OnDisconnect.setWithPriority",3,n,!0);var r=new Ti;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},Ca.prototype.update=function(t,e){if(zi("OnDisconnect.update",1,2,arguments.length),ga("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,ko("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}pa("OnDisconnect.update",1,t,this.path_,!1),Xi("OnDisconnect.update",2,e,!0);var i=new Ti;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},Ca);function Ca(t,e){this.repo_=t,this.path_=e}var Na=(Aa.prototype.toJSON=function(){return zi("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},Aa);function Aa(t,e){this.committed=t,this.snapshot=e}var ka,Da,Ra,Oa=(ka="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Da=0,Ra=[],function(t){var e,n=t===Da;Da=t;var r=new Array(8);for(e=7;0<=e;e--)r[e]=ka.charAt(t%64),t=Math.floor(t/64);gi(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;0<=e&&63===Ra[e];e--)Ra[e]=0;Ra[e]++}else for(e=0;e<12;e++)Ra[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=ka.charAt(Ra[e]);return gi(20===i.length,"nextPushId: Length should be 20."),i}),Pa=(Ma.Wrap=function(t,e){return new Ma(t,e)},Ma);function Ma(t,e){this.name=t,this.node=e}var xa,La=(Fa.prototype.getCompare=function(){return this.compare.bind(this)},Fa.prototype.indexedValueChanged=function(t,e){var n=new Pa(Wo,t),r=new Pa(Wo,e);return 0!==this.compare(n,r)},Fa.prototype.minPost=function(){return Pa.MIN},Fa);function Fa(){}var Ua,qa=(ui(Va,Ua=La),Object.defineProperty(Va,"__EMPTY_NODE",{get:function(){return xa},set:function(t){xa=t},enumerable:!0,configurable:!0}),Va.prototype.compare=function(t,e){return Ko(t.name,e.name)},Va.prototype.isDefinedOn=function(t){throw bi("KeyIndex.isDefinedOn not expected to be called.")},Va.prototype.indexedValueChanged=function(t,e){return!1},Va.prototype.minPost=function(){return Pa.MIN},Va.prototype.maxPost=function(){return new Pa(Qo,xa)},Va.prototype.makePost=function(t,e){return gi("string"==typeof t,"KeyIndex indexValue must always be a string."),new Pa(t,xa)},Va.prototype.toString=function(){return".key"},Va);function Va(){return null!==Ua&&Ua.apply(this,arguments)||this}var Ba,ja=new qa;function Wa(t){return"number"==typeof t?"number:"+zo(t):"string:"+t}function Qa(t){if(t.isLeafNode()){var e=t.val();gi("string"==typeof e||"number"==typeof e||"object"==typeof e&&Ui(e,".sv"),"Priority must be a string or number.")}else gi(t===Ba||t.isEmpty(),"priority of unexpected type.");gi(t===Ba||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}var Ka,Ha,Ga,za,Ya=(Object.defineProperty(Xa,"__childrenNodeConstructor",{get:function(){return Ka},set:function(t){Ka=t},enumerable:!0,configurable:!0}),Xa.prototype.isLeafNode=function(){return!0},Xa.prototype.getPriority=function(){return this.priorityNode_},Xa.prototype.updatePriority=function(t){return new Xa(this.value_,t)},Xa.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:Xa.__childrenNodeConstructor.EMPTY_NODE},Xa.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:Xa.__childrenNodeConstructor.EMPTY_NODE},Xa.prototype.hasChild=function(){return!1},Xa.prototype.getPredecessorChildName=function(t,e){return null},Xa.prototype.updateImmediateChild=function(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:Xa.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)},Xa.prototype.updateChild=function(t,e){var n=t.getFront();return null===n?e:e.isEmpty()&&".priority"!==n?this:(gi(".priority"!==n||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(n,Xa.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),e)))},Xa.prototype.isEmpty=function(){return!1},Xa.prototype.numChildren=function(){return 0},Xa.prototype.forEachChild=function(t,e){return!1},Xa.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},Xa.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+Wa(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"==e?zo(this.value_):this.value_,this.lazyHash_=To(t)}return this.lazyHash_},Xa.prototype.getValue=function(){return this.value_},Xa.prototype.compareTo=function(t){return t===Xa.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof Xa.__childrenNodeConstructor?-1:(gi(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},Xa.prototype.compareToLeafNode_=function(t){var e=typeof t.value_,n=typeof this.value_,r=Xa.VALUE_TYPE_ORDER.indexOf(e),i=Xa.VALUE_TYPE_ORDER.indexOf(n);return gi(0<=r,"Unknown leaf type: "+e),gi(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:i-r},Xa.prototype.withIndex=function(){return this},Xa.prototype.isIndexed=function(){return!0},Xa.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},Xa.VALUE_TYPE_ORDER=["object","boolean","number","string"],Xa);function Xa(t,e){void 0===e&&(e=Xa.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=e,this.lazyHash_=null,gi(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Qa(this.priorityNode_)}function Ja(){return null!==za&&za.apply(this,arguments)||this}var $a=new(ui(Ja,za=La),Ja.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?Ko(t.name,e.name):i},Ja.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},Ja.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},Ja.prototype.minPost=function(){return Pa.MIN},Ja.prototype.maxPost=function(){return new Pa(Qo,new Ya("[PRIORITY-POST]",Ga))},Ja.prototype.makePost=function(t,e){var n=Ha(t);return new Pa(e,new Ya("[PRIORITY-POST]",n))},Ja.prototype.toString=function(){return".priority"},Ja),Za=(ts.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},ts.prototype.hasNext=function(){return 0<this.nodeStack_.length},ts.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},ts);function ts(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}var es=(ns.prototype.copy=function(t,e,n,r,i){return new ns(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},ns.prototype.count=function(){return this.left.count()+1+this.right.count()},ns.prototype.isEmpty=function(){return!1},ns.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},ns.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},ns.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},ns.prototype.minKey=function(){return this.min_().key},ns.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},ns.prototype.insert=function(t,e,n){var r,i;return(i=(r=n(t,(i=this).key))<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp_()},ns.prototype.removeMin_=function(){if(this.left.isEmpty())return os.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},ns.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return os.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},ns.prototype.isRed_=function(){return this.color},ns.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},ns.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},ns.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},ns.prototype.rotateLeft_=function(){var t=this.copy(null,null,ns.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},ns.prototype.rotateRight_=function(){var t=this.copy(null,null,ns.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},ns.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},ns.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},ns.prototype.check_=function(){var t;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((t=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},ns.RED=!0,ns.BLACK=!1,ns);function ns(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:ns.RED,this.left=null!=r?r:os.EMPTY_NODE,this.right=null!=i?i:os.EMPTY_NODE}var rs=(is.prototype.copy=function(t,e,n,r,i){return this},is.prototype.insert=function(t,e,n){return new es(t,e,null)},is.prototype.remove=function(t,e){return this},is.prototype.count=function(){return 0},is.prototype.isEmpty=function(){return!0},is.prototype.inorderTraversal=function(t){return!1},is.prototype.reverseTraversal=function(t){return!1},is.prototype.minKey=function(){return null},is.prototype.maxKey=function(){return null},is.prototype.check_=function(){return 0},is.prototype.isRed_=function(){return!1},is);function is(){}var os=(as.prototype.insert=function(t,e){return new as(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,es.BLACK,null,null))},as.prototype.remove=function(t){return new as(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,es.BLACK,null,null))},as.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:0<e&&(n=n.right)}return null},as.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:0<e&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},as.prototype.isEmpty=function(){return this.root_.isEmpty()},as.prototype.count=function(){return this.root_.count()},as.prototype.minKey=function(){return this.root_.minKey()},as.prototype.maxKey=function(){return this.root_.maxKey()},as.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},as.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},as.prototype.getIterator=function(t){return new Za(this.root_,null,this.comparator_,!1,t)},as.prototype.getIteratorFrom=function(t,e){return new Za(this.root_,t,this.comparator_,!1,e)},as.prototype.getReverseIteratorFrom=function(t,e){return new Za(this.root_,t,this.comparator_,!0,e)},as.prototype.getReverseIterator=function(t){return new Za(this.root_,null,this.comparator_,!0,t)},as.EMPTY_NODE=new rs,as);function as(t,e){void 0===e&&(e=as.EMPTY_NODE),this.comparator_=t,this.root_=e}var ss=Math.log(2),us=(cs.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},cs);function cs(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/ss,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}var hs,ls,fs=function(c,t,h,e){c.sort(t);var l=function(t,e){var n,r,i=e-t;if(0==i)return null;if(1==i)return n=c[t],r=h?h(n):n,new es(r,n.node,es.BLACK,null,null);var o=parseInt(i/2,10)+t,a=l(t,o),s=l(o+1,e);return n=c[o],r=h?h(n):n,new es(r,n.node,es.BLACK,a,s)},n=function(t){for(var e=null,n=null,s=c.length,r=function(t,e){var n=s-t,r=s;s-=t;var i=l(1+n,r),o=c[n],a=h?h(o):o;u(new es(a,o.node,e,null,i))},u=function(t){e=e?e.left=t:n=t},i=0;i<t.count;++i){var o=t.nextBitIsOne(),a=Math.pow(2,t.count-(i+1));o?r(a,es.BLACK):(r(a,es.BLACK),r(a,es.RED))}return n}(new us(c.length));return new os(e||t,n)},ps={},ds=(Object.defineProperty(ys,"Default",{get:function(){return gi($a,"ChildrenNode.ts has not been loaded"),hs=hs||new ys({".priority":ps},{".priority":$a})},enumerable:!0,configurable:!0}),ys.prototype.get=function(t){var e=qi(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof os?e:null},ys.prototype.hasIndex=function(t){return Ui(this.indexSet_,t.toString())},ys.prototype.addIndex=function(t,e){gi(t!==ja,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n,r=[],i=!1,o=e.getIterator(Pa.Wrap),a=o.getNext();a;)i=i||t.isDefinedOn(a.node),r.push(a),a=o.getNext();n=i?fs(r,t.getCompare()):ps;var s=t.toString(),u=ci({},this.indexSet_);u[s]=t;var c=ci({},this.indexes_);return c[s]=n,new ys(c,u)},ys.prototype.addToIndexes=function(u,c){var h=this;return new ys(Bi(this.indexes_,function(t,e){var n=qi(h.indexSet_,e);if(gi(n,"Missing index implementation for "+e),t===ps){if(n.isDefinedOn(u.node)){for(var r=[],i=c.getIterator(Pa.Wrap),o=i.getNext();o;)o.name!=u.name&&r.push(o),o=i.getNext();return r.push(u),fs(r,n.getCompare())}return ps}var a=c.get(u.name),s=t;return a&&(s=s.remove(new Pa(u.name,a))),s.insert(u,u.node)}),this.indexSet_)},ys.prototype.removeFromIndexes=function(n,r){return new ys(Bi(this.indexes_,function(t){if(t===ps)return t;var e=r.get(n.name);return e?t.remove(new Pa(n.name,e)):t}),this.indexSet_)},ys);function ys(t,e){this.indexes_=t,this.indexSet_=e}function ms(t,e){return Ko(t.name,e.name)}function vs(t,e){return Ko(t,e)}var gs,bs=(Object.defineProperty(ws,"EMPTY_NODE",{get:function(){return ls=ls||new ws(new os(vs),null,ds.Default)},enumerable:!0,configurable:!0}),ws.prototype.isLeafNode=function(){return!1},ws.prototype.getPriority=function(){return this.priorityNode_||ls},ws.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new ws(this.children_,t,this.indexMap_)},ws.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?ls:e},ws.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},ws.prototype.hasChild=function(t){return null!==this.children_.get(t)},ws.prototype.updateImmediateChild=function(t,e){if(gi(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);var n,r=new Pa(t,e),i=void 0,o=void 0;return o=e.isEmpty()?(i=this.children_.remove(t),this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,e),this.indexMap_.addToIndexes(r,this.children_)),n=i.isEmpty()?ls:this.priorityNode_,new ws(i,n,o)},ws.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;gi(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},ws.prototype.isEmpty=function(){return this.children_.isEmpty()},ws.prototype.numChildren=function(){return this.children_.count()},ws.prototype.val=function(n){if(this.isEmpty())return null;var r={},i=0,o=0,a=!0;if(this.forEachChild($a,function(t,e){r[t]=e.val(n),i++,a&&ws.INTEGER_REGEXP_.test(t)?o=Math.max(o,Number(t)):a=!1}),!n&&a&&o<2*i){var t=[];for(var e in r)t[e]=r[e];return t}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r},ws.prototype.hash=function(){if(null===this.lazyHash_){var r="";this.getPriority().isEmpty()||(r+="priority:"+Wa(this.getPriority().val())+":"),this.forEachChild($a,function(t,e){var n=e.hash();""!==n&&(r+=":"+t+":"+n)}),this.lazyHash_=""===r?"":To(r)}return this.lazyHash_},ws.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new Pa(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},ws.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},ws.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new Pa(e,this.children_.get(e)):null},ws.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},ws.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new Pa(e,this.children_.get(e)):null},ws.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},ws.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},ws.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,Pa.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},ws.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},ws.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,Pa.Wrap),i=r.peek();null!=i&&0<e.compare(i,t);)r.getNext(),i=r.peek();return r},ws.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Es?-1:0},ws.prototype.withIndex=function(t){if(t===ja||this.indexMap_.hasIndex(t))return this;var e=this.indexMap_.addIndex(t,this.children_);return new ws(this.children_,this.priorityNode_,e)},ws.prototype.isIndexed=function(t){return t===ja||this.indexMap_.hasIndex(t)},ws.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var n=this.getIterator($a),r=e.getIterator($a),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1},ws.prototype.resolveIndex_=function(t){return t===ja?null:this.indexMap_.get(t.toString())},ws.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,ws);function ws(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Qa(this.priorityNode_),this.children_.isEmpty()&&gi(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}function _s(){return gs.call(this,new os(vs),bs.EMPTY_NODE,ds.Default)||this}var Es=new(ui(_s,gs=bs),_s.prototype.compareTo=function(t){return t===this?0:1},_s.prototype.equals=function(t){return t===this},_s.prototype.getPriority=function(){return this},_s.prototype.getImmediateChild=function(t){return bs.EMPTY_NODE},_s.prototype.isEmpty=function(){return!1},_s);Object.defineProperties(Pa,{MIN:{value:new Pa(Wo,bs.EMPTY_NODE)},MAX:{value:new Pa(Qo,Es)}}),qa.__EMPTY_NODE=bs.EMPTY_NODE,Ya.__childrenNodeConstructor=bs,Ba=Es,Ga=Es;var Ts,Ss=!0;function Is(r,t){if(void 0===t&&(t=null),null===r)return bs.EMPTY_NODE;if("object"==typeof r&&".priority"in r&&(t=r[".priority"]),gi(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof r&&".value"in r&&null!==r[".value"]&&(r=r[".value"]),"object"!=typeof r||".sv"in r)return new Ya(r,Is(t));if(r instanceof Array||!Ss){var i=bs.EMPTY_NODE;return Go(r,function(t,e){if(Ui(r,t)&&"."!==t.substring(0,1)){var n=Is(e);!n.isLeafNode()&&n.isEmpty()||(i=i.updateImmediateChild(t,n))}}),i.updatePriority(Is(t))}var o=[],a=!1;if(Go(r,function(t,e){if("."!==t.substring(0,1)){var n=Is(e);n.isEmpty()||(a=a||!n.getPriority().isEmpty(),o.push(new Pa(t,n)))}}),0==o.length)return bs.EMPTY_NODE;var e=fs(o,ms,function(t){return t.name},vs);if(a){var n=fs(o,$a.getCompare());return new bs(e,Is(t),new ds({".priority":n},{".priority":$a}))}return new bs(e,Is(t),ds.Default)}function Cs(){return null!==Ts&&Ts.apply(this,arguments)||this}Ha=Is;var Ns,As=new(ui(Cs,Ts=La),Cs.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?Ko(t.name,e.name):n},Cs.prototype.isDefinedOn=function(t){return!0},Cs.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},Cs.prototype.minPost=function(){return Pa.MIN},Cs.prototype.maxPost=function(){return Pa.MAX},Cs.prototype.makePost=function(t,e){var n=Is(t);return new Pa(e,n)},Cs.prototype.toString=function(){return".value"},Cs),ks=(ui(Ds,Ns=La),Ds.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},Ds.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},Ds.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?Ko(t.name,e.name):i},Ds.prototype.makePost=function(t,e){var n=Is(t),r=bs.EMPTY_NODE.updateChild(this.indexPath_,n);return new Pa(e,r)},Ds.prototype.maxPost=function(){var t=bs.EMPTY_NODE.updateChild(this.indexPath_,Es);return new Pa(Qo,t)},Ds.prototype.toString=function(){return this.indexPath_.slice().join("/")},Ds);function Ds(t){var e=Ns.call(this)||this;return e.indexPath_=t,gi(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),e}var Rs=(Os.prototype.val=function(){return zi("DataSnapshot.val",0,0,arguments.length),this.node_.val()},Os.prototype.exportVal=function(){return zi("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},Os.prototype.toJSON=function(){return zi("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},Os.prototype.exists=function(){return zi("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},Os.prototype.child=function(t){zi("DataSnapshot.child",0,1,arguments.length),t=String(t),va("DataSnapshot.child",1,t,!1);var e=new Zo(t),n=this.ref_.child(e);return new Os(this.node_.getChild(e),n,$a)},Os.prototype.hasChild=function(t){zi("DataSnapshot.hasChild",1,1,arguments.length),va("DataSnapshot.hasChild",1,t,!1);var e=new Zo(t);return!this.node_.getChild(e).isEmpty()},Os.prototype.getPriority=function(){return zi("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},Os.prototype.forEach=function(n){var r=this;return zi("DataSnapshot.forEach",1,1,arguments.length),Xi("DataSnapshot.forEach",1,n,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(t,e){return n(new Os(e,r.ref_.child(t),$a))})},Os.prototype.hasChildren=function(){return zi("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(Os.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),Os.prototype.numChildren=function(){return zi("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},Os.prototype.getRef=function(){return zi("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(Os.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),Os);function Os(t,e,n){this.node_=t,this.ref_=e,this.index_=n}var Ps=(Ms.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},Ms.prototype.getEventType=function(){return this.eventType},Ms.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},Ms.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Li(this.snapshot.exportVal())},Ms);function Ms(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}var xs=(Ls.prototype.getPath=function(){return this.path},Ls.prototype.getEventType=function(){return"cancel"},Ls.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},Ls.prototype.toString=function(){return this.path.toString()+":cancel"},Ls);function Ls(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}var Fs=(Us.prototype.respondsTo=function(t){return"value"===t},Us.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new Ps("value",this,new Rs(t.snapshotNode,e.getRef(),n))},Us.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){gi(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},Us.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new xs(this,t,e):null},Us.prototype.matches=function(t){return t instanceof Us&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},Us.prototype.hasAnyCallback=function(){return null!==this.callback_},Us);function Us(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}var qs,Vs=(Bs.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,Ui(this.callbacks_,e)},Bs.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new xs(this,t,e):null},Bs.prototype.createEvent=function(t,e){gi(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new Ps(t.type,this,new Rs(t.snapshotNode,n,r),t.prevName)},Bs.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){gi(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},Bs.prototype.matches=function(e){var n=this;if(e instanceof Bs){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var t=Object.keys(e.callbacks_),r=Object.keys(this.callbacks_),i=t.length;if(i===r.length){if(1!==i)return r.every(function(t){return e.callbacks_[t]===n.callbacks_[t]});var o=t[0],a=r[0];return!(a!==o||e.callbacks_[o]&&this.callbacks_[a]&&e.callbacks_[o]!==this.callbacks_[a])}}}return!1},Bs.prototype.hasAnyCallback=function(){return null!==this.callbacks_},Bs);function Bs(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}var js=(Object.defineProperty(Ws,"__referenceConstructor",{get:function(){return gi(qs,"Reference.ts has not been loaded"),qs},set:function(t){qs=t},enumerable:!0,configurable:!0}),Ws.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===ja){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!=Wo)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!=Qo)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===$a){if(null!=e&&!la(e)||null!=n&&!la(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(gi(t.getIndex()instanceof ks||t.getIndex()===As,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},Ws.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},Ws.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},Ws.prototype.getQueryParams=function(){return this.queryParams_},Ws.prototype.getRef=function(){return zi("Query.ref",0,0,arguments.length),new Ws.__referenceConstructor(this.repo,this.path)},Ws.prototype.on=function(t,e,n,r){zi("Query.on",2,4,arguments.length),ya("Query.on",1,t,!1),Xi("Query.on",2,e,!1);var i=Ws.getCancelAndContextArgs_("Query.on",n,r);if("value"===t)this.onValueEvent(e,i.cancel,i.context);else{var o={};o[t]=e,this.onChildEvent(o,i.cancel,i.context)}return e},Ws.prototype.onValueEvent=function(t,e,n){var r=new Fs(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},Ws.prototype.onChildEvent=function(t,e,n){var r=new Vs(t,e,n);this.repo.addEventCallbackForQuery(this,r)},Ws.prototype.off=function(t,e,n){zi("Query.off",0,3,arguments.length),ya("Query.off",1,t,!0),Xi("Query.off",2,e,!0),Ji("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new Fs(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new Vs(i,null,n||null)),this.repo.removeEventCallbackForQuery(this,r)},Ws.prototype.once=function(e,n,t,r){var i=this;zi("Query.once",1,4,arguments.length),ya("Query.once",1,e,!1),Xi("Query.once",2,n,!0);var o=Ws.getCancelAndContextArgs_("Query.once",t,r),a=!0,s=new Ti;s.promise.catch(function(){});var u=function(t){a&&(a=!1,i.off(e,u),n&&n.bind(o.context)(t),s.resolve(t))};return this.on(e,u,function(t){i.off(e,u),o.cancel&&o.cancel.bind(o.context)(t),s.reject(t)}),s.promise},Ws.prototype.limitToFirst=function(t){if(zi("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new Ws(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},Ws.prototype.limitToLast=function(t){if(zi("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new Ws(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},Ws.prototype.orderByChild=function(t){if(zi("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');va("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var e=new Zo(t);if(e.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new ks(e),r=this.queryParams_.orderBy(n);return Ws.validateQueryEndpoints_(r),new Ws(this.repo,this.path,r,!0)},Ws.prototype.orderByKey=function(){zi("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(ja);return Ws.validateQueryEndpoints_(t),new Ws(this.repo,this.path,t,!0)},Ws.prototype.orderByPriority=function(){zi("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy($a);return Ws.validateQueryEndpoints_(t),new Ws(this.repo,this.path,t,!0)},Ws.prototype.orderByValue=function(){zi("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(As);return Ws.validateQueryEndpoints_(t),new Ws(this.repo,this.path,t,!0)},Ws.prototype.startAt=function(t,e){void 0===t&&(t=null),zi("Query.startAt",0,2,arguments.length),fa("Query.startAt",1,t,this.path,!0),ma("Query.startAt",2,e,!0);var n=this.queryParams_.startAt(t,e);if(Ws.validateLimit_(n),Ws.validateQueryEndpoints_(n),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(e=t=null),new Ws(this.repo,this.path,n,this.orderByCalled_)},Ws.prototype.endAt=function(t,e){void 0===t&&(t=null),zi("Query.endAt",0,2,arguments.length),fa("Query.endAt",1,t,this.path,!0),ma("Query.endAt",2,e,!0);var n=this.queryParams_.endAt(t,e);if(Ws.validateLimit_(n),Ws.validateQueryEndpoints_(n),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new Ws(this.repo,this.path,n,this.orderByCalled_)},Ws.prototype.equalTo=function(t,e){if(zi("Query.equalTo",1,2,arguments.length),fa("Query.equalTo",1,t,this.path,!1),ma("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},Ws.prototype.toString=function(){return zi("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},Ws.prototype.toJSON=function(){return zi("Query.toJSON",0,1,arguments.length),this.toString()},Ws.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},Ws.prototype.queryIdentifier=function(){var t=this.queryObject(),e=Ho(t);return"{}"===e?"default":e},Ws.prototype.isEqual=function(t){if(zi("Query.isEqual",1,1,arguments.length),!(t instanceof Ws))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");var e=this.repo===t.repo,n=this.path.equals(t.path),r=this.queryIdentifier()===t.queryIdentifier();return e&&n&&r},Ws.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,Xi(t,3,r.cancel,!0),r.context=n,Ji(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(Yi(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(Ws.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),Ws);function Ws(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}var Qs=(Ks.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&0<this.children.size){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},Ks.prototype.remember=function(t,e){if(t.isEmpty())this.value=e,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,e);else{var n=t.getFront();this.children.has(n)||this.children.set(n,new Ks);var r=this.children.get(n);t=t.popFront(),r.remember(t,e)}},Ks.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild($a,function(t,e){n.remember(new Zo(t),e)}),this.forget(t)}if(0<this.children.size){var r=t.getFront();return t=t.popFront(),!this.children.has(r)||this.children.get(r).forget(t)&&this.children.delete(r),0===this.children.size}return!0},Ks.prototype.forEachTree=function(r,i){null!==this.value?i(r,this.value):this.forEachChild(function(t,e){var n=new Zo(r.toString()+"/"+t);e.forEachTree(n,i)})},Ks.prototype.forEachChild=function(n){this.children.forEach(function(t,e){n(e,t)})},Ks);function Ks(){this.value=null,this.children=new Map}function Hs(t,e){return t&&"object"==typeof t?(gi(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t}var Gs,zs,Ys=function(t,r){var i,e=t.getPriority().val(),n=Hs(e,r);if(t.isLeafNode()){var o=t,a=Hs(o.getValue(),r);return a!==o.getValue()||n!==o.getPriority().val()?new Ya(a,Is(n)):t}var s=t;return n!==(i=s).getPriority().val()&&(i=i.updatePriority(new Ya(n))),s.forEachChild($a,function(t,e){var n=Ys(e,r);n!==e&&(i=i.updateImmediateChild(t,n))}),i};(zs=Gs=Gs||{})[zs.OVERWRITE=0]="OVERWRITE",zs[zs.MERGE=1]="MERGE",zs[zs.ACK_USER_WRITE=2]="ACK_USER_WRITE",zs[zs.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var Xs=(Js.User=new Js(!0,!1,null,!1),Js.Server=new Js(!1,!0,null,!1),Js.forServerTaggedQuery=function(t){return new Js(!1,!0,t,!0)},Js);function Js(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,gi(!r||e,"Tagged queries must be from server.")}var $s,Zs=(tu.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return gi(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var e=this.affectedTree.subtree(new Zo(t));return new tu(Zo.Empty,e,this.revert)}return gi(this.path.getFront()===t,"operationForChild called for unrelated child."),new tu(this.path.popFront(),this.affectedTree,this.revert)},tu);function tu(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Gs.ACK_USER_WRITE,this.source=Xs.User}var eu=(nu.fromObject=function(t){var n=nu.Empty;return Go(t,function(t,e){n=n.set(new Zo(t),e)}),n},nu.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},nu.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:Zo.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null==i?null:{path:new Zo(n).child(i.path),value:i.value}},nu.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},nu.prototype.subtree=function(t){if(t.isEmpty())return this;var e=t.getFront(),n=this.children.get(e);return null!==n?n.subtree(t.popFront()):nu.Empty},nu.prototype.set=function(t,e){if(t.isEmpty())return new nu(e,this.children);var n=t.getFront(),r=(this.children.get(n)||nu.Empty).set(t.popFront(),e),i=this.children.insert(n,r);return new nu(this.value,i)},nu.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?nu.Empty:new nu(null,this.children);var e=t.getFront(),n=this.children.get(e);if(n){var r=n.remove(t.popFront()),i=void 0;return i=r.isEmpty()?this.children.remove(e):this.children.insert(e,r),null===this.value&&i.isEmpty()?nu.Empty:new nu(this.value,i)}return this},nu.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},nu.prototype.setTree=function(t,e){if(t.isEmpty())return e;var n=t.getFront(),r=(this.children.get(n)||nu.Empty).setTree(t.popFront(),e),i=void 0;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new nu(this.value,i)},nu.prototype.fold=function(t){return this.fold_(Zo.Empty,t)},nu.prototype.fold_=function(n,r){var i={};return this.children.inorderTraversal(function(t,e){i[t]=e.fold_(n.child(t),r)}),r(n,this.value,i)},nu.prototype.findOnPath=function(t,e){return this.findOnPath_(t,Zo.Empty,e)},nu.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},nu.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,Zo.Empty,e)},nu.prototype.foreachOnPath_=function(t,e,n){if(t.isEmpty())return this;this.value&&n(e,this.value);var r=t.getFront(),i=this.children.get(r);return i?i.foreachOnPath_(t.popFront(),e.child(r),n):nu.Empty},nu.prototype.foreach=function(t){this.foreach_(Zo.Empty,t)},nu.prototype.foreach_=function(n,r){this.children.inorderTraversal(function(t,e){e.foreach_(n.child(t),r)}),this.value&&r(n,this.value)},nu.prototype.foreachChild=function(n){this.children.inorderTraversal(function(t,e){e.value&&n(t,e.value)})},nu.Empty=new nu(null),nu);function nu(t,e){void 0===e&&(e=$s=$s||new os(Ro)),this.value=t,this.children=e}var ru=(iu.prototype.operationForChild=function(t){return this.path.isEmpty()?new iu(this.source,Zo.Empty):new iu(this.source,this.path.popFront())},iu);function iu(t,e){this.source=t,this.path=e,this.type=Gs.LISTEN_COMPLETE}var ou=(au.prototype.operationForChild=function(t){return this.path.isEmpty()?new au(this.source,Zo.Empty,this.snap.getImmediateChild(t)):new au(this.source,this.path.popFront(),this.snap)},au);function au(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Gs.OVERWRITE}var su=(uu.prototype.operationForChild=function(t){if(this.path.isEmpty()){var e=this.children.subtree(new Zo(t));return e.isEmpty()?null:e.value?new ou(this.source,Zo.Empty,e.value):new uu(this.source,Zo.Empty,e)}return gi(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new uu(this.source,this.path.popFront(),this.children)},uu.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},uu);function uu(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Gs.MERGE}var cu=(hu.prototype.isFullyInitialized=function(){return this.fullyInitialized_},hu.prototype.isFiltered=function(){return this.filtered_},hu.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},hu.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},hu.prototype.getNode=function(){return this.node_},hu);function hu(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}var lu=(fu.prototype.updateEventSnap=function(t,e,n){return new fu(new cu(t,e,n),this.serverCache_)},fu.prototype.updateServerSnap=function(t,e,n){return new fu(this.eventCache_,new cu(t,e,n))},fu.prototype.getEventCache=function(){return this.eventCache_},fu.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},fu.prototype.getServerCache=function(){return this.serverCache_},fu.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},fu.Empty=new fu(new cu(bs.EMPTY_NODE,!1,!1),new cu(bs.EMPTY_NODE,!1,!1)),fu);function fu(t,e){this.eventCache_=t,this.serverCache_=e}var pu=(du.valueChange=function(t){return new du(du.VALUE,t)},du.childAddedChange=function(t,e){return new du(du.CHILD_ADDED,e,t)},du.childRemovedChange=function(t,e){return new du(du.CHILD_REMOVED,e,t)},du.childChangedChange=function(t,e,n){return new du(du.CHILD_CHANGED,e,t,n)},du.childMovedChange=function(t,e){return new du(du.CHILD_MOVED,e,t)},du.CHILD_ADDED="child_added",du.CHILD_REMOVED="child_removed",du.CHILD_CHANGED="child_changed",du.CHILD_MOVED="child_moved",du.VALUE="value",du);function du(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}var yu=(mu.prototype.updateChild=function(t,e,n,r,i,o){gi(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()==n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(pu.childRemovedChange(e,a)):gi(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(pu.childAddedChange(e,n)):o.trackChildChange(pu.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},mu.prototype.updateFullNode=function(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild($a,function(t,e){n.hasChild(t)||i.trackChildChange(pu.childRemovedChange(t,e))}),n.isLeafNode()||n.forEachChild($a,function(t,e){if(r.hasChild(t)){var n=r.getImmediateChild(t);n.equals(e)||i.trackChildChange(pu.childChangedChange(t,e,n))}else i.trackChildChange(pu.childAddedChange(t,e))})),n.withIndex(this.index_)},mu.prototype.updatePriority=function(t,e){return t.isEmpty()?bs.EMPTY_NODE:t.updatePriority(e)},mu.prototype.filtersNodes=function(){return!1},mu.prototype.getIndexedFilter=function(){return this},mu.prototype.getIndex=function(){return this.index_},mu);function mu(t){this.index_=t}var vu=(gu.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;gi(e==pu.CHILD_ADDED||e==pu.CHILD_CHANGED||e==pu.CHILD_REMOVED,"Only child changes supported for tracking"),gi(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(e==pu.CHILD_ADDED&&i==pu.CHILD_REMOVED)this.changeMap.set(n,pu.childChangedChange(n,t.snapshotNode,r.snapshotNode));else if(e==pu.CHILD_REMOVED&&i==pu.CHILD_ADDED)this.changeMap.delete(n);else if(e==pu.CHILD_REMOVED&&i==pu.CHILD_CHANGED)this.changeMap.set(n,pu.childRemovedChange(n,r.oldSnap));else if(e==pu.CHILD_CHANGED&&i==pu.CHILD_ADDED)this.changeMap.set(n,pu.childAddedChange(n,t.snapshotNode));else{if(e!=pu.CHILD_CHANGED||i!=pu.CHILD_CHANGED)throw bi("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,pu.childChangedChange(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},gu.prototype.getChanges=function(){return Array.from(this.changeMap.values())},gu);function gu(){this.changeMap=new Map}function bu(){}var wu=new(bu.prototype.getCompleteChild=function(t){return null},bu.prototype.getChildAfterChild=function(t,e,n){return null},bu),_u=(Eu.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new cu(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},Eu.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},Eu);function Eu(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}var Tu=function(t,e){this.viewCache=t,this.changes=e},Su=(Iu.prototype.assertIndexed=function(t){gi(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),gi(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},Iu.prototype.applyOperation=function(t,e,n,r){var i,o,a=new vu;if(e.type===Gs.OVERWRITE){var s=e;i=s.source.fromUser?this.applyUserOverwrite_(t,s.path,s.snap,n,r,a):(gi(s.source.fromServer,"Unknown source."),o=s.source.tagged||t.getServerCache().isFiltered()&&!s.path.isEmpty(),this.applyServerOverwrite_(t,s.path,s.snap,n,r,o,a))}else if(e.type===Gs.MERGE){var u=e;i=u.source.fromUser?this.applyUserMerge_(t,u.path,u.children,n,r,a):(gi(u.source.fromServer,"Unknown source."),o=u.source.tagged||t.getServerCache().isFiltered(),this.applyServerMerge_(t,u.path,u.children,n,r,o,a))}else if(e.type===Gs.ACK_USER_WRITE){var c=e;i=c.revert?this.revertUserWrite_(t,c.path,n,r,a):this.ackUserWrite_(t,c.path,c.affectedTree,n,r,a)}else{if(e.type!==Gs.LISTEN_COMPLETE)throw bi("Unknown operation type: "+e.type);i=this.listenComplete_(t,e.path,n,a)}var h=a.getChanges();return Iu.maybeAddValueEvent_(t,i,h),new Tu(i,h)},Iu.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(0<n.length||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(pu.valueChange(e.getCompleteEventSnap()))}},Iu.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var a=void 0,s=void 0;if(e.isEmpty())if(gi(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),c=u instanceof bs?u:bs.EMPTY_NODE,h=n.calcCompleteEventChildren(c);a=this.filter_.updateFullNode(t.getEventCache().getNode(),h,i)}else{var l=n.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var f=e.getFront();if(".priority"==f){gi(1==e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();s=t.getServerCache().getNode();var d=n.calcEventCacheAfterServerOverwrite(e,p,s);a=null!=d?this.filter_.updatePriority(p,d):o.getNode()}else{var y=e.popFront(),m=void 0;if(o.isCompleteForChild(f)){s=t.getServerCache().getNode();var v=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),s);m=null!=v?o.getNode().getImmediateChild(f).updateChild(y,v):o.getNode().getImmediateChild(f)}else m=n.calcCompleteChild(f,t.getServerCache());a=null!=m?this.filter_.updateChild(o.getNode(),f,m,y,r,i):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},Iu.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&1<e.getLength())return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);s=".priority"==l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,wu,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new _u(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,a)},Iu.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new _u(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):bs.EMPTY_NODE}if(f.equals(p))a=t;else{var y=this.filter_.updateChild(u.getNode(),h,p,l,c,o);a=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},Iu.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},Iu.prototype.applyUserMerge_=function(r,i,t,o,a,s){var u=this,c=r;return t.foreach(function(t,e){var n=i.child(t);Iu.cacheHasChild_(r,n.getFront())&&(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),t.foreach(function(t,e){var n=i.child(t);Iu.cacheHasChild_(r,n.getFront())||(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),c},Iu.prototype.applyMerge_=function(n,t){return t.foreach(function(t,e){n=n.updateChild(t,e)}),n},Iu.prototype.applyServerMerge_=function(o,t,e,a,s,u,c){var h=this;if(o.getServerCache().getNode().isEmpty()&&!o.getServerCache().isFullyInitialized())return o;var n,l=o;n=t.isEmpty()?e:eu.Empty.setTree(t,e);var f=o.getServerCache().getNode();return n.children.inorderTraversal(function(t,e){if(f.hasChild(t)){var n=o.getServerCache().getNode().getImmediateChild(t),r=h.applyMerge_(n,e);l=h.applyServerOverwrite_(l,new Zo(t),r,a,s,u,c)}}),n.children.inorderTraversal(function(t,e){var n=!o.getServerCache().isCompleteForChild(t)&&null==e.value;if(!f.hasChild(t)&&!n){var r=o.getServerCache().getNode().getImmediateChild(t),i=h.applyMerge_(r,e);l=h.applyServerOverwrite_(l,new Zo(t),i,a,s,u,c)}}),l},Iu.prototype.ackUserWrite_=function(t,r,e,n,i,o){if(null!=n.shadowingWrite(r))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=e.value){if(r.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(r))return this.applyServerOverwrite_(t,r,s.getNode().getChild(r),n,i,a,o);if(r.isEmpty()){var u=eu.Empty;return s.getNode().forEachChild(ja,function(t,e){u=u.set(new Zo(t),e)}),this.applyServerMerge_(t,r,u,n,i,a,o)}return t}var c=eu.Empty;return e.foreach(function(t,e){var n=r.child(t);s.isCompleteForPath(n)&&(c=c.set(t,s.getNode().getChild(n)))}),this.applyServerMerge_(t,r,c,n,i,a,o)},Iu.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,wu,r)},Iu.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var a=new _u(n,t,r),s=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var c=void 0;if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();gi(h instanceof bs,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(h)}c=c,u=this.filter_.updateFullNode(s,c,i)}else{var l=e.getFront(),f=n.calcCompleteChild(l,t.getServerCache());null==f&&t.getServerCache().isCompleteForChild(l)&&(f=s.getImmediateChild(l)),(u=null!=f?this.filter_.updateChild(s,l,f,e.popFront(),a,i):t.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(s,l,bs.EMPTY_NODE,e.popFront(),a,i):s).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(Zo.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},Iu);function Iu(t){this.filter_=t}var Cu=(Nu.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach(function(t){t.type===pu.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(pu.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,pu.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,pu.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,pu.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,pu.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,pu.VALUE,t,n,e),i},Nu.prototype.generateEventsForType_=function(r,e,t,i,o){var a=this,n=t.filter(function(t){return t.type===e});n.sort(this.compareChanges_.bind(this)),n.forEach(function(e){var n=a.materializeSingleChange_(e,o);i.forEach(function(t){t.respondsTo(e.type)&&r.push(t.createEvent(n,a.query_))})})},Nu.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},Nu.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw bi("Should only compare child_ events.");var n=new Pa(t.childName,t.snapshotNode),r=new Pa(e.childName,e.snapshotNode);return this.index_.compare(n,r)},Nu);function Nu(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}var Au,ku=(Du.prototype.getQuery=function(){return this.query_},Du.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},Du.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},Du.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},Du.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},Du.prototype.removeEventRegistration=function(t,n){var r=[];if(n){gi(null==t,"A cancel should cancel all event registrations.");var i=this.query_.path;this.eventRegistrations_.forEach(function(t){n=n;var e=t.createCancelEvent(n,i);e&&r.push(e)})}if(t){for(var e=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(t)){if(t.hasAnyCallback()){e=e.concat(this.eventRegistrations_.slice(o+1));break}}else e.push(a)}this.eventRegistrations_=e}else this.eventRegistrations_=[];return r},Du.prototype.applyOperation=function(t,e,n){t.type===Gs.MERGE&&null!==t.source.queryId&&(gi(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),gi(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),gi(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},Du.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];return e.getNode().isLeafNode()||e.getNode().forEachChild($a,function(t,e){n.push(pu.childAddedChange(t,e))}),e.isFullyInitialized()&&n.push(pu.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},Du.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},Du);function Du(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new yu(n.getIndex()),i=n.getNodeFilter();this.processor_=new Su(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(bs.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(bs.EMPTY_NODE,a.getNode(),null),c=new cu(s,o.isFullyInitialized(),r.filtersNodes()),h=new cu(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new lu(h,c),this.eventGenerator_=new Cu(this.query_)}var Ru=(Object.defineProperty(Ou,"__referenceConstructor",{get:function(){return gi(Au,"Reference.ts has not been loaded"),Au},set:function(t){gi(!Au,"__referenceConstructor has already been defined"),Au=t},enumerable:!0,configurable:!0}),Ou.prototype.isEmpty=function(){return 0===this.views.size},Ou.prototype.applyOperation=function(t,e,n){var r,i,o=t.source.queryId;if(null!==o){var a=this.views.get(o);return gi(null!=a,"SyncTree gave us an op for an invalid query."),a.applyOperation(t,e,n)}var s=[];try{for(var u=fi(this.views.values()),c=u.next();!c.done;c=u.next())a=c.value,s=s.concat(a.applyOperation(t,e,n))}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return s},Ou.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=this.views.get(o);if(!a){var s=n.calcCompleteEventCache(i?r:null),u=!1;u=!!s||(s=r instanceof bs?n.calcCompleteEventChildren(r):bs.EMPTY_NODE,!1);var c=new lu(new cu(s,u,!1),new cu(r,i,!1));a=new ku(t,c),this.views.set(o,a)}return a.addEventRegistration(e),a.getInitialEvents(e)},Ou.prototype.removeEventRegistration=function(t,e,n){var r,i,o=t.queryIdentifier(),a=[],s=[],u=this.hasCompleteView();if("default"===o)try{for(var c=fi(this.views.entries()),h=c.next();!h.done;h=c.next()){var l=pi(h.value,2),f=l[0],p=l[1];s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(f),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery()))}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}else(p=this.views.get(o))&&(s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(o),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery())));return u&&!this.hasCompleteView()&&a.push(new Ou.__referenceConstructor(t.repo,t.path)),{removed:a,events:s}},Ou.prototype.getQueryViews=function(){var e,t,n=[];try{for(var r=fi(this.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.getQuery().getQueryParams().loadsAllData()||n.push(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},Ou.prototype.getCompleteServerCache=function(t){var e,n,r=null;try{for(var i=fi(this.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;r=r||a.getCompleteServerCache(t)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},Ou.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},Ou.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},Ou.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},Ou.prototype.getCompleteView=function(){var e,t;try{for(var n=fi(this.views.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.getQuery().getQueryParams().loadsAllData())return i}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return null},Ou);function Ou(){this.views=new Map}var Pu=(Mu.prototype.addWrite=function(t,e){if(t.isEmpty())return new Mu(new eu(e));var n=this.writeTree_.findRootMostValueAndPath(t);if(null!=n){var r=n.path,i=n.value,o=Zo.relativePath(r,t);return i=i.updateChild(o,e),new Mu(this.writeTree_.set(r,i))}var a=new eu(e);return new Mu(this.writeTree_.setTree(t,a))},Mu.prototype.addWrites=function(n,t){var r=this;return Go(t,function(t,e){r=r.addWrite(n.child(t),e)}),r},Mu.prototype.removeWrite=function(t){return t.isEmpty()?Mu.Empty:new Mu(this.writeTree_.setTree(t,eu.Empty))},Mu.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},Mu.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(Zo.relativePath(e.path,t)):null},Mu.prototype.getCompleteChildren=function(){var n=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild($a,function(t,e){n.push(new Pa(t,e))}):this.writeTree_.children.inorderTraversal(function(t,e){null!=e.value&&n.push(new Pa(t,e.value))}),n},Mu.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var e=this.getCompleteNode(t);return new Mu(null!=e?new eu(e):this.writeTree_.subtree(t))},Mu.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},Mu.prototype.apply=function(t){return function n(r,t,i){if(null!=t.value)return i.updateChild(r,t.value);var o=null;return t.children.inorderTraversal(function(t,e){".priority"===t?(gi(null!==e.value,"Priority writes must always be leaf nodes"),o=e.value):i=n(r.child(t),e,i)}),i.getChild(r).isEmpty()||null===o||(i=i.updateChild(r.child(".priority"),o)),i}(Zo.Empty,this.writeTree_,t)},Mu.Empty=new Mu(new eu(null)),Mu);function Mu(t){this.writeTree_=t}var xu=(Lu.prototype.childWrites=function(t){return new Fu(t,this)},Lu.prototype.addOverwrite=function(t,e,n,r){gi(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},Lu.prototype.addMerge=function(t,e,n){gi(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},Lu.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},Lu.prototype.removeWrite=function(e){var n=this,t=this.allWrites_.findIndex(function(t){return t.writeId===e});gi(0<=t,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[t];this.allWrites_.splice(t,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&0<=a;){var s=this.allWrites_[a];s.visible&&(t<=a&&this.recordContainsPath_(s,r.path)?i=!1:r.path.contains(s.path)&&(o=!0)),a--}return!!i&&(o?this.resetTree_():r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):Go(r.children,function(t){n.visibleWrites_=n.visibleWrites_.removeWrite(r.path.child(t))}),!0)},Lu.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},Lu.prototype.calcCompleteEventCache=function(e,t,n,r){if(n||r){var i=this.visibleWrites_.childCompoundWrite(e);if(!r&&i.isEmpty())return t;if(r||null!=t||i.hasCompleteWrite(Zo.Empty)){var o=Lu.layerTree_(this.allWrites_,function(t){return(t.visible||r)&&(!n||!~n.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))},e);return u=t||bs.EMPTY_NODE,o.apply(u)}return null}var a=this.visibleWrites_.getCompleteNode(e);if(null!=a)return a;var s=this.visibleWrites_.childCompoundWrite(e);if(s.isEmpty())return t;if(null!=t||s.hasCompleteWrite(Zo.Empty)){var u=t||bs.EMPTY_NODE;return s.apply(u)}return null},Lu.prototype.calcCompleteEventChildren=function(t,e){var r=bs.EMPTY_NODE,n=this.visibleWrites_.getCompleteNode(t);if(n)return n.isLeafNode()||n.forEachChild($a,function(t,e){r=r.updateImmediateChild(t,e)}),r;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild($a,function(t,e){var n=i.childCompoundWrite(new Zo(t)).apply(e);r=r.updateImmediateChild(t,n)}),i.getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r},Lu.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){gi(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},Lu.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},Lu.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},Lu.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode(Zo.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},Lu.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1},Lu.prototype.resetTree_=function(){this.visibleWrites_=Lu.layerTree_(this.allWrites_,Lu.DefaultFilter_,Zo.Empty),0<this.allWrites_.length?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},Lu.DefaultFilter_=function(t){return t.visible},Lu.layerTree_=function(t,e,n){for(var r=Pu.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var a=o.path,s=void 0;if(o.snap)n.contains(a)?(s=Zo.relativePath(n,a),r=r.addWrite(s,o.snap)):a.contains(n)&&(s=Zo.relativePath(a,n),r=r.addWrite(Zo.Empty,o.snap.getChild(s)));else{if(!o.children)throw bi("WriteRecord should have .snap or .children");if(n.contains(a))s=Zo.relativePath(n,a),r=r.addWrites(s,o.children);else if(a.contains(n))if((s=Zo.relativePath(a,n)).isEmpty())r=r.addWrites(Zo.Empty,o.children);else{var u=qi(o.children,s.getFront());if(u){var c=u.getChild(s.popFront());r=r.addWrite(Zo.Empty,c)}}}}}return r},Lu);function Lu(){this.visibleWrites_=Pu.Empty,this.allWrites_=[],this.lastWriteId_=-1}var Fu=(Uu.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},Uu.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},Uu.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},Uu.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},Uu.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},Uu.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},Uu.prototype.child=function(t){return new Uu(this.treePath_.child(t),this.writeTree_)},Uu);function Uu(t,e){this.treePath_=t,this.writeTree_=e}var qu=(Vu.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new ou(Xs.User,t,e)):[]},Vu.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=eu.fromObject(e);return this.applyOperationToSyncPoints_(new su(Xs.User,t,r))},Vu.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=eu.Empty;return null!=n.snap?r=r.set(Zo.Empty,!0):Go(n.children,function(t,e){r=r.set(new Zo(t),e)}),this.applyOperationToSyncPoints_(new Zs(n.path,r,e))}return[]},Vu.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new ou(Xs.Server,t,e))},Vu.prototype.applyServerMerge=function(t,e){var n=eu.fromObject(e);return this.applyOperationToSyncPoints_(new su(Xs.Server,t,n))},Vu.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new ru(Xs.Server,t))},Vu.prototype.applyTaggedQueryOverwrite=function(t,e,n){var r=this.queryKeyForTag_(n);if(null==r)return[];var i=Vu.parseQueryKey_(r),o=i.path,a=i.queryId,s=Zo.relativePath(o,t),u=new ou(Xs.forServerTaggedQuery(a),s,e);return this.applyTaggedOperation_(o,u)},Vu.prototype.applyTaggedQueryMerge=function(t,e,n){var r=this.queryKeyForTag_(n);if(r){var i=Vu.parseQueryKey_(r),o=i.path,a=i.queryId,s=Zo.relativePath(o,t),u=eu.fromObject(e),c=new su(Xs.forServerTaggedQuery(a),s,u);return this.applyTaggedOperation_(o,c)}return[]},Vu.prototype.applyTaggedListenComplete=function(t,e){var n=this.queryKeyForTag_(e);if(n){var r=Vu.parseQueryKey_(n),i=r.path,o=r.queryId,a=Zo.relativePath(i,t),s=new ru(Xs.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(i,s)}return[]},Vu.prototype.addEventRegistration=function(t,e){var r=t.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,function(t,e){var n=Zo.relativePath(t,r);i=i||e.getCompleteServerCache(n),o=o||e.hasCompleteView()});var n,a=this.syncPointTree_.get(r);a?(o=o||a.hasCompleteView(),i=i||a.getCompleteServerCache(Zo.Empty)):(a=new Ru,this.syncPointTree_=this.syncPointTree_.set(r,a)),null!=i?n=!0:(n=!1,i=bs.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(t,e){var n=e.getCompleteServerCache(Zo.Empty);n&&(i=i.updateImmediateChild(t,n))}));var s=a.viewExistsForQuery(t);if(!s&&!t.getQueryParams().loadsAllData()){var u=Vu.makeQueryKey_(t);gi(!this.queryToTagMap.has(u),"View does not exist, but we have a tag");var c=Vu.getNextQueryTag_();this.queryToTagMap.set(u,c),this.tagToQueryMap.set(c,u)}var h=this.pendingWriteTree_.childWrites(r),l=a.addEventRegistration(t,e,h,i,n);if(!s&&!o){var f=a.viewForQuery(t);l=l.concat(this.setupListener_(t,f))}return l},Vu.prototype.removeEventRegistration=function(t,e,n){var r=this,i=t.path,o=this.syncPointTree_.get(i),a=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var s=o.removeEventRegistration(t,e,n);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(i));var u=s.removed;a=s.events;var c=-1!==u.findIndex(function(t){return t.getQueryParams().loadsAllData()}),h=this.syncPointTree_.findOnPath(i,function(t,e){return e.hasCompleteView()});if(c&&!h){var l=this.syncPointTree_.subtree(i);if(!l.isEmpty())for(var f=this.collectDistinctViewsForSubTree_(l),p=0;p<f.length;++p){var d=f[p],y=d.getQuery(),m=this.createListenerForView_(d);this.listenProvider_.startListening(Vu.queryForListening_(y),this.tagForQuery_(y),m.hashFn,m.onComplete)}}!h&&0<u.length&&!n&&(c?this.listenProvider_.stopListening(Vu.queryForListening_(t),null):u.forEach(function(t){var e=r.queryToTagMap.get(Vu.makeQueryKey_(t));r.listenProvider_.stopListening(Vu.queryForListening_(t),e)})),this.removeTags_(u)}return a},Vu.prototype.calcCompleteEventCache=function(i,t){var e=this.pendingWriteTree_,n=this.syncPointTree_.findOnPath(i,function(t,e){var n=Zo.relativePath(t,i),r=e.getCompleteServerCache(n);if(r)return r});return e.calcCompleteEventCache(i,n,t,!0)},Vu.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),Go(n,function(t,e){r=r.concat(e)}),r})},Vu.prototype.removeTags_=function(t){for(var e=0;e<t.length;++e){var n=t[e];if(!n.getQueryParams().loadsAllData()){var r=Vu.makeQueryKey_(n),i=this.queryToTagMap.get(r);this.queryToTagMap.delete(r),this.tagToQueryMap.delete(i)}}},Vu.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},Vu.prototype.setupListener_=function(t,e){var n=t.path,r=this.tagForQuery_(t),i=this.createListenerForView_(e),o=this.listenProvider_.startListening(Vu.queryForListening_(t),r,i.hashFn,i.onComplete),a=this.syncPointTree_.subtree(n);if(r)gi(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var s=a.fold(function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),Go(n,function(t,e){r=r.concat(e)}),r}),u=0;u<s.length;++u){var c=s[u];this.listenProvider_.stopListening(Vu.queryForListening_(c),this.tagForQuery_(c))}return o},Vu.prototype.createListenerForView_=function(t){var n=this,r=t.getQuery(),i=this.tagForQuery_(r);return{hashFn:function(){return(t.getServerCache()||bs.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return i?n.applyTaggedListenComplete(r.path,i):n.applyListenComplete(r.path);var e=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==t?n="Client doesn't have permission to access the desired data.":"unavailable"==t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,r);return n.removeEventRegistration(r,null,e)}}},Vu.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},Vu.parseQueryKey_=function(t){var e=t.indexOf("$");return gi(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Zo(t.substr(0,e))}},Vu.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},Vu.prototype.tagForQuery_=function(t){var e=Vu.makeQueryKey_(t);return this.queryToTagMap.get(e)},Vu.getNextQueryTag_=function(){return Vu.nextQueryTag_++},Vu.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);gi(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},Vu.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(Zo.Empty))},Vu.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(Zo.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(Zo.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},Vu.prototype.applyOperationDescendantsHelper_=function(o,t,a,s){var u=this,e=t.get(Zo.Empty);null==a&&null!=e&&(a=e.getCompleteServerCache(Zo.Empty));var c=[];return t.children.inorderTraversal(function(t,e){var n=a?a.getImmediateChild(t):null,r=s.child(t),i=o.operationForChild(t);i&&(c=c.concat(u.applyOperationDescendantsHelper_(i,e,n,r)))}),e&&(c=c.concat(e.applyOperation(o,s,a))),c},Vu.nextQueryTag_=1,Vu);function Vu(t){this.listenProvider_=t,this.syncPointTree_=eu.Empty,this.pendingWriteTree_=new xu,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}var Bu=(ju.prototype.getNode=function(t){return this.rootNode_.getChild(t)},ju.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},ju);function ju(){this.rootNode_=bs.EMPTY_NODE}var Wu=(Qu.prototype.getToken=function(t){return this.app_.INTERNAL.getToken(t).then(null,function(t){return t&&"auth/token-not-initialized"===t.code?(Io("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})},Qu.prototype.addTokenChangeListener=function(t){this.app_.INTERNAL.addAuthTokenListener(t)},Qu.prototype.removeTokenChangeListener=function(t){this.app_.INTERNAL.removeAuthTokenListener(t)},Qu.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ko(t)},Qu);function Qu(t){this.app_=t}var Ku=function(t){this.accessToken=t},Hu=(Gu.prototype.getToken=function(t){return Promise.resolve(new Ku("owner"))},Gu.prototype.addTokenChangeListener=function(t){},Gu.prototype.removeTokenChangeListener=function(t){},Gu.prototype.notifyForInvalidToken=function(){ko('Database emulator unexpectedly rejected fake "owner" credentials.')},Gu);function Gu(t){this.app_=t}var zu=(Yu.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),Ui(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},Yu.prototype.get=function(){return _i(this.counters_)},Yu);function Yu(){this.counters_={}}var Xu=(Ju.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new zu),this.collections_[e]},Ju.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},Ju.collections_={},Ju.reporters_={},Ju);function Ju(){}var $u=(Zu.prototype.get=function(){var t=this.collection_.get(),n=ci({},t);return this.last_&&Go(this.last_,function(t,e){n[t]=n[t]-e}),this.last_=t,n},Zu);function Zu(t){this.collection_=t,this.last_=null}var tc=(ec.prototype.includeStat=function(t){this.statsToReport_[t]=!0},ec.prototype.reportStats_=function(){var n=this,t=this.statsListener_.get(),r={},i=!1;Go(t,function(t,e){0<e&&Ui(n.statsToReport_,t)&&(r[t]=e,i=!0)}),i&&this.server_.reportStats(r),Xo(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},ec);function ec(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new $u(t);var n=1e4+2e4*Math.random();Xo(this.reportStats_.bind(this),Math.floor(n))}var nc=(rc.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new ic(i)),e.add(r)}e&&this.eventLists_.push(e)},rc.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.equals(e)})},rc.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.contains(e)||e.contains(t)})},rc.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];r&&(t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1)}e&&(this.eventLists_=[]),this.recursionDepth_--},rc);function rc(){this.eventLists_=[],this.recursionDepth_=0}var ic=(oc.prototype.add=function(t){this.events_.push(t)},oc.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();Bo&&Io("event: "+e.toString()),Yo(n)}}},oc.prototype.getPath=function(){return this.path_},oc);function oc(t){this.path_=t,this.events_=[]}var ac=(sc.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=di(this.listeners_[t]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},sc.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},sc.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},sc.prototype.validateEventType_=function(e){gi(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},sc);function sc(t){this.allowedEvents_=t,this.listeners_={},gi(Array.isArray(t)&&0<t.length,"Requires a non-empty array")}var uc,cc=(ui(hc,uc=ac),hc.getInstance=function(){return new hc},hc.prototype.getInitialEvent=function(t){return gi("visible"===t,"Unknown event type: "+t),[this.visible_]},hc);function hc(){var e,t,n=uc.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),n.visible_=!0,t&&document.addEventListener(t,function(){var t=!document[e];t!==n.visible_&&(n.visible_=t,n.trigger("visible",t))},!1),n}var lc,fc=(ui(pc,lc=ac),pc.getInstance=function(){return new pc},pc.prototype.getInitialEvent=function(t){return gi("online"===t,"Unknown event type: "+t),[this.online_]},pc.prototype.currentlyOnline=function(){return this.online_},pc);function pc(){var t=lc.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Ci()||(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}var dc=(yc.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},yc.prototype.handleResponse=function(t,e){var r=this;this.pendingResponses[t]=e;for(var n=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&Yo(function(){r.onMessage_(e[t])})},n=0;n<e.length;++n)t(n);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==n(););},yc);function yc(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}var mc=(vc.prototype.open=function(t,e){var a=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new dc(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){a.log_("Timed out trying to connect."),a.onClosed_(),a.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!a.isClosed_){a.scriptTagHolder=new gc(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=pi(t,5),r=n[0],i=n[1],o=n[2];if(n[3],n[4],a.incrementIncomingBytes_(t),a.scriptTagHolder)if(a.connectTimeoutTimer_&&(clearTimeout(a.connectTimeoutTimer_),a.connectTimeoutTimer_=null),a.everConnected_=!0,"start"==r)a.id=i,a.password=o;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);i?(a.scriptTagHolder.sendNewPolls=!1,a.myPacketOrderer.closeAfter(i,function(){a.onClosed_()})):a.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=pi(t,2),r=n[0],i=n[1];a.incrementIncomingBytes_(t),a.myPacketOrderer.handleResponse(r,i)},function(){a.onClosed_()},a.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),a.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=a.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",a.transportSessionId&&(t.s=a.transportSessionId),a.lastSessionId&&(t.ls=a.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(ra)&&(t.r="f");var e=a.urlFn(t);a.log_("Connecting via long-poll to "+e),a.scriptTagHolder.addTag(e,function(){})}})},vc.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},vc.forceAllow=function(){vc.forceAllow_=!0},vc.forceDisallow=function(){vc.forceDisallow_=!0},vc.isAvailable=function(){return!!vc.forceAllow_||!(vc.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)},vc.prototype.markConnectionHealthy=function(){},vc.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},vc.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},vc.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},vc.prototype.send=function(t){var e=Li(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=function(t){var e=yi(t);return wi.encodeByteArray(e,!0)}(e),r=Po(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},vc.prototype.addDisconnectPingFrame=function(t,e){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},vc.prototype.incrementIncomingBytes_=function(t){var e=Li(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},vc);function vc(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Co(t),this.stats_=Xu.getCollection(e),this.urlFn=function(t){return e.connectionURL(oa,t)}}var gc=(bc.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Io("No IE domain setting required")}catch(t){var n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},bc.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)},Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},bc.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},bc.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},bc.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},bc.prototype.addLongPollTag_=function(t,e){var n=this;function r(){n.outstandingRequests.delete(e),n.newRequest_()}this.outstandingRequests.add(e);var i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},bc.prototype.addTag=function(t,n){var r=this;setTimeout(function(){try{if(!r.sendNewPolls)return;var e=r.myIFrame.doc.createElement("script");e.type="text/javascript",e.async=!0,e.src=t,e.onload=e.onreadystatechange=function(){var t=e.readyState;t&&"loaded"!==t&&"complete"!==t||(e.onload=e.onreadystatechange=null,e.parentNode&&e.parentNode.removeChild(e),n())},e.onerror=function(){Io("Long-poll script failed to load: "+t),r.sendNewPolls=!1,r.close()},r.myIFrame.doc.body.appendChild(e)}catch(t){}},Math.floor(1))},bc);function bc(t,e,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=qo(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=bc.createIFrame_();var i="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i='<script>document.domain="'+document.domain+'";<\/script>');var o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(t){Io("frame writing exception"),t.stack&&Io(t.stack),Io(t)}}var wc="";var _c=null;"undefined"!=typeof MozWebSocket?_c=MozWebSocket:"undefined"!=typeof WebSocket&&(_c=WebSocket);var Ec=(Tc.connectionURL_=function(t,e,n){var r={v:"5"};return"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(ra)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL(ia,r)},Tc.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,xo.set("previous_websocket_failure",!0);try{if(Ai()){var r=vi.NODE_ADMIN?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/5/"+wc+"/"+process.platform+"/"+r}},o=process.env,a=0==this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a}),this.mySock=new _c(this.connURL,[],i)}else this.mySock=new _c(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var s=t.message||t.data;return s&&this.log_(s),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},Tc.prototype.start=function(){},Tc.forceDisallow=function(){Tc.forceDisallow_=!0},Tc.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&1<e.length&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==_c&&!Tc.forceDisallow_},Tc.previouslyFailed=function(){return xo.isInMemoryStorage||!0===xo.get("previous_websocket_failure")},Tc.prototype.markConnectionHealthy=function(){xo.remove("previous_websocket_failure")},Tc.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length==this.totalFrames){var e=this.frames.join("");this.frames=null;var n=xi(e);this.onMessage(n)}},Tc.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},Tc.prototype.extractFrameCount_=function(t){if(gi(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},Tc.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},Tc.prototype.send=function(t){this.resetKeepAlive();var e=Li(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=Po(e,16384);1<n.length&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},Tc.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},Tc.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},Tc.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},Tc.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},Tc.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},Tc.responsesRequiredToBeHealthy=2,Tc.healthyTimeout=3e4,Tc);function Tc(t,e,n,r){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Co(this.connId),this.stats_=Xu.getCollection(e),this.connURL=Tc.connectionURL_(e,n,r)}var Sc=(Object.defineProperty(Ic,"ALL_TRANSPORTS",{get:function(){return[mc,Ec]},enumerable:!0,configurable:!0}),Ic.prototype.initTransports_=function(t){var e,n,r=Ec&&Ec.isAvailable(),i=r&&!Ec.previouslyFailed();if(t.webSocketOnly&&(r||ko("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Ec];else{var o=this.transports_=[];try{for(var a=fi(Ic.ALL_TRANSPORTS),s=a.next();!s.done;s=a.next()){var u=s.value;u&&u.isAvailable()&&o.push(u)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}}},Ic.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},Ic.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},Ic);function Ic(t){this.initTransports_(t)}var Cc=(Nc.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;0<i&&(this.healthyTimeout_=Xo(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&102400<t.conn_.bytesReceived?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&10240<t.conn_.bytesSent?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},Nc.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},Nc.prototype.disconnReceiver_=function(e){var n=this;return function(t){e===n.conn_?n.onConnectionLost_(t):e===n.secondaryConn_?(n.log_("Secondary connection lost."),n.onSecondaryConnectionLost_()):n.log_("closing an old connection")}},Nc.prototype.connReceiver_=function(e){var n=this;return function(t){2!=n.state_&&(e===n.rx_?n.onPrimaryMessageReceived_(t):e===n.secondaryConn_?n.onSecondaryMessageReceived_(t):n.log_("message on old connection"))}},Nc.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},Nc.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},Nc.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},Nc.prototype.onSecondaryMessageReceived_=function(t){var e=Oo("t",t),n=Oo("d",t);if("c"==e)this.onSecondaryControl_(n);else{if("d"!=e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},Nc.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},Nc.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},Nc.prototype.onPrimaryMessageReceived_=function(t){var e=Oo("t",t),n=Oo("d",t);"c"==e?this.onControl_(n):"d"==e&&this.onDataMessage_(n)},Nc.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},Nc.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},Nc.prototype.onControl_=function(t){var e=Oo("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?No("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):No("Unknown control packet command: "+e)}},Nc.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&ko("Protocol version mismatch detected"),this.tryStartUpgrade_())},Nc.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},Nc.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Xo(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},Nc.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},Nc.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Xo(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},Nc.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},Nc.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},Nc.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(xo.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},Nc.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},Nc.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},Nc.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},Nc.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},Nc);function Nc(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Co("c:"+this.id+":"),this.transportManager_=new Sc(e),this.log_("Connection created"),this.start_()}var Ac=(kc.prototype.put=function(t,e,n,r){},kc.prototype.merge=function(t,e,n,r){},kc.prototype.refreshAuthToken=function(t){},kc.prototype.onDisconnectPut=function(t,e,n){},kc.prototype.onDisconnectMerge=function(t,e,n){},kc.prototype.onDisconnectCancel=function(t,e){},kc.prototype.reportStats=function(t){},kc);function kc(){}var Dc,Rc=(ui(Oc,Dc=Ac),Oc.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(Li(i)),gi(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},Oc.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),gi(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),gi(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)},Oc.prototype.sendListen_=function(r){var i=this,o=r.query,a=o.path.toString(),s=o.queryIdentifier();this.log_("Listen on "+a+" for "+s);var t={p:a};r.tag&&(t.q=o.queryObject(),t.t=r.tag),t.h=r.hashFn(),this.sendRequest("q",t,function(t){var e=t.d,n=t.s;Oc.warnOnListenWarnings_(e,o),(i.listens.get(a)&&i.listens.get(a).get(s))===r&&(i.log_("listen response",t),"ok"!==n&&i.removeListen_(a,s),r.onComplete&&r.onComplete(n,e))})},Oc.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&Ui(t,"w")){var n=qi(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();ko("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},Oc.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},Oc.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||function(t){var e=Fi(t).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},Oc.prototype.tryAuth=function(){var r=this;if(this.connected_&&this.authToken_){var i=this.authToken_,t=function(t){var e=Fi(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(i)?"auth":"gauth",e={cred:i};null===this.authOverride_?e.noauth=!0:"object"==typeof this.authOverride_&&(e.authvar=this.authOverride_),this.sendRequest(t,e,function(t){var e=t.s,n=t.d||"error";r.authToken_===i&&("ok"===e?r.invalidAuthTokenCount_=0:r.onAuthRevoked_(e,n))})}},Oc.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),gi(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},Oc.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},Oc.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},Oc.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},Oc.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},Oc.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},Oc.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},Oc.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},Oc.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+e)},Oc.prototype.sendPut_=function(e){var n=this,r=this.outstandingPuts_[e].action,t=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(r,t,function(t){n.log_(r+" response",t),delete n.outstandingPuts_[e],n.outstandingPutCount_--,0===n.outstandingPutCount_&&(n.outstandingPuts_=[]),i&&i(t.s,t.d)})},Oc.prototype.reportStats=function(t){var n=this;if(this.connected_){var e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,function(t){if("ok"!==t.s){var e=t.d;n.log_("reportStats","Error sending stats: "+e)}})}},Oc.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+Li(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},Oc.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):No("Unrecognized action received from server: "+Li(t)+"\nAre you using the latest client?")},Oc.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},Oc.prototype.scheduleConnect_=function(t){var e=this;gi(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},Oc.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},Oc.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},Oc.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},Oc.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Oc.nextConnectionId_++,o=this,a=this.lastSessionId,s=!1,u=null,c=function(){u?u.close():(s=!0,r())};this.realtime_={close:c,sendRequest:function(t){gi(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(t)}};var t=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(t).then(function(t){s?Io("getToken() completed but was canceled"):(Io("getToken() completed. Creating connection."),o.authToken_=t&&t.accessToken,u=new Cc(i,o.repoInfo_,e,n,r,function(t){ko(t+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")},a))}).then(null,function(t){o.log_("Failed to get token: "+t),s||c()})}},Oc.prototype.interrupt=function(t){Io("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},Oc.prototype.resume=function(t){Io("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Vi(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},Oc.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},Oc.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},Oc.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return Ho(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},Oc.prototype.removeListen_=function(t,e){var n,r=new Zo(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},Oc.prototype.onAuthRevoked_=function(t,e){Io("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},Oc.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},Oc.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth();try{for(var i=fi(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,fi(a.values())),u=s.next();!u.done;u=s.next()){var c=u.value;this.sendListen_(c)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var l=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(l.action,l.pathString,l.data,l.onComplete)}},Oc.prototype.sendConnectStats_=function(){var t={};t["sdk.js."+wc.replace(/\./g,"-")]=1,Ci()?t["framework.cordova"]=1:Ni()&&(t["framework.reactnative"]=1),this.reportStats(t)},Oc.prototype.shouldReconnect_=function(){var t=fc.getInstance().currentlyOnline();return Vi(this.interruptReasons_)&&t},Oc.nextPersistentConnectionId_=0,Oc.nextConnectionId_=0,Oc);function Oc(t,e,n,r,i,o){var a=Dc.call(this)||this;if(a.repoInfo_=t,a.onDataUpdate_=e,a.onConnectStatus_=n,a.onServerInfoUpdate_=r,a.authTokenProvider_=i,a.authOverride_=o,a.id=Oc.nextPersistentConnectionId_++,a.log_=Co("p:"+a.id+":"),a.interruptReasons_={},a.listens=new Map,a.outstandingPuts_=[],a.outstandingPutCount_=0,a.onDisconnectRequestQueue_=[],a.connected_=!1,a.reconnectDelay_=1e3,a.maxReconnectDelay_=3e5,a.securityDebugCallback_=null,a.lastSessionId=null,a.establishConnectionTimer_=null,a.visible_=!1,a.requestCBHash_={},a.requestNumber_=0,a.realtime_=null,a.authToken_=null,a.forceTokenRefresh_=!1,a.invalidAuthTokenCount_=0,a.firstConnection_=!0,a.lastConnectionAttemptTime_=null,a.lastConnectionEstablishedTime_=null,o&&!Ai())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return a.scheduleConnect_(0),cc.getInstance().on("visible",a.onVisible_,a),-1===t.host.indexOf("fblocal")&&fc.getInstance().on("online",a.onOnline_,a),a}var Pc,Mc=(ui(xc,Pc=Ac),xc.prototype.reportStats=function(t){throw new Error("Method not implemented.")},xc.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(gi(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},xc.prototype.listen=function(t,e,r,i){var o=this,a=t.path.toString();this.log_("Listen called for "+a+" "+t.queryIdentifier());var s=xc.getListenId_(t,r),u={};this.listens_[s]=u;var n=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",n,function(t,e){var n=e;404===t&&(t=n=null),null===t&&o.onDataUpdate_(a,n,!1,r),qi(o.listens_,s)===u&&i(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)})},xc.prototype.unlisten=function(t,e){var n=xc.getListenId_(t,e);delete this.listens_[n]},xc.prototype.refreshAuthToken=function(t){},xc.prototype.restRequest_=function(i,o,a){var s=this;void 0===o&&(o={}),o.format="export",this.authTokenProvider_.getToken(!1).then(function(t){var e=t&&t.accessToken;e&&(o.auth=e);var n=(s.repoInfo_.secure?"https://":"http://")+s.repoInfo_.host+i+"?ns="+s.repoInfo_.namespace+function(t){for(var n=[],e=function(e,t){Array.isArray(t)?t.forEach(function(t){n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}):n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];e(o[0],o[1])}return n.length?"&"+n.join("&"):""}(o);s.log_("Sending REST request for "+n);var r=new XMLHttpRequest;r.onreadystatechange=function(){if(a&&4===r.readyState){s.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);var t=null;if(200<=r.status&&r.status<300){try{t=xi(r.responseText)}catch(t){ko("Failed to parse JSON response for "+n+": "+r.responseText)}a(null,t)}else 401!==r.status&&404!==r.status&&ko("Got unsuccessful REST response for "+n+" Status: "+r.status),a(r.status);a=null}},r.open("GET",n,!0),r.send()})},xc);function xc(t,e,n){var r=Pc.call(this)||this;return r.repoInfo_=t,r.onDataUpdate_=e,r.authTokenProvider_=n,r.log_=Co("p:rest:"),r.listens_={},r}var Lc="repo_interrupt",Fc=(Uc.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},Uc.prototype.name=function(){return this.repoInfo_.namespace},Uc.prototype.serverTime=function(){var t=this.infoData_.getNode(new Zo(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},Uc.prototype.generateServerValues=function(){return function(t){return(t=t||{}).timestamp=t.timestamp||(new Date).getTime(),t}({timestamp:this.serverTime()})},Uc.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new Zo(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var a=Bi(e,function(t){return Is(t)});o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var s=Is(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,r)}else if(n){var u=Bi(e,function(t){return Is(t)});o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=Is(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;0<o.length&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},Uc.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},Uc.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},Uc.prototype.onServerInfoUpdate_=function(t){var n=this;Go(t,function(t,e){n.updateInfo_(t,e)})},Uc.prototype.updateInfo_=function(t,e){var n=new Zo("/.info/"+t),r=Is(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},Uc.prototype.getNextWriteId_=function(){return this.nextWriteId_++},Uc.prototype.setWithPriority=function(i,t,e,o){var a=this;this.log_("set",{path:i.toString(),value:t,priority:e});var n=this.generateServerValues(),r=Is(t,e),s=Ys(r,n),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(i,s,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(i.toString(),r.val(!0),function(t,e){var n="ok"===t;n||ko("set at "+i+" failed: "+t);var r=a.serverSyncTree_.ackUserWrite(u,!n);a.eventQueue_.raiseEventsForChangedPath(i,r),a.callOnCompleteCallback(o,t,e)});var h=this.abortTransactions_(i);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},Uc.prototype.update=function(o,t,a){var s=this;this.log_("update",{path:o.toString(),value:t});var r=!0,i=this.generateServerValues(),u={};if(Go(t,function(t,e){r=!1;var n=Is(e);u[t]=Ys(n,i)}),r)Io("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(a,"ok");else{var c=this.getNextWriteId_(),e=this.serverSyncTree_.applyUserMerge(o,u,c);this.eventQueue_.queueEvents(e),this.server_.merge(o.toString(),t,function(t,e){var n="ok"===t;n||ko("update at "+o+" failed: "+t);var r=s.serverSyncTree_.ackUserWrite(c,!n),i=0<r.length?s.rerunTransactions_(o):o;s.eventQueue_.raiseEventsForChangedPath(i,r),s.callOnCompleteCallback(a,t,e)}),Go(t,function(t){var e=s.abortTransactions_(o.child(t));s.rerunTransactions_(e)}),this.eventQueue_.raiseEventsForChangedPath(o,[])}},Uc.prototype.runOnDisconnectEvents_=function(){var r=this;this.log_("onDisconnectEvents");var t=this.generateServerValues(),e=function(t,n){var r=new Qs;return t.forEachTree(new Zo(""),function(t,e){r.remember(t,Ys(e,n))}),r}(this.onDisconnect_,t),i=[];e.forEachTree(Zo.Empty,function(t,e){i=i.concat(r.serverSyncTree_.applyServerOverwrite(t,e));var n=r.abortTransactions_(t);r.rerunTransactions_(n)}),this.onDisconnect_=new Qs,this.eventQueue_.raiseEventsForChangedPath(Zo.Empty,i)},Uc.prototype.onDisconnectCancel=function(n,r){var i=this;this.server_.onDisconnectCancel(n.toString(),function(t,e){"ok"===t&&i.onDisconnect_.forget(n),i.callOnCompleteCallback(r,t,e)})},Uc.prototype.onDisconnectSet=function(n,t,r){var i=this,o=Is(t);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},Uc.prototype.onDisconnectSetWithPriority=function(n,t,e,r){var i=this,o=Is(t,e);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},Uc.prototype.onDisconnectUpdate=function(r,n,i){var o=this;if(Vi(n))return Io("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(i,"ok");this.server_.onDisconnectMerge(r.toString(),n,function(t,e){"ok"===t&&Go(n,function(t,e){var n=Is(e);o.onDisconnect_.remember(r.child(t),n)}),o.callOnCompleteCallback(i,t,e)})},Uc.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},Uc.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},Uc.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(Lc)},Uc.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(Lc)},Uc.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;e=t?(this.statsListener_||(this.statsListener_=new $u(this.stats_)),this.statsListener_.get()):this.stats_.get();var i=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);Go(e,function(t,e){for(var n=t,r=t.length;r<i+2;r++)n+=" ";console.log(n+e)})}},Uc.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},Uc.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),Io.apply(void 0,di([n],t))},Uc.prototype.callOnCompleteCallback=function(r,i,o){r&&Yo(function(){if("ok"==i)r(null);else{var t=(i||"error").toUpperCase(),e=t;o&&(e+=": "+o);var n=new Error(e);n.code=t,r(n)}})},Object.defineProperty(Uc.prototype,"database",{get:function(){return this.__database||(this.__database=new rh(this))},enumerable:!0,configurable:!0}),Uc);function Uc(t,e,n){var r,a=this;if(this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new nc,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new Qs,this.persistentConnection_=null,r="undefined"!=typeof process&&process.env[Uo]?new Hu(n):new Wu(n),this.stats_=Xu.getCollection(t),e||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))this.server_=new Mc(this.repoInfo_,this.onDataUpdate_.bind(this),r),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var i=n.options.databaseAuthVariableOverride;if(null!=i){if("object"!=typeof i)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Li(i)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new Rc(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),r,i),this.server_=this.persistentConnection_}r.addTokenChangeListener(function(t){a.server_.refreshAuthToken(t)}),this.statsReporter_=Xu.getOrCreateReporter(t,function(){return new tc(a.stats_,a.server_)}),this.transactions_init_(),this.infoData_=new Bu,this.infoSyncTree_=new qu({startListening:function(t,e,n,r){var i=[],o=a.infoData_.getNode(t.path);return o.isEmpty()||(i=a.infoSyncTree_.applyServerOverwrite(t.path,o),setTimeout(function(){r("ok")},0)),i},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new qu({startListening:function(r,t,e,i){return a.server_.listen(r,e,t,function(t,e){var n=i(t,e);a.eventQueue_.raiseEventsForChangedPath(r.path,n)}),[]},stopListening:function(t,e){a.server_.unlisten(t,e)}})}var qc=(Vc.prototype.getStartPost=function(){return this.startPost_},Vc.prototype.getEndPost=function(){return this.endPost_},Vc.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},Vc.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new Pa(e,n))||(n=bs.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},Vc.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=bs.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(bs.EMPTY_NODE);var i=this;return e.forEachChild($a,function(t,e){i.matches(new Pa(t,e))||(r=r.updateImmediateChild(t,bs.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},Vc.prototype.updatePriority=function(t,e){return t},Vc.prototype.filtersNodes=function(){return!0},Vc.prototype.getIndexedFilter=function(){return this.indexedFilter_},Vc.prototype.getIndex=function(){return this.index_},Vc.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},Vc.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},Vc);function Vc(t){this.indexedFilter_=new yu(t.getIndex()),this.index_=t.getIndex(),this.startPost_=Vc.getStartPost_(t),this.endPost_=Vc.getEndPost_(t)}var Bc=(jc.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new Pa(e,n))||(n=bs.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},jc.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=bs.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=bs.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(bs.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();)a=i.getNext(),!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,bs.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},jc.prototype.updatePriority=function(t,e){return t},jc.prototype.filtersNodes=function(){return!0},jc.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},jc.prototype.getIndex=function(){return this.index_},jc.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(t,e){return a(e,t)}}else o=this.index_.getCompare();var s=t;gi(s.numChildren()==this.limit_,"");var u=new Pa(e,n),c=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(s.hasChild(e)){for(var l=s.getImmediateChild(e),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name==e||s.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var p=null==f?1:o(f,u);if(h&&!n.isEmpty()&&0<=p)return null!=i&&i.trackChildChange(pu.childChangedChange(e,n,l)),s.updateImmediateChild(e,n);null!=i&&i.trackChildChange(pu.childRemovedChange(e,l));var d=s.updateImmediateChild(e,bs.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(pu.childAddedChange(f.name,f.node)),d.updateImmediateChild(f.name,f.node)):d}return n.isEmpty()?t:h&&0<=o(c,u)?(null!=i&&(i.trackChildChange(pu.childRemovedChange(c.name,c.node)),i.trackChildChange(pu.childAddedChange(e,n))),s.updateImmediateChild(e,n).updateImmediateChild(c.name,bs.EMPTY_NODE)):t},jc);function jc(t){this.rangedFilter_=new qc(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}var Wc=(Qc.prototype.hasStart=function(){return this.startSet_},Qc.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===Qc.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},Qc.prototype.getIndexStartValue=function(){return gi(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},Qc.prototype.getIndexStartName=function(){return gi(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Wo},Qc.prototype.hasEnd=function(){return this.endSet_},Qc.prototype.getIndexEndValue=function(){return gi(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},Qc.prototype.getIndexEndName=function(){return gi(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Qo},Qc.prototype.hasLimit=function(){return this.limitSet_},Qc.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},Qc.prototype.getLimit=function(){return gi(this.limitSet_,"Only valid if limit has been set"),this.limit_},Qc.prototype.getIndex=function(){return this.index_},Qc.prototype.copy_=function(){var t=new Qc;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},Qc.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},Qc.prototype.limitToFirst=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=Qc.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,e},Qc.prototype.limitToLast=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=Qc.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,e},Qc.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},Qc.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},Qc.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},Qc.prototype.getQueryObject=function(){var t=Qc.WIRE_PROTOCOL_CONSTANTS_,e={};if(this.startSet_&&(e[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(e[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(e[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(e[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){e[t.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),e[t.VIEW_FROM]=n}return this.index_!==$a&&(e[t.INDEX]=this.index_.toString()),e},Qc.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},Qc.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==$a},Qc.prototype.getNodeFilter=function(){return this.loadsAllData()?new yu(this.getIndex()):this.hasLimit()?new Bc(this):new qc(this)},Qc.prototype.toRestQueryStringParameters=function(){var t,e=Qc.REST_QUERY_CONSTANTS_,n={};return this.isDefault()||(t=this.index_===$a?e.PRIORITY_INDEX:this.index_===As?e.VALUE_INDEX:this.index_===ja?e.KEY_INDEX:(gi(this.index_ instanceof ks,"Unrecognized index type!"),this.index_.toString()),n[e.ORDER_BY]=Li(t),this.startSet_&&(n[e.START_AT]=Li(this.indexStartValue_),this.startNameSet_&&(n[e.START_AT]+=","+Li(this.indexStartName_))),this.endSet_&&(n[e.END_AT]=Li(this.indexEndValue_),this.endNameSet_&&(n[e.END_AT]+=","+Li(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?n[e.LIMIT_TO_FIRST]=this.limit_:n[e.LIMIT_TO_LAST]=this.limit_)),n},Qc.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},Qc.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},Qc.DEFAULT=new Qc,Qc);function Qc(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=$a}var Kc,Hc=(ui(Gc,Kc=js),Gc.prototype.getKey=function(){return zi("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},Gc.prototype.child=function(t){return zi("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof Zo||(null===this.path.getFront()?function(t,e,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),va(t,e,n,r)}("Reference.child",1,t,!1):va("Reference.child",1,t,!1)),new Gc(this.repo,this.path.child(t))},Gc.prototype.getParent=function(){zi("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new Gc(this.repo,t)},Gc.prototype.getRoot=function(){zi("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},Gc.prototype.databaseProp=function(){return this.repo.database},Gc.prototype.set=function(t,e){zi("Reference.set",1,2,arguments.length),ga("Reference.set",this.path),fa("Reference.set",1,t,this.path,!1),Xi("Reference.set",2,e,!0);var n=new Ti;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},Gc.prototype.update=function(t,e){if(zi("Reference.update",1,2,arguments.length),ga("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,ko("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}pa("Reference.update",1,t,this.path,!1),Xi("Reference.update",2,e,!0);var i=new Ti;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},Gc.prototype.setWithPriority=function(t,e,n){if(zi("Reference.setWithPriority",2,3,arguments.length),ga("Reference.setWithPriority",this.path),fa("Reference.setWithPriority",1,t,this.path,!1),da("Reference.setWithPriority",2,e,!1),Xi("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new Ti;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},Gc.prototype.remove=function(t){return zi("Reference.remove",0,1,arguments.length),ga("Reference.remove",this.path),Xi("Reference.remove",1,t,!0),this.set(null,t)},Gc.prototype.transaction=function(t,r,e){if(zi("Reference.transaction",1,3,arguments.length),ga("Reference.transaction",this.path),Xi("Reference.transaction",1,t,!1),Xi("Reference.transaction",2,r,!0),function(t,e,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Yi(t,e,r)+"must be a boolean.")}("Reference.transaction",3,e,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===e&&(e=!0);var i=new Ti;return"function"==typeof r&&i.promise.catch(function(){}),this.repo.startTransaction(this.path,t,function(t,e,n){t?i.reject(t):i.resolve(new Na(e,n)),"function"==typeof r&&r(t,e,n)},e),i.promise},Gc.prototype.setPriority=function(t,e){zi("Reference.setPriority",1,2,arguments.length),ga("Reference.setPriority",this.path),da("Reference.setPriority",1,t,!1),Xi("Reference.setPriority",2,e,!0);var n=new Ti;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},Gc.prototype.push=function(t,e){zi("Reference.push",0,2,arguments.length),ga("Reference.push",this.path),fa("Reference.push",1,t,this.path,!0),Xi("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=Oa(r),o=this.child(i),a=this.child(i);return n=null!=t?o.set(t,e).then(function(){return a}):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch(function(){}),o},Gc.prototype.onDisconnect=function(){return ga("Reference.onDisconnect",this.path),new Ia(this.repo,this.path)},Object.defineProperty(Gc.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(Gc.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(Gc.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(Gc.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),Gc);function Gc(t,e){if(!(t instanceof Fc))throw new Error("new Reference() no longer supported - use app.database().");return Kc.call(this,t,e,Wc.DEFAULT,!1)||this}js.__referenceConstructor=Hc,Ru.__referenceConstructor=Hc;var zc,Yc,Xc=function(){this.children={},this.childCount=0,this.value=null},Jc=($c.prototype.subTree=function(t){for(var e,n=t instanceof Zo?t:new Zo(t),r=this;null!==(e=n.getFront());)r=new $c(e,r,qi(r.node_.children,e)||new Xc),n=n.popFront();return r},$c.prototype.getValue=function(){return this.node_.value},$c.prototype.setValue=function(t){gi(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},$c.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},$c.prototype.hasChildren=function(){return 0<this.node_.childCount},$c.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},$c.prototype.forEachChild=function(n){var r=this;Go(this.node_.children,function(t,e){n(new $c(t,r,e))})},$c.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild(function(t){t.forEachDescendant(e,!0,n)}),t&&n&&e(this)},$c.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},$c.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild(function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)})},$c.prototype.path=function(){return new Zo(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},$c.prototype.name=function(){return this.name_},$c.prototype.parent=function(){return this.parent_},$c.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},$c.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=Ui(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},$c);function $c(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new Xc),this.name_=t,this.parent_=e,this.node_=n}(Yc=zc=zc||{})[Yc.RUN=0]="RUN",Yc[Yc.SENT=1]="SENT",Yc[Yc.COMPLETED=2]="COMPLETED",Yc[Yc.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",Yc[Yc.NEEDS_ABORT=4]="NEEDS_ABORT",Fc.MAX_TRANSACTION_RETRIES_=25,Fc.prototype.transactions_init_=function(){this.transactionQueueTree_=new Jc},Fc.prototype.startTransaction=function(t,e,n,r){this.log_("transaction on "+t);function i(){}var o=new Hc(this,t);o.on("value",i);var a={path:t,update:e,onComplete:n,status:null,order:qo(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=this.getLatestState_(t);a.currentInputSnapshot=s;var u=a.update(s.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var c=new Rs(a.currentInputSnapshot,new Hc(this,a.path),$a);a.onComplete(null,!1,c)}}else{Sa("transaction failed: Data returned ",u,a.path),a.status=zc.RUN;var h=this.transactionQueueTree_.subTree(t),l=h.getValue()||[];l.push(a),h.setValue(l);var f=void 0;if("object"==typeof u&&null!==u&&Ui(u,".priority"))f=qi(u,".priority"),gi(la(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else f=(this.serverSyncTree_.calcCompleteEventCache(t)||bs.EMPTY_NODE).getPriority().val();f=f;var p=this.generateServerValues(),d=Is(u,f),y=Ys(d,p);a.currentOutputSnapshotRaw=d,a.currentOutputSnapshotResolved=y,a.currentWriteId=this.getNextWriteId_();var m=this.serverSyncTree_.applyUserOverwrite(t,y,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,m),this.sendReadyTransactions_()}},Fc.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||bs.EMPTY_NODE},Fc.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);gi(0<n.length,"Sending zero length transaction queue"),n.every(function(t){return t.status===zc.RUN})&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},Fc.prototype.sendTransactionQueue_=function(s,u){for(var c=this,t=u.map(function(t){return t.currentWriteId}),e=this.getLatestState_(s,t),n=e,r=e.hash(),i=0;i<u.length;i++){var o=u[i];gi(o.status===zc.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),o.status=zc.SENT,o.retryCount++;var a=Zo.relativePath(s,o.path);n=n.updateChild(a,o.currentOutputSnapshotRaw)}var h=n.val(!0),l=s;this.server_.put(l.toString(),h,function(t){c.log_("transaction put response",{path:l.toString(),status:t});var e=[];if("ok"===t){for(var n=[],r=0;r<u.length;r++){if(u[r].status=zc.COMPLETED,e=e.concat(c.serverSyncTree_.ackUserWrite(u[r].currentWriteId)),u[r].onComplete){var i=u[r].currentOutputSnapshotResolved,o=new Hc(c,u[r].path),a=new Rs(i,o,$a);n.push(u[r].onComplete.bind(null,null,!0,a))}u[r].unwatcher()}c.pruneCompletedTransactionsBelowNode_(c.transactionQueueTree_.subTree(s)),c.sendReadyTransactions_(),c.eventQueue_.raiseEventsForChangedPath(s,e);for(r=0;r<n.length;r++)Yo(n[r])}else{if("datastale"===t)for(r=0;r<u.length;r++)u[r].status===zc.SENT_NEEDS_ABORT?u[r].status=zc.NEEDS_ABORT:u[r].status=zc.RUN;else{ko("transaction at "+l.toString()+" failed: "+t);for(r=0;r<u.length;r++)u[r].status=zc.NEEDS_ABORT,u[r].abortReason=t}c.rerunTransactions_(s)}},r)},Fc.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},Fc.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],o=t.filter(function(t){return t.status===zc.RUN}).map(function(t){return t.currentWriteId}),a=0;a<t.length;a++){var s=t[a],u=Zo.relativePath(e,s.path),c=!1,h=void 0;if(gi(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),s.status===zc.NEEDS_ABORT)c=!0,h=s.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else if(s.status===zc.RUN)if(s.retryCount>=Fc.MAX_TRANSACTION_RETRIES_)c=!0,h="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else{var l=this.getLatestState_(s.path,o);s.currentInputSnapshot=l;var f=t[a].update(l.val());if(void 0!==f){Sa("transaction failed: Data returned ",f,s.path);var p=Is(f);"object"==typeof f&&null!=f&&Ui(f,".priority")||(p=p.updatePriority(l.getPriority()));var d=s.currentWriteId,y=this.generateServerValues(),m=Ys(p,y);s.currentOutputSnapshotRaw=p,s.currentOutputSnapshotResolved=m,s.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(d),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(s.path,m,s.currentWriteId,s.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(d,!0))}else c=!0,h="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],c&&(t[a].status=zc.COMPLETED,n=t[a].unwatcher,setTimeout(n,Math.floor(0)),t[a].onComplete))if("nodata"===h){var v=new Hc(this,t[a].path),g=t[a].currentInputSnapshot,b=new Rs(g,v,$a);r.push(t[a].onComplete.bind(null,null,!1,b))}else r.push(t[a].onComplete.bind(null,new Error(h),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(a=0;a<r.length;a++)Yo(r[a]);this.sendReadyTransactions_()}},Fc.prototype.getAncestorTransactionNode_=function(t){for(var e,n=this.transactionQueueTree_;null!==(e=t.getFront())&&null===n.getValue();)n=n.subTree(e),t=t.popFront();return n},Fc.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},Fc.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild(function(t){n.aggregateTransactionQueuesForNode_(t,e)})},Fc.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==zc.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(0<n.length?n:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},Fc.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),n},Fc.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)if(e[o].status===zc.SENT_NEEDS_ABORT);else if(e[o].status===zc.SENT)gi(i===o-1,"All SENT items should be at beginning of queue."),e[i=o].status=zc.SENT_NEEDS_ABORT,e[o].abortReason="set";else if(gi(e[o].status===zc.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete){n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))}-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r);for(o=0;o<n.length;o++)Yo(n[o])}};var Zc,th="databaseURL",eh=(nh.getInstance=function(){return Zc=Zc||new nh},nh.prototype.interrupt=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].interrupt()},nh.prototype.resume=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].resume()},nh.prototype.databaseFromApp=function(t,e){var n=e||t.options[th];void 0===n&&Ao("Can't determine Firebase Database URL.  Be sure to include "+th+" option when calling firebase.initializeApp().");var r=ua(n),i=r.repoInfo,o=void 0;return"undefined"!=typeof process&&(o=process.env[Uo]),o&&(n="http://"+o+"?ns="+i.namespace,i=(r=ua(n)).repoInfo),ba("Invalid Firebase Database URL",1,r),r.path.isEmpty()||Ao("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(i,t).database},nh.prototype.deleteRepo=function(t){var e=qi(this.repos_,t.app.name);e&&qi(e,t.repoInfo_.toURLString())===t||Ao("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},nh.prototype.createRepo=function(t,e){var n=qi(this.repos_,e.name);n||(n={},this.repos_[e.name]=n);var r=qi(n,t.toURLString());return r&&Ao("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Fc(t,this.useRestClient_,e),n[t.toURLString()]=r},nh.prototype.forceRestClient=function(t){this.useRestClient_=t},nh);function nh(){this.repos_={},this.useRestClient_=!1}var rh=(Object.defineProperty(ih.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),ih.prototype.ref=function(t){return this.checkDeleted_("ref"),zi("database.ref",0,1,arguments.length),t instanceof Hc?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},ih.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),zi(e,1,1,arguments.length);var n=ua(t);ba(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&Ao(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},ih.prototype.checkDeleted_=function(t){null===this.repo_&&Ao("Cannot call "+t+" on a deleted database.")},ih.prototype.goOffline=function(){zi("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},ih.prototype.goOnline=function(){zi("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},ih.ServerValue={TIMESTAMP:{".sv":"timestamp"}},ih);function ih(t){(this.repo_=t)instanceof Fc||Ao("Don't call new Database() directly - please use firebase.database()."),this.root_=new Hc(t,Zo.Empty),this.INTERNAL=new oh(this)}var oh=(ah.prototype.delete=function(){return hi(this,void 0,void 0,function(){return li(this,function(t){return this.database.checkDeleted_("delete"),eh.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},ah);function ah(t){this.database=t}var sh=Object.freeze({forceLongPolling:function(){Ec.forceDisallow(),mc.forceAllow()},forceWebSockets:function(){mc.forceDisallow()},isWebSocketsAvailable:function(){return Ec.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),uh=Rc;Rc.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Rc.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var ch,hh,lh=Cc,fh=aa,ph=Object.freeze({DataConnection:uh,RealTimeConnection:lh,hijackHash:function(i){var o=Rc.prototype.put;return Rc.prototype.put=function(t,e,n,r){void 0!==r&&(r=i()),o.call(this,t,e,n,r)},function(){Rc.prototype.put=o}},ConnectionTarget:fh,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){eh.getInstance().forceRestClient(t)}}),dh=rh.ServerValue;ch=(hh=fl).SDK_VERSION,wc=ch,hh.INTERNAL.registerService("database",function(t,e,n){return eh.getInstance().databaseFromApp(t,n)},{Reference:Hc,Query:js,Database:rh,DataSnapshot:Rs,enableLogging:So,INTERNAL:sh,ServerValue:dh,TEST_ACCESS:ph},null,!0);var yh,mh="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},vh=vh||{},gh=mh;function bh(t){return"string"==typeof t}function wh(t){return"number"==typeof t}function _h(t,e){t=t.split("."),e=e||gh;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function Eh(){}function Th(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function Sh(t){return"array"==Th(t)}function Ih(t){var e=Th(t);return"array"==e||"object"==e&&"number"==typeof t.length}function Ch(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Nh="closure_uid_"+(1e9*Math.random()>>>0),Ah=0;function kh(t,e,n){return t.call.apply(t.bind,arguments)}function Dh(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function Rh(t,e,n){return(Rh=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?kh:Dh).apply(null,arguments)}function Oh(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var Ph=Date.now||function(){return+new Date};function Mh(t,o){function e(){}e.prototype=o.prototype,t.N=o.prototype,t.prototype=new e,(t.prototype.constructor=t).yb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function xh(){this.j=this.j,this.i=this.i}xh.prototype.j=!1,xh.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[Nh]||(this[Nh]=++Ah)},xh.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var Lh=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(bh(t))return bh(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Fh=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=bh(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Uh(){return Array.prototype.concat.apply([],arguments)}function qh(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Vh(t){return/^[\s\xa0]*$/.test(t)}var Bh,jh=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Wh(t,e){return-1!=t.indexOf(e)}function Qh(t,e){return t<e?-1:e<t?1:0}t:{var Kh=gh.navigator;if(Kh){var Hh=Kh.userAgent;if(Hh){Bh=Hh;break t}}Bh=""}function Gh(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function zh(t){var e,n={};for(e in t)n[e]=t[e];return n}var Yh="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Xh(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<Yh.length;i++)e=Yh[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function Jh(t){return Jh[" "](t),t}Jh[" "]=Eh;var $h,Zh,tl=Wh(Bh,"Opera"),el=Wh(Bh,"Trident")||Wh(Bh,"MSIE"),nl=Wh(Bh,"Edge"),rl=nl||el,il=Wh(Bh,"Gecko")&&!(Wh(Bh.toLowerCase(),"webkit")&&!Wh(Bh,"Edge"))&&!(Wh(Bh,"Trident")||Wh(Bh,"MSIE"))&&!Wh(Bh,"Edge"),ol=Wh(Bh.toLowerCase(),"webkit")&&!Wh(Bh,"Edge");function al(){var t=gh.document;return t?t.documentMode:void 0}t:{var sl="",ul=(Zh=Bh,il?/rv:([^\);]+)(\)|;)/.exec(Zh):nl?/Edge\/([\d\.]+)/.exec(Zh):el?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Zh):ol?/WebKit\/(\S+)/.exec(Zh):tl?/(?:Version)[ \/]?(\S+)/.exec(Zh):void 0);if(ul&&(sl=ul?ul[1]:""),el){var cl=al();if(null!=cl&&cl>parseFloat(sl)){$h=String(cl);break t}}$h=sl}var hl,ll={};function pl(s){return function(t,e){var n=ll;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(s,function(){for(var t=0,e=jh(String($h)).split("."),n=jh(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=Qh(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||Qh(0==o[2].length,0==a[2].length)||Qh(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t})}var dl=gh.document;hl=dl&&el?al()||("CSS1Compat"==dl.compatMode?parseInt($h,10):5):void 0;var yl=!el||9<=Number(hl),ml=el&&!pl("9"),vl=function(){if(!gh.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{gh.addEventListener("test",Eh,e),gh.removeEventListener("test",Eh,e)}catch(t){}return t}();function gl(t,e){this.type=t,this.a=this.target=e,this.Ja=!0}function bl(t,e){if(gl.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(il){t:{try{Jh(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=bh(t.pointerType)?t.pointerType:wl[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}gl.prototype.b=function(){this.Ja=!1},Mh(bl,gl);var wl={2:"touch",3:"pen",4:"mouse"};bl.prototype.b=function(){bl.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,ml)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var _l="closure_listenable_"+(1e6*Math.random()|0),El=0;function Tl(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++El,this.X=this.Z=!1}function Sl(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Il(t){this.src=t,this.a={},this.b=0}function Cl(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=Lh(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Sl(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Nl(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}Il.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Nl(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new Tl(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Al="closure_lm_"+(1e6*Math.random()|0),kl={};function Dl(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Sh(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}r=Ul(r);return e&&e[_l]?e.Ba(n,r,Ch(i)?!!i.capture:!!i,o):Rl(e,n,r,!0,i,o)}(t,e,n,r,i);if(Sh(e)){for(var o=0;o<e.length;o++)Dl(t,e[o],n,r,i);return null}return n=Ul(n),t&&t[_l]?t.Aa(e,n,Ch(r)?!!r.capture:!!r,i):Rl(t,e,n,!1,r,i)}function Rl(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=Ch(i)?!!i.capture:!!i;if(a&&!yl)return null;var s=Ll(t);if(s||(t[Al]=s=new Il(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var e=xl,n=yl?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)vl||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Pl(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ol(t){if(!wh(t)&&t&&!t.X){var e=t.src;if(e&&e[_l])Cl(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Pl(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ll(e))?(Cl(n,t),0==n.b&&(n.src=null,e[Al]=null)):Sl(t)}}}function Pl(t){return t in kl?kl[t]:kl[t]="on"+t}function Ml(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Ol(t),n.call(r,e)}function xl(t,e){return!!t.X||(yl?Ml(t,new bl(e,this)):Ml(t,e=new bl(e||_h("window.event"),this)))}function Ll(t){return(t=t[Al])instanceof Il?t:null}var Fl="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ul(e){return"function"==Th(e)?e:(e[Fl]||(e[Fl]=function(t){return e.handleEvent(t)}),e[Fl])}function ql(){xh.call(this),this.c=new Il(this),(this.J=this).B=null}function Vl(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&Cl(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ja}Mh(ql,xh),ql.prototype[_l]=!0,(yh=ql.prototype).addEventListener=function(t,e,n,r){Dl(this,t,e,n,r)},yh.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Sh(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=Ch(i)?!!i.capture:!!i,r=Ul(r),e&&e[_l]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Nl(a=e.a[n],r,i,o))&&(Sl(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):(e=e&&Ll(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Nl(n,r,i,o)),(r=-1<e?n[e]:null)&&Ol(r))}(this,t,e,n,r)},yh.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(bh(t))t=new gl(t,n);else if(t instanceof gl)t.target=t.target||n;else{var i=t;Xh(t=new gl(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=Vl(a,r,!0,t)&&i}if(i=Vl(a=t.a=n,r,!0,t)&&i,i=Vl(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Vl(a=t.a=e[o],r,!1,t)&&i;return i},yh.G=function(){if(ql.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Sl(n[r]);delete e.a[t],e.b--}}this.B=null},yh.Aa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},yh.Ba=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Bl=gh.JSON.stringify;function jl(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Wl(){this.b=this.a=null}jl.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Ql,Kl=new jl(function(){return new Hl},function(t){t.reset()});function Hl(){this.next=this.b=this.a=null}function Gl(t){gh.setTimeout(function(){throw t},0)}function zl(t,e){Ql||function(){var t=gh.Promise.resolve(void 0);Ql=function(){t.then(Jl)}}(),Yl||(Ql(),Yl=!0),Xl.add(t,e)}Wl.prototype.add=function(t,e){var n=Kl.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Hl.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Yl=!(Hl.prototype.reset=function(){this.next=this.b=this.a=null}),Xl=new Wl;function Jl(){for(var t;r=n=void 0,r=null,(n=Xl).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){Gl(t)}var e=Kl;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;Yl=!1}function $l(t,e){ql.call(this),this.b=t||1,this.a=e||gh,this.f=Rh(this.gb,this),this.g=Ph()}function Zl(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function tf(t,e,n){if("function"==Th(t))n&&(t=Rh(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Rh(t.handleEvent,t)}return 2147483647<Number(e)?-1:gh.setTimeout(t,e||0)}function ef(t,e,n){xh.call(this),this.f=null!=n?Rh(t,n):t,this.c=e,this.b=Rh(this.ab,this),this.a=[]}function nf(t){t.U=tf(t.b,t.c),t.f.apply(null,t.a)}function rf(t){xh.call(this),this.b=t,this.a={}}Mh($l,ql),(yh=$l.prototype).ba=!1,yh.L=null,yh.gb=function(){if(this.ba){var t=Ph()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(Zl(this),this.start()))}},yh.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=Ph())},yh.G=function(){$l.N.G.call(this),Zl(this),delete this.a},Mh(ef,xh),(yh=ef.prototype).ea=!1,yh.U=null,yh.Ua=function(t){this.a=arguments,this.U?this.ea=!0:nf(this)},yh.G=function(){ef.N.G.call(this),this.U&&(gh.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},yh.ab=function(){this.U=null,this.ea&&(this.ea=!1,nf(this))},Mh(rf,xh);var of=[];function af(t,e,n,r){Sh(n)||(n&&(of[0]=n.toString()),n=of);for(var i=0;i<n.length;i++){var o=Dl(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function sf(t){Gh(t.a,function(t,e){this.a.hasOwnProperty(e)&&Ol(t)},t),t.a={}}function uf(){}rf.prototype.G=function(){rf.N.G.call(this),sf(this)},rf.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var cf=new ql;function hf(t){gl.call(this,"serverreachability",t)}function lf(t){cf.dispatchEvent(new hf(cf,t))}function ff(t){gl.call(this,"statevent",t)}function pf(t){cf.dispatchEvent(new ff(cf,t))}function df(t){gl.call(this,"timingevent",t)}function yf(t,e){if("function"!=Th(t))throw Error("Fn must not be null and must be a function");return gh.setTimeout(function(){t()},e)}Mh(hf,gl),Mh(ff,gl),Mh(df,gl);var mf={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,Ma:7,TIMEOUT:8,sb:9},vf={jb:"complete",wb:"success",Na:"error",Ma:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function gf(){}function bf(t){var e;return(e=t.a)||(e=t.a={}),e}function wf(){}gf.prototype.a=null;var _f,Ef={OPEN:"a",ib:"b",Na:"c",rb:"d"};function Tf(){gl.call(this,"d")}function Sf(){gl.call(this,"c")}function If(){}function Cf(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new rf(this),this.O=Nf,t=rl?125:void 0,this.P=new $l(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}Mh(Tf,gl),Mh(Sf,gl),Mh(If,gf),_f=new If;var Nf=45e3,Af={},kf={};function Df(t,e,n){t.F=1,t.f=ep(zf(e)),t.l=n,t.H=!0,Of(t,null)}function Rf(t,e,n,r){t.F=1,t.f=ep(zf(e)),t.l=null,t.H=n,Of(t,r)}function Of(t,e){t.v=Ph(),xf(t),t.D=zf(t.f),tp(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new ef(Rh(t.Ka,t,t.a),t.J)),af(t.I,t.a,"readystatechange",t.eb),e=t.h?zh(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),lf(1)}function Pf(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Mf(t,n);if(i==kf){4==e&&(t.c=4,pf(14),r=!1);break}if(i==Af){t.c=4,pf(15),r=!1;break}Vf(t,i)}4==e&&0==n.length&&(t.c=1,pf(16),r=!1),t.b=t.b&&r,r||(qf(t),Uf(t))}function Mf(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?kf:(n=Number(e.substring(n,r)),isNaN(n)?Af:(r+=1)+n>e.length?kf:(e=e.substr(r,n),t.A=r+n,e))}function xf(t){t.R=Ph()+t.O,Lf(t,t.O)}function Lf(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=yf(Rh(t.bb,t),e)}function Ff(t){t.i&&(gh.clearTimeout(t.i),t.i=null)}function Uf(t){t.g.Da()||t.m||t.g.na(t)}function qf(t){Ff(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,Zl(t.P),sf(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Vf(t,e){try{t.g.Ga(t,e),lf(4)}catch(t){}}function Bf(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Ih(t)||bh(t))Fh(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(Ih(t)||bh(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(bh(t))return t.split("");if(Ih(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function jf(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof jf)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Wf(t,e){Kf(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Qf(t))}function Qf(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Kf(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Kf(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Kf(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(yh=Cf.prototype).setTimeout=function(t){this.O=t},yh.eb=function(t){t=t.target;var e=this.B;e&&3==Gp(t)?e.Ua():this.Ka(t)},yh.Ka=function(t){try{if(t==this.a)t:{var e=Gp(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!rl&&!this.a.aa())){this.m||4!=e||7==n||lf(8==n||r<=0?3:2),Ff(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=zp(this.a,"X-HTTP-Initial-Response");if(a&&!Vh(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,pf(12),qf(this),Uf(this);break t}this.s=!0,Vf(this,s)}this.H?(Pf(this,e,o),rl&&this.b&&3==e&&(af(this.I,this.P,"tick",this.cb),this.P.start())):Vf(this,o),4==e&&qf(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,xf(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,pf(12)):(this.c=0,pf(13)),qf(this),Uf(this)}}}catch(t){}},yh.cb=function(){if(this.a){var t=Gp(this.a),e=this.a.aa();this.A<e.length&&(Ff(this),Pf(this,t,e),this.b&&4!=t&&xf(this))}},yh.cancel=function(){this.m=!0,qf(this)},yh.bb=function(){this.i=null;var t=Ph();0<=t-this.R?(2!=this.F&&(lf(3),pf(17)),qf(this),this.c=2,Uf(this)):Lf(this,this.R-t)},(yh=jf.prototype).C=function(){Qf(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},yh.K=function(){return Qf(this),this.a.concat()},yh.get=function(t,e){return Kf(this.b,t)?this.b[t]:e},yh.set=function(t,e){Kf(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},yh.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Hf=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Gf(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof Gf?(this.h=void 0!==e?e:t.h,Yf(this,t.f),this.j=t.j,Xf(this,t.b),Jf(this,t.i),this.a=t.a,$f(this,yp(t.c)),this.g=t.g):t&&(n=String(t).match(Hf))?(this.h=!!e,Yf(this,n[1]||"",!0),this.j=np(n[2]||""),Xf(this,n[3]||"",!0),Jf(this,n[4]),this.a=np(n[5]||"",!0),$f(this,n[6]||"",!0),this.g=np(n[7]||"")):(this.h=!!e,this.c=new hp(null,this.h))}function zf(t){return new Gf(t)}function Yf(t,e,n){t.f=n?np(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Xf(t,e,n){t.b=n?np(e,!0):e}function Jf(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function $f(t,e,n){e instanceof hp?(t.c=e,function(t,e){e&&!t.f&&(lp(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(fp(this,e),dp(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=rp(e,up)),t.c=new hp(e,t.h))}function Zf(t,e,n){t.c.set(e,n)}function tp(t,e,n){Sh(n)||(n=[String(n)]),dp(t.c,e,n)}function ep(t){return Zf(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Ph()).toString(36)),t}function np(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function rp(t,e,n){return bh(t)?(t=encodeURI(t).replace(e,ip),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ip(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Gf.prototype.toString=function(){var t=[],e=this.f;e&&t.push(rp(e,op,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(rp(e,op,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(rp(n,"/"==n.charAt(0)?sp:ap,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",rp(n,cp)),t.join("")},Gf.prototype.resolve=function(t){var e=zf(this),n=!!t.f;n?Yf(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?Xf(e,t.b):n=null!=t.i;var r=t.a;if(n)Jf(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(Wh(i,"./")||Wh(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?$f(e,yp(t.c)):n=!!t.g,n&&(e.g=t.g),e};var op=/[#\/\?@]/g,ap=/[#\?:]/g,sp=/[#\?]/g,up=/[#\?@]/g,cp=/#/g;function hp(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function lp(n){n.a||(n.a=new jf,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function fp(t,e){lp(t),e=mp(t,e),Kf(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Wf(t.a,e))}function pp(t,e){return lp(t),e=mp(t,e),Kf(t.a.b,e)}function dp(t,e,n){fp(t,e),0<n.length&&(t.c=null,t.a.set(mp(t,e),qh(n)),t.b+=n.length)}function yp(t){var e=new hp;return e.c=t.c,t.a&&(e.a=new jf(t.a),e.b=t.b),e}function mp(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function vp(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function gp(t){var e=t.a.F.a;if(null!=e)pf(4),e?(pf(10),ad(t.a,t,!1)):(pf(11),ad(t.a,t,!0));else{t.b=new Cf(t,void 0,void 0),t.b.h=t.h,e=ld(e=t.a,e.Y()?t.f:null,t.i),pf(4),tp(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&Zf(e,n,r),Rf(t.b,e,!1,t.f)}}function bp(){this.a=this.b=null}function wp(){this.a=new jf}function _p(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[Nh]||(t[Nh]=++Ah)):e.charAt(0)+t}function Ep(t,e){this.b=t,this.a=e}function Tp(t){this.g=t||Sp,t=gh.PerformanceNavigationTiming?0<(t=gh.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(gh.ka&&gh.ka.Ea&&gh.ka.Ea()&&gh.ka.Ea().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new wp),this.b=null,this.c=[]}(yh=hp.prototype).add=function(t,e){lp(this),this.c=null,t=mp(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},yh.forEach=function(n,r){lp(this),this.a.forEach(function(t,e){Fh(t,function(t){n.call(r,t,e,this)},this)},this)},yh.K=function(){lp(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},yh.C=function(t){lp(this);var e=[];if(bh(t))pp(this,t)&&(e=Uh(e,this.a.get(mp(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=Uh(e,t[n])}return e},yh.set=function(t,e){return lp(this),this.c=null,pp(this,t=mp(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},yh.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},yh.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},Mh(function(){},function(){}),(yh=vp.prototype).M=null,yh.$=function(t){return this.a.$(t)},yh.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},yh.Da=function(){return!1},yh.Ga=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=zp(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=zp(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void cd(e,2)}this.f=r[0]}else(e=this.a).m=this.c,cd(e,2)}else 1==this.M&&(this.g?pf(6):"11111"==e?(pf(5),this.g=!0,(!el||10<=Number(hl))&&(this.c=200,this.b.cancel(),pf(11),ad(this.a,this,!0))):(pf(7),this.g=!1))},yh.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,gp(this)):1==this.M&&(this.g?(pf(11),ad(this.a,this,!0)):(pf(10),ad(this.a,this,!1)));else{0==this.M?pf(8):1==this.M&&pf(9);var t=this.a;t.m=this.c,cd(t,2)}},yh.Y=function(){return this.a.Y()},yh.ma=function(){return this.a.ma()},wp.prototype.add=function(t){this.a.set(_p(t),t)},wp.prototype.C=function(){return this.a.C()};var Sp=10;function Ip(t,e){!t.a&&(Wh(e,"spdy")||Wh(e,"quic")||Wh(e,"h2"))&&(t.f=t.g,t.a=new wp,t.b&&(kp(t,t.b),t.b=null))}function Cp(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function Np(t){return t.b?1:t.a?t.a.a.c:0}function Ap(t,e){return t=t.b?t.b==e:!!t.a&&(e=_p(e),Kf(t.a.a.b,e))}function kp(t,e){t.a?t.a.add(e):t.b=e}function Dp(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=_p(e),n=Kf(t.a.a.b,n)),n&&Wf(t.a.a,_p(e)))}function Rp(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return qh(t.c);var e=t.c;return Fh(t.a.C(),function(t){e=e.concat(t.j)}),e}function Op(){}function Pp(){this.a=new Op}function Mp(t,r,e){var i=e||"";try{Bf(t,function(t,e){var n=t;Ch(t)&&(n=Bl(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function xp(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}Tp.prototype.cancel=function(){this.c=Rp(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(Fh(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},Op.prototype.stringify=function(t){return gh.JSON.stringify(t,void 0)},Op.prototype.parse=function(t){return gh.JSON.parse(t,void 0)};var Lp=gh.JSON.parse;function Fp(t){ql.call(this),this.headers=new jf,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Up,this.D=this.F=!1}Mh(Fp,ql);var Up="",qp=/^https?$/i,Vp=["POST","PUT"];function Bp(t){return"content-type"==t.toLowerCase()}function jp(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Wp(t),Kp(t)}function Wp(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Qp(t){if(t.b&&void 0!==vh&&(!t.s[1]||4!=Gp(t)||2!=t.T()))if(t.l&&4==Gp(t))tf(t.Fa,0,t);else if(t.dispatchEvent("readystatechange"),4==Gp(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Hf)[1]||null;if(!o&&gh.self&&gh.self.location){var a=gh.self.location.protocol;o=a.substr(0,a.length-1)}i=!qp.test(o?o.toLowerCase():"")}e=i}e?(t.dispatchEvent("complete"),t.dispatchEvent("success")):(t.h=6,t.f=t.za()+" ["+t.T()+"]",Wp(t))}finally{Kp(t)}}}function Kp(t,e){if(t.a){Hp(t);var n=t.a,r=t.s[0]?Eh:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Hp(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(gh.clearTimeout(t.m),t.m=null)}function Gp(t){return t.a?t.a.readyState:0}function zp(t,e){return t.a?t.a.getResponseHeader(e):null}function Yp(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var n="";return Gh(t,function(t,e){n+=e,n+=":",n+=t,n+="\r\n"}),n}(n),bh(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return Zf(t,e,n),t}function Xp(t){this.f=[],this.F=new bp,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Ra=this.P=0,this.Pa=!!_h("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Oa=_h("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Sa=_h("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Qa=_h("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=_h("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.La=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new Tp(t&&t.concurrentRequestLimit),this.ja=new Pp,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function Jp(t){if($p(t),3==t.u){var e=t.P++,n=zf(t.B);Zf(n,"SID",t.H),Zf(n,"RID",e),Zf(n,"TYPE","terminate"),nd(t,n),(e=new Cf(t,e,void 0)).F=2,e.f=ep(zf(n)),n=!1,gh.navigator&&gh.navigator.sendBeacon&&(n=gh.navigator.sendBeacon(e.f.toString(),"")),!n&&gh.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=Ph(),xf(e)}hd(t)}function $p(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(gh.clearTimeout(t.l),t.l=null),sd(t),t.b.cancel(),t.h&&(wh(t.h)&&gh.clearTimeout(t.h),t.h=null)}function Zp(t,e){t.f.push(new Ep(t.Ra++,e)),3==t.u&&td(t)}function td(t){Cp(t.b)||t.h||(t.h=!0,zl(t.Ia,t),t.A=0)}function ed(t,e){var n;n=e?e.W:t.P++;var r=zf(t.B);Zf(r,"SID",t.H),Zf(r,"RID",n),Zf(r,"AID",t.O),nd(t,r),t.g&&t.i&&Yp(r,t.g,t.i),n=new Cf(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=rd(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),kp(t.b,n),Df(n,r,e)}function nd(t,n){t.c&&Bf({},function(t,e){Zf(n,e,t)})}function rd(t,e,n){n=Math.min(t.f.length,n);var r=t.c?Rh(t.c.Ta,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{Mp(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function id(t){t.a||t.l||(t.S=1,zl(t.Ha,t),t.v=0)}function od(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=yf(Rh(t.Ha,t),ud(t,t.v)),t.v++,!0)}function ad(t,e,n){var r=e.l;r&&Ip(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=ld(t,null,t.ha),td(t)}function sd(t){null!=t.s&&(gh.clearTimeout(t.s),t.s=null)}function ud(t,e){var n=t.Oa+Math.floor(Math.random()*t.Sa);return t.ma()||(n*=2),n*e}function cd(t,e){if(2==e){var n=null;t.c&&(n=null);var r=Rh(t.fb,t);n||(n=new Gf("//www.google.com/images/cleardot.gif"),gh.location&&"http"==gh.location.protocol||Yf(n,"https"),ep(n)),function(t,e){var n=new uf;if(gh.Image){var r=new Image;r.onload=Oh(xp,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Oh(xp,n,r,"TestLoadImage: error",!1,e),r.onabort=Oh(xp,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Oh(xp,n,r,"TestLoadImage: timeout",!1,e),gh.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else pf(2);t.u=0,t.c&&t.c.ta(e),hd(t),$p(t)}function hd(t){t.u=0,t.m=-1,t.c&&(0==Rp(t.b).length&&0==t.f.length||(t.b.c.length=0,qh(t.f),t.f.length=0),t.c.sa())}function ld(t,e,n){var r=function(t){return t instanceof Gf?zf(t):new Gf(t,void 0)}(n);if(""!=r.b)e&&Xf(r,e+"."+r.b),Jf(r,r.i);else{var i,o=gh.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new Gf(null,void 0);return t&&Yf(i,t),e&&Xf(i,e),n&&Jf(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&Gh(t.V,function(t,e){Zf(r,e,t)}),e=t.j,n=t.I,e&&n&&Zf(r,e,n),Zf(r,"VER",t.wa),nd(t,r),r}function fd(){}function pd(){if(el&&!(10<=Number(hl)))throw Error("Environmental error: no available transport.")}function dd(t,e){ql.call(this),this.a=new Xp(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];if(0==i.lastIndexOf("/",0))e=i;else(r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!Vh(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Vh(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new vd(this)}function yd(t){Tf.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function md(){Sf.call(this),this.status=1}function vd(t){this.a=t}(yh=Fp.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?bf(this.H):bf(_f),this.a.onreadystatechange=Rh(this.Fa,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void jp(this,t)}t=n||"";var i=new jf(this.headers);r&&Bf(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Bp,n=t.length,r=bh(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:bh(t)?t.charAt(e):t[e]}(i.K()),n=gh.FormData&&t instanceof gh.FormData,0<=Lh(Vp,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Hp(this),0<this.o&&((this.D=function(t){return el&&pl(9)&&wh(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=Rh(this.Ca,this)):this.m=tf(this.Ca,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){jp(this,t)}},yh.Ca=function(){void 0!==vh&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},yh.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Kp(this))},yh.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Kp(this,!0)),Fp.N.G.call(this)},yh.Fa=function(){this.j||(this.w||this.l||this.g?Qp(this):this.$a())},yh.$a=function(){Qp(this)},yh.T=function(){try{return 2<Gp(this)?this.a.status:-1}catch(t){return-1}},yh.za=function(){try{return 2<Gp(this)?this.a.statusText:""}catch(t){return""}},yh.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},yh.Va=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Lp(e)}},yh.ya=function(){return this.h},yh.Ya=function(){return bh(this.f)?this.f:String(this.f)},(yh=Xp.prototype).wa=8,yh.u=1,yh.Da=function(){return 0==this.u},yh.Ia=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random()),t=this.P++;var e,n=new Cf(this,t,void 0),r=this.i;if(this.J&&(r?Xh(r=zh(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&bh(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=rd(this,n,e),Zf(i=zf(this.B),"RID",t),Zf(i,"CVER",22),this.o&&this.j&&Zf(i,"X-HTTP-Session-Id",this.j),nd(this,i),this.g&&r&&Yp(i,this.g,r),kp(this.b,n),this.W?(Zf(i,"$req",e),Zf(i,"SID","null"),n.S=!0,Df(n,i,null)):Df(n,i,e),this.u=2}}else 3==this.u&&(t?ed(this,t):0==this.f.length||Cp(this.b)||ed(this))},yh.Ha=function(){this.l=null,this.a=new Cf(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=zf(this.pa);Zf(t,"RID","rpc"),Zf(t,"SID",this.H),Zf(t,"CI",this.ia?"0":"1"),Zf(t,"AID",this.O),nd(this,t),Zf(t,"TYPE","xmlhttp"),this.g&&this.i&&Yp(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Rf(this.a,t,!0,this.ga)},yh.Ga=function(t,e){if(0!=this.u&&(this.a==t||Ap(this.b,t)))if(this.m=t.o,!t.s&&Ap(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(Sh(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;sd(this),this.a.cancel(),this.a=null}od(this),pf(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=yf(Rh(this.Za,this),6e3));if(Np(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else cd(this,11)}else if(!t.s&&this.a!=t||sd(this),!Vh(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&wh(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=zp(r,"X-Client-Wire-Protocol"))&&Ip(this.b,i),this.j&&(r=zp(r,"X-HTTP-Session-Id")))&&(this.I=r,Zf(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=ld(this,this.Y()?this.ga:null,this.ha),r.s?(Dp(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Ff(r),xf(r)),this.a=r):id(this),0<this.f.length&&td(this)}else"stop"!=r[0]&&"close"!=r[0]||cd(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?cd(this,7):Jp(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},yh.Za=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,od(this),pf(19))},yh.na=function(t){var e=null;if(this.a==t){sd(this),this.a=null;var n=2}else{if(!Ap(this.b,t))return;e=t.j,Dp(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=Ph()-t.v,cf.dispatchEvent(new df(cf,t.l?t.l.length:0,e,this.A)),td(this)):id(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(Np(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.f=e.j.concat(t.f),!0):!(1==t.u||2==t.u||t.A>=(t.Pa?0:t.Qa))&&(t.h=yf(Rh(t.Ia,t,e),ud(t,t.A)),t.A++,!0))}(this,t)||2==n&&od(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:cd(this,5);break;case 4:cd(this,10);break;case 3:cd(this,6);break;default:cd(this,2)}}},yh.fb=function(t){pf(t?2:1)},yh.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Fp(this.La)).F=this.R,t},yh.ma=function(){return!!this.c&&!0},yh.Y=function(){return this.R},(yh=fd.prototype).va=function(){},yh.ua=function(){},yh.ta=function(){},yh.sa=function(){},yh.Ta=function(){},pd.prototype.a=function(t,e){return new dd(t,e)},Mh(dd,ql),(yh=dd.prototype).addEventListener=function(t,e,n,r){dd.N.addEventListener.call(this,t,e,n,r)},yh.removeEventListener=function(t,e,n,r){dd.N.removeEventListener.call(this,t,e,n,r)},yh.Wa=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;pf(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new vp(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=Yp(e,t.g,t.i)),(t=t.w).i=n,e=ld(t.a,null,t.i),pf(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,gp(t)):(tp(e,"MODE","init"),!t.a.o&&t.a.j&&tp(e,"X-HTTP-Session-Id",t.a.j),t.b=new Cf(t,void 0,void 0),t.b.h=t.h,Rf(t.b,e,!1,null),t.M=0)},yh.close=function(){Jp(this.a)},yh.Xa=function(t){if(bh(t)){var e={};e.__data__=t,Zp(this.a,e)}else this.h?((e={}).__data__=Bl(t),Zp(this.a,e)):Zp(this.a,t)},yh.G=function(){this.a.c=null,delete this.f,Jp(this.a),delete this.a,dd.N.G.call(this)},Mh(yd,Tf),Mh(md,Sf),Mh(vd,fd),vd.prototype.va=function(){this.a.dispatchEvent("a")},vd.prototype.ua=function(t){this.a.dispatchEvent(new yd(t))},vd.prototype.ta=function(t){this.a.dispatchEvent(new md(t))},vd.prototype.sa=function(){this.a.dispatchEvent("b")};var gd=Oh(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},pd);pd.prototype.createWebChannel=pd.prototype.a,dd.prototype.send=dd.prototype.Xa,dd.prototype.open=dd.prototype.Wa,dd.prototype.close=dd.prototype.close,mf.NO_ERROR=0,mf.TIMEOUT=8,mf.HTTP_ERROR=6,vf.COMPLETE="complete",(wf.EventType=Ef).OPEN="a",Ef.CLOSE="b",Ef.ERROR="c",Ef.MESSAGE="d",ql.prototype.listen=ql.prototype.Aa,Fp.prototype.listenOnce=Fp.prototype.Ba,Fp.prototype.getLastError=Fp.prototype.Ya,Fp.prototype.getLastErrorCode=Fp.prototype.ya,Fp.prototype.getStatus=Fp.prototype.T,Fp.prototype.getStatusText=Fp.prototype.za,Fp.prototype.getResponseJson=Fp.prototype.Va,Fp.prototype.getResponseText=Fp.prototype.aa,Fp.prototype.send=Fp.prototype.ca;var bd,wd,_d={createWebChannelTransport:gd,ErrorCode:mf,EventType:vf,WebChannel:wf,XhrIo:Fp},Ed=_d.createWebChannelTransport,Td=_d.ErrorCode,Sd=_d.EventType,Id=_d.WebChannel,Cd=_d.XhrIo,Nd=fl.SDK_VERSION,Ad=new io("@firebase/firestore");function kd(){return Ad.logLevel===Zi.DEBUG?bd.DEBUG:Ad.logLevel===Zi.SILENT?bd.SILENT:bd.ERROR}function Dd(t){switch(t){case bd.DEBUG:Ad.logLevel=Zi.DEBUG;break;case bd.ERROR:Ad.logLevel=Zi.ERROR;break;case bd.SILENT:Ad.logLevel=Zi.SILENT;break;default:Ad.error("Firestore ("+Nd+"): Invalid value passed to `setLogLevel`")}}function Rd(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Ad.logLevel<=Zi.DEBUG){var i=n.map(Pd);Ad.debug.apply(Ad,["Firestore ("+Nd+") ["+t+"]: "+e].concat(i))}}function Od(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Ad.logLevel<=Zi.ERROR){var r=e.map(Pd);Ad.error.apply(Ad,["Firestore ("+Nd+"): "+t].concat(r))}}function Pd(e){if("string"==typeof e)return e;var t=Ld.getPlatform();try{return t.formatJSON(e)}catch(t){return e}}function Md(t){var e="FIRESTORE ("+Nd+") INTERNAL ASSERTION FAILED: "+t;throw Od(e),new Error(e)}function xd(t,e){t||Md(e)}(wd=bd=bd||{})[wd.DEBUG=0]="DEBUG",wd[wd.ERROR=1]="ERROR",wd[wd.SILENT=2]="SILENT";var Ld=(Fd.setPlatform=function(t){Fd.platform&&Md("Platform already defined"),Fd.platform=t},Fd.getPlatform=function(){return Fd.platform||Md("Platform not set"),Fd.platform},Fd);function Fd(){}function Ud(){return Ld.getPlatform().emptyByteString}var qd,Vd={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Bd=(ui(jd,qd=Error),jd);function jd(t,e){var n=qd.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Wd(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Bd(Vd.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function Qd(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Kd(t,e){return void 0!==t?t:e}function Hd(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function Gd(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function zd(t){for(var e in xd(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Yd(t,e){if(0!==e.length)throw new Bd(Vd.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+fy(e.length,"argument")+".")}function Xd(t,e,n){if(e.length!==n)throw new Bd(Vd.INVALID_ARGUMENT,"Function "+t+"() requires "+fy(n,"argument")+", but was called with "+fy(e.length,"argument")+".")}function Jd(t,e,n){if(e.length<n)throw new Bd(Vd.INVALID_ARGUMENT,"Function "+t+"() requires at least "+fy(n,"argument")+", but was called with "+fy(e.length,"argument")+".")}function $d(t,e,n,r){if(e.length<n||e.length>r)throw new Bd(Vd.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+fy(e.length,"argument")+".")}function Zd(t,e,n,r){oy(t,e,ly(n)+" argument",r)}function ty(t,e,n,r){void 0!==r&&Zd(t,e,n,r)}function ey(t,e,n,r){oy(t,e,n+" option",r)}function ny(t,e,n,r){void 0!==r&&ey(t,e,n,r)}function ry(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new Bd(Vd.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+sy(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new Bd(Vd.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+sy(r[o]))}(t,e,n,r,i)}function iy(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(sy(u))}var c=sy(r);throw new Bd(Vd.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function oy(t,e,n,r){if(!("object"===e?ay(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=sy(r);throw new Bd(Vd.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function ay(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function sy(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Md("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function uy(t,e,n){if(void 0===n)throw new Bd(Vd.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+ly(e)+" argument, but it was undefined.")}function cy(n,t,r){Gd(t,function(t,e){if(r.indexOf(t)<0)throw new Bd(Vd.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function hy(t,e,n,r){var i=sy(r);return new Bd(Vd.INVALID_ARGUMENT,"Function "+t+"() requires its "+ly(n)+" argument to be a "+e+", but it was: "+i)}function ly(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function fy(t,e){return t+" "+e+(1===t?"":"s")}var py=(dy.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return xd(20===e.length,"Invalid auto ID: "+e),e},dy);function dy(){}function yy(t,e){return t<e?-1:e<t?1:0}function my(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function vy(t){return t+"\0"}function gy(){if("undefined"==typeof Uint8Array)throw new Bd(Vd.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function by(){if(!Ld.getPlatform().base64Available)throw new Bd(Vd.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var wy=(_y.fromBase64String=function(t){Xd("Blob.fromBase64String",arguments,1),Zd("Blob.fromBase64String","string",1,t),by();try{return new _y(Ld.getPlatform().atob(t))}catch(t){throw new Bd(Vd.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},_y.fromUint8Array=function(t){if(Xd("Blob.fromUint8Array",arguments,1),gy(),!(t instanceof Uint8Array))throw hy("Blob.fromUint8Array","Uint8Array",1,t);return new _y(Array.prototype.map.call(t,function(t){return String.fromCharCode(t)}).join(""))},_y.prototype.toBase64=function(){return Xd("Blob.toBase64",arguments,0),by(),Ld.getPlatform().btoa(this._binaryString)},_y.prototype.toUint8Array=function(){Xd("Blob.toUint8Array",arguments,0),gy();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},_y.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},_y.prototype.isEqual=function(t){return this._binaryString===t._binaryString},_y.prototype._compareTo=function(t){return yy(this._binaryString,t._binaryString)},_y);function _y(t){by(),this._binaryString=t}var Ey=Wd(wy,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Ty=function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},Sy="(default)",Iy=(Object.defineProperty(Cy.prototype,"isDefaultDatabase",{get:function(){return this.database===Sy},enumerable:!0,configurable:!0}),Cy.prototype.isEqual=function(t){return t instanceof Cy&&t.projectId===this.projectId&&t.database===this.database},Cy.prototype.compareTo=function(t){return yy(this.projectId,t.projectId)||yy(this.database,t.database)},Cy);function Cy(t,e){this.projectId=t,this.database=e||Sy}var Ny=(Ay.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Ay.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},Ay.INVALID=-1,Ay);function Ay(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}var ky="__name__",Dy=(Object.defineProperty(Ry.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),Ry.prototype.isEqual=function(t){return 0===Ry.comparator(this,t)},Ry.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Ry?t.forEach(function(t){e.push(t)}):e.push(t),this.construct(e)},Ry.prototype.limit=function(){return this.offset+this.length},Ry.prototype.popFirst=function(t){return t=void 0===t?1:t,xd(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},Ry.prototype.popLast=function(){return xd(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},Ry.prototype.firstSegment=function(){return xd(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},Ry.prototype.lastSegment=function(){return this.get(this.length-1)},Ry.prototype.get=function(t){return xd(t<this.length,"Index out of range"),this.segments[this.offset+t]},Ry.prototype.isEmpty=function(){return 0===this.length},Ry.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Ry.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Ry.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Ry.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},Ry.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Ry);function Ry(t,e,n){void 0===e?e=0:e>t.length&&Md("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Md("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}var Oy,Py=(ui(My,Oy=Dy),My.prototype.construct=function(t,e,n){return new My(t,e,n)},My.prototype.canonicalString=function(){return this.toArray().join("/")},My.prototype.toString=function(){return this.canonicalString()},My.fromString=function(t){if(0<=t.indexOf("//"))throw new Bd(Vd.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new My(t.split("/").filter(function(t){return 0<t.length}))},My.EMPTY_PATH=new My([]),My);function My(){return null!==Oy&&Oy.apply(this,arguments)||this}var xy,Ly=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Fy=(ui(Uy,xy=Dy),Uy.prototype.construct=function(t,e,n){return new Uy(t,e,n)},Uy.isValidIdentifier=function(t){return Ly.test(t)},Uy.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Uy.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},Uy.prototype.toString=function(){return this.canonicalString()},Uy.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===ky},Uy.keyField=function(){return new Uy([ky])},Uy.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Bd(Vd.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var a=t[r];if("\\"===a){if(r+1===t.length)throw new Bd(Vd.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var s=t[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new Bd(Vd.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new Bd(Vd.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Uy(e)},Uy.EMPTY_PATH=new Uy([]),Uy);function Uy(){return null!==xy&&xy.apply(this,arguments)||this}var qy=(Vy.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Vy.prototype.isEqual=function(t){return null!==t&&0===Py.comparator(this.path,t.path)},Vy.prototype.toString=function(){return this.path.toString()},Vy.comparator=function(t,e){return Py.comparator(t.path,e.path)},Vy.isDocumentKey=function(t){return t.length%2==0},Vy.fromSegments=function(t){return new Vy(new Py(t.slice()))},Vy.fromPathString=function(t){return new Vy(Py.fromString(t))},Vy.EMPTY=new Vy(new Py([])),Vy);function Vy(t){this.path=t,xd(Vy.isDocumentKey(t),"Invalid DocumentKey with an odd number of segments: "+t.toArray().join("/"))}var By,jy,Wy=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})};(jy=By=By||{}).All="all",jy.ListenStreamIdle="listen_stream_idle",jy.ListenStreamConnectionBackoff="listen_stream_connection_backoff",jy.WriteStreamIdle="write_stream_idle",jy.WriteStreamConnectionBackoff="write_stream_connection_backoff",jy.OnlineStateTimeout="online_state_timeout",jy.ClientMetadataRefresh="client_metadata_refresh",jy.LruGarbageCollection="lru_garbage_collection",jy.RetryTransaction="retry_transaction";var Qy=(Ky.createAndSchedule=function(t,e,n,r,i){var o=new Ky(t,e,Date.now()+n,r,i);return o.start(n),o},Ky.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},Ky.prototype.skipDelay=function(){return this.handleDelayElapsed()},Ky.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Bd(Vd.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Ky.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},Ky.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},Ky);function Ky(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Wy,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}var Hy=(Object.defineProperty(Gy.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!0,configurable:!0}),Gy.prototype.enqueueAndForget=function(t){this.enqueue(t)},Gy.prototype.enqueueAndForgetEvenAfterShutdown=function(t){this.verifyNotFailed(),this.enqueueInternal(t)},Gy.prototype.enqueueEvenAfterShutdown=function(t){return this.verifyNotFailed(),this.enqueueInternal(t)},Gy.prototype.enqueueAndInitiateShutdown=function(e){return hi(this,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return this.verifyNotFailed(),this._isShuttingDown?[3,2]:(this._isShuttingDown=!0,[4,this.enqueueEvenAfterShutdown(e)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Gy.prototype.enqueue=function(t){return this.verifyNotFailed(),this._isShuttingDown?new Promise(function(t){}):this.enqueueInternal(t)},Gy.prototype.enqueueInternal=function(t){var n=this,e=this.tail.then(function(){return n.operationInProgress=!0,t().catch(function(t){n.failure=t,n.operationInProgress=!1;var e=t.stack||t.message||"";throw Od("INTERNAL UNHANDLED ERROR: ",e),e.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return n.operationInProgress=!1,t})});return this.tail=e},Gy.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),xd(0<=e,"Attempted to schedule an operation with a negative delay of "+e),-1<this.timerIdsToSkip.indexOf(t)&&(e=0);var i=Qy.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},Gy.prototype.verifyNotFailed=function(){this.failure&&Md("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},Gy.prototype.verifyOperationInProgress=function(){xd(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},Gy.prototype.drain=function(){return this.enqueueEvenAfterShutdown(function(){return Promise.resolve()})},Gy.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},Gy.prototype.runDelayedOperationsEarly=function(r){var i=this;return this.drain().then(function(){xd(r===By.All||i.containsDelayedOperation(r),"Attempted to drain to missing operation "+r),i.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var t=0,e=i.delayedOperations;t<e.length;t++){var n=e[t];if(n.skipDelay(),r!==By.All&&n.timerId===r)break}return i.drain()})},Gy.prototype.skipDelaysForTimerId=function(t){this.timerIdsToSkip.push(t)},Gy.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);xd(0<=e,"Delayed operation not found."),this.delayedOperations.splice(e,1)},Gy);function Gy(){this.tail=Promise.resolve(),this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.timerIdsToSkip=[]}var zy="",Yy="",Xy="",Jy="";function $y(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=tm(e)),e=Zy(t.get(n),e);return tm(e)}function Zy(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=zy+Xy;break;case zy:n+=zy+Jy;break;default:n+=o}}return n}function tm(t){return t+zy+Yy}function em(t){var e=t.length;if(xd(2<=e,"Invalid path "+t),2===e)return xd(t.charAt(0)===zy&&t.charAt(1)===Yy,"Non-empty path "+t+" had length 2"),Py.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(zy,o);switch((a<0||n<a)&&Md('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case Yy:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case Xy:i+=t.substring(o,a),i+="\0";break;case Jy:i+=t.substring(o,a+1);break;default:Md('Invalid encoded resource path: "'+t+'"')}o=a+2}return new Py(r)}var nm=(rm.now=function(){return rm.fromMillis(Date.now())},rm.fromDate=function(t){return rm.fromMillis(t.getTime())},rm.fromMillis=function(t){var e=Math.floor(t/1e3);return new rm(e,1e6*(t-1e3*e))},rm.prototype.toDate=function(){return new Date(this.toMillis())},rm.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},rm.prototype._compareTo=function(t){return this.seconds===t.seconds?yy(this.nanoseconds,t.nanoseconds):yy(this.seconds,t.seconds)},rm.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},rm.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},rm);function rm(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Bd(Vd.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Bd(Vd.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Bd(Vd.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Bd(Vd.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}var im=(om.fromMicroseconds=function(t){var e=Math.floor(t/1e6);return new om(new nm(e,t%1e6*1e3))},om.fromTimestamp=function(t){return new om(t)},om.forDeletedDoc=function(){return om.MIN},om.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},om.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},om.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},om.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},om.prototype.toTimestamp=function(){return this.timestamp},om.MIN=new om(new nm(0,0)),om);function om(t){this.timestamp=t}var am=(sm.prototype.insert=function(t,e){return new sm(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,hm.BLACK,null,null))},sm.prototype.remove=function(t){return new sm(this.comparator,this.root.remove(t,this.comparator).copy(null,null,hm.BLACK,null,null))},sm.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},sm.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},sm.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(sm.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),sm.prototype.minKey=function(){return this.root.minKey()},sm.prototype.maxKey=function(){return this.root.maxKey()},sm.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},sm.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},sm.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},sm.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},sm.prototype.getIterator=function(){return new um(this.root,null,this.comparator,!1)},sm.prototype.getIteratorFrom=function(t){return new um(this.root,t,this.comparator,!1)},sm.prototype.getReverseIterator=function(){return new um(this.root,null,this.comparator,!0)},sm.prototype.getReverseIteratorFrom=function(t){return new um(this.root,t,this.comparator,!0)},sm);function sm(t,e){this.comparator=t,this.root=e||hm.EMPTY}var um=(cm.prototype.getNext=function(){xd(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},cm.prototype.hasNext=function(){return 0<this.nodeStack.length},cm.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},cm);function cm(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}var hm=(lm.prototype.copy=function(t,e,n,r,i){return new lm(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},lm.prototype.isEmpty=function(){return!1},lm.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},lm.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},lm.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},lm.prototype.minKey=function(){return this.min().key},lm.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},lm.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},lm.prototype.removeMin=function(){if(this.left.isEmpty())return lm.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},lm.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return lm.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},lm.prototype.isRed=function(){return this.color},lm.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},lm.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},lm.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},lm.prototype.rotateLeft=function(){var t=this.copy(null,null,lm.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},lm.prototype.rotateRight=function(){var t=this.copy(null,null,lm.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},lm.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},lm.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},lm.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Md("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Md("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Md("Black depths differ");return t+(this.isRed()?0:1)},lm.EMPTY=null,lm.RED=!0,lm.BLACK=!1,lm);function lm(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:lm.RED,this.left=null!=r?r:lm.EMPTY,this.right=null!=i?i:lm.EMPTY,this.size=this.left.size+1+this.right.size}var fm=(Object.defineProperty(pm.prototype,"key",{get:function(){throw Md("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(pm.prototype,"value",{get:function(){throw Md("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(pm.prototype,"color",{get:function(){throw Md("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(pm.prototype,"left",{get:function(){throw Md("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(pm.prototype,"right",{get:function(){throw Md("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),pm.prototype.copy=function(t,e,n,r,i){return this},pm.prototype.insert=function(t,e,n){return new hm(t,e)},pm.prototype.remove=function(t,e){return this},pm.prototype.isEmpty=function(){return!0},pm.prototype.inorderTraversal=function(t){return!1},pm.prototype.reverseTraversal=function(t){return!1},pm.prototype.minKey=function(){return null},pm.prototype.maxKey=function(){return null},pm.prototype.isRed=function(){return!1},pm.prototype.checkMaxDepth=function(){return!0},pm.prototype.check=function(){return 0},pm);function pm(){this.size=0}hm.EMPTY=new fm;var dm=(ym.fromMapKeys=function(t){var e=new ym(t.comparator);return t.forEach(function(t){e=e.add(t)}),e},ym.prototype.has=function(t){return null!==this.data.get(t)},ym.prototype.first=function(){return this.data.minKey()},ym.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(ym.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),ym.prototype.indexOf=function(t){return this.data.indexOf(t)},ym.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},ym.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},ym.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},ym.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},ym.prototype.getIterator=function(){return new mm(this.data.getIterator())},ym.prototype.getIteratorFrom=function(t){return new mm(this.data.getIteratorFrom(t))},ym.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},ym.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},ym.prototype.isEmpty=function(){return this.data.isEmpty()},ym.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},ym.prototype.isEqual=function(t){if(!(t instanceof ym))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},ym.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},ym.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},ym.prototype.copy=function(t){var e=new ym(this.comparator);return e.data=t,e},ym);function ym(t){this.comparator=t,this.data=new am(this.comparator)}var mm=(vm.prototype.getNext=function(){return this.iter.getNext().key},vm.prototype.hasNext=function(){return this.iter.hasNext()},vm);function vm(t){this.iter=t}var gm=new am(qy.comparator);function bm(){return gm}function wm(){return bm()}var _m=new am(qy.comparator);function Em(){return _m}var Tm=new am(qy.comparator);function Sm(){return Tm}var Im=new dm(qy.comparator);function Cm(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Im,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Nm=new dm(yy);function Am(){return Nm}var km=(Dm.prototype.applyToRemoteDocument=function(t,e,n){e&&xd(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;xd(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},Dm.prototype.applyToLocalView=function(t,e){e&&xd(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime));for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},Dm.prototype.applyToLocalDocumentSet=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.applyToLocalView(t.key,n.get(t.key));e&&(i=i.insert(t.key,e))}),i},Dm.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Cm())},Dm.prototype.isEqual=function(t){return this.batchId===t.batchId&&my(this.mutations,t.mutations)&&my(this.baseMutations,t.baseMutations)},Dm);function Dm(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,xd(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}var Rm=(Om.from=function(t,e,n,r){xd(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=Sm(),o=t.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new Om(t,e,n,r,i)},Om);function Om(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}var Pm=(Mm.prototype.catch=function(t){return this.next(void 0,t)},Mm.prototype.next=function(r,i){var o=this;return this.callbackAttached&&Md("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new Mm(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},Mm.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Mm.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof Mm?e:Mm.resolve(e)}catch(t){return Mm.reject(t)}},Mm.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Mm.resolve(e)},Mm.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Mm.reject(e)},Mm.resolve=function(n){return new Mm(function(t,e){t(n)})},Mm.reject=function(n){return new Mm(function(t,e){e(n)})},Mm.waitFor=function(t){return new Mm(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Mm.or=function(t){for(var n=Mm.resolve(!1),e=function(e){n=n.next(function(t){return t?Mm.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},Mm.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},Mm);function Mm(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}var xm=(Lm.forUser=function(t,e,n,r){return xd(""!==t.uid,"UserID must not be an empty string."),new Lm(t.isAuthenticated()?t.uid:"",e,n,r)},Lm.prototype.checkEmpty=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Vm(t).iterate({index:lb.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},Lm.prototype.acknowledgeBatch=function(e,t,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=qm(n),jm(e).put(t)})},Lm.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},Lm.prototype.setLastStreamToken=function(e,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=qm(n),jm(e).put(t)})},Lm.prototype.addMutationBatch=function(u,c,h,l){var f=this,p=Bm(u),d=Vm(u);return d.add({}).next(function(t){xd("number"==typeof t,"Auto-generated key is not a number");var e=new km(t,c,h,l),n=f.serializer.toDbMutationBatch(f.userId,e);f.documentKeysByBatchId[t]=e.keys();for(var r=[],i=0,o=l;i<o.length;i++){var a=o[i],s=pb.key(f.userId,a.key.path,t);r.push(d.put(n)),r.push(p.put(s,pb.PLACEHOLDER)),r.push(f.indexManager.addToCollectionParentIndex(u,a.key.path.popLast()))}return Pm.waitFor(r).next(function(){return e})})},Lm.prototype.lookupMutationBatch=function(t,e){var n=this;return Vm(t).get(e).next(function(t){return t?(xd(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},Lm.prototype.lookupMutationKeys=function(t,n){var r=this;return this.documentKeysByBatchId[n]?Pm.resolve(this.documentKeysByBatchId[n]):this.lookupMutationBatch(t,n).next(function(t){if(t){var e=t.keys();return r.documentKeysByBatchId[n]=e}return null})},Lm.prototype.getNextMutationBatchAfterBatchId=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Vm(t).iterate({index:lb.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(xd(e.batchId>=i,"Should have found mutation after "+i),o=r.serializer.fromDbMutationBatch(e)),n.done()}).next(function(){return o})},Lm.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Vm(t).iterate({index:lb.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},Lm.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Vm(t).loadAll(lb.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},Lm.prototype.getAllMutationBatchesAffectingDocumentKey=function(s,u){var c=this,t=pb.prefixForPath(this.userId,u.path),e=IDBKeyRange.lowerBound(t),h=[];return Bm(s).iterate({range:e},function(e,t,n){var r=e[0],i=e[1],o=e[2],a=em(i);if(r===c.userId&&u.path.isEqual(a))return Vm(s).get(o).next(function(t){if(!t)throw Md("Dangling document-mutation reference found: "+e+" which points to "+o);xd(t.userId===c.userId,"Unexpected user '"+t.userId+"' for mutation batch "+o),h.push(c.serializer.fromDbMutationBatch(t))});n.done()}).next(function(){return h})},Lm.prototype.getAllMutationBatchesAffectingDocumentKeys=function(r,t){var u=this,c=new dm(yy),i=[];return t.forEach(function(s){var t=pb.prefixForPath(u.userId,s.path),e=IDBKeyRange.lowerBound(t),n=Bm(r).iterate({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=em(i);r===u.userId&&s.path.isEqual(a)?c=c.add(o):n.done()});i.push(n)}),Pm.waitFor(i).next(function(){return u.lookupMutationBatches(r,c)})},Lm.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var s=this;xd(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),xd(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var u=e.path,c=u.length+1,n=pb.prefixForPath(this.userId,u),r=IDBKeyRange.lowerBound(n),h=new dm(yy);return Bm(t).iterate({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=em(i);r===s.userId&&u.isPrefixOf(a)?a.length===c&&(h=h.add(o)):n.done()}).next(function(){return s.lookupMutationBatches(t,h)})},Lm.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Vm(t).get(e).next(function(t){if(null===t)throw Md("Dangling document-mutation reference found, which points to "+e);xd(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),Pm.waitFor(i).next(function(){return r})},Lm.prototype.removeMutationBatch=function(e,n){var r=this;return Um(e.simpleDbTransaction,this.userId,n).next(function(t){return r.removeCachedMutationKeys(n.batchId),Pm.forEach(t,function(t){return r.referenceDelegate.removeMutationReference(e,t)})})},Lm.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},Lm.prototype.performConsistencyCheck=function(n){var o=this;return this.checkEmpty(n).next(function(t){if(!t)return Pm.resolve();var e=IDBKeyRange.lowerBound(pb.prefixForUser(o.userId)),i=[];return Bm(n).iterate({range:e},function(t,e,n){if(t[0]===o.userId){var r=em(t[1]);i.push(r)}else n.done()}).next(function(){xd(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},Lm.prototype.containsKey=function(t,e){return Fm(t,this.userId,e)},Lm.prototype.getMutationQueueMetadata=function(t){var e=this;return jm(t).get(this.userId).next(function(t){return t||new cb(e.userId,-1,"")})},Lm);function Lm(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}function Fm(t,o,e){var n=pb.prefixForPath(o,e.path),a=n[1],r=IDBKeyRange.lowerBound(n),s=!1;return Bm(t).iterate({range:r,keysOnly:!0},function(t,e,n){var r=t[0],i=t[1];t[2];r===o&&i===a&&(s=!0),n.done()}).next(function(){return s})}function Um(t,e,n){var r=t.store(lb.store),i=t.store(pb.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){xd(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=pb.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return Pm.waitFor(o).next(function(){return c})}function qm(t){return t instanceof Uint8Array?(xd("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function Vm(t){return aw.getStore(t,lb.store)}function Bm(t){return aw.getStore(t,pb.store)}function jm(t){return aw.getStore(t,cb.store)}var Wm,Qm;(Qm=Wm=Wm||{})[Qm.QueryCache=0]="QueryCache",Qm[Qm.SyncEngine=1]="SyncEngine";var Km=(Hm.prototype.next=function(){var t=this.nextId;return this.nextId+=2,t},Hm.prototype.after=function(t){return this.seek(t+2),this.next()},Hm.prototype.seek=function(t){xd((1&t)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},Hm.forQueryCache=function(){return new Hm(Wm.QueryCache,2)},Hm.forSyncEngine=function(){return new Hm(Wm.SyncEngine)},Hm);function Hm(t,e){xd((1&(this.generatorId=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.seek(void 0!==e?e:this.generatorId)}var Gm="SimpleDb",zm=(Ym.openOrCreate=function(o,t,a){return xd(Ym.isAvailable(),"IndexedDB not supported in current environment."),Rd(Gm,"Opening database:",o),new Pm(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new Ym(e))},i.onblocked=function(){r(new Bd(Vd.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Bd(Vd.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Rd(Gm,'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result,n=new $m(i.transaction);a.createOrUpgrade(e,n,t.oldVersion,rb).next(function(){Rd(Gm,"Database upgrade to version "+rb+" complete")})}}).toPromise()},Ym.delete=function(t){return Rd(Gm,"Removing database:",t),nv(window.indexedDB.deleteDatabase(t)).toPromise()},Ym.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return"YES"===process.env.USE_MOCK_PERSISTENCE;var t=Ii(),e=Ym.getIOSVersion(t),n=0<e&&e<10,r=Ym.getAndroidVersion(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Ym.getStore=function(t,e){return t.store(e)},Ym.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Ym.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Ym.prototype.setVersionChangeListener=function(e){this.db.onversionchange=function(t){return e(t)}},Ym.prototype.runTransaction=function(t,e,n){var r=$m.open(this.db,t,e),i=n(r).catch(function(t){return r.abort(t),Pm.reject(t)}).toPromise();return i.catch(function(){}),r.completionPromise.then(function(){return i})},Ym.prototype.close=function(){this.db.close()},Ym);function Ym(t){this.db=t,12.2===Ym.getIOSVersion(Ii())&&Od("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}var Xm=(Object.defineProperty(Jm.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(Jm.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(Jm.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),Jm.prototype.done=function(){this.shouldStop=!0},Jm.prototype.skip=function(t){this.nextKey=t},Jm.prototype.delete=function(){return nv(this.dbCursor.delete())},Jm);function Jm(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}var $m=(Zm.open=function(t,e,n){return new Zm(t.transaction(n,e))},Object.defineProperty(Zm.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),Zm.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(Rd(Gm,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Zm.prototype.store=function(t){var e=this.transaction.objectStore(t);return xd(!!e,"Object store not part of transaction: "+t),new tv(e)},Zm);function Zm(t){var n=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new Wy,this.transaction.oncomplete=function(){n.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?n.completionDeferred.reject(t.error):n.completionDeferred.resolve()},this.transaction.onerror=function(t){var e=iv(t.target.error);n.completionDeferred.reject(e)}}var tv=(ev.prototype.put=function(t,e){return nv(void 0!==e?(Rd(Gm,"PUT",this.store.name,t,e),this.store.put(e,t)):(Rd(Gm,"PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},ev.prototype.add=function(t){return Rd(Gm,"ADD",this.store.name,t,t),nv(this.store.add(t))},ev.prototype.get=function(e){var n=this;return nv(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Rd(Gm,"GET",n.store.name,e,t),t})},ev.prototype.delete=function(t){return Rd(Gm,"DELETE",this.store.name,t),nv(this.store.delete(t))},ev.prototype.count=function(){return Rd(Gm,"COUNT",this.store.name),nv(this.store.count())},ev.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},ev.prototype.deleteAll=function(t,e){Rd(Gm,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},ev.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},ev.prototype.iterateSerial=function(i){var t=this.cursor({});return new Pm(function(n,r){t.onerror=function(t){var e=iv(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},ev.prototype.iterateCursor=function(t,a){var s=[];return new Pm(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new Xm(e),r=a(e.primaryKey,e.value,n);if(r instanceof Pm){var i=r.catch(function(t){return n.done(),Pm.reject(t)});s.push(i)}n.isDone?o():null===n.skipToKey?e.continue():e.continue(n.skipToKey)}else o()}}).next(function(){return Pm.waitFor(s)})},ev.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(xd(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},ev.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},ev);function ev(t){this.store=t}function nv(t){return new Pm(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=iv(t.target.error);r(e)}})}var rv=!1;function iv(t){var e=zm.getIOSVersion(Ii());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Bd("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return rv||(rv=!0,setTimeout(function(){throw r},0)),r}}return t}var ov=(av.prototype.allocateTargetId=function(e){var n=this;return this.retrieveMetadata(e).next(function(t){return t.highestTargetId=n.targetIdGenerator.after(t.highestTargetId),n.saveMetadata(e,t).next(function(){return t.highestTargetId})})},av.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return im.fromTimestamp(new nm(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},av.prototype.getHighestSequenceNumber=function(t){return cv(t.simpleDbTransaction)},av.prototype.setTargetsMetadata=function(e,n,r){var i=this;return this.retrieveMetadata(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.toTimestamp()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.saveMetadata(e,t)})},av.prototype.addQueryData=function(e,n){var r=this;return this.saveQueryData(e,n).next(function(){return r.retrieveMetadata(e).next(function(t){return t.targetCount+=1,r.updateMetadataFromQueryData(n,t),r.saveMetadata(e,t)})})},av.prototype.updateQueryData=function(t,e){return this.saveQueryData(t,e)},av.prototype.removeQueryData=function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return sv(e).delete(t.targetId)}).next(function(){return n.retrieveMetadata(e)}).next(function(t){return xd(0<t.targetCount,"Removing from an empty query cache"),t.targetCount-=1,n.saveMetadata(e,t)})},av.prototype.removeTargets=function(r,i,o){var a=this,s=0,u=[];return sv(r).iterate(function(t,e){var n=a.serializer.fromDbTarget(e);n.sequenceNumber<=i&&void 0===o[n.targetId]&&(s++,u.push(a.removeQueryData(r,n)))}).next(function(){return Pm.waitFor(u)}).next(function(){return s})},av.prototype.forEachTarget=function(t,r){var i=this;return sv(t).iterate(function(t,e){var n=i.serializer.fromDbTarget(e);r(n)})},av.prototype.retrieveMetadata=function(t){return uv(t.simpleDbTransaction)},av.prototype.saveMetadata=function(t,e){return function(t){return aw.getStore(t,Ib.store)}(t).put(Ib.key,e)},av.prototype.saveQueryData=function(t,e){return sv(t).put(this.serializer.toDbTarget(e))},av.prototype.updateMetadataFromQueryData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},av.prototype.getQueryCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},av.prototype.getQueryData=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),a=null;return sv(t).iterate({range:n,index:_b.queryTargetsIndexName},function(t,e,n){var r=o.serializer.fromDbTarget(e);i.isEqual(r.query)&&(a=r,n.done())}).next(function(){return a})},av.prototype.addMatchingKeys=function(n,t,r){var i=this,o=[],a=hv(n);return t.forEach(function(t){var e=$y(t.path);o.push(a.put(new Tb(r,e))),o.push(i.referenceDelegate.addReference(n,t))}),Pm.waitFor(o)},av.prototype.removeMatchingKeys=function(n,t,r){var i=this,o=hv(n);return Pm.forEach(t,function(t){var e=$y(t.path);return Pm.waitFor([o.delete([r,e]),i.referenceDelegate.removeReference(n,t)])})},av.prototype.removeMatchingKeysForTargetId=function(t,e){var n=hv(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},av.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=hv(t),o=Cm();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=em(t[1]),i=new qy(r);o=o.add(i)}).next(function(){return o})},av.prototype.containsKey=function(t,e){var n=$y(e.path),r=IDBKeyRange.bound([n],[vy(n)],!1,!0),i=0;return hv(t).iterate({index:Tb.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},av.prototype.getQueryDataForTarget=function(t,e){var n=this;return sv(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},av);function av(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=Km.forQueryCache()}function sv(t){return aw.getStore(t,_b.store)}function uv(t){return zm.getStore(t,Ib.store).get(Ib.key).next(function(t){return xd(null!==t,"Missing metadata row."),t})}function cv(t){return uv(t).next(function(t){return t.highestListenSequenceNumber})}function hv(t){return aw.getStore(t,Tb.store)}var lv=(fv.fromSet=function(t){return new fv(t)},fv.fromArray=function(t){var e=new dm(Fy.comparator);return t.forEach(function(t){return e=e.add(t)}),new fv(e)},fv.prototype.covers=function(e){var n=!1;return this.fields.forEach(function(t){t.isPrefixOf(e)&&(n=!0)}),n},fv.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},fv);function fv(t){this.fields=t}var pv=(dv.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},dv);function dv(t,e){this.field=t,this.transform=e}var yv,mv,vv=function(t,e){this.version=t,this.transformResults=e};(mv=yv=yv||{})[mv.Set=0]="Set",mv[mv.Patch=1]="Patch",mv[mv.Transform=2]="Transform",mv[mv.Delete=3]="Delete";var gv=(bv.exists=function(t){return new bv(void 0,t)},bv.updateTime=function(t){return new bv(t)},Object.defineProperty(bv.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),bv.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof Rg&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Rg:(xd(this.isNone,"Precondition should be empty"),!0)},bv.prototype.isEqual=function(t){return function(t,e){return null!=t?!(!e||!t.isEqual(e)):t===e}(this.updateTime,t.updateTime)&&this.exists===t.exists},bv.NONE=new bv,bv);function bv(t,e){this.updateTime=t,this.exists=e,xd(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}var wv=(_v.prototype.verifyKeyMatches=function(t){null!=t&&xd(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},_v.getPostMutationVersion=function(t){return t instanceof Rg?t.version:im.MIN},_v);function _v(){}var Ev,Tv=(ui(Sv,Ev=wv),Sv.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),xd(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Rg(this.key,n,{hasCommittedMutations:!0},this.value)},Sv.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=wv.getPostMutationVersion(t);return new Rg(this.key,r,{hasLocalMutations:!0},this.value)},Sv.prototype.extractBaseValue=function(t){return null},Sv.prototype.isEqual=function(t){return t instanceof Sv&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},Sv);function Sv(t,e,n){var r=Ev.call(this)||this;return r.key=t,r.value=e,r.precondition=n,r.type=yv.Set,r}var Iv,Cv=(ui(Nv,Iv=wv),Nv.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),xd(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new Fg(this.key,e.version);var n=this.patchDocument(t);return new Rg(this.key,e.version,{hasCommittedMutations:!0},n)},Nv.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=wv.getPostMutationVersion(t),i=this.patchDocument(t);return new Rg(this.key,r,{hasLocalMutations:!0},i)},Nv.prototype.extractBaseValue=function(t){return null},Nv.prototype.isEqual=function(t){return t instanceof Nv&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},Nv.prototype.patchDocument=function(t){var e;return e=t instanceof Rg?t.data():Tg.EMPTY,this.patchObject(e)},Nv.prototype.patchObject=function(n){var r=this;return this.fieldMask.fields.forEach(function(t){if(!t.isEmpty()){var e=r.data.field(t);n=null!==e?n.set(t,e):n.delete(t)}}),n},Nv);function Nv(t,e,n,r){var i=Iv.call(this)||this;return i.key=t,i.data=e,i.fieldMask=n,i.precondition=r,i.type=yv.Patch,i}var Av,kv=(ui(Dv,Av=wv),Dv.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),xd(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new Fg(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data(),r);return new Rg(this.key,i,{hasCommittedMutations:!0},o)},Dv.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data(),i);return new Rg(this.key,r.version,{hasLocalMutations:!0},o)},Dv.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Rg?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?Tg.EMPTY.set(i.field,a):e.set(i.field,a))}return e},Dv.prototype.isEqual=function(t){return t instanceof Dv&&this.key.isEqual(t.key)&&my(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},Dv.prototype.requireDocument=function(t){xd(t instanceof Rg,"Unknown MaybeDocument type "+t);var e=t;return xd(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},Dv.prototype.serverTransformResults=function(t,e){var n=[];xd(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof Rg&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},Dv.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof Rg&&(u=e.field(a.field)),null===u&&n instanceof Rg&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},Dv.prototype.transformObject=function(t,e){xd(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},Dv);function Dv(t,e){var n=Av.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=yv.Transform,n.precondition=gv.exists(!0),n}var Rv,Ov,Pv,Mv,xv,Lv=(ui(Fv,Rv=wv),Fv.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),xd(null==e.transformResults,"Transform results received by DeleteMutation."),new Mg(this.key,e.version,{hasCommittedMutations:!0})},Fv.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&xd(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new Mg(this.key,im.forDeletedDoc())):t},Fv.prototype.extractBaseValue=function(t){return null},Fv.prototype.isEqual=function(t){return t instanceof Fv&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},Fv);function Fv(t,e){var n=Rv.call(this)||this;return n.key=t,n.precondition=e,n.type=yv.Delete,n}(Pv=Ov=Ov||{})[Pv.NullValue=0]="NullValue",Pv[Pv.BooleanValue=1]="BooleanValue",Pv[Pv.NumberValue=2]="NumberValue",Pv[Pv.TimestampValue=3]="TimestampValue",Pv[Pv.StringValue=4]="StringValue",Pv[Pv.BlobValue=5]="BlobValue",Pv[Pv.RefValue=6]="RefValue",Pv[Pv.GeoPointValue=7]="GeoPointValue",Pv[Pv.ArrayValue=8]="ArrayValue",Pv[Pv.ObjectValue=9]="ObjectValue",(xv=Mv=Mv||{})[xv.Default=0]="Default",xv[xv.Estimate=1]="Estimate",xv[xv.Previous=2]="Previous";var Uv=(qv.fromSnapshotOptions=function(t,e){switch(t.serverTimestamps){case"estimate":return new qv(Mv.Estimate,e);case"previous":return new qv(Mv.Previous,e);case"none":case void 0:return new qv(Mv.Default,e);default:return Md("fromSnapshotOptions() called with invalid options.")}},qv);function qv(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}var Vv=(Bv.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},Bv.prototype.defaultCompareTo=function(t){return xd(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),yy(this.typeOrder,t.typeOrder)},Bv);function Bv(){}var jv,Wv=(ui(Qv,jv=Vv),Qv.prototype.value=function(t){return null},Qv.prototype.isEqual=function(t){return t instanceof Qv},Qv.prototype.compareTo=function(t){return t instanceof Qv?0:this.defaultCompareTo(t)},Qv.INSTANCE=new Qv,Qv);function Qv(){var t=jv.call(this)||this;return t.typeOrder=Ov.NullValue,t.internalValue=null,t}var Kv,Hv=(ui(Gv,Kv=Vv),Gv.prototype.value=function(t){return this.internalValue},Gv.prototype.isEqual=function(t){return t instanceof Gv&&this.internalValue===t.internalValue},Gv.prototype.compareTo=function(t){return t instanceof Gv?yy(this,t):this.defaultCompareTo(t)},Gv.of=function(t){return t?Gv.TRUE:Gv.FALSE},Gv.TRUE=new Gv(!0),Gv.FALSE=new Gv(!1),Gv);function Gv(t){var e=Kv.call(this)||this;return e.internalValue=t,e.typeOrder=Ov.BooleanValue,e}var zv,Yv=(ui(Xv,zv=Vv),Xv.prototype.value=function(t){return this.internalValue},Xv.prototype.compareTo=function(t){return t instanceof Xv?function(t,e){return t<e?-1:e<t?1:t===e?0:isNaN(t)?isNaN(e)?0:-1:1}(this.internalValue,t.internalValue):this.defaultCompareTo(t)},Xv);function Xv(t){var e=zv.call(this)||this;return e.internalValue=t,e.typeOrder=Ov.NumberValue,e}function Jv(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var $v,Zv=(ui(tg,$v=Yv),tg.prototype.isEqual=function(t){return t instanceof tg&&Jv(this.internalValue,t.internalValue)},tg);function tg(){return null!==$v&&$v.apply(this,arguments)||this}var eg,ng=(ui(rg,eg=Yv),rg.prototype.isEqual=function(t){return t instanceof rg&&Jv(this.internalValue,t.internalValue)},rg.NAN=new rg(NaN),rg.POSITIVE_INFINITY=new rg(1/0),rg.NEGATIVE_INFINITY=new rg(-1/0),rg);function rg(){return null!==eg&&eg.apply(this,arguments)||this}var ig,og=(ui(ag,ig=Vv),ag.prototype.value=function(t){return this.internalValue},ag.prototype.isEqual=function(t){return t instanceof ag&&this.internalValue===t.internalValue},ag.prototype.compareTo=function(t){return t instanceof ag?yy(this.internalValue,t.internalValue):this.defaultCompareTo(t)},ag);function ag(t){var e=ig.call(this)||this;return e.internalValue=t,e.typeOrder=Ov.StringValue,e}var sg,ug=(ui(cg,sg=Vv),cg.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},cg.prototype.isEqual=function(t){return t instanceof cg&&this.internalValue.isEqual(t.internalValue)},cg.prototype.compareTo=function(t){return t instanceof cg?this.internalValue._compareTo(t.internalValue):t instanceof lg?-1:this.defaultCompareTo(t)},cg);function cg(t){var e=sg.call(this)||this;return e.internalValue=t,e.typeOrder=Ov.TimestampValue,e}var hg,lg=(ui(fg,hg=Vv),fg.prototype.value=function(t){return t&&t.serverTimestampBehavior===Mv.Estimate?new ug(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===Mv.Previous&&this.previousValue?this.previousValue.value(t):null},fg.prototype.isEqual=function(t){return t instanceof fg&&this.localWriteTime.isEqual(t.localWriteTime)},fg.prototype.compareTo=function(t){return t instanceof fg?this.localWriteTime._compareTo(t.localWriteTime):t instanceof ug?1:this.defaultCompareTo(t)},fg.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},fg);function fg(t,e){var n=hg.call(this)||this;return n.localWriteTime=t,n.previousValue=e,n.typeOrder=Ov.TimestampValue,n}var pg,dg=(ui(yg,pg=Vv),yg.prototype.value=function(t){return this.internalValue},yg.prototype.isEqual=function(t){return t instanceof yg&&this.internalValue.isEqual(t.internalValue)},yg.prototype.compareTo=function(t){return t instanceof yg?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},yg);function yg(t){var e=pg.call(this)||this;return e.internalValue=t,e.typeOrder=Ov.BlobValue,e}var mg,vg=(ui(gg,mg=Vv),gg.prototype.value=function(t){return this.key},gg.prototype.isEqual=function(t){return t instanceof gg&&this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId)},gg.prototype.compareTo=function(t){if(t instanceof gg){var e=this.databaseId.compareTo(t.databaseId);return 0!==e?e:qy.comparator(this.key,t.key)}return this.defaultCompareTo(t)},gg);function gg(t,e){var n=mg.call(this)||this;return n.databaseId=t,n.key=e,n.typeOrder=Ov.RefValue,n}var bg,wg=(ui(_g,bg=Vv),_g.prototype.value=function(t){return this.internalValue},_g.prototype.isEqual=function(t){return t instanceof _g&&this.internalValue.isEqual(t.internalValue)},_g.prototype.compareTo=function(t){return t instanceof _g?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},_g);function _g(t){var e=bg.call(this)||this;return e.internalValue=t,e.typeOrder=Ov.GeoPointValue,e}var Eg,Tg=(ui(Sg,Eg=Vv),Sg.prototype.value=function(n){var r={};return this.internalValue.inorderTraversal(function(t,e){r[t]=e.value(n)}),r},Sg.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},Sg.prototype.isEqual=function(t){if(t instanceof Sg){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.hasNext()&&!n.hasNext()}return!1},Sg.prototype.compareTo=function(t){if(t instanceof Sg){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext(),o=yy(r.key,i.key)||r.value.compareTo(i.value);if(o)return o}return yy(e.hasNext(),n.hasNext())}return this.defaultCompareTo(t)},Sg.prototype.set=function(t,e){if(xd(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),e);var n=this.child(t.firstSegment());n instanceof Sg||(n=Sg.EMPTY);var r=n.set(t.popFirst(),e);return this.setChild(t.firstSegment(),r)},Sg.prototype.delete=function(t){if(xd(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new Sg(this.internalValue.remove(t.firstSegment()));var e=this.child(t.firstSegment());if(e instanceof Sg){var n=e.delete(t.popFirst());return new Sg(this.internalValue.insert(t.firstSegment(),n))}return this},Sg.prototype.contains=function(t){return null!==this.field(t)},Sg.prototype.field=function(t){xd(!t.isEmpty(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof Sg?e.internalValue.get(t):null}),e},Sg.prototype.fieldMask=function(){var i=new dm(Fy.comparator);return this.internalValue.forEach(function(t,e){var n=new Fy([t]);if(e instanceof Sg){var r=e.fieldMask().fields;r.isEmpty()?i=i.add(n):r.forEach(function(t){i=i.add(n.child(t))})}else i=i.add(n)}),lv.fromSet(i)},Sg.prototype.toString=function(){return this.internalValue.toString()},Sg.prototype.child=function(t){return this.internalValue.get(t)||void 0},Sg.prototype.setChild=function(t,e){return new Sg(this.internalValue.insert(t,e))},Sg.EMPTY=new Sg(new am(yy)),Sg);function Sg(t){var e=Eg.call(this)||this;return e.internalValue=t,e.typeOrder=Ov.ObjectValue,e}var Ig,Cg=(ui(Ng,Ig=Vv),Ng.prototype.value=function(e){return this.internalValue.map(function(t){return t.value(e)})},Ng.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},Ng.prototype.forEach=function(t){this.internalValue.forEach(t)},Ng.prototype.isEqual=function(t){if(t instanceof Ng){if(this.internalValue.length!==t.internalValue.length)return!1;for(var e=0;e<this.internalValue.length;e++)if(!this.internalValue[e].isEqual(t.internalValue[e]))return!1;return!0}return!1},Ng.prototype.compareTo=function(t){if(t instanceof Ng){for(var e=Math.min(this.internalValue.length,t.internalValue.length),n=0;n<e;n++){var r=this.internalValue[n].compareTo(t.internalValue[n]);if(r)return r}return yy(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},Ng.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},Ng);function Ng(t){var e=Ig.call(this)||this;return e.internalValue=t,e.typeOrder=Ov.ArrayValue,e}var Ag=(kg.compareByKey=function(t,e){return qy.comparator(t.key,e.key)},kg);function kg(t,e){this.key=t,this.version=e}var Dg,Rg=(ui(Og,Dg=Ag),Og.prototype.field=function(t){if(this.objectValue)return this.objectValue.field(t);this.fieldValueCache||(this.fieldValueCache=new Map);var e=t.canonicalString(),n=this.fieldValueCache.get(e);if(void 0===n){var r=this.getProtoField(t);n=void 0===r?null:this.converter(r),this.fieldValueCache.set(e,n)}return n},Og.prototype.data=function(){var n=this;if(!this.objectValue){var r=Tg.EMPTY;Gd(this.proto.fields,function(t,e){r=r.set(new Fy([t]),n.converter(e))}),this.objectValue=r,this.fieldValueCache=void 0}return this.objectValue},Og.prototype.value=function(){return this.data().value()},Og.prototype.isEqual=function(t){return t instanceof Og&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},Og.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Og.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Og.prototype.getProtoField=function(t){xd(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields[t.firstSegment()],n=1;n<t.length;++n){if(!e||!e.mapValue)return;e=e.mapValue.fields[t.get(n)]}return e},Og.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):Md("Trying to compare documents on fields that don't exist")},Og);function Og(t,e,n,r,i,o){var a=Dg.call(this,t,e)||this;return a.objectValue=r,a.proto=i,a.converter=o,xd(void 0!==a.objectValue||void 0!==a.proto&&void 0!==a.converter,"If objectValue is not defined, proto and converter need to be set."),a.hasLocalMutations=!!n.hasLocalMutations,a.hasCommittedMutations=!!n.hasCommittedMutations,a}var Pg,Mg=(ui(xg,Pg=Ag),xg.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(xg.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),xg.prototype.isEqual=function(t){return t instanceof xg&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},xg);function xg(t,e,n){var r=Pg.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}var Lg,Fg=(ui(Ug,Lg=Ag),Ug.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ug.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),Ug.prototype.isEqual=function(t){return t instanceof Ug&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Ug);function Ug(){return null!==Lg&&Lg.apply(this,arguments)||this}var qg=(Vg.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},Vg.prototype.has=function(t){return void 0!==this.get(t)},Vg.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},Vg.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},Vg.prototype.forEach=function(s){Gd(this.inner,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],a=i[1];s(o,a)}})},Vg.prototype.isEmpty=function(){return zd(this.inner)},Vg);function Vg(t){this.mapKeyFn=t,this.inner={}}var Bg=(jg.prototype.addEntry=function(t){this.assertNotApplied(),this.changes.set(t.key,t)},jg.prototype.removeEntry=function(t){this.assertNotApplied(),this.changes.set(t,null)},jg.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Pm.resolve(n):this.getFromCache(t,e)},jg.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},jg.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},jg.prototype.assertNotApplied=function(){xd(!this.changesApplied,"Changes have already been applied.")},jg);function jg(){this.changes=new qg(function(t){return t.toString()}),this.changesApplied=!1}var Wg,Qg="The remote document changelog no longer contains all changes for all local query views. It may be necessary to rebuild these views.",Kg=(Object.defineProperty(Hg.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:!0,configurable:!0}),Hg.prototype.start=function(t){var e=zm.getStore(t,Db.store);return this.synchronizeLastDocumentChangeId(e)},Hg.prototype.addEntry=function(t,e,n){var r=this;return Yg(t).put(Jg(e),n).next(function(){r.indexManager.addToCollectionParentIndex(t,e.path.popLast())})},Hg.prototype.removeEntry=function(t,e){var n=Yg(t),r=Jg(e);return n.delete(r)},Hg.prototype.updateMetadata=function(e,n,r){var i=this;return this.getMetadata(e).next(function(t){return t.byteSize+=r,i.setMetadata(e,t).next(function(){if(i.keepDocumentChangeLog)return Xg(e).put({changes:i.serializer.toDbResourcePaths(n)})})})},Hg.prototype.getEntry=function(t,e){var n=this;return Yg(t).get(Jg(e)).next(function(t){return t?n.serializer.fromDbRemoteDocument(t):null})},Hg.prototype.getSizedEntry=function(t,e){var n=this;return Yg(t).get(Jg(e)).next(function(t){return t?{maybeDocument:n.serializer.fromDbRemoteDocument(t),size:$g(t)}:null})},Hg.prototype.getEntries=function(t,e){var n=this,r=wm();return this.forEachDbEntry(t,e,function(t,e){r=e?r.insert(t,n.serializer.fromDbRemoteDocument(e)):r.insert(t,null)}).next(function(){return r})},Hg.prototype.getSizedEntries=function(t,e){var n=this,r=wm(),i=new am(qy.comparator);return this.forEachDbEntry(t,e,function(t,e){i=e?(r=r.insert(t,n.serializer.fromDbRemoteDocument(e)),i.insert(t,$g(e))):(r=r.insert(t,null),i.insert(t,0))}).next(function(){return{maybeDocuments:r,sizeMap:i}})},Hg.prototype.forEachDbEntry=function(t,e,i){if(e.isEmpty())return Pm.resolve();var n=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),o=e.getIterator(),a=o.getNext();return Yg(t).iterate({range:n},function(t,e,n){for(var r=qy.fromSegments(t);a&&qy.comparator(a,r)<0;)i(a,null),a=o.getNext();a&&a.isEqual(r)&&(i(a,e),a=o.hasNext()?o.getNext():null),a?n.skip(a.path.toArray()):n.done()}).next(function(){for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})},Hg.prototype.getDocumentsMatchingQuery=function(t,i){var o=this;xd(!i.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var a=Em(),s=i.path.length+1,e=i.path.toArray(),n=IDBKeyRange.lowerBound(e);return Yg(t).iterate({range:n},function(t,e,n){if(t.length===s){var r=o.serializer.fromDbRemoteDocument(e);i.path.isPrefixOf(r.key.path)?r instanceof Rg&&i.matches(r)&&(a=a.insert(r.key,r)):n.done()}}).next(function(){return a})},Hg.prototype.getNewDocumentChanges=function(e){var r=this;xd(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var n=Cm(),i=bm(),t=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1),o=!0,a=Xg(e);return a.iterate({range:t},function(t,e){if(o&&(o=!1,r._lastProcessedDocumentChangeId+1!==e.id))return r.synchronizeLastDocumentChangeId(a).next(function(){return Pm.reject(new Bd(Vd.DATA_LOSS,Qg))});n=n.unionWith(r.serializer.fromDbResourcePaths(e.changes)),r._lastProcessedDocumentChangeId=e.id}).next(function(){var t=[];return n.forEach(function(n){t.push(r.getEntry(e,n).next(function(t){var e=t||new Mg(n,im.forDeletedDoc());i=i.insert(n,e)}))}),Pm.waitFor(t)}).next(function(){return i})},Hg.prototype.removeDocumentChangesThroughChangeId=function(t,e){var n=IDBKeyRange.upperBound(e);return Xg(t).delete(n)},Hg.prototype.synchronizeLastDocumentChangeId=function(t){var r=this;return this._lastProcessedDocumentChangeId=0,t.iterate({keysOnly:!0,reverse:!0},function(t,e,n){r._lastProcessedDocumentChangeId=t,n.done()})},Hg.prototype.newChangeBuffer=function(){return new Hg.RemoteDocumentChangeBuffer(this)},Hg.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Hg.prototype.getMetadata=function(t){return zg(t).get(bb.key).next(function(t){return xd(!!t,"Missing document cache metadata"),t})},Hg.prototype.setMetadata=function(t,e){return zg(t).put(bb.key,e)},Hg.RemoteDocumentChangeBuffer=(ui(Gg,Wg=Bg),Gg.prototype.applyChanges=function(o){var a=this,s=[],u=0,c=Cm();return this.changes.forEach(function(t,e){var n=a.documentSizes.get(t);if(xd(void 0!==n,"Cannot modify a document that wasn't read (for "+t+")"),e){var r=a.documentCache.serializer.toDbRemoteDocument(e),i=$g(r);u+=i-n,s.push(a.documentCache.addEntry(o,t,r))}else u-=n,s.push(a.documentCache.removeEntry(o,t));c=c.add(t)}),s.push(this.documentCache.updateMetadata(o,c,u)),Pm.waitFor(s)},Gg.prototype.getFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntry(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},Gg.prototype.getAllFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntries(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},Gg),Hg);function Hg(t,e,n){this.serializer=t,this.indexManager=e,this.keepDocumentChangeLog=n,this._lastProcessedDocumentChangeId=0}function Gg(t){var e=Wg.call(this)||this;return e.documentCache=t,e.documentSizes=new qg(function(t){return t.toString()}),e}function zg(t){return aw.getStore(t,bb.store)}function Yg(t){return aw.getStore(t,vb.store)}function Xg(t){return aw.getStore(t,Db.store)}function Jg(t){return t.path.toArray()}function $g(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Md("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var Zg=(tb.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),Pm.resolve()},tb.prototype.getCollectionParents=function(t,e){return Pm.resolve(this.collectionParentIndex.getEntries(e))},tb);function tb(){this.collectionParentIndex=new eb}var eb=(nb.prototype.add=function(t){xd(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new dm(Py.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},nb.prototype.getEntries=function(t){return(this.index[t]||new dm(Py.comparator)).toArray()},nb);function nb(){this.index={}}var rb=8,ib=(ob.prototype.createOrUpgrade=function(t,e,n,r){var i=this;xd(n<r&&0<=n&&r<=rb,"Unexpected schema upgrade from v"+n+" to v{toVersion}."),n<1&&1<=r&&(function(t){t.createObjectStore(sb.store)}(t),function(t){t.createObjectStore(cb.store,{keyPath:cb.keyPath}),t.createObjectStore(lb.store,{keyPath:lb.keyPath,autoIncrement:!0}).createIndex(lb.userMutationsIndex,lb.userMutationsKeyPath,{unique:!0}),t.createObjectStore(pb.store)}(t),kb(t),function(t){t.createObjectStore(vb.store)}(t));var o=Pm.resolve();return n<3&&3<=r&&(0!==n&&(function(t){t.deleteObjectStore(Tb.store),t.deleteObjectStore(_b.store),t.deleteObjectStore(Ib.store)}(t),kb(t)),o=o.next(function(){return function(t){var e=t.store(Ib.store),n=new Ib(0,0,im.MIN.toTimestamp(),0);return e.put(Ib.key,n)}(e)})),n<4&&4<=r&&(0!==n&&(o=o.next(function(){return function(r,i){return i.store(lb.store).loadAll().next(function(t){r.deleteObjectStore(lb.store),r.createObjectStore(lb.store,{keyPath:lb.keyPath,autoIncrement:!0}).createIndex(lb.userMutationsIndex,lb.userMutationsKeyPath,{unique:!0});var e=i.store(lb.store),n=t.map(function(t){return e.put(t)});return Pm.waitFor(n)})}(t,e)})),o=o.next(function(){!function(t){t.createObjectStore(Ob.store,{keyPath:Ob.keyPath})}(t),function(t){t.createObjectStore(Db.store,{keyPath:"id",autoIncrement:!0})}(t)})),n<5&&5<=r&&(o=o.next(function(){return i.removeAcknowledgedMutations(e)})),n<6&&6<=r&&(o=o.next(function(){return function(t){t.createObjectStore(bb.store)}(t),i.addDocumentGlobal(e)})),n<7&&7<=r&&(o=o.next(function(){return i.ensureSequenceNumbers(e)})),n<8&&8<=r&&(o=o.next(function(){return i.createCollectionParentIndex(t,e)})),o},ob.prototype.addDocumentGlobal=function(e){var n=0;return e.store(vb.store).iterate(function(t,e){n+=$g(e)}).next(function(){var t=new bb(n);return e.store(bb.store).put(bb.key,t)})},ob.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(cb.store),e=r.store(lb.store);return t.loadAll().next(function(t){return Pm.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.loadAll(lb.userMutationsIndex,t).next(function(t){return Pm.forEach(t,function(t){xd(t.userId===n.userId,"Cannot process batch "+t.batchId+" from unexpected user");var e=i.serializer.fromDbMutationBatch(t);return Um(r,n.userId,e).next(function(){})})})})})},ob.prototype.ensureSequenceNumbers=function(t){var a=t.store(Tb.store),e=t.store(vb.store);return cv(t).next(function(i){var o=[];return e.iterate(function(t,e){var n=new Py(t),r=function(t){return[0,$y(t)]}(n);o.push(a.get(r).next(function(t){return t?Pm.resolve():function(t){return a.put(new Tb(0,$y(t),i))}(n)}))}).next(function(){return Pm.waitFor(o)})})},ob.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.lastSegment(),n=t.popLast();return r.put({collectionId:e,parent:$y(n)})}}t.createObjectStore(Nb.store,{keyPath:Nb.keyPath});var r=e.store(Nb.store),o=new eb;return e.store(vb.store).iterate({keysOnly:!0},function(t,e){var n=new Py(t);return i(n.popLast())}).next(function(){return e.store(pb.store).iterate({keysOnly:!0},function(t,e){t[0];var n=t[1],r=(t[2],em(n));return i(r.popLast())})})},ob);function ob(t){this.serializer=t}var ab=function(t,e){this.seconds=t,this.nanoseconds=e},sb=(ub.store="owner",ub.key="owner",ub);function ub(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var cb=(hb.store="mutationQueues",hb.keyPath="userId",hb);function hb(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var lb=(fb.store="mutations",fb.keyPath="batchId",fb.userMutationsIndex="userMutationsIndex",fb.userMutationsKeyPath=["userId","batchId"],fb);function fb(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}var pb=(db.prefixForUser=function(t){return[t]},db.prefixForPath=function(t,e){return[t,$y(e)]},db.key=function(t,e,n){return[t,$y(e),n]},db.store="documentMutations",db.PLACEHOLDER=new db,db);function db(){}var yb=function(t,e){this.path=t,this.readTime=e},mb=function(t,e){this.path=t,this.version=e},vb=(gb.store="remoteDocuments",gb);function gb(t,e,n,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r}var bb=(wb.store="remoteDocumentGlobal",wb.key="remoteDocumentGlobalKey",wb);function wb(t){this.byteSize=t}var _b=(Eb.store="targets",Eb.keyPath="targetId",Eb.queryTargetsIndexName="queryTargetsIndex",Eb.queryTargetsKeyPath=["canonicalId","targetId"],Eb);function Eb(t,e,n,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.query=o}var Tb=(Sb.store="targetDocuments",Sb.keyPath=["targetId","path"],Sb.documentTargetsIndex="documentTargetsIndex",Sb.documentTargetsKeyPath=["path","targetId"],Sb);function Sb(t,e,n){this.targetId=t,this.path=e,xd(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}var Ib=(Cb.key="targetGlobalKey",Cb.store="targetGlobal",Cb);function Cb(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}var Nb=(Ab.store="collectionParents",Ab.keyPath=["collectionId","parent"],Ab);function Ab(t,e){this.collectionId=t,this.parent=e}function kb(t){t.createObjectStore(Tb.store,{keyPath:Tb.keyPath}).createIndex(Tb.documentTargetsIndex,Tb.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(_b.store,{keyPath:_b.keyPath}).createIndex(_b.queryTargetsIndexName,_b.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Ib.store)}var Db=(Rb.store="remoteDocumentChanges",Rb.keyPath="id",Rb);function Rb(t){this.changes=t}var Ob=(Pb.store="clientMetadata",Pb.keyPath="clientId",Pb);function Pb(t,e,n,r,i){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r,this.lastProcessedDocumentChangeId=i}var Mb,xb,Lb=[cb.store,lb.store,pb.store,vb.store,_b.store,sb.store,Ib.store,Tb.store].concat([Ob.store,Db.store]).concat([bb.store]).concat([Nb.store]),Fb=(Ub.prototype.addToCollectionParentIndex=function(t,e){if(xd(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.add(e)){xd(1<=e.length,"Invalid collection path.");var n=e.lastSegment(),r=e.popLast();return qb(t).put({collectionId:n,parent:$y(r)})}return Pm.resolve()},Ub.prototype.getCollectionParents=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[vy(i),""],!1,!0);return qb(t).loadAll(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(em(r.parent))}return o})},Ub);function Ub(){this.collectionParentsCache=new eb}function qb(t){return aw.getStore(t,Nb.store)}(xb=Mb=Mb||{})[xb.Listen=0]="Listen",xb[xb.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",xb[xb.LimboResolution=2]="LimboResolution";var Vb=(Bb.prototype.withSequenceNumber=function(t){return new Bb(this.query,this.targetId,this.purpose,t,this.snapshotVersion,this.resumeToken)},Bb.prototype.withResumeToken=function(t,e){return new Bb(this.query,this.targetId,this.purpose,this.sequenceNumber,e,t)},Bb.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.resumeToken===t.resumeToken&&this.query.isEqual(t.query)},Bb);function Bb(t,e,n,r,i,o){void 0===i&&(i=im.MIN),void 0===o&&(o=Ud()),this.query=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.resumeToken=o}var jb=(Wb.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=qy.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new Mg(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=qy.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version),new Fg(e,n)):Md("Unexpected DbRemoteDocument")},Wb.prototype.toDbRemoteDocument=function(t){if(t instanceof Rg){var e=t.proto?t.proto:this.remoteSerializer.toDocument(t),n=t.hasCommittedMutations;return new vb(null,null,e,n)}if(t instanceof Mg){var r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);return n=t.hasCommittedMutations,new vb(null,new yb(r,i),null,n)}return t instanceof Fg?(r=t.key.path.toArray(),i=this.toDbTimestamp(t.version),new vb(new mb(r,i),null,null,!0)):Md("Unexpected MaybeDocumment")},Wb.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new ab(e.seconds,e.nanoseconds)},Wb.prototype.fromDbTimestamp=function(t){var e=new nm(t.seconds,t.nanoseconds);return im.fromTimestamp(e)},Wb.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new lb(t,e.batchId,e.localWriteTime.toMillis(),r,i)},Wb.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=nm.fromMillis(t.localWriteTimeMs);return new km(t.batchId,i,n,r)},Wb.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push($y(t.path))}),e},Wb.prototype.fromDbResourcePaths=function(t){for(var e=Cm(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new qy(em(i)))}return e},Wb.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime);return e=function(t){return void 0!==t.documents}(t.query)?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new Vb(e,t.targetId,Mb.Listen,t.lastListenSequenceNumber,n,t.resumeToken)},Wb.prototype.toDbTarget=function(t){xd(Mb.Listen===t.purpose,"Only queries with purpose "+Mb.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion);return e=t.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.query):this.remoteSerializer.toQueryTarget(t.query),n=t.resumeToken instanceof Uint8Array?(xd("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence ."),t.resumeToken.toString()):t.resumeToken,new _b(t.targetId,t.query.canonicalId(),r,n,t.sequenceNumber,e)},Wb);function Wb(t){this.remoteSerializer=t}function Qb(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=yy(n,i);return 0===a?yy(r,o):a}var Kb=(Hb.prototype.nextIndex=function(){return++this.previousIndex},Hb.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Qb(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(Hb.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),Hb);function Hb(t){this.maxElements=t,this.buffer=new dm(Qb),this.previousIndex=0}var Gb={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},zb=(Yb.withCacheSize=function(t){return new Yb(t,Yb.DEFAULT_COLLECTION_PERCENTILE,Yb.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},Yb.COLLECTION_DISABLED=-1,Yb.MINIMUM_CACHE_SIZE_BYTES=1048576,Yb.DEFAULT=new Yb(Yb.DEFAULT_CACHE_SIZE_BYTES=41943040,Yb.DEFAULT_COLLECTION_PERCENTILE=10,Yb.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),Yb.DISABLED=new Yb(Yb.COLLECTION_DISABLED,0,0),Yb);function Yb(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}var Xb=(Jb.prototype.start=function(){xd(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==zb.COLLECTION_DISABLED&&this.scheduleGC()},Jb.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(Jb.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),Jb.prototype.scheduleGC=function(){var t=this;xd(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;Rd("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(By.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(uw)})},Jb);function Jb(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.hasRun=!1,this.gcTask=null}var $b=(Zb.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},Zb.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Pm.resolve(Ny.INVALID);var r=new Kb(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},Zb.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},Zb.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},Zb.prototype.collect=function(e,n){var r=this;return this.params.cacheSizeCollectionThreshold===zb.COLLECTION_DISABLED?(Rd("LruGarbageCollector","Garbage collection skipped; disabled"),Pm.resolve(Gb)):this.getCacheSize(e).next(function(t){return t<r.params.cacheSizeCollectionThreshold?(Rd("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),Gb):r.runGarbageCollection(e,n)})},Zb.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},Zb.prototype.runGarbageCollection=function(e,n){var r,i,o,a,s,u,c,h=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return i=t>h.params.maximumSequenceNumbersToCollect?(Rd("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+t),h.params.maximumSequenceNumbersToCollect):t,a=Date.now(),h.nthSequenceNumber(e,i)}).next(function(t){return r=t,s=Date.now(),h.removeTargets(e,r,n)}).next(function(t){return o=t,u=Date.now(),h.removeOrphanedDocuments(e,r)}).next(function(t){return c=Date.now(),kd()<=bd.DEBUG&&Rd("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(a-l)+"ms\n\tDetermined least recently used "+i+" in "+(s-a)+"ms\n\tRemoved "+o+" targets in "+(u-s)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),Pm.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})})},Zb);function Zb(t,e){this.delegate=t,this.params=e}var tw,ew="IndexedDbPersistence",nw="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",rw="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",iw=(ui(ow,tw=function(){}),ow);function ow(t,e){var n=tw.call(this)||this;return n.simpleDbTransaction=t,n.currentSequenceNumber=e,n}var aw=(sw.getStore=function(t,e){if(t instanceof iw)return zm.getStore(t.simpleDbTransaction,e);throw Md("IndexedDbPersistence must use instances of IndexedDbTransaction")},sw.createIndexedDbPersistence=function(n){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:if(!sw.isAvailable())throw new Bd(Vd.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(e=new sw(n.allowTabSynchronization,n.persistenceKey,n.clientId,n.platform,n.lruParams,n.queue,n.serializer,n.sequenceNumberSyncer)).start()];case 1:return t.sent(),[2,e]}})})},sw.prototype.start=function(){var e=this;return xd(!this.started,"IndexedDbPersistence double-started!"),xd(null!==this.window,"Expected 'window' to be defined"),zm.openOrCreate(this.dbName,rb,new ib(this.serializer)).then(function(t){return e.simpleDb=t,e.updateClientMetadataAndTryBecomePrimary()}).then(function(){return e.attachVisibilityHandler(),e.attachWindowUnloadHook(),e.scheduleClientMetadataAndPrimaryLeaseRefreshes(),e.startRemoteDocumentCache()}).then(function(){return e.simpleDb.runTransaction("readonly",[Ib.store],function(t){return cv(t).next(function(t){e.listenSequence=new Ny(t,e.sequenceNumberSyncer)})})}).then(function(){e._started=!0}).catch(function(t){return e.simpleDb&&e.simpleDb.close(),Promise.reject(t)})},sw.prototype.startRemoteDocumentCache=function(){var e=this;return this.simpleDb.runTransaction("readonly",Lb,function(t){return e.remoteDocumentCache.start(t)})},sw.prototype.setPrimaryStateListener=function(n){var t=this;return this.primaryStateListener=function(e){return hi(t,void 0,void 0,function(){return li(this,function(t){return this.started?[2,n(e)]:[2]})})},n(this.isPrimary)},sw.prototype.setDatabaseDeletedListener=function(n){var t=this;this.simpleDb.setVersionChangeListener(function(e){return hi(t,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return null!==e.newVersion?[3,2]:[4,n()];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},sw.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return hi(e,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},sw.prototype.updateClientMetadataAndTryBecomePrimary=function(){var r=this;return this.simpleDb.runTransaction("readwrite",Lb,function(n){return hw(n).put(new Ob(r.clientId,Date.now(),r.networkEnabled,r.inForeground,r.remoteDocumentCache.lastProcessedDocumentChangeId)).next(function(){if(r.isPrimary)return r.verifyPrimaryLease(n).next(function(t){t||(r.isPrimary=!1,r.queue.enqueueAndForget(function(){return r.primaryStateListener(!1)}))})}).next(function(){return r.canActAsPrimary(n)}).next(function(t){var e=r.isPrimary;return r.isPrimary=t,e!==r.isPrimary&&r.queue.enqueueAndForget(function(){return r.primaryStateListener(r.isPrimary)}),e&&!r.isPrimary?r.releasePrimaryLeaseIfHeld(n):r.isPrimary?r.acquireOrExtendPrimaryLease(n):void 0})})},sw.prototype.verifyPrimaryLease=function(t){var e=this;return cw(t).get(sb.key).next(function(t){return Pm.resolve(e.isLocalClient(t))})},sw.prototype.removeClientMetadata=function(t){return hw(t).delete(this.clientId)},sw.prototype.maybeGarbageCollectMultiClientState=function(){return hi(this,void 0,void 0,function(){var r,i,o=this;return li(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),i=[],[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(n){var e=sw.getStore(n,Ob.store);return e.loadAll().next(function(t){r=o.filterActiveClients(t,18e5),i=t.filter(function(t){return-1===r.indexOf(t)})}).next(function(){return Pm.forEach(i,function(t){return e.delete(t.clientId)})}).next(function(){if(0<(r=r.filter(function(t){return t.clientId!==o.clientId})).length){var t=r.map(function(t){return t.lastProcessedDocumentChangeId||0}),e=Math.min.apply(Math,t);return o.remoteDocumentCache.removeDocumentChangesThroughChangeId(n,e)}})})]);case 1:t.sent(),i.forEach(function(t){o.window.localStorage.removeItem(o.zombiedClientLocalStorageKey(t.clientId))}),t.label=2;case 2:return[2]}})})},sw.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(By.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},sw.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},sw.prototype.canActAsPrimary=function(e){var i=this;return cw(e).get(sb.key).next(function(t){if(null!==t&&i.isWithinAge(t.leaseTimestampMs,5e3)&&!i.isClientZombied(t.ownerId)){if(i.isLocalClient(t)&&i.networkEnabled)return!0;if(!i.isLocalClient(t)){if(!t.allowTabSynchronization)throw new Bd(Vd.FAILED_PRECONDITION,rw);return!1}}return!(!i.networkEnabled||!i.inForeground)||hw(e).loadAll().next(function(t){return void 0===i.filterActiveClients(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Rd(ew,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},sw.prototype.shutdown=function(){return hi(this,void 0,void 0,function(){var e=this;return li(this,function(t){switch(t.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite",[sb.store,Ob.store],function(t){return e.releasePrimaryLeaseIfHeld(t).next(function(){return e.removeClientMetadata(t)})})];case 1:return t.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},sw.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},sw.prototype.getActiveClients=function(){var e=this;return this.simpleDb.runTransaction("readonly",[Ob.store],function(t){return hw(t).loadAll().next(function(t){return e.filterActiveClients(t,18e5).map(function(t){return t.clientId})})})},sw.clearPersistence=function(n){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:return sw.isAvailable()?(e=n+sw.MAIN_DATABASE,[4,zm.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(sw.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),sw.prototype.getMutationQueue=function(t){return xd(this.started,"Cannot initialize MutationQueue before persistence is started."),xm.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},sw.prototype.getQueryCache=function(){return xd(this.started,"Cannot initialize QueryCache before persistence is started."),this.queryCache},sw.prototype.getRemoteDocumentCache=function(){return xd(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},sw.prototype.getIndexManager=function(){return xd(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},sw.prototype.runTransaction=function(n,t,r){var i=this;return Rd(ew,"Starting transaction:",n),this.simpleDb.runTransaction("readonly"===t?"readonly":"readwrite",Lb,function(e){return"readwrite-primary"===t?i.verifyPrimaryLease(e).next(function(t){if(!t)throw Od("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.queue.enqueueAndForget(function(){return i.primaryStateListener(!1)}),new Bd(Vd.FAILED_PRECONDITION,nw);return r(new iw(e,i.listenSequence.next()))}).next(function(t){return i.acquireOrExtendPrimaryLease(e).next(function(){return t})}):i.verifyAllowTabSynchronization(e).next(function(){return r(new iw(e,i.listenSequence.next()))})})},sw.prototype.verifyAllowTabSynchronization=function(t){var e=this;return cw(t).get(sb.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new Bd(Vd.FAILED_PRECONDITION,rw)})},sw.prototype.acquireOrExtendPrimaryLease=function(t){var e=new sb(this.clientId,this.allowTabSynchronization,Date.now());return cw(t).put(sb.key,e)},sw.isAvailable=function(){return zm.isAvailable()},sw.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},sw.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=cw(t);return n.get(sb.key).next(function(t){return e.isLocalClient(t)?(Rd(ew,"Releasing primary lease."),n.delete(sb.key)):Pm.resolve()})},sw.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Od("Detected an update time that is in the future: "+t+" > "+n),1))},sw.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},sw.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(xd(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},sw.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},sw.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(xd("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},sw.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return Rd(ew,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Od(ew,"Failed to get zombied client id.",t),!1}},sw.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){Od("Failed to set zombie client id.",t)}},sw.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},sw.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},sw.MAIN_DATABASE="main",sw);function sw(t,e,n,r,i,o,a,s){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.queue=o,this.sequenceNumberSyncer=s,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},this.referenceDelegate=new lw(this,i),this.dbName=e+sw.MAIN_DATABASE,this.serializer=new jb(a),this.document=r.document,this.queryCache=new ov(this.referenceDelegate,this.serializer),this.indexManager=new Fb,this.remoteDocumentCache=new Kg(this.serializer,this.indexManager,this.allowTabSynchronization),!r.window||!r.window.localStorage)throw new Bd(Vd.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.webStorage=this.window.localStorage}function uw(e){return hi(this,void 0,void 0,function(){return li(this,function(t){if(!function(t){return t.code===Vd.FAILED_PRECONDITION&&t.message===nw}(e))throw e;return Rd(ew,"Unexpectedly lost primary lease"),[2]})})}function cw(t){return t.store(sb.store)}function hw(t){return t.store(Ob.store)}var lw=(fw.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocmentCount(t);return this.db.getQueryCache().getQueryCount(t).next(function(e){return n.next(function(t){return e+t})})},fw.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},fw.prototype.forEachTarget=function(t,e){return this.db.getQueryCache().forEachTarget(t,e)},fw.prototype.forEachOrphanedDocumentSequenceNumber=function(t,n){return this.forEachOrphanedDocument(t,function(t,e){return n(e)})},fw.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},fw.prototype.addReference=function(t,e){return pw(t,e)},fw.prototype.removeReference=function(t,e){return pw(t,e)},fw.prototype.removeTargets=function(t,e,n){return this.db.getQueryCache().removeTargets(t,e,n)},fw.prototype.removeMutationReference=function(t,e){return pw(t,e)},fw.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?Pm.resolve(!0):function(e,n){var r=!1;return jm(e).iterateSerial(function(t){return Fm(e,t,n).next(function(t){return t&&(r=!0),Pm.resolve(!t)})}).next(function(){return r})}(t,e)},fw.prototype.removeOrphanedDocuments=function(r,i){var o=this,a=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],u=0;return this.forEachOrphanedDocument(r,function(e,t){if(t<=i){var n=o.isPinned(r,e).next(function(t){if(!t)return u++,a.getEntry(r,e).next(function(){return a.removeEntry(e),hv(r).delete(function(t){return[0,$y(t.path)]}(e))})});s.push(n)}}).next(function(){return Pm.waitFor(s)}).next(function(){return a.apply(r)}).next(function(){return u})},fw.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getQueryCache().updateQueryData(t,n)},fw.prototype.updateLimboDocument=function(t,e){return pw(t,e)},fw.prototype.forEachOrphanedDocument=function(t,o){var a,e=hv(t),s=Ny.INVALID;return e.iterate({index:Tb.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(s!==Ny.INVALID&&o(new qy(em(a)),s),s=i,a=r):s=Ny.INVALID}).next(function(){s!==Ny.INVALID&&o(new qy(em(a)),s)})},fw.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},fw);function fw(t,e){this.db=t,this.inMemoryPins=null,this.garbageCollector=new $b(this,e)}function pw(t,e){return hv(t).put(function(t,e){return new Tb(0,$y(t.path),e)}(e,t.currentSequenceNumber))}var dw=(yw.prototype.getDocument=function(e,n){var r=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.getDocumentInternal(e,n,t)})},yw.prototype.getDocumentInternal=function(t,r,i){return this.remoteDocumentCache.getEntry(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].applyToLocalView(r,t);return t})},yw.prototype.applyLocalMutationsToDocuments=function(t,e,i){var o=wm();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].applyToLocalView(t,e);o=o.insert(t,e)}),o},yw.prototype.getDocuments=function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.getLocalViewOfDocuments(e,t)})},yw.prototype.getLocalViewOfDocuments=function(r,i){var o=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(r,i).next(function(t){var e=o.applyLocalMutationsToDocuments(r,i,t),n=bm();return e.forEach(function(t,e){e=e||new Mg(t,im.forDeletedDoc()),n=n.insert(t,e)}),n})},yw.prototype.getDocumentsMatchingQuery=function(t,e){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e):this.getDocumentsMatchingCollectionQuery(t,e)},yw.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new qy(e)).next(function(t){var e=Em();return t instanceof Rg&&(e=e.insert(t.key,t)),e})},yw.prototype.getDocumentsMatchingCollectionGroupQuery=function(n,r){var i=this;xd(r.path.isEmpty(),"Currently we only support collection group queries at the root.");var o=r.collectionGroup,a=Em();return this.indexManager.getCollectionParents(n,o).next(function(t){return Pm.forEach(t,function(t){var e=r.asCollectionQueryAtPath(t.child(o));return i.getDocumentsMatchingCollectionQuery(n,e).next(function(t){t.forEach(function(t,e){a=a.insert(t,e)})})}).next(function(){return a})})},yw.prototype.getDocumentsMatchingCollectionQuery=function(e,n){var h,l,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(e,n).next(function(t){return h=t,r.mutationQueue.getAllMutationBatchesAffectingQuery(e,n)}).next(function(t){return l=t,r.addMissingBaseDocuments(e,l,h).next(function(t){h=t;for(var e=0,n=l;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var a=o[i],s=a.key,u=h.get(s),c=a.applyToLocalView(u,u,r.localWriteTime);h=c instanceof Rg?h.insert(s,c):h.remove(s)}})}).next(function(){return h.forEach(function(t,e){n.matches(e)||(h=h.remove(t))}),h})},yw.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=Cm(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof Cv&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Rg&&(c=c.insert(t,e))}),c})},yw);function yw(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}var mw=(vw.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},vw.prototype.addReference=function(t,e){var n=new gw(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},vw.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},vw.prototype.removeReference=function(t,e){this.removeRef(new gw(t,e))},vw.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},vw.prototype.removeReferencesForId=function(t){var e=this,n=qy.EMPTY,r=new gw(n,t),i=new gw(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},vw.prototype.removeAllReferences=function(){var e=this;this.refsByKey.forEach(function(t){return e.removeRef(t)})},vw.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},vw.prototype.referencesForId=function(t){var e=qy.EMPTY,n=new gw(e,t),r=new gw(e,t+1),i=Cm();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},vw.prototype.containsKey=function(t){var e=new gw(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},vw);function vw(){this.refsByKey=new dm(gw.compareByKey),this.refsByTarget=new dm(gw.compareByTargetId)}var gw=(bw.compareByKey=function(t,e){return qy.comparator(t.key,e.key)||yy(t.targetOrBatchId,e.targetOrBatchId)},bw.compareByTargetId=function(t,e){return yy(t.targetOrBatchId,e.targetOrBatchId)||qy.comparator(t.key,e.key)},bw);function bw(t,e){this.key=t,this.targetOrBatchId=e}var ww=(_w.prototype.handleUserChange=function(e){var m=this;return this.persistence.runTransaction("Handle user change","readonly",function(d){var y;return m.mutationQueue.getAllMutationBatches(d).next(function(t){return y=t,m.mutationQueue=m.persistence.getMutationQueue(e),m.localDocuments=new dw(m.remoteDocuments,m.mutationQueue,m.persistence.getIndexManager()),m.mutationQueue.getAllMutationBatches(d)}).next(function(t){for(var e=[],n=[],r=Cm(),i=0,o=y;i<o.length;i++){var a=o[i];e.push(a.batchId);for(var s=0,u=a.mutations;s<u.length;s++){var c=u[s];r=r.add(c.key)}}for(var h=0,l=t;h<l.length;h++){a=l[h],n.push(a.batchId);for(var f=0,p=a.mutations;f<p.length;f++)c=p[f],r=r.add(c.key)}return m.localDocuments.getDocuments(d,r).next(function(t){return{affectedDocuments:t,removedBatchIds:e,addedBatchIds:n}})})})},_w.prototype.localWrite=function(s){var u=this,c=nm.now(),t=s.reduce(function(t,e){return t.add(e.key)},Cm());return this.persistence.runTransaction("Locally write mutations","readwrite",function(a){return u.localDocuments.getDocuments(a,t).next(function(n){for(var t=[],e=0,r=s;e<r.length;e++){var i=r[e],o=i.extractBaseValue(n.get(i.key));null!=o&&t.push(new Cv(i.key,o,o.fieldMask(),gv.exists(!0)))}return u.mutationQueue.addMutationBatch(a,c,t,s).next(function(t){var e=t.applyToLocalDocumentSet(n);return{batchId:t.batchId,changes:e}})})})},_w.prototype.lookupMutationDocuments=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return n.mutationQueue.lookupMutationKeys(e,t).next(function(t){return t?n.localDocuments.getDocuments(e,t):Pm.resolve(null)})})},_w.prototype.acknowledgeBatch=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.remoteDocuments.newChangeBuffer();return i.mutationQueue.acknowledgeBatch(t,r.batch,r.streamToken).next(function(){return i.applyWriteToRemoteDocuments(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.mutationQueue.performConsistencyCheck(t)}).next(function(){return i.localDocuments.getDocuments(t,e)})})},_w.prototype.rejectBatch=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.mutationQueue.lookupMutationBatch(e,t).next(function(t){return xd(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t)}).next(function(){return r.mutationQueue.performConsistencyCheck(e)}).next(function(){return r.localDocuments.getDocuments(e,n)})})},_w.prototype.getHighestUnacknowledgedBatchId=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.mutationQueue.getHighestUnacknowledgedBatchId(t)})},_w.prototype.getLastStreamToken=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly",function(t){return e.mutationQueue.getLastStreamToken(t)})},_w.prototype.setLastStreamToken=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(t){return n.mutationQueue.setLastStreamToken(t,e)})},_w.prototype.getLastRemoteSnapshotVersion=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.queryCache.getLastRemoteSnapshotVersion(t)})},_w.prototype.applyRemoteEvent=function(s){var u=this,c=this.remoteDocuments.newChangeBuffer(),h=s.snapshotVersion;return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var a=[];Hd(s.targetChanges,function(t,e){var n=u.queryDataByTarget[t];if(n){a.push(u.queryCache.removeMatchingKeys(o,e.removedDocuments,t).next(function(){return u.queryCache.addMatchingKeys(o,e.addedDocuments,t)}));var r=e.resumeToken;if(0<r.length){var i=n.withResumeToken(r,h);u.queryDataByTarget[t]=i,_w.shouldPersistQueryData(n,i,e)&&a.push(u.queryCache.updateQueryData(o,i))}}});var i=bm(),n=Cm();if(s.documentUpdates.forEach(function(t,e){n=n.add(t)}),a.push(c.getEntries(o,n).next(function(r){s.documentUpdates.forEach(function(t,e){var n=r.get(t);null==n||0<e.version.compareTo(n.version)||0===e.version.compareTo(n.version)&&n.hasPendingWrites?(c.addEntry(e),i=i.insert(t,e)):e instanceof Mg&&e.version.isEqual(im.MIN)?(c.removeEntry(t),i=i.insert(t,e)):Rd("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),s.resolvedLimboDocuments.has(t)&&a.push(u.persistence.referenceDelegate.updateLimboDocument(o,t))})})),!h.isEqual(im.MIN)){var t=u.queryCache.getLastRemoteSnapshotVersion(o).next(function(t){return xd(0<=h.compareTo(t),"Watch stream reverted to previous snapshot?? "+h+" < "+t),u.queryCache.setTargetsMetadata(o,o.currentSequenceNumber,h)});a.push(t)}return Pm.waitFor(a).next(function(){return c.apply(o)}).next(function(){return u.localDocuments.getLocalViewOfDocuments(o,i)})})},_w.shouldPersistQueryData=function(t,e,n){return xd(0<e.resumeToken.length,"Attempted to persist query data with no resume token"),0===t.resumeToken.length||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size},_w.prototype.notifyLocalViewChanges=function(t){var n=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(e){return Pm.forEach(t,function(t){return n.localViewReferences.addReferences(t.addedKeys,t.targetId),n.localViewReferences.removeReferences(t.removedKeys,t.targetId),Pm.forEach(t.removedKeys,function(t){return n.persistence.referenceDelegate.removeReference(e,t)})})})},_w.prototype.nextMutationBatch=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e)})},_w.prototype.readDocument=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.localDocuments.getDocument(t,e)})},_w.prototype.allocateQuery=function(r){var i=this;return this.persistence.runTransaction("Allocate query","readwrite",function(e){var n;return i.queryCache.getQueryData(e,r).next(function(t){return t?(n=t,Pm.resolve()):i.queryCache.allocateTargetId(e).next(function(t){return n=new Vb(r,t,Mb.Listen,e.currentSequenceNumber),i.queryCache.addQueryData(e,n)})}).next(function(){return xd(!i.queryDataByTarget[n.targetId],"Tried to allocate an already allocated query: "+r),i.queryDataByTarget[n.targetId]=n})})},_w.prototype.releaseQuery=function(o,a){var s=this,t=a?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",t,function(i){return s.queryCache.getQueryData(i,o).next(function(t){xd(null!=t,"Tried to release nonexistent query: "+o);var e=t.targetId,n=s.queryDataByTarget[e],r=s.localViewReferences.removeReferencesForId(e);return delete s.queryDataByTarget[e],a?Pm.resolve():Pm.forEach(r,function(t){return s.persistence.referenceDelegate.removeReference(i,t)}).next(function(){return s.persistence.referenceDelegate.removeTarget(i,n)})})})},_w.prototype.executeQuery=function(e){var n=this;return this.persistence.runTransaction("Execute query","readonly",function(t){return n.localDocuments.getDocumentsMatchingQuery(t,e)})},_w.prototype.remoteDocumentKeys=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly",function(t){return n.queryCache.getMatchingKeysForTargetId(t,e)})},_w.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},_w.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},_w.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},_w.prototype.applyWriteToRemoteDocuments=function(t,i,o){var e=this,a=i.batch,n=a.keys(),s=Pm.resolve();return n.forEach(function(r){s=s.next(function(){return o.getEntry(t,r)}).next(function(t){var e=t,n=i.docVersions.get(r);xd(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.compareTo(n)<0)&&((e=a.applyToRemoteDocument(r,e,i))?o.addEntry(e):xd(!t,"Mutation batch "+a+" applied to document "+t+" resulted in null"))})}),s.next(function(){return e.mutationQueue.removeMutationBatch(t,a)})},_w.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.collect(t,n.queryDataByTarget)})},_w.prototype.getQueryForTarget=function(e){var n=this;return this.queryDataByTarget[e]?Promise.resolve(this.queryDataByTarget[e].query):this.persistence.runTransaction("Get query data","readonly",function(t){return n.queryCache.getQueryDataForTarget(t,e).next(function(t){return t?t.query:null})})},_w.prototype.getNewDocumentChanges=function(){var e=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return e.remoteDocuments.getNewDocumentChanges(t)})},_w.RESUME_TOKEN_MAX_AGE_MICROS=3e8,_w);function _w(t,e){this.persistence=t,this.localViewReferences=new mw,this.queryDataByTarget={},xd(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(e),this.remoteDocuments=t.getRemoteDocumentCache(),this.queryCache=t.getQueryCache(),this.localDocuments=new dw(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager())}var Ew=(Tw.prototype.checkEmpty=function(t){return Pm.resolve(0===this.mutationQueue.length)},Tw.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");xd(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return xd(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Pm.resolve()},Tw.prototype.getLastStreamToken=function(t){return Pm.resolve(this.lastStreamToken)},Tw.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,Pm.resolve()},Tw.prototype.addMutationBatch=function(t,e,n,r){xd(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,0<this.mutationQueue.length&&xd(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new km(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new gw(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return Pm.resolve(o)},Tw.prototype.lookupMutationBatch=function(t,e){return Pm.resolve(this.findMutationBatch(e))},Tw.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return xd(null!=n,"Failed to find local mutation batch."),Pm.resolve(n.keys())},Tw.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return Pm.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},Tw.prototype.getHighestUnacknowledgedBatchId=function(){return Pm.resolve(0===this.mutationQueue.length?-1:this.nextBatchId-1)},Tw.prototype.getAllMutationBatches=function(t){return Pm.resolve(this.mutationQueue.slice())},Tw.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,e=new gw(n,0),i=new gw(n,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([e,i],function(t){xd(n.isEqual(t.key),"Should only iterate over a single key's batches");var e=r.findMutationBatch(t.targetOrBatchId);xd(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),Pm.resolve(o)},Tw.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var r=this,i=new dm(yy);return e.forEach(function(e){var t=new gw(e,0),n=new gw(e,Number.POSITIVE_INFINITY);r.batchesByDocumentKey.forEachInRange([t,n],function(t){xd(e.isEqual(t.key),"For each key, should only iterate over a single key's batches"),i=i.add(t.targetOrBatchId)})}),Pm.resolve(this.findMutationBatches(i))},Tw.prototype.getAllMutationBatchesAffectingQuery=function(t,e){xd(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;qy.isDocumentKey(i)||(i=i.child(""));var o=new gw(new qy(i),0),a=new dm(yy);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),Pm.resolve(this.findMutationBatches(a))},Tw.prototype.findMutationBatches=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.findMutationBatch(t);null!==e&&r.push(e)}),r},Tw.prototype.removeMutationBatch=function(n,r){var i=this;xd(0===this.indexOfExistingBatchId(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var o=this.batchesByDocumentKey;return Pm.forEach(r.mutations,function(t){var e=new gw(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.removeMutationReference(n,t.key)}).next(function(){i.batchesByDocumentKey=o})},Tw.prototype.removeCachedMutationKeys=function(t){},Tw.prototype.containsKey=function(t,e){var n=new gw(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return Pm.resolve(e.isEqual(r&&r.key))},Tw.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&xd(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),Pm.resolve()},Tw.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return xd(0<=n&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},Tw.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},Tw.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return xd(n.batchId===t,"If found batch must match"),n},Tw);function Tw(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=Ud(),this.batchesByDocumentKey=new dm(gw.compareByKey)}var Sw=(Iw.prototype.getTargetCount=function(t){return Pm.resolve(this.targetCount)},Iw.prototype.forEachTarget=function(t,n){return this.queries.forEach(function(t,e){return n(e)}),Pm.resolve()},Iw.prototype.getLastRemoteSnapshotVersion=function(t){return Pm.resolve(this.lastRemoteSnapshotVersion)},Iw.prototype.getHighestSequenceNumber=function(t){return Pm.resolve(this.highestSequenceNumber)},Iw.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,Pm.resolve(e)},Iw.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),Pm.resolve()},Iw.prototype.saveQueryData=function(t){this.queries.set(t.query,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},Iw.prototype.addQueryData=function(t,e){return xd(!this.queries.has(e.query),"Adding a query that already exists"),this.saveQueryData(e),this.targetCount+=1,Pm.resolve()},Iw.prototype.updateQueryData=function(t,e){return xd(this.queries.has(e.query),"Updating a non-existent query"),this.saveQueryData(e),Pm.resolve()},Iw.prototype.removeQueryData=function(t,e){return xd(0<this.targetCount,"Removing a target from an empty cache"),xd(this.queries.has(e.query),"Removing a non-existent target from the cache"),this.queries.delete(e.query),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,Pm.resolve()},Iw.prototype.removeTargets=function(n,r,i){var o=this,a=0,s=[];return this.queries.forEach(function(t,e){e.sequenceNumber<=r&&!i[e.targetId]&&(o.queries.delete(t),s.push(o.removeMatchingKeysForTargetId(n,e.targetId)),a++)}),Pm.waitFor(s).next(function(){return a})},Iw.prototype.getQueryCount=function(t){return Pm.resolve(this.targetCount)},Iw.prototype.getQueryData=function(t,e){var n=this.queries.get(e)||null;return Pm.resolve(n)},Iw.prototype.getQueryDataForTarget=function(t,e){return Md("Not yet implemented.")},Iw.prototype.addMatchingKeys=function(e,t,n){this.references.addReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.addReference(e,t))}),Pm.waitFor(i)},Iw.prototype.removeMatchingKeys=function(e,t,n){this.references.removeReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.removeReference(e,t))}),Pm.waitFor(i)},Iw.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),Pm.resolve()},Iw.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return Pm.resolve(n)},Iw.prototype.containsKey=function(t,e){return Pm.resolve(this.references.containsKey(e))},Iw);function Iw(t){this.persistence=t,this.queries=new qg(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=im.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new mw,this.targetCount=0,this.targetIdGenerator=Km.forQueryCache()}var Cw,Nw=(Aw.prototype.addEntry=function(t,e){var n=e.key,r=this.docs.get(n),i=r?r.size:0,o=this.sizer(e);return this.docs=this.docs.insert(n,{maybeDocument:e,size:o}),this.newDocumentChanges=this.newDocumentChanges.add(n),this.size+=o-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())},Aw.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Aw.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Pm.resolve(n?n.maybeDocument:null)},Aw.prototype.getEntries=function(t,e){var n=this,r=wm();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),Pm.resolve(r)},Aw.prototype.getDocumentsMatchingQuery=function(t,e){xd(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var n=Em(),r=new qy(e.path.child("")),i=this.docs.getIteratorFrom(r);i.hasNext();){var o=i.getNext(),a=o.key,s=o.value.maybeDocument;if(!e.path.isPrefixOf(a.path))break;s instanceof Rg&&e.matches(s)&&(n=n.insert(s.key,s))}return Pm.resolve(n)},Aw.prototype.forEachDocumentKey=function(t,e){return Pm.forEach(this.docs,function(t){return e(t)})},Aw.prototype.getNewDocumentChanges=function(t){var r=this,i=bm();return this.newDocumentChanges.forEach(function(t){var e=r.docs.get(t),n=e?e.maybeDocument:new Mg(t,im.forDeletedDoc());i=i.insert(t,n)}),this.newDocumentChanges=Cm(),Pm.resolve(i)},Aw.prototype.newChangeBuffer=function(){return new Aw.RemoteDocumentChangeBuffer(this)},Aw.prototype.getSize=function(t){return Pm.resolve(this.size)},Aw.RemoteDocumentChangeBuffer=(ui(kw,Cw=Bg),kw.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(t,e){e?i.push(r.documentCache.addEntry(n,e)):r.documentCache.removeEntry(t)}),Pm.waitFor(i)},kw.prototype.getFromCache=function(t,e){return this.documentCache.getEntry(t,e)},kw.prototype.getAllFromCache=function(t,e){return this.documentCache.getEntries(t,e)},kw),Aw);function Aw(t,e){this.indexManager=t,this.sizer=e,this.docs=new am(qy.comparator),this.newDocumentChanges=Cm(),this.size=0}function kw(t){var e=Cw.call(this)||this;return e.documentCache=t,e}var Dw=(Rw.createLruPersistence=function(t,e,n){return new Rw(t,function(t){return new xw(t,new jb(e),n)})},Rw.createEagerPersistence=function(t){return new Rw(t,function(t){return new Pw(t)})},Rw.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(Rw.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),Rw.prototype.getActiveClients=function(){return hi(this,void 0,void 0,function(){return li(this,function(t){return[2,[this.clientId]]})})},Rw.prototype.setPrimaryStateListener=function(t){return t(!0)},Rw.prototype.setDatabaseDeletedListener=function(){},Rw.prototype.setNetworkEnabled=function(t){},Rw.prototype.getIndexManager=function(){return this.indexManager},Rw.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new Ew(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},Rw.prototype.getQueryCache=function(){return this.queryCache},Rw.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},Rw.prototype.runTransaction=function(t,e,n){var r=this;Rd("MemoryPersistence","Starting transaction:",t);var i=new Ow(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise()},Rw.prototype.mutationQueuesContainKey=function(e,n){return Pm.or(function(t){var n=[];return Gd(t,function(t,e){return n.push(e)}),n}(this.mutationQueues).map(function(t){return function(){return t.containsKey(e,n)}}))},Rw);function Rw(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new Ny(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.queryCache=new Sw(this);this.indexManager=new Zg,this.remoteDocumentCache=new Nw(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}var Ow=function(t){this.currentSequenceNumber=t},Pw=(Object.defineProperty(Mw.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw Md("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),Mw.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Mw.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),Pm.resolve()},Mw.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),Pm.resolve()},Mw.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),Pm.resolve()},Mw.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeQueryData(t,e)})},Mw.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},Mw.prototype.onTransactionCommitted=function(t){var n=this,r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Pm.forEach(this.orphanedDocuments,function(e){return n.isReferenced(t,e).next(function(t){t||r.removeEntry(e)})}).next(function(){return n._orphanedDocuments=null,r.apply(t)})},Mw.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},Mw.prototype.documentSize=function(t){return 0},Mw.prototype.isReferenced=function(t,e){var n=this;return Pm.or([function(){return n.persistence.getQueryCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return Pm.resolve(n.inMemoryPins.containsKey(e))}])},Mw);function Mw(t){this.persistence=t,this.inMemoryPins=null,this._orphanedDocuments=null}var xw=(Lw.prototype.onTransactionStarted=function(){},Lw.prototype.onTransactionCommitted=function(t){return Pm.resolve()},Lw.prototype.forEachTarget=function(t,e){return this.persistence.getQueryCache().forEachTarget(t,e)},Lw.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocumentCount(t);return this.persistence.getQueryCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},Lw.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},Lw.prototype.forEachOrphanedDocumentSequenceNumber=function(n,r){var i=this;return Pm.forEach(this.orphanedSequenceNumbers,function(t,e){return i.isPinned(n,t,e).next(function(t){return t?Pm.resolve():r(e)})})},Lw.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Lw.prototype.removeTargets=function(t,e,n){return this.persistence.getQueryCache().removeTargets(t,e,n)},Lw.prototype.removeOrphanedDocuments=function(t,n){var r=this,i=0,e=this.persistence.getRemoteDocumentCache(),o=e.newChangeBuffer();return e.forEachDocumentKey(t,function(e){return r.isPinned(t,e,n).next(function(t){t||(i++,o.removeEntry(e))})}).next(function(){return o.apply(t)}).next(function(){return i})},Lw.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Pm.resolve()},Lw.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getQueryCache().updateQueryData(t,n)},Lw.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Pm.resolve()},Lw.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Pm.resolve()},Lw.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Pm.resolve()},Lw.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Md("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},Lw.prototype.isPinned=function(t,e,n){var r=this;return Pm.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return Pm.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getQueryCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return Pm.resolve(void 0!==t&&n<t)}])},Lw.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},Lw);function Lw(t,e,n){this.persistence=t,this.serializer=e,this.inMemoryPins=null,this.orphanedSequenceNumbers=new qg(function(t){return $y(t.path)}),this.garbageCollector=new $b(this,n)}var Fw=Number,Uw=Fw.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),qw=Fw.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Vw=Fw.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function Bw(t){return null==t}function jw(t){return Vw(t)&&t<=qw&&Uw<=t}var Ww=(Qw.prototype.reset=function(){this.currentBaseMs=0},Qw.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},Qw.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<this.currentBaseMs&&Rd("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},Qw.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},Qw.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},Qw);function Qw(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}var Kw,Hw,Gw="PersistentStream";(Hw=Kw=Kw||{})[Hw.Initial=0]="Initial",Hw[Hw.Starting=1]="Starting",Hw[Hw.Open=2]="Open",Hw[Hw.Error=3]="Error",Hw[Hw.Backoff=4]="Backoff";var zw=(Yw.prototype.isStarted=function(){return this.state===Kw.Starting||this.state===Kw.Open||this.state===Kw.Backoff},Yw.prototype.isOpen=function(){return this.state===Kw.Open},Yw.prototype.start=function(){this.state!==Kw.Error?(xd(this.state===Kw.Initial,"Already started"),this.auth()):this.performBackoff()},Yw.prototype.stop=function(){return hi(this,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(Kw.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Yw.prototype.inhibitBackoff=function(){xd(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=Kw.Initial,this.backoff.reset()},Yw.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},Yw.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},Yw.prototype.handleIdleCloseTimer=function(){return hi(this,void 0,void 0,function(){return li(this,function(t){return this.isOpen()?[2,this.close(Kw.Initial)]:[2]})})},Yw.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},Yw.prototype.close=function(e,n){return hi(this,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return xd(this.isStarted(),"Only started streams should be closed."),xd(e===Kw.Error||Bw(n),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,e!==Kw.Error?this.backoff.reset():n&&n.code===Vd.RESOURCE_EXHAUSTED?(Od(n.toString()),Od("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):n&&n.code===Vd.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.onClose(n)];case 1:return t.sent(),[2]}})})},Yw.prototype.tearDown=function(){},Yw.prototype.auth=function(){var n=this;xd(this.state===Kw.Initial,"Must be in initial state to auth"),this.state=Kw.Starting;var t=this.getCloseGuardedDispatcher(this.closeCount),e=this.closeCount;this.credentialsProvider.getToken().then(function(t){n.closeCount===e&&n.startStream(t)},function(e){t(function(){var t=new Bd(Vd.UNKNOWN,"Fetching auth token failed: "+e.message);return n.handleStreamClose(t)})})},Yw.prototype.startStream=function(t){var e=this;xd(this.state===Kw.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return xd(e.state===Kw.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=Kw.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Yw.prototype.performBackoff=function(){var t=this;xd(this.state===Kw.Error,"Should only perform backoff when in Error state"),this.state=Kw.Backoff,this.backoff.backoffAndRun(function(){return hi(t,void 0,void 0,function(){return li(this,function(t){return xd(this.state===Kw.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=Kw.Initial,this.start(),xd(this.isStarted(),"PersistentStream should have started"),[2]})})})},Yw.prototype.handleStreamClose=function(t){return xd(this.isStarted(),"Can't handle server close on non-started stream"),Rd(Gw,"close with error: "+t),this.stream=null,this.close(Kw.Error,t)},Yw.prototype.getCloseGuardedDispatcher=function(e){var n=this;return function(t){n.queue.enqueueAndForget(function(){return n.closeCount===e?t():(Rd(Gw,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Yw);function Yw(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=Kw.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new Ww(t,e)}var Xw,Jw=(ui($w,Xw=zw),$w.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},$w.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},$w.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},$w.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},$w);function $w(t,e,n,r,i){var o=Xw.call(this,t,By.ListenStreamConnectionBackoff,By.ListenStreamIdle,e,n,i)||this;return o.serializer=r,o}var Zw,t_=(ui(e_,Zw=zw),Object.defineProperty(e_.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),e_.prototype.start=function(){this.handshakeComplete_=!1,Zw.prototype.start.call(this)},e_.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},e_.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},e_.prototype.onMessage=function(t){if(xd(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return xd(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},e_.prototype.writeHandshake=function(){xd(this.isOpen(),"Writing handshake requires an opened stream"),xd(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},e_.prototype.writeMutations=function(t){var e=this;xd(this.isOpen(),"Writing mutations requires an opened stream"),xd(this.handshakeComplete_,"Handshake must be complete before writing mutations"),xd(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},e_);function e_(t,e,n,r,i){var o=Zw.call(this,t,By.WriteStreamConnectionBackoff,By.WriteStreamIdle,e,n,i)||this;return o.serializer=r,o.handshakeComplete_=!1,o.lastStreamToken=Ud(),o}var n_=(r_.prototype.newPersistentWriteStream=function(t){return new t_(this.queue,this.connection,this.credentials,this.serializer,t)},r_.prototype.newPersistentWatchStream=function(t){return new Jw(this.queue,this.connection,this.credentials,this.serializer,t)},r_.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},r_.prototype.lookup=function(e){var i=this,t={database:this.serializer.encodedDatabaseId,documents:e.map(function(t){return i.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",t).then(function(t){var n=bm();t.forEach(function(t){var e=i.serializer.fromMaybeDocument(t);n=n.insert(e.key,e)});var r=[];return e.forEach(function(t){var e=n.get(t);xd(!!e,"Missing entity in write response for "+t),r.push(e)}),r})},r_.prototype.invokeRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeRPC(e,n,t)}).catch(function(t){throw t.code===Vd.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},r_.prototype.invokeStreamingRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeStreamingRPC(e,n,t)}).catch(function(t){throw t.code===Vd.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},r_);function r_(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}var i_,o_,a_,s_,u_=(c_.prototype.lookup=function(r){return hi(this,void 0,void 0,function(){var e,n=this;return li(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Bd(Vd.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(r)];case 1:return(e=t.sent()).forEach(function(t){t instanceof Mg||t instanceof Rg?n.recordVersion(t):Md("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},c_.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},c_.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},c_.prototype.delete=function(t){this.write([new Lv(t,this.precondition(t))]),this.writtenDocs.add(t)},c_.prototype.commit=function(){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;if(e=this.readVersions,this.mutations.forEach(function(t){e=e.remove(t.key)}),!e.isEmpty())throw new Bd(Vd.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return[4,this.datastore.commit(this.mutations)];case 1:return t.sent(),this.committed=!0,[2]}})})},c_.prototype.recordVersion=function(t){var e;if(t instanceof Rg)e=t.version;else{if(!(t instanceof Mg))throw Md("Document in a transaction was a "+t.constructor.name);e=im.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Bd(Vd.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},c_.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?gv.updateTime(e):gv.NONE},c_.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(this.writtenDocs.has(t)||!e)return gv.exists(!0);if(e.isEqual(im.forDeletedDoc()))throw new Bd(Vd.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return gv.updateTime(e)},c_.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},c_.prototype.ensureCommitNotCalled=function(){xd(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},c_);function c_(t){this.datastore=t,this.readVersions=Sm(),this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}(o_=i_=i_||{})[o_.Unknown=0]="Unknown",o_[o_.Online=1]="Online",o_[o_.Offline=2]="Offline",(s_=a_=a_||{})[s_.RemoteStore=0]="RemoteStore",s_[s_.SharedClientState=1]="SharedClientState";var h_,l_,f_=(p_.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(i_.Unknown),xd(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(By.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,xd(t.state===i_.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(i_.Offline),Promise.resolve()}))},p_.prototype.handleWatchStreamFailure=function(t){this.state===i_.Online?(this.setAndBroadcast(i_.Unknown),xd(0===this.watchStreamFailures,"watchStreamFailures must be 0"),xd(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(i_.Offline)))},p_.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===i_.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},p_.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},p_.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(Od(e),this.shouldWarnClientIsOffline=!1):Rd("OnlineStateTracker",e)},p_.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},p_);function p_(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=i_.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}function d_(t){switch(t){case Vd.OK:return Md("Treated status OK as error");case Vd.CANCELLED:case Vd.UNKNOWN:case Vd.DEADLINE_EXCEEDED:case Vd.RESOURCE_EXHAUSTED:case Vd.INTERNAL:case Vd.UNAVAILABLE:case Vd.UNAUTHENTICATED:return!1;case Vd.INVALID_ARGUMENT:case Vd.NOT_FOUND:case Vd.ALREADY_EXISTS:case Vd.PERMISSION_DENIED:case Vd.FAILED_PRECONDITION:case Vd.ABORTED:case Vd.OUT_OF_RANGE:case Vd.UNIMPLEMENTED:case Vd.DATA_LOSS:return!0;default:return Md("Unknown status code: "+t)}}function y_(t){if(void 0===t)return Od("GRPC error has no .code"),Vd.UNKNOWN;switch(t){case h_.OK:return Vd.OK;case h_.CANCELLED:return Vd.CANCELLED;case h_.UNKNOWN:return Vd.UNKNOWN;case h_.DEADLINE_EXCEEDED:return Vd.DEADLINE_EXCEEDED;case h_.RESOURCE_EXHAUSTED:return Vd.RESOURCE_EXHAUSTED;case h_.INTERNAL:return Vd.INTERNAL;case h_.UNAVAILABLE:return Vd.UNAVAILABLE;case h_.UNAUTHENTICATED:return Vd.UNAUTHENTICATED;case h_.INVALID_ARGUMENT:return Vd.INVALID_ARGUMENT;case h_.NOT_FOUND:return Vd.NOT_FOUND;case h_.ALREADY_EXISTS:return Vd.ALREADY_EXISTS;case h_.PERMISSION_DENIED:return Vd.PERMISSION_DENIED;case h_.FAILED_PRECONDITION:return Vd.FAILED_PRECONDITION;case h_.ABORTED:return Vd.ABORTED;case h_.OUT_OF_RANGE:return Vd.OUT_OF_RANGE;case h_.UNIMPLEMENTED:return Vd.UNIMPLEMENTED;case h_.DATA_LOSS:return Vd.DATA_LOSS;default:return Md("Unknown status code: "+t)}}(l_=h_=h_||{})[l_.OK=0]="OK",l_[l_.CANCELLED=1]="CANCELLED",l_[l_.UNKNOWN=2]="UNKNOWN",l_[l_.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",l_[l_.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",l_[l_.NOT_FOUND=5]="NOT_FOUND",l_[l_.ALREADY_EXISTS=6]="ALREADY_EXISTS",l_[l_.PERMISSION_DENIED=7]="PERMISSION_DENIED",l_[l_.UNAUTHENTICATED=16]="UNAUTHENTICATED",l_[l_.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",l_[l_.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",l_[l_.ABORTED=10]="ABORTED",l_[l_.OUT_OF_RANGE=11]="OUT_OF_RANGE",l_[l_.UNIMPLEMENTED=12]="UNIMPLEMENTED",l_[l_.INTERNAL=13]="INTERNAL",l_[l_.UNAVAILABLE=14]="UNAVAILABLE",l_[l_.DATA_LOSS=15]="DATA_LOSS";var m_,v_,g_,b_,w_=(__.emptySet=function(t){return new __(t.comparator)},__.prototype.has=function(t){return null!=this.keyedMap.get(t)},__.prototype.get=function(t){return this.keyedMap.get(t)},__.prototype.first=function(){return this.sortedSet.minKey()},__.prototype.last=function(){return this.sortedSet.maxKey()},__.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},__.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(__.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),__.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},__.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},__.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},__.prototype.isEqual=function(t){if(!(t instanceof __))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},__.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},__.prototype.copy=function(t,e){var n=new __;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},__);function __(n){this.comparator=n?function(t,e){return n(t,e)||qy.comparator(t.key,e.key)}:function(t,e){return qy.comparator(t.key,e.key)},this.keyedMap=Em(),this.sortedSet=new am(this.comparator)}(v_=m_=m_||{})[v_.Added=0]="Added",v_[v_.Removed=1]="Removed",v_[v_.Modified=2]="Modified",v_[v_.Metadata=3]="Metadata",(b_=g_=g_||{})[b_.Local=0]="Local",b_[b_.Synced=1]="Synced";var E_=(T_.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==m_.Added&&n.type===m_.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===m_.Metadata&&n.type!==m_.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===m_.Modified&&n.type===m_.Modified?this.changeMap=this.changeMap.insert(e,{type:m_.Modified,doc:t.doc}):t.type===m_.Modified&&n.type===m_.Added?this.changeMap=this.changeMap.insert(e,{type:m_.Added,doc:t.doc}):t.type===m_.Removed&&n.type===m_.Added?this.changeMap=this.changeMap.remove(e):t.type===m_.Removed&&n.type===m_.Modified?this.changeMap=this.changeMap.insert(e,{type:m_.Removed,doc:n.doc}):t.type===m_.Added&&n.type===m_.Removed?this.changeMap=this.changeMap.insert(e,{type:m_.Modified,doc:t.doc}):Md("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},T_.prototype.getChanges=function(){var n=[];return this.changeMap.inorderTraversal(function(t,e){n.push(e)}),n},T_);function T_(){this.changeMap=new am(qy.comparator)}var S_=(I_.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:m_.Added,doc:t})}),new I_(t,e,w_.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(I_.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),I_.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},I_);function I_(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}var C_=(N_.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n,r=((n={})[t]=A_.createSynthesizedTargetChangeForCurrentChange(t,e),n);return new N_(im.MIN,r,Am(),bm(),Cm())},N_);function N_(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}var A_=(k_.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new k_(Ud(),e,Cm(),Cm(),Cm())},k_);function k_(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}var D_,R_,O_=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},P_=function(t,e){this.targetId=t,this.existenceFilter=e};(R_=D_=D_||{})[R_.NoChange=0]="NoChange",R_[R_.Added=1]="Added",R_[R_.Removed=2]="Removed",R_[R_.Current=3]="Current",R_[R_.Reset=4]="Reset";var M_=function(t,e,n,r){void 0===n&&(n=Ud()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},x_=(Object.defineProperty(L_.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(L_.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(L_.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(L_.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),L_.prototype.updateResumeToken=function(t){0<t.length&&(this._hasPendingChanges=!0,this._resumeToken=t)},L_.prototype.toTargetChange=function(){var n=Cm(),r=Cm(),i=Cm();return this.documentChanges.forEach(function(t,e){switch(e){case m_.Added:n=n.add(t);break;case m_.Modified:r=r.add(t);break;case m_.Removed:i=i.add(t);break;default:Md("Encountered invalid change type: "+e)}}),new A_(this._resumeToken,this._current,n,r,i)},L_.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=V_()},L_.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},L_.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},L_.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},L_.prototype.recordTargetResponse=function(){this.pendingResponses-=1},L_.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},L_);function L_(){this.pendingResponses=0,this.documentChanges=V_(),this._resumeToken=Ud(),this._current=!1,this._hasPendingChanges=!0}var F_=(U_.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof Rg?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof Mg&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.removeDocumentFromTarget(r,t.key,t.newDoc)},U_.prototype.handleTargetChange=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.ensureTargetState(t);switch(n.state){case D_.NoChange:r.isActiveTarget(t)&&e.updateResumeToken(n.resumeToken);break;case D_.Added:e.recordTargetResponse(),e.isPending||e.clearPendingChanges(),e.updateResumeToken(n.resumeToken);break;case D_.Removed:e.recordTargetResponse(),e.isPending||r.removeTarget(t),xd(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case D_.Current:r.isActiveTarget(t)&&(e.markCurrent(),e.updateResumeToken(n.resumeToken));break;case D_.Reset:r.isActiveTarget(t)&&(r.resetTarget(t),e.updateResumeToken(n.resumeToken));break;default:Md("Unknown target watch change state: "+n.state)}})},U_.prototype.forEachTarget=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):Hd(this.targetStates,e)},U_.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.queryDataForActiveTarget(e);if(r){var i=r.query;if(i.isDocumentQuery())if(0===n){var o=new qy(i.path);this.removeDocumentFromTarget(e,o,new Mg(o,im.forDeletedDoc()))}else xd(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},U_.prototype.createRemoteEvent=function(i){var o=this,a={};Hd(this.targetStates,function(t,e){var n=o.queryDataForActiveTarget(t);if(n){if(e.current&&n.query.isDocumentQuery()){var r=new qy(n.query.path);null!==o.pendingDocumentUpdates.get(r)||o.targetContainsDocument(t,r)||o.removeDocumentFromTarget(t,r,new Mg(r,i))}e.hasPendingChanges&&(a[t]=e.toTargetChange(),e.clearPendingChanges())}});var r=Cm();this.pendingDocumentTargetMapping.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){var e=o.queryDataForActiveTarget(t);return!e||e.purpose===Mb.LimboResolution||(n=!1)}),n&&(r=r.add(t))});var t=new C_(i,a,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=bm(),this.pendingDocumentTargetMapping=q_(),this.pendingTargetResets=new dm(yy),t},U_.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?m_.Modified:m_.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},U_.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,m_.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},U_.prototype.removeTarget=function(t){delete this.targetStates[t]},U_.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},U_.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},U_.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new x_),this.targetStates[t]},U_.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new dm(yy),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},U_.prototype.isActiveTarget=function(t){var e=null!==this.queryDataForActiveTarget(t);return e||Rd("WatchChangeAggregator","Detected inactive target",t),e},U_.prototype.queryDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getQueryDataForTarget(t)},U_.prototype.resetTarget=function(e){var n=this;xd(!this.targetStates[e].isPending,"Should only reset active targets"),this.targetStates[e]=new x_,this.metadataProvider.getRemoteKeysForTarget(e).forEach(function(t){n.removeDocumentFromTarget(e,t,null)})},U_.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},U_);function U_(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=bm(),this.pendingDocumentTargetMapping=q_(),this.pendingTargetResets=new dm(yy)}function q_(){return new am(qy.comparator)}function V_(){return new am(qy.comparator)}var B_="RemoteStore",j_=(W_.prototype.start=function(){return this.enableNetwork()},W_.prototype.enableNetwork=function(){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(e=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(i_.Unknown),[4,this.fillWritePipeline()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},W_.prototype.disableNetwork=function(){return hi(this,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(i_.Offline),[2]}})})},W_.prototype.disableNetworkInternal=function(){return hi(this,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),0<this.writePipeline.length&&(Rd(B_,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},W_.prototype.shutdown=function(){return hi(this,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return Rd(B_,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(i_.Unknown),[2]}})})},W_.prototype.listen=function(t){xd(!Qd(this.listenTargets,t.targetId),"listen called with duplicate targetId!"),this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t)},W_.prototype.unlisten=function(t){xd(Qd(this.listenTargets,t),"unlisten called without assigned target ID!"),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),zd(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(i_.Unknown))},W_.prototype.getQueryDataForTarget=function(t){return this.listenTargets[t]||null},W_.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},W_.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},W_.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},W_.prototype.startWatchStream=function(){xd(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new F_(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},W_.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!zd(this.listenTargets)},W_.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},W_.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},W_.prototype.onWatchStreamOpen=function(){return hi(this,void 0,void 0,function(){var n=this;return li(this,function(t){return Hd(this.listenTargets,function(t,e){n.sendWatchRequest(e)}),[2]})})},W_.prototype.onWatchStreamClose=function(e){return hi(this,void 0,void 0,function(){return li(this,function(t){return void 0===e&&xd(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(e),this.startWatchStream()):this.onlineStateTracker.set(i_.Unknown),[2]})})},W_.prototype.onWatchStreamChange=function(n,r){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:return this.onlineStateTracker.set(i_.Online),n instanceof M_&&n.state===D_.Removed&&n.cause?[2,this.handleTargetError(n)]:(n instanceof O_?this.watchChangeAggregator.handleDocumentChange(n):n instanceof P_?this.watchChangeAggregator.handleExistenceFilter(n):(xd(n instanceof M_,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(n)),r.isEqual(im.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return e=t.sent(),0<=r.compareTo(e)?[4,this.raiseWatchSnapshot(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},W_.prototype.raiseWatchSnapshot=function(r){var i=this;xd(!r.isEqual(im.MIN),"Can't raise event for unknown SnapshotVersion");var t=this.watchChangeAggregator.createRemoteEvent(r);return Hd(t.targetChanges,function(t,e){if(0<e.resumeToken.length){var n=i.listenTargets[t];n&&(i.listenTargets[t]=n.withResumeToken(e.resumeToken,r))}}),t.targetMismatches.forEach(function(t){var e=i.listenTargets[t];if(e){i.listenTargets[t]=e.withResumeToken(Ud(),e.snapshotVersion),i.sendUnwatchRequest(t);var n=new Vb(e.query,t,Mb.ExistenceFilterMismatch,e.sequenceNumber);i.sendWatchRequest(n)}}),this.syncEngine.applyRemoteEvent(t)},W_.prototype.handleTargetError=function(t){var n=this;xd(!!t.cause,"Handling target error without a cause");var r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return hi(n,void 0,void 0,function(){return li(this,function(t){return Qd(this.listenTargets,e)?(delete this.listenTargets[e],this.watchChangeAggregator.removeTarget(e),[2,this.syncEngine.rejectListen(e,r)]):[2]})})})}),i},W_.prototype.fillWritePipeline=function(){return hi(this,void 0,void 0,function(){var e,n;return li(this,function(t){switch(t.label){case 0:return this.canAddToWritePipeline()?(e=0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(e)]):[3,4];case 1:return null!==(n=t.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(n),[4,this.fillWritePipeline()];case 3:t.sent(),t.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},W_.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},W_.prototype.outstandingWrites=function(){return this.writePipeline.length},W_.prototype.addToWritePipeline=function(t){xd(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},W_.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},W_.prototype.startWriteStream=function(){xd(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},W_.prototype.onWriteStreamOpen=function(){return hi(this,void 0,void 0,function(){return li(this,function(t){return this.writeStream.writeHandshake(),[2]})})},W_.prototype.onWriteHandshakeComplete=function(){var r=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var t=0,e=r.writePipeline;t<e.length;t++){var n=e[t];r.writeStream.writeMutations(n.mutations)}}).catch(uw)},W_.prototype.onMutationResult=function(t,e){var n=this;xd(0<this.writePipeline.length,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=Rm.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},W_.prototype.onWriteStreamClose=function(n){return hi(this,void 0,void 0,function(){var e=this;return li(this,function(t){return void 0===n&&xd(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),n&&0<this.writePipeline.length?[2,(this.writeStream.handshakeComplete?this.handleWriteError(n):this.handleHandshakeError(n)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]:[2]})})},W_.prototype.handleHandshakeError=function(e){return hi(this,void 0,void 0,function(){return li(this,function(t){return d_(e.code)?(Rd(B_,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=Ud(),[2,this.localStore.setLastStreamToken(Ud()).catch(uw)]):[2]})})},W_.prototype.handleWriteError=function(r){return hi(this,void 0,void 0,function(){var e,n=this;return li(this,function(t){return function(t){return d_(t)&&t!==Vd.ABORTED}(r.code)?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,r).then(function(){return n.fillWritePipeline()})]):[2]})})},W_.prototype.createTransaction=function(){return new u_(this.datastore)},W_.prototype.restartNetwork=function(){return hi(this,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(i_.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},W_.prototype.handleCredentialChange=function(){return hi(this,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Rd(B_,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},W_.prototype.applyPrimaryState=function(e){return hi(this,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,4];case 2:return e?[3,4]:[4,this.disableNetworkInternal()];case 3:t.sent(),this.onlineStateTracker.set(i_.Unknown),t.label=4;case 4:return[2]}})})},W_);function W_(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(t){n.enqueueAndForget(function(){return hi(o,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Rd(B_,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new f_(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}var Q_=(Object.defineProperty(K_.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(K_.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),K_.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},K_.prototype._compareTo=function(t){return yy(this._lat,t._lat)||yy(this._long,t._long)},K_);function K_(t,e){if(Xd("GeoPoint",arguments,2),Zd("GeoPoint","number",1,t),Zd("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Bd(Vd.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Bd(Vd.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}var H_=(G_.atPath=function(t){return new G_(t)},Object.defineProperty(G_.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[_E]:this.memoizedOrderBy=[new bE(t),_E];else{xd(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.memoizedOrderBy=[]),r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:yE.ASCENDING;this.memoizedOrderBy.push(a===yE.ASCENDING?_E:EE)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),G_.prototype.addFilter=function(t){xd(null==this.getInequalityFilterField()||!(t instanceof $_)||!t.isInequality()||t.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),xd(!this.isDocumentQuery(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new G_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),e,this.limit,this.startAt,this.endAt)},G_.prototype.addOrderBy=function(t){xd(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.explicitOrderBy.concat([t]);return new G_(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.startAt,this.endAt)},G_.prototype.withLimit=function(t){return new G_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,this.startAt,this.endAt)},G_.prototype.withStartAt=function(t){return new G_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,t,this.endAt)},G_.prototype.withEndAt=function(t){return new G_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,t)},G_.prototype.asCollectionQueryAtPath=function(t){return new G_(t,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,this.endAt)},G_.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();this.isCollectionGroupQuery()&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";Bw(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},G_.prototype.toString=function(){var t="Query("+this.path.canonicalString();return this.isCollectionGroupQuery()&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),Bw(this.limit)||(t+=", limit: "+this.limit),0<this.explicitOrderBy.length&&(t+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),t+")"},G_.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},G_.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return xd(n,"orderBy used that doesn't compare on key field"),0},G_.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},G_.prototype.hasLimit=function(){return!Bw(this.limit)},G_.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},G_.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof $_&&n.isInequality())return n.field}return null},G_.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof $_&&0<=t.indexOf(r.op))return r.op}return null},G_.prototype.isDocumentQuery=function(){return qy.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},G_.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},G_.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):qy.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},G_.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},G_.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},G_.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,t))},G_.prototype.assertValidBound=function(t){xd(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},G_);function G_(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}function z_(){}var Y_=(X_.fromString=function(t){switch(t){case"<":return X_.LESS_THAN;case"<=":return X_.LESS_THAN_OR_EQUAL;case"==":return X_.EQUAL;case">=":return X_.GREATER_THAN_OR_EQUAL;case">":return X_.GREATER_THAN;case"array-contains":return X_.ARRAY_CONTAINS;case"in":return X_.IN;case"array-contains-any":return X_.ARRAY_CONTAINS_ANY;default:return Md("Unknown FieldFilter operator: "+t)}},X_.prototype.toString=function(){return this.name},X_.prototype.isEqual=function(t){return this.name===t.name},X_.LESS_THAN=new X_("<"),X_.LESS_THAN_OR_EQUAL=new X_("<="),X_.EQUAL=new X_("=="),X_.GREATER_THAN=new X_(">"),X_.GREATER_THAN_OR_EQUAL=new X_(">="),X_.ARRAY_CONTAINS=new X_("array-contains"),X_.IN=new X_("in"),X_.ARRAY_CONTAINS_ANY=new X_("array-contains-any"),X_);function X_(t){this.name=t}var J_,$_=(ui(Z_,J_=z_),Z_.create=function(t,e,n){if(t.isKeyField())return e===Y_.IN?(xd(n instanceof Cg,"Comparing on key with IN, but filter value not an ArrayValue"),xd(n.internalValue.every(function(t){return t instanceof vg}),"Comparing on key with IN, but an array value was not a RefValue"),new iE(t,n)):(xd(n instanceof vg,"Comparing on key, but filter value not a RefValue"),xd(e!==Y_.ARRAY_CONTAINS&&e!==Y_.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new eE(t,e,n));if(n.isEqual(Wv.INSTANCE)){if(e!==Y_.EQUAL)throw new Bd(Vd.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Z_(t,e,n)}if(n.isEqual(ng.NAN)){if(e!==Y_.EQUAL)throw new Bd(Vd.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Z_(t,e,n)}return e===Y_.ARRAY_CONTAINS?new sE(t,n):e===Y_.IN?(xd(n instanceof Cg,"IN filter has invalid value: "+n.toString()),new hE(t,n)):e===Y_.ARRAY_CONTAINS_ANY?(xd(n instanceof Cg,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new pE(t,n)):new Z_(t,e,n)},Z_.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},Z_.prototype.matchesComparison=function(t){switch(this.op){case Y_.LESS_THAN:return t<0;case Y_.LESS_THAN_OR_EQUAL:return t<=0;case Y_.EQUAL:return 0===t;case Y_.GREATER_THAN:return 0<t;case Y_.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Md("Unknown FieldFilter operator: "+this.op)}},Z_.prototype.isInequality=function(){return 0<=[Y_.LESS_THAN,Y_.LESS_THAN_OR_EQUAL,Y_.GREATER_THAN,Y_.GREATER_THAN_OR_EQUAL].indexOf(this.op)},Z_.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},Z_.prototype.isEqual=function(t){return t instanceof Z_&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},Z_.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},Z_);function Z_(t,e,n){var r=J_.call(this)||this;return r.field=t,r.op=e,r.value=n,r}var tE,eE=(ui(nE,tE=$_),nE.prototype.matches=function(t){var e=this.value,n=qy.comparator(t.key,e.key);return this.matchesComparison(n)},nE);function nE(){return null!==tE&&tE.apply(this,arguments)||this}var rE,iE=(ui(oE,rE=$_),oE.prototype.matches=function(e){return this.value.internalValue.some(function(t){return e.key.isEqual(t.key)})},oE);function oE(t,e){var n=rE.call(this,t,Y_.IN,e)||this;return n.value=e,n}var aE,sE=(ui(uE,aE=$_),uE.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Cg&&e.contains(this.value)},uE);function uE(t,e){return aE.call(this,t,Y_.ARRAY_CONTAINS,e)||this}var cE,hE=(ui(lE,cE=$_),lE.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},lE);function lE(t,e){var n=cE.call(this,t,Y_.IN,e)||this;return n.value=e,n}var fE,pE=(ui(dE,fE=$_),dE.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Cg&&n.internalValue.some(function(t){return e.value.contains(t)})},dE);function dE(t,e){var n=fE.call(this,t,Y_.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}var yE=(mE.prototype.toString=function(){return this.name},mE.ASCENDING=new mE("asc"),mE.DESCENDING=new mE("desc"),mE);function mE(t){this.name=t}var vE=(gE.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},gE.prototype.sortsBeforeDocument=function(t,e){xd(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())xd(o instanceof vg,"Bound has a non-key value where the key path is being used."),n=qy.comparator(o.key,e.key);else{var a=e.field(i.field);xd(null!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===yE.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},gE.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},gE);function gE(t,e){this.position=t,this.before=e}var bE=(wE.prototype.compare=function(t,e){var n=this.isKeyOrderBy?Rg.compareByKey(t,e):Rg.compareByField(this.field,t,e);switch(this.dir){case yE.ASCENDING:return n;case yE.DESCENDING:return-1*n;default:return Md("Unknown direction: "+this.dir)}},wE.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},wE.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},wE.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},wE);function wE(t,e){this.field=t,void 0===e&&(e=yE.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}var _E=new bE(Fy.keyField(),yE.ASCENDING),EE=new bE(Fy.keyField(),yE.DESCENDING),TE=(SE.prototype.applyToLocalView=function(t,e){return new lg(e,t)},SE.prototype.applyToRemoteDocument=function(t,e){return e},SE.prototype.computeBaseValue=function(t){return null},SE.prototype.isEqual=function(t){return t instanceof SE},SE.instance=new SE,SE);function SE(){}var IE=(CE.prototype.applyToLocalView=function(t,e){return this.apply(t)},CE.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},CE.prototype.apply=function(t){for(var n=RE(t),e=function(e){n.find(function(t){return t.isEqual(e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Cg(n)},CE.prototype.computeBaseValue=function(t){return null},CE.prototype.isEqual=function(t){return t instanceof CE&&my(t.elements,this.elements)},CE);function CE(t){this.elements=t}var NE=(AE.prototype.applyToLocalView=function(t,e){return this.apply(t)},AE.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},AE.prototype.apply=function(t){for(var n=RE(t),e=function(e){n=n.filter(function(t){return!t.isEqual(e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Cg(n)},AE.prototype.computeBaseValue=function(t){return null},AE.prototype.isEqual=function(t){return t instanceof AE&&my(t.elements,this.elements)},AE);function AE(t){this.elements=t}var kE=(DE.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof Zv&&this.operand instanceof Zv){var r=n.internalValue+this.operand.internalValue;return new Zv(r)}return r=n.internalValue+this.operand.internalValue,new ng(r)},DE.prototype.applyToRemoteDocument=function(t,e){return xd(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},DE.prototype.computeBaseValue=function(t){return t instanceof Yv?t:new Zv(0)},DE.prototype.isEqual=function(t){return t instanceof DE&&this.operand.isEqual(t.operand)},DE);function DE(t){this.operand=t}function RE(t){return t instanceof Cg?t.internalValue.slice():[]}var OE=(PE.prototype.isEqual=function(t){return t&&t.count===this.count},PE);function PE(t){this.count=t}var ME,xE,LE=((ME={})[yE.ASCENDING.name]="ASCENDING",ME[yE.DESCENDING.name]="DESCENDING",ME),FE=((xE={})[Y_.LESS_THAN.name]="LESS_THAN",xE[Y_.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",xE[Y_.GREATER_THAN.name]="GREATER_THAN",xE[Y_.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",xE[Y_.EQUAL.name]="EQUAL",xE[Y_.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",xE[Y_.IN.name]="IN",xE[Y_.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",xE),UE=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qE(t,e){xd(!Bw(t),e+" is missing")}function VE(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Md("can't parse "+t)}var BE=(jE.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},jE.prototype.unsafeCastProtoByteString=function(t){return t},jE.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Vd.UNKNOWN:y_(t.code);return new Bd(e,t.message||"")},jE.prototype.toInt32Value=function(t){return Bw(t)?void 0:{value:t}},jE.prototype.fromInt32Value=function(t){var e;return Bw(e="object"==typeof t?t.value:t)?null:e},jE.prototype.toTimestamp=function(t){return{seconds:""+t.seconds,nanos:t.nanoseconds}},jE.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);xd(!!t,"Cannot deserialize null or undefined timestamp.");var e=VE(t.seconds||"0"),n=t.nanos||0;return new nm(e,n)},jE.prototype.fromIso8601String=function(t){var e=0,n=UE.exec(t);if(xd(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new nm(o,e)},jE.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},jE.prototype.fromBlob=function(t){return"string"==typeof t?(xd(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),wy.fromBase64String(t)):(xd(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),wy.fromUint8Array(t))},jE.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},jE.prototype.fromVersion=function(t){return xd(!!t,"Trying to deserialize version that isn't set"),im.fromTimestamp(this.fromTimestamp(t))},jE.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},jE.prototype.fromResourceName=function(t){var e=Py.fromString(t);return xd(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},jE.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},jE.prototype.fromName=function(t){var e=this.fromResourceName(t);return xd(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),xd(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new qy(this.extractLocalPathFromResourceName(e))},jE.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},jE.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?Py.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(jE.prototype,"encodedDatabaseId",{get:function(){return new Py(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),jE.prototype.fullyQualifiedPrefixPath=function(t){return new Py(["projects",t.projectId,"databases",t.database])},jE.prototype.extractLocalPathFromResourceName=function(t){return xd(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},jE.prototype.isValidResourceName=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},jE.prototype.toValue=function(t){if(t instanceof Wv)return{nullValue:"NULL_VALUE"};if(t instanceof Hv)return{booleanValue:t.value()};if(t instanceof Zv)return{integerValue:""+t.value()};if(t instanceof ng){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof og?{stringValue:t.value()}:t instanceof Tg?{mapValue:this.toMapValue(t)}:t instanceof Cg?{arrayValue:this.toArrayValue(t)}:t instanceof ug?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof wg?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof dg?{bytesValue:this.toBytes(t.value())}:t instanceof vg?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Md("Unknown FieldValue "+JSON.stringify(t))},jE.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return Wv.INSTANCE;if("booleanValue"in t)return Hv.of(t.booleanValue);if("integerValue"in t)return new Zv(VE(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return ng.NAN;if("Infinity"===t.doubleValue)return ng.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return ng.NEGATIVE_INFINITY}return new ng(t.doubleValue)}if("stringValue"in t)return new og(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){qE(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Cg(n.map(function(t){return e.fromValue(t)}))}if("timestampValue"in t)return qE(t.timestampValue,"timestampValue"),new ug(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){qE(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new wg(new Q_(r,i))}if("bytesValue"in t){qE(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new dg(o)}if("referenceValue"in t){qE(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new Iy(a.get(1),a.get(3)),u=new qy(this.extractLocalPathFromResourceName(a));return new vg(s,u)}return Md("Unknown Value proto "+JSON.stringify(t))},jE.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},jE.prototype.toDocument=function(t){return xd(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data()),updateTime:this.toTimestamp(t.version.toTimestamp())}},jE.prototype.fromDocument=function(t,e){var n=this,r=this.fromName(t.name),i=this.fromVersion(t.updateTime);return new Rg(r,i,{hasCommittedMutations:!!e},void 0,t,function(t){return n.fromValue(t)})},jE.prototype.toFields=function(t){var n=this,r={};return t.forEach(function(t,e){r[t]=n.toValue(e)}),r},jE.prototype.fromFields=function(t){var n=this,e=t,r=Tg.EMPTY;return Gd(e,function(t,e){r=r.set(new Fy([t]),n.fromValue(e))}),r},jE.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},jE.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},jE.prototype.fromFound=function(t){var e=this;xd(!!t.found,"Tried to deserialize a found document from a missing document."),qE(t.found.name,"doc.found.name"),qE(t.found.updateTime,"doc.found.updateTime");var n=this.fromName(t.found.name),r=this.fromVersion(t.found.updateTime);return new Rg(n,r,{},void 0,t.found,function(t){return e.fromValue(t)})},jE.prototype.fromMissing=function(t){xd(!!t.missing,"Tried to deserialize a missing document from a found document."),xd(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new Mg(e,n)},jE.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):Md("invalid batch get response: "+JSON.stringify(t))},jE.prototype.toWatchTargetChangeState=function(t){switch(t){case D_.Added:return"ADD";case D_.Current:return"CURRENT";case D_.NoChange:return"NO_CHANGE";case D_.Removed:return"REMOVE";case D_.Reset:return"RESET";default:return Md("Unknown WatchTargetChangeState: "+t)}},jE.prototype.toTestWatchChange=function(t){if(t instanceof P_)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof O_){if(t.newDoc instanceof Rg){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof Mg)return e=t.newDoc,{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof M_){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return h_.OK;switch(t){case Vd.OK:return h_.OK;case Vd.CANCELLED:return h_.CANCELLED;case Vd.UNKNOWN:return h_.UNKNOWN;case Vd.DEADLINE_EXCEEDED:return h_.DEADLINE_EXCEEDED;case Vd.RESOURCE_EXHAUSTED:return h_.RESOURCE_EXHAUSTED;case Vd.INTERNAL:return h_.INTERNAL;case Vd.UNAVAILABLE:return h_.UNAVAILABLE;case Vd.UNAUTHENTICATED:return h_.UNAUTHENTICATED;case Vd.INVALID_ARGUMENT:return h_.INVALID_ARGUMENT;case Vd.NOT_FOUND:return h_.NOT_FOUND;case Vd.ALREADY_EXISTS:return h_.ALREADY_EXISTS;case Vd.PERMISSION_DENIED:return h_.PERMISSION_DENIED;case Vd.FAILED_PRECONDITION:return h_.FAILED_PRECONDITION;case Vd.ABORTED:return h_.ABORTED;case Vd.OUT_OF_RANGE:return h_.OUT_OF_RANGE;case Vd.UNIMPLEMENTED:return h_.UNIMPLEMENTED;case Vd.DATA_LOSS:return h_.DATA_LOSS;default:return Md("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Md("Unrecognized watch change: "+JSON.stringify(t))},jE.prototype.fromWatchChange=function(t){var e,n=this;if("targetChange"in t){qE(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),a=t.targetChange.cause,s=a&&this.fromRpcStatus(a);e=new M_(r,i,o,s||null)}else if("documentChange"in t){qE(t.documentChange,"documentChange"),qE(t.documentChange.document,"documentChange.name"),qE(t.documentChange.document.name,"documentChange.document.name"),qE(t.documentChange.document.updateTime,"documentChange.document.updateTime");var u=t.documentChange,c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=new Rg(c,h,{},void 0,u.document,function(t){return n.fromValue(t)}),f=u.targetIds||[],p=u.removedTargetIds||[];e=new O_(f,p,l.key,l)}else if("documentDelete"in t){qE(t.documentDelete,"documentDelete"),qE(t.documentDelete.document,"documentDelete.document");var d=t.documentDelete;c=this.fromName(d.document),h=d.readTime?this.fromVersion(d.readTime):im.forDeletedDoc(),l=new Mg(c,h),p=d.removedTargetIds||[],e=new O_([],p,l.key,l)}else if("documentRemove"in t){qE(t.documentRemove,"documentRemove"),qE(t.documentRemove.document,"documentRemove");var y=t.documentRemove;c=this.fromName(y.document),p=y.removedTargetIds||[],e=new O_([],p,c,null)}else{if(!("filter"in t))return Md("Unknown change type "+JSON.stringify(t));qE(t.filter,"filter"),qE(t.filter.targetId,"filter.targetId");var m=t.filter,v=m.count||0,g=new OE(v),b=m.targetId;e=new P_(b,g)}return e},jE.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?D_.NoChange:"ADD"===t?D_.Added:"REMOVE"===t?D_.Removed:"CURRENT"===t?D_.Current:"RESET"===t?D_.Reset:Md("Got unexpected TargetChange.state: "+t)},jE.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return im.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?im.MIN:e.readTime?this.fromVersion(e.readTime):im.MIN},jE.prototype.toMutation=function(t){var e,n=this;if(t instanceof Tv)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof Lv)e={delete:this.toName(t.key)};else if(t instanceof Cv)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof kv))return Md("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},jE.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):gv.NONE;if(t.update){qE(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new Cv(r,i,o,n)}return new Tv(r,i,n)}if(t.delete)return r=this.fromName(t.delete),new Lv(r,n);if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return xd(!0===n.exists,'Transforms only support precondition "exists == true"'),new kv(r,a)}return Md("unknown mutation proto: "+JSON.stringify(t))},jE.prototype.toPrecondition=function(t){return xd(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Md("Unknown precondition")},jE.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?gv.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?gv.exists(t.exists):gv.NONE},jE.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e),i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new vv(r,i)},jE.prototype.fromWriteResults=function(t,e){var n=this;return t&&0<t.length?(xd(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},jE.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof TE)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof IE)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof NE)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof kE)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw Md("Unknown transform: "+t.transform)},jE.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)xd("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=TE.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new IE(r.map(function(t){return e.fromValue(t)}))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new NE(r.map(function(t){return e.fromValue(t)}));else if("increment"in t){var i=this.fromValue(t.increment);xd(i instanceof Yv,"NUMERIC_ADD transform requires a NumberValue"),n=new kE(i)}else Md("Unknown transform proto: "+JSON.stringify(t));var o=Fy.fromServerFormat(t.fieldPath);return new pv(o,n)},jE.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},jE.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;xd(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return H_.atPath(this.fromQueryPath(n))},jE.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(xd(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(xd(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return void 0!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},jE.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){xd(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new H_(e,i,s,a,u,c,h)},jE.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},jE.prototype.toLabel=function(t){switch(t){case Mb.Listen:return null;case Mb.ExistenceFilterMismatch:return"existence-filter-mismatch";case Mb.LimboResolution:return"limbo-document";default:return Md("Unrecognized query purpose: "+t)}},jE.prototype.toTarget=function(t){var e,n=t.query;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,0<t.resumeToken.length&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},jE.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof $_?e.toUnaryOrFieldFilter(t):Md("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},jE.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):Md("Unknown filter: "+JSON.stringify(t)):[]},jE.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},jE.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},jE.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},jE.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new vE(r,n)},jE.prototype.toDirection=function(t){return LE[t.name]},jE.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return yE.ASCENDING;case"DESCENDING":return yE.DESCENDING;default:return}},jE.prototype.toOperatorName=function(t){return FE[t.name]},jE.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return Y_.EQUAL;case"GREATER_THAN":return Y_.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return Y_.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return Y_.LESS_THAN;case"LESS_THAN_OR_EQUAL":return Y_.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return Y_.ARRAY_CONTAINS;case"IN":return Y_.IN;case"ARRAY_CONTAINS_ANY":return Y_.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Md("Unspecified operator");default:return Md("Unknown operator")}},jE.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},jE.prototype.fromFieldPathReference=function(t){return Fy.fromServerFormat(t.fieldPath)},jE.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},jE.prototype.fromPropertyOrder=function(t){return new bE(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},jE.prototype.fromFieldFilter=function(t){return $_.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},jE.prototype.toUnaryOrFieldFilter=function(t){if(t.op===Y_.EQUAL){if(t.value.isEqual(ng.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(Wv.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},jE.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return $_.create(e,Y_.EQUAL,ng.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return $_.create(n,Y_.EQUAL,Wv.INSTANCE);case"OPERATOR_UNSPECIFIED":return Md("Unspecified filter");default:return Md("Unknown filter")}},jE.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},jE.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return Fy.fromServerFormat(t)});return lv.fromArray(e)},jE);function jE(t,e){this.databaseId=t,this.options=e}var WE=function(){this.viewSnap=null,this.targetId=0,this.listeners=[]},QE=(KE.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new WE,this.queries.set(e,r)),r.listeners.push(t),xd(!t.applyOnlineStateChange(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),!r.viewSnap||t.onViewSnapshot(r.viewSnap)&&this.raiseSnapshotsInSyncEvent(),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},KE.prototype.unlisten=function(o){return hi(this,void 0,void 0,function(){var e,n,r,i;return li(this,function(t){return e=o.query,n=!1,(r=this.queries.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},KE.prototype.onWatchChange=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,a=this.queries.get(o);if(a){for(var s=0,u=a.listeners;s<u.length;s++)u[s].onViewSnapshot(i)&&(e=!0);a.viewSnap=i}}e&&this.raiseSnapshotsInSyncEvent()},KE.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.queries.delete(t)},KE.prototype.onOnlineStateChange=function(i){this.onlineState=i;var o=!1;this.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].applyOnlineStateChange(i)&&(o=!0)}),o&&this.raiseSnapshotsInSyncEvent()},KE.prototype.addSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.add(t),t.next()},KE.prototype.removeSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.delete(t)},KE.prototype.raiseSnapshotsInSyncEvent=function(){this.snapshotsInSyncListeners.forEach(function(t){t.next()})},KE);function KE(t){this.syncEngine=t,this.queries=new qg(function(t){return t.canonicalId()}),this.onlineState=i_.Unknown,this.snapshotsInSyncListeners=new Set,this.syncEngine.subscribe(this)}var HE=(GE.prototype.onViewSnapshot=function(t){if(xd(0<t.docChanges.length||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==m_.Metadata&&e.push(i)}t=new S_(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(t)&&(this.queryObserver.next(t),o=!0):this.shouldRaiseInitialEvent(t,this.onlineState)&&(this.raiseInitialEvent(t),o=!0),this.snap=t,o},GE.prototype.onError=function(t){this.queryObserver.error(t)},GE.prototype.applyOnlineStateChange=function(t){this.onlineState=t;var e=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&(this.raiseInitialEvent(this.snap),e=!0),e},GE.prototype.shouldRaiseInitialEvent=function(t,e){if(xd(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==i_.Offline;return this.options.waitForSyncWhenOnline&&n?(xd(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===i_.Offline},GE.prototype.shouldRaiseEvent=function(t){if(0<t.docChanges.length)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},GE.prototype.raiseInitialEvent=function(t){xd(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=S_.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},GE);function GE(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.snap=null,this.onlineState=i_.Unknown,this.options=n||{}}var zE=(YE.fromSnapshot=function(t,e){for(var n=Cm(),r=Cm(),i=0,o=e.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case m_.Added:n=n.add(a.doc.key);break;case m_.Removed:r=r.add(a.doc.key)}}return new YE(t,n,r)},YE);function YE(t,e,n){this.targetId=t,this.addedKeys=e,this.removedKeys=n}var XE=function(t){this.key=t},JE=function(t){this.key=t},$E=(Object.defineProperty(ZE.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),ZE.prototype.computeDocChanges=function(t,e){var s=this,u=e?e.changeSet:new E_,c=e?e.documentSet:this.documentSet,h=e?e.mutatedKeys:this.mutatedKeys,l=c,f=!1,p=this.query.hasLimit()&&c.size===this.query.limit?c.last():null;if(t.inorderTraversal(function(t,e){var n=c.get(t),r=e instanceof Rg?e:null;r&&(xd(t.isEqual(r.key),"Mismatching keys found in document changes: "+t+" != "+r.key),r=s.query.matches(r)?r:null);var i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),a=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:m_.Metadata,doc:r}),a=!0):s.shouldWaitForSyncedDocument(n,r)||(u.track({type:m_.Modified,doc:r}),a=!0,p&&0<s.query.docComparator(r,p)&&(f=!0)):!n&&r?(u.track({type:m_.Added,doc:r}),a=!0):n&&!r&&(u.track({type:m_.Removed,doc:n}),a=!0,p&&(f=!0)),a&&(h=r?(l=l.add(r),o?h.add(t):h.delete(t)):(l=l.delete(t),h.delete(t)))}),this.query.hasLimit())for(;l.size>this.query.limit;){var n=l.last();l=l.delete(n.key),h=h.delete(n.key),u.track({type:m_.Removed,doc:n})}return xd(!f||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:l,changeSet:u,needsRefill:f,mutatedKeys:h}},ZE.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},ZE.prototype.applyChanges=function(t,e,n){var r=this;xd(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return function(t,e){function n(t){switch(t){case m_.Added:return 1;case m_.Modified:case m_.Metadata:return 2;case m_.Removed:return 0;default:return Md("Unknown ChangeType: "+t)}}return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?g_.Synced:g_.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new S_(this.query,t.documentSet,i,o,t.mutatedKeys,s===g_.Local,u,!1),limboChanges:a}:{limboChanges:a}},ZE.prototype.applyOnlineStateChange=function(t){return this.current&&t===i_.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new E_,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},ZE.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations},ZE.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return xd(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},ZE.prototype.updateLimboDocuments=function(){var e=this;if(!this.current)return[];var n=this.limboDocuments;this.limboDocuments=Cm(),this.documentSet.forEach(function(t){e.shouldBeInLimbo(t.key)&&(e.limboDocuments=e.limboDocuments.add(t.key))});var r=[];return n.forEach(function(t){e.limboDocuments.has(t)||r.push(new JE(t))}),this.limboDocuments.forEach(function(t){n.has(t)||r.push(new XE(t))}),r},ZE.prototype.synchronizeWithPersistedState=function(t,e){this._syncedDocuments=e,this.limboDocuments=Cm();var n=this.computeDocChanges(t);return this.applyChanges(n,!0)},ZE.prototype.computeInitialSnapshot=function(){return S_.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===g_.Local)},ZE);function ZE(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=Cm(),this.mutatedKeys=Cm(),this.documentSet=new w_(t.docComparator.bind(t))}var tT=(eT.prototype.run=function(){this.runWithBackOff()},eT.prototype.runWithBackOff=function(){var t=this;this.backoff.backoffAndRun(function(){return hi(t,void 0,void 0,function(){var e,n,r=this;return li(this,function(t){return e=this.remoteStore.createTransaction(),(n=this.tryRunUpdateFunction(e))&&n.then(function(t){r.asyncQueue.enqueueAndForget(function(){return e.commit().then(function(){r.deferred.resolve(t)}).catch(function(t){r.handleTransactionError(t)})})}).catch(function(t){r.handleTransactionError(t)}),[2]})})})},eT.prototype.tryRunUpdateFunction=function(t){try{var e=this.updateFunction(t);return!Bw(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},eT.prototype.handleTransactionError=function(t){var e=this;0<this.retries&&this.isRetryableTransactionError(t)?(this.retries-=1,this.asyncQueue.enqueueAndForget(function(){return e.runWithBackOff(),Promise.resolve()})):this.deferred.reject(t)},eT.prototype.isRetryableTransactionError=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!d_(e)},eT);function eT(t,e,n,r){this.asyncQueue=t,this.remoteStore=e,this.updateFunction=n,this.deferred=r,this.retries=5,this.backoff=new Ww(this.asyncQueue,By.RetryTransaction)}var nT="SyncEngine",rT=function(t,e,n){this.query=t,this.targetId=e,this.view=n},iT=function(t){this.key=t,this.receivedDocument=!1},oT=(Object.defineProperty(aT.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),aT.prototype.subscribe=function(t){xd(null!==t,"SyncEngine listener cannot be null"),xd(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},aT.prototype.listen=function(a){return hi(this,void 0,void 0,function(){var e,n,r,i,o;return li(this,function(t){switch(t.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(a))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateQuery(a)];case 2:return i=t.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(i,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this.remoteStore.listen(i),t.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},aT.prototype.initializeViewAndComputeSnapshot=function(c,h){return hi(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u;return li(this,function(t){switch(t.label){case 0:return e=c.query,[4,this.localStore.executeQuery(e)];case 1:return n=t.sent(),[4,this.localStore.remoteDocumentKeys(c.targetId)];case 2:return r=t.sent(),i=new $E(e,r),o=i.computeDocChanges(n),a=A_.createSynthesizedTargetChangeForCurrentChange(c.targetId,h&&this.onlineState!==i_.Offline),xd(0===(s=i.applyChanges(o,!0===this.isPrimary,a)).limboChanges.length,"View returned limbo docs before target ack from the server."),xd(!!s.snapshot,"applyChanges for new view should always return a snapshot"),u=new rT(e,c.targetId,i),this.queryViewsByQuery.set(e,u),this.queryViewsByTarget[c.targetId]=u,[2,s.snapshot]}})})},aT.prototype.synchronizeViewAndComputeSnapshot=function(i){return hi(this,void 0,void 0,function(){var e,n,r;return li(this,function(t){switch(t.label){case 0:return[4,this.localStore.executeQuery(i.query)];case 1:return e=t.sent(),[4,this.localStore.remoteDocumentKeys(i.targetId)];case 2:return n=t.sent(),r=i.view.synchronizeWithPersistedState(e,n),this.isPrimary&&this.updateTrackedLimbos(i.targetId,r.limboChanges),[2,r]}})})},aT.prototype.unlisten=function(r){return hi(this,void 0,void 0,function(){var e,n=this;return li(this,function(t){switch(t.label){case 0:return this.assertSubscribed("unlisten()"),xd(!!(e=this.queryViewsByQuery.get(r)),"Trying to unlisten on query not found:"+r),this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseQuery(r,!1).then(function(){n.sharedClientState.clearQueryState(e.targetId),n.remoteStore.unlisten(e.targetId),n.removeAndCleanupQuery(e)}).catch(uw)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(r,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},aT.prototype.write=function(n,r){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(n)];case 1:return e=t.sent(),this.sharedClientState.addPendingMutation(e.batchId),this.addMutationCallback(e.batchId,r),[4,this.emitNewSnapsAndNotifyLocalStore(e.changes)];case 2:return t.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return t.sent(),[2]}})})},aT.prototype.runTransaction=function(t,e,n){new tT(t,this.remoteStore,e,n).run()},aT.prototype.applyRemoteEvent=function(n){return hi(this,void 0,void 0,function(){var e,r=this;return li(this,function(t){switch(t.label){case 0:this.assertSubscribed("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(n)];case 2:return e=t.sent(),Gd(n.targetChanges,function(t,e){var n=r.limboResolutionsByTarget[Number(t)];n&&(xd(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?n.receivedDocument=!0:0<e.modifiedDocuments.size?xd(n.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&(xd(n.receivedDocument,"Received remove for limbo target document without add."),n.receivedDocument=!1))}),[4,this.emitNewSnapsAndNotifyLocalStore(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,uw(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},aT.prototype.applyOnlineStateChange=function(r,t){if(this.isPrimary&&t===a_.RemoteStore||!this.isPrimary&&t===a_.SharedClientState){this.assertSubscribed("applyOnlineStateChange()");var i=[];this.queryViewsByQuery.forEach(function(t,e){var n=e.view.applyOnlineStateChange(r);xd(0===n.limboChanges.length,"OnlineState should not affect limbo documents."),n.snapshot&&i.push(n.snapshot)}),this.syncEngineListener.onOnlineStateChange(r),this.syncEngineListener.onWatchChange(i),this.onlineState=r,this.isPrimary&&this.sharedClientState.setOnlineState(r)}},aT.prototype.rejectListen=function(u,c){return hi(this,void 0,void 0,function(){var e,n,r,i,o,a,s=this;return li(this,function(t){switch(t.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(u,"rejected",c),e=this.limboResolutionsByTarget[u],(n=e&&e.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(n),delete this.limboResolutionsByTarget[u],r=(r=new am(qy.comparator)).insert(n,new Mg(n,im.forDeletedDoc())),i=Cm().add(n),o=new C_(im.MIN,{},new dm(yy),r,i),[2,this.applyRemoteEvent(o)]):[3,1];case 1:return xd(!!(a=this.queryViewsByTarget[u]),"Unknown targetId: "+u),[4,this.localStore.releaseQuery(a.query,!1).then(function(){return s.removeAndCleanupQuery(a)}).catch(uw)];case 2:t.sent(),this.syncEngineListener.onWatchError(a.query,c),t.label=3;case 3:return[2]}})})},aT.prototype.applyBatchState=function(n,r,i){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(n)];case 1:return null===(e=t.sent())?(Rd(nT,"Cannot apply mutation batch with id: "+n),[2]):"pending"!==r?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.processUserCallback(n,i||null),this.localStore.removeCachedMutationBatchMetadata(n)):Md("Unknown batchState: "+r),t.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 5:return t.sent(),[2]}})})},aT.prototype.applySuccessfulWrite=function(r){return hi(this,void 0,void 0,function(){var e,n;return li(this,function(t){switch(t.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),e=r.batch.batchId,this.processUserCallback(e,null),this.triggerPendingWritesCallbacks(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(r)];case 2:return n=t.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return t.sent(),[3,6];case 4:return[4,uw(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},aT.prototype.rejectFailedWrite=function(n,r){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(n,r),this.triggerPendingWritesCallbacks(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(n)];case 2:return e=t.sent(),this.sharedClientState.updateMutationState(n,"rejected",r),[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 3:return t.sent(),[3,6];case 4:return[4,uw(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},aT.prototype.registerPendingWritesCallback=function(r){return hi(this,void 0,void 0,function(){var e,n;return li(this,function(t){switch(t.label){case 0:return this.remoteStore.canUseNetwork()||Rd(nT,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.localStore.getHighestUnacknowledgedBatchId()];case 1:return-1===(e=t.sent())?r.resolve():((n=this.pendingWritesCallbacks.get(e)||[]).push(r),this.pendingWritesCallbacks.set(e,n)),[2]}})})},aT.prototype.triggerPendingWritesCallbacks=function(t){(this.pendingWritesCallbacks.get(t)||[]).forEach(function(t){t.resolve()}),this.pendingWritesCallbacks.delete(t)},aT.prototype.rejectOutstandingPendingWritesCallbacks=function(e){this.pendingWritesCallbacks.forEach(function(t){t.forEach(function(t){t.reject(new Bd(Vd.CANCELLED,e))})}),this.pendingWritesCallbacks.clear()},aT.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n=(n=n||new am(yy)).insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},aT.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(xd(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},aT.prototype.removeAndCleanupQuery=function(t){var e=this;if(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.queryViewsByQuery.delete(t.query),delete this.queryViewsByTarget[t.targetId],this.isPrimary){var n=this.limboDocumentRefs.referencesForId(t.targetId);this.limboDocumentRefs.removeReferencesForId(t.targetId),n.forEach(function(t){e.limboDocumentRefs.containsKey(t)||e.removeLimboTarget(t)})}},aT.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},aT.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof XE?(this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i)):i instanceof JE?(Rd(nT,"Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)):Md("Unknown limbo change: "+JSON.stringify(i))}},aT.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){Rd(nT,"New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=H_.atPath(e.path);this.limboResolutionsByTarget[n]=new iT(e),this.remoteStore.listen(new Vb(r,n,Mb.LimboResolution,Ny.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},aT.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},aT.prototype.emitNewSnapsAndNotifyLocalStore=function(n,u){return hi(this,void 0,void 0,function(){var o,a,e,s=this;return li(this,function(t){switch(t.label){case 0:return o=[],a=[],e=[],this.queryViewsByQuery.forEach(function(t,i){e.push(Promise.resolve().then(function(){var e=i.view.computeDocChanges(n);return e.needsRefill?s.localStore.executeQuery(i.query).then(function(t){return i.view.computeDocChanges(t,e)}):e}).then(function(t){var e=u&&u.targetChanges[i.targetId],n=i.view.applyChanges(t,!0===s.isPrimary,e);if(s.updateTrackedLimbos(i.targetId,n.limboChanges),n.snapshot){s.isPrimary&&s.sharedClientState.updateQueryState(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=zE.fromSnapshot(i.targetId,n.snapshot);a.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.syncEngineListener.onWatchChange(o),[4,this.localStore.notifyLocalViewChanges(a)];case 2:return t.sent(),[2]}})})},aT.prototype.assertSubscribed=function(t){xd(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},aT.prototype.handleCredentialChange=function(r){return hi(this,void 0,void 0,function(){var e,n;return li(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?(this.rejectOutstandingPendingWritesCallbacks("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.localStore.handleUserChange(r)]):[3,3];case 1:return n=t.sent(),this.sharedClientState.handleUserChange(r,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:t.sent(),t.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return t.sent(),[2]}})})},aT.prototype.applyPrimaryState=function(c){return hi(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u=this;return li(this,function(t){switch(t.label){case 0:return!0!==c||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return t.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==c||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),Hd(this.queryViewsByTarget,function(t,e){u.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then(function(){return u.unlisten(e.query)}),u.remoteStore.unlisten(e.targetId)}),[4,s]);case 4:return t.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return t.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},aT.prototype.resetLimboDocuments=function(){var e=this;Hd(this.limboResolutionsByTarget,function(t){e.remoteStore.unlisten(t)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new am(qy.comparator)},aT.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(h){return hi(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c;return li(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=h,t.label=1;case 1:return r<i.length?(o=i[r],a=void 0,(s=this.queryViewsByTarget[o])?[4,this.localStore.releaseQuery(s.query,!0)]:[3,5]):[3,11];case 2:return t.sent(),[4,this.localStore.allocateQuery(s.query)];case 3:return a=t.sent(),[4,this.synchronizeViewAndComputeSnapshot(s)];case 4:return(u=t.sent()).snapshot&&n.push(u.snapshot),[3,9];case 5:return xd(!0===this.isPrimary,"A secondary tab should never have an active query without an active view."),[4,this.localStore.getQueryForTarget(o)];case 6:return xd(!!(c=t.sent()),"Query data for target "+o+" not found"),[4,this.localStore.allocateQuery(c)];case 7:return a=t.sent(),[4,this.initializeViewAndComputeSnapshot(a,!1)];case 8:t.sent(),t.label=9;case 9:e.push(a),t.label=10;case 10:return r++,[3,1];case 11:return this.syncEngineListener.onWatchChange(n),[2,e]}})})},aT.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},aT.prototype.applyTargetState=function(a,s,u){return hi(this,void 0,void 0,function(){var e,n,r,i,o;return li(this,function(t){switch(t.label){case 0:if(this.isPrimary)return Rd(nT,"Ignoring unexpected query state notification."),[2];if(!this.queryViewsByTarget[a])return[3,11];switch(s){case"current":case"not-current":return[3,1];case"rejected":return[3,8]}return[3,10];case 1:return t.trys.push([1,4,,8]),[4,this.localStore.getNewDocumentChanges()];case 2:return e=t.sent(),n=C_.createSynthesizedRemoteEventForCurrentChange(a,"current"===s),[4,this.emitNewSnapsAndNotifyLocalStore(e,n)];case 3:return t.sent(),[3,11];case 4:return function(t){return t.code===Vd.DATA_LOSS&&t.message===Qg}(r=t.sent())?(i=[],Hd(this.queryViewsByTarget,function(t){return i.push(t)}),[4,this.synchronizeQueryViewsAndRaiseSnapshots(i)]):[3,6];case 5:return t.sent(),[3,7];case 6:throw r;case 7:return[3,8];case 8:return o=this.queryViewsByTarget[a],this.removeAndCleanupQuery(o),[4,this.localStore.releaseQuery(o.query,!0)];case 9:return t.sent(),this.syncEngineListener.onWatchError(o.query,u),[3,11];case 10:Md("Unexpected target state: "+s),t.label=11;case 11:return[2]}})})},aT.prototype.applyActiveTargetsChange=function(l,f){return hi(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h=this;return li(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[2];e=0,n=l,t.label=1;case 1:return e<n.length?(c=n[e],xd(!this.queryViewsByTarget[c],"Trying to add an already active target"),[4,this.localStore.getQueryForTarget(c)]):[3,6];case 2:return xd(!!(r=t.sent()),"Query data for active target "+c+" not found"),[4,this.localStore.allocateQuery(r)];case 3:return i=t.sent(),[4,this.initializeViewAndComputeSnapshot(i,!1)];case 4:t.sent(),this.remoteStore.listen(i),t.label=5;case 5:return e++,[3,1];case 6:o=function(e){var n;return li(this,function(t){switch(t.label){case 0:return(n=a.queryViewsByTarget[e])?[4,a.localStore.releaseQuery(n.query,!1).then(function(){h.remoteStore.unlisten(e),h.removeAndCleanupQuery(n)}).catch(uw)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},a=this,s=0,u=f,t.label=7;case 7:return s<u.length?(c=u[s],[5,o(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return s++,[3,7];case 10:return[2]}})})},aT.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},aT.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},aT.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];return e&&e.receivedDocument?Cm().add(e.key):this.queryViewsByTarget[t]?this.queryViewsByTarget[t].view.syncedDocuments:Cm()},aT);function aT(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new qg(function(t){return t.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new am(qy.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new mw,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=Km.forSyncEngine(),this.isPrimary=void 0,this.onlineState=i_.Unknown}var sT=(uT.prototype.isAuthenticated=function(){return null!=this.uid},uT.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},uT.prototype.isEqual=function(t){return t.uid===this.uid},uT.UNAUTHENTICATED=new uT(null),uT.GOOGLE_CREDENTIALS=new uT("google-credentials-uid"),uT.FIRST_PARTY=new uT("first-party-uid"),uT);function uT(t){this.uid=t}var cT="SharedClientState",hT="firestore_clients",lT="firestore_mutations",fT="firestore_targets",pT=(dT.fromWebStorageEntry=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Bd(r.error.code,r.error.message)),i?new dT(t,e,r.state,o):(Od(cT,"Failed to parse mutation state for ID '"+e+"': "+n),null)},dT.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},dT);function dT(t,e,n,r){this.user=t,this.batchId=e,this.state=n,xd(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}var yT=(mT.fromWebStorageEntry=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Bd(n.error.code,n.error.message)),r?new mT(t,n.state,i):(Od(cT,"Failed to parse target state for ID '"+t+"': "+e),null)},mT.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},mT);function mT(t,e,n){this.targetId=t,this.state=e,xd(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}var vT=(gT.fromWebStorageEntry=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Am(),o=0;r&&o<n.activeTargetIds.length;++o)r=jw(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new gT(t,i):(Od(cT,"Failed to parse client data for instance '"+t+"': "+e),null)},gT);function gT(t,e){this.clientId=t,this.activeTargetIds=e}var bT=(wT.fromWebStorageEntry=function(t){var e=JSON.parse(t);return"object"==typeof e&&e.onlineState in i_&&"string"==typeof e.clientId?new wT(e.clientId,i_[e.onlineState]):(Od(cT,"Failed to parse online state: "+t),null)},wT);function wT(t,e){this.clientId=t,this.onlineState=e}var _T=(ET.prototype.addQueryTarget=function(t){xd(!this.activeTargetIds.has(t),"Target with ID '"+t+"' already active."),this.activeTargetIds=this.activeTargetIds.add(t)},ET.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},ET.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},ET);function ET(){this.activeTargetIds=Am()}var TT=(ST.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},ST.prototype.start=function(){return hi(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f=this;return li(this,function(t){switch(t.label){case 0:return xd(!this.started,"WebStorageSharedClientState already started"),xd(null!==this.syncEngine,"syncEngine property must be set before calling start()"),xd(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.localClientId&&(o=this.getItem(this.toWebStorageClientStateKey(i)))&&(a=vT.fromWebStorageEntry(i,o))&&(this.activeClients[a.clientId]=a);for(this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(u=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(u),c=0,h=this.earlyEvents;c<h.length;c++)l=h[c],this.handleWebStorageEvent(l);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return f.shutdown()}),this.started=!0,[2]}})})},ST.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},ST.prototype.getAllActiveQueryTargets=function(){var n=Am();return Gd(this.activeClients,function(t,e){n=n.unionWith(e.activeTargetIds)}),n},ST.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},ST.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},ST.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},ST.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=yT.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},ST.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},ST.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},ST.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},ST.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},ST.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},ST.prototype.setOnlineState=function(t){this.persistOnlineState(t)},ST.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},ST.prototype.getItem=function(t){var e=this.storage.getItem(t);return Rd(cT,"READ",t,e),e},ST.prototype.setItem=function(t,e){Rd(cT,"SET",t,e),this.storage.setItem(t,e)},ST.prototype.removeItem=function(t){Rd(cT,"REMOVE",t),this.storage.removeItem(t)},ST.prototype.handleWebStorageEvent=function(s){var t=this;if(s.storageArea===this.storage){if(Rd(cT,"EVENT",s.key,s.newValue),s.key===this.localClientStorageKey)return void Od("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return hi(t,void 0,void 0,function(){var e,n,r,i,o,a;return li(this,function(t){if(!this.started)return this.earlyEvents.push(s),[2];if(null===s.key)return[2];if(this.clientStateKeyRe.test(s.key)){if(null==s.newValue)return n=this.fromWebStorageClientStateKey(s.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(s.key,s.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(s.key)){if(null!==s.newValue&&(r=this.fromWebStorageMutationMetadata(s.key,s.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(s.key)){if(null!==s.newValue&&(i=this.fromWebStorageQueryTargetMetadata(s.key,s.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(s.key===this.onlineStateKey){if(null!==s.newValue&&(o=this.fromWebStorageOnlineState(s.newValue)))return[2,this.handleOnlineStateEvent(o)]}else s.key===this.sequenceNumberKey&&(xd(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=Ny.INVALID;if(null!=t)try{var n=JSON.parse(t);xd("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Od(cT,"Failed to read sequence number from WebStorage",t)}return e}(s.newValue))!==Ny.INVALID&&this.sequenceNumberHandler(a));return[2]})})})}},Object.defineProperty(ST.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),ST.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},ST.prototype.persistMutationState=function(t,e,n){var r=new pT(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},ST.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},ST.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:i_[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},ST.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new yT(t,e,n);this.setItem(r,i.toWebStorageJSON())},ST.prototype.toWebStorageClientStateKey=function(t){return xd(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),hT+"_"+this.persistenceKey+"_"+t},ST.prototype.toWebStorageQueryTargetMetadataKey=function(t){return fT+"_"+this.persistenceKey+"_"+t},ST.prototype.toWebStorageMutationBatchKey=function(t){var e=lT+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},ST.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},ST.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return xd(null!==n,"Cannot parse client state key '"+t+"'"),vT.fromWebStorageEntry(n,e)},ST.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);xd(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return pT.fromWebStorageEntry(new sT(i),r,e)},ST.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);xd(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return yT.fromWebStorageEntry(r,e)},ST.prototype.fromWebStorageOnlineState=function(t){return bT.fromWebStorageEntry(t)},ST.prototype.handleMutationBatchEvent=function(e){return hi(this,void 0,void 0,function(){return li(this,function(t){return e.user.uid!==this.currentUser.uid?(Rd(cT,"Ignoring mutation for non-active user "+e.user.uid),[2]):[2,this.syncEngine.applyBatchState(e.batchId,e.state,e.error)]})})},ST.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},ST.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach(function(e){return hi(n,void 0,void 0,function(){return li(this,function(t){return r.has(e)||o.push(e),[2]})})}),r.forEach(function(e){return hi(n,void 0,void 0,function(){return li(this,function(t){return i.has(e)||a.push(e),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,a)},ST.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},ST);function ST(t,e,n,r,i){if(this.queue=t,this.platform=e,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!ST.isAvailable(this.platform))throw new Bd(Vd.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey="firestore_sequence_number_"+n,this.activeClients[this.localClientId]=new _T,this.clientStateKeyRe=new RegExp("^"+hT+"_"+o+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+lT+"_"+o+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+fT+"_"+o+"_(\\d+)$"),this.onlineStateKey="firestore_online_state_"+n,this.platform.window.addEventListener("storage",this.storageListener)}var IT=(CT.prototype.addPendingMutation=function(t){},CT.prototype.updateMutationState=function(t,e,n){},CT.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},CT.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},CT.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},CT.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},CT.prototype.clearQueryState=function(t){delete this.queryState[t]},CT.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},CT.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},CT.prototype.start=function(){return this.localState=new _T,Promise.resolve()},CT.prototype.handleUserChange=function(t,e,n){},CT.prototype.setOnlineState=function(t){},CT.prototype.shutdown=function(){},CT.prototype.writeSequenceNumber=function(t){},CT);function CT(){this.localState=new _T,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}var NT="FirestoreClient",AT=(kT.prototype.lruParams=function(){return zb.withCacheSize(this.cacheSizeBytes)},kT);function kT(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}var DT=function(){},RT=(OT.prototype.start=function(t){var n=this;this.verifyNotTerminated();var r=new Wy,i=new Wy,o=!1;return this.credentials.setChangeListener(function(e){o?n.asyncQueue.enqueueAndForget(function(){return n.handleCredentialChange(e)}):(o=!0,n.initializePersistence(t,i,e).then(function(t){return n.initializeRest(e,t)}).then(r.resolve,r.reject))}),this.asyncQueue.enqueueAndForget(function(){return r.promise}),i.promise},OT.prototype.enableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},OT.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof AT?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},OT.prototype.canFallback=function(t){return t instanceof Bd?t.code===Vd.FAILED_PRECONDITION||t.code===Vd.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},OT.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Bd(Vd.FAILED_PRECONDITION,"The client has already been terminated.")},OT.prototype.startIndexedDbPersistence=function(r,i){var t=this,o=aw.buildStoragePrefix(this.databaseInfo),a=new BE(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return hi(t,void 0,void 0,function(){var e,n;return li(this,function(t){switch(t.label){case 0:if(i.synchronizeTabs&&!TT.isAvailable(this.platform))throw new Bd(Vd.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return e=i.lruParams(),this.sharedClientState=i.synchronizeTabs?new TT(this.asyncQueue,this.platform,o,this.clientId,r):new IT,[4,aw.createIndexedDbPersistence({allowTabSynchronization:i.synchronizeTabs,persistenceKey:o,clientId:this.clientId,platform:this.platform,queue:this.asyncQueue,serializer:a,lruParams:e,sequenceNumberSyncer:this.sharedClientState})];case 1:return n=t.sent(),[2,(this.persistence=n).referenceDelegate.garbageCollector]}})})})},OT.prototype.startMemoryPersistence=function(){return this.persistence=Dw.createEagerPersistence(this.clientId),this.sharedClientState=new IT,Promise.resolve(null)},OT.prototype.initializeRest=function(u,c){var t=this;return Rd(NT,"Initializing. user=",u.uid),this.platform.loadConnection(this.databaseInfo).then(function(s){return hi(t,void 0,void 0,function(){var e,n,r,i,o,a=this;return li(this,function(t){switch(t.label){case 0:return this.localStore=new ww(this.persistence,u),c&&(this.lruScheduler=new Xb(c,this.asyncQueue,this.localStore)),e=this.platform.newConnectivityMonitor(),n=this.platform.newSerializer(this.databaseInfo.databaseId),r=new n_(this.asyncQueue,s,this.credentials,n),i=function(t){return a.syncEngine.applyOnlineStateChange(t,a_.RemoteStore)},o=function(t){return a.syncEngine.applyOnlineStateChange(t,a_.SharedClientState)},this.remoteStore=new j_(this.localStore,r,this.asyncQueue,i,e),this.syncEngine=new oT(this.localStore,this.remoteStore,this.sharedClientState,u),this.sharedClientState.onlineStateHandler=o,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new QE(this.syncEngine),[4,this.sharedClientState.start()];case 1:return t.sent(),[4,this.remoteStore.start()];case 2:return t.sent(),[4,this.persistence.setPrimaryStateListener(function(e){return hi(a,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return[4,this.syncEngine.applyPrimaryState(e)];case 1:return t.sent(),this.lruScheduler&&(e&&!this.lruScheduler.started?this.lruScheduler.start():e||this.lruScheduler.stop()),[2]}})})})];case 3:return t.sent(),[4,this.persistence.setDatabaseDeletedListener(function(){return hi(a,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})})];case 4:return t.sent(),[2]}})})})},OT.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),Rd(NT,"Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},OT.prototype.disableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},OT.prototype.terminate=function(){var t=this;return this.asyncQueue.enqueueAndInitiateShutdown(function(){return hi(t,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),[2]}})})})},OT.prototype.waitForPendingWrites=function(){var t=this;this.verifyNotTerminated();var e=new Wy;return this.asyncQueue.enqueueAndForget(function(){return t.syncEngine.registerPendingWritesCallback(e)}),e.promise},OT.prototype.listen=function(t,e,n){var r=this;this.verifyNotTerminated();var i=new HE(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},OT.prototype.unlisten=function(t){var e=this;this.clientTerminated||this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},OT.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof Rg)return t;if(t instanceof Mg)return null;throw new Bd(Vd.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},OT.prototype.getDocumentsFromLocalCache=function(i){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return t.localStore.executeQuery(i)}).then(function(t){var e=Cm(),n=new $E(i,e),r=n.computeDocChanges(t);return n.applyChanges(r,!1).snapshot})},OT.prototype.write=function(t){var e=this;this.verifyNotTerminated();var n=new Wy;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},OT.prototype.databaseId=function(){return this.databaseInfo.databaseId},OT.prototype.addSnapshotsInSyncListener=function(t){var e=this;this.verifyNotTerminated(),this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.addSnapshotsInSyncListener(t),Promise.resolve()})},OT.prototype.removeSnapshotsInSyncListener=function(t){this.clientTerminated||this.eventMgr.removeSnapshotsInSyncListener(t)},Object.defineProperty(OT.prototype,"clientTerminated",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:!0,configurable:!0}),OT.prototype.transaction=function(t){var e=this;this.verifyNotTerminated();var n=new Wy;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.runTransaction(e.asyncQueue,t,n),Promise.resolve()}),n.promise},OT);function OT(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=py.newId()}var PT=(MT.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},MT.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},MT.prototype.mute=function(){this.muted=!0},MT.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},MT);function MT(t){this.observer=t,this.muted=!1}var xT=(LT.documentId=function(){return LT._DOCUMENT_ID},LT.prototype.isEqual=function(t){if(!(t instanceof LT))throw hy("isEqual","FieldPath",1,t);return this._internalPath.isEqual(t._internalPath)},LT._DOCUMENT_ID=new LT(Fy.keyField().canonicalString()),LT);function LT(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new Bd(Vd.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+fy(r,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(Zd("FieldPath","string",n,t[n]),0===t[n].length)throw new Bd(Vd.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Fy(t)}var FT=new RegExp("[~\\*/\\[\\]]");var UT=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}},qT=(VT.prototype.getToken=function(){return Promise.resolve(null)},VT.prototype.invalidateToken=function(){},VT.prototype.setChangeListener=function(t){xd(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(sT.UNAUTHENTICATED)},VT.prototype.removeChangeListener=function(){xd(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},VT);function VT(){this.changeListener=null}var BT=(jT.prototype.getToken=function(){var e=this;xd(null!=this.tokenListener,"getToken cannot be called after listener removed.");var n=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(t).then(function(t){if(e.tokenCounter!==n)throw new Bd(Vd.ABORTED,"getToken aborted due to token change.");return t?(xd("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new UT(t.accessToken,e.currentUser)):null})},jT.prototype.invalidateToken=function(){this.forceRefresh=!0},jT.prototype.setChangeListener=function(t){xd(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(this.currentUser)},jT.prototype.removeChangeListener=function(){xd(null!=this.tokenListener,"removeChangeListener() called twice"),xd(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},jT.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return xd(null===t||"string"==typeof t,"Received invalid UID: "+t),new sT(t)},jT);function jT(t){var e=this;this.app=t,this.tokenListener=null,this.currentUser=sT.UNAUTHENTICATED,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.changeListener&&e.changeListener(e.currentUser)},this.currentUser=this.getUser(),this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}var WT=(Object.defineProperty(QT.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),QT);function QT(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=sT.FIRST_PARTY}var KT=(HT.prototype.getToken=function(){return Promise.resolve(new WT(this.gapi,this.sessionIndex))},HT.prototype.setChangeListener=function(t){t(sT.FIRST_PARTY)},HT.prototype.removeChangeListener=function(){},HT.prototype.invalidateToken=function(){},HT);function HT(t,e){this.gapi=t,this.sessionIndex=e}function GT(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t,["next","error","complete"])}var zT=(YT.delete=function(){return Yd("FieldValue.delete",arguments),JT.instance},YT.serverTimestamp=function(){return Yd("FieldValue.serverTimestamp",arguments),tS.instance},YT.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Jd("FieldValue.arrayUnion",arguments,1),new rS(t)},YT.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Jd("FieldValue.arrayRemove",arguments,1),new aS(t)},YT.increment=function(t){return Zd("FieldValue.increment","number",1,t),Xd("FieldValue.increment",arguments,1),new cS(t)},YT.prototype.isEqual=function(t){return this===t},YT);function YT(t){this._methodName=t}var XT,JT=(ui($T,XT=zT),$T.instance=new $T,$T);function $T(){return XT.call(this,"FieldValue.delete")||this}var ZT,tS=(ui(eS,ZT=zT),eS.instance=new eS,eS);function eS(){return ZT.call(this,"FieldValue.serverTimestamp")||this}var nS,rS=(ui(iS,nS=zT),iS);function iS(t){var e=nS.call(this,"FieldValue.arrayUnion")||this;return e._elements=t,e}var oS,aS=(ui(sS,oS=zT),sS);function sS(t){var e=oS.call(this,"FieldValue.arrayRemove")||this;return e._elements=t,e}var uS,cS=(ui(hS,uS=zT),hS);function hS(t){var e=uS.call(this,"FieldValue.increment")||this;return e._operand=t,e}var lS=Wd(zT,"Use FieldValue.<field>() instead."),fS=/^__.*__$/,pS=(dS.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new Cv(t,this.data,this.fieldMask,e)):n.push(new Tv(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new kv(t,this.fieldTransforms)),n},dS);function dS(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}var yS,mS,vS=(gS.prototype.toMutations=function(t,e){var n=[new Cv(t,this.data,this.fieldMask,e)];return 0<this.fieldTransforms.length&&n.push(new kv(t,this.fieldTransforms)),n},gS);function gS(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function bS(t){switch(t){case yS.Set:case yS.MergeSet:case yS.Update:return!0;case yS.Argument:return!1;default:throw Md("Unexpected case for UserDataSource: "+t)}}(mS=yS=yS||{})[mS.Set=0]="Set",mS[mS.Update=1]="Update",mS[mS.MergeSet=2]="MergeSet",mS[mS.Argument=3]="Argument";var wS=(_S.prototype.childContextForField=function(t){var e=null==this.path?null:this.path.child(t),n=new _S(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePathSegment(t),n},_S.prototype.childContextForFieldPath=function(t){var e=null==this.path?null:this.path.child(t),n=new _S(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePath(),n},_S.prototype.childContextForArray=function(t){return new _S(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},_S.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new Bd(Vd.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},_S.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},_S.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},_S.prototype.validatePathSegment=function(t){if(bS(this.dataSource)&&fS.test(t))throw this.createError("Document fields cannot begin and end with __")},_S);function _S(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}var ES=function(t,e){this.databaseId=t,this.key=e},TS=(SS.prototype.parseSetData=function(t,e){var n=new wS(yS.Set,t,Fy.EMPTY_PATH);CS("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new pS(r,null,n.fieldTransforms)},SS.prototype.parseMergeData=function(t,e,n){var r=new wS(yS.MergeSet,t,Fy.EMPTY_PATH);CS("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new dm(Fy.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof xT)l=h._internalPath;else{if("string"!=typeof h)throw Md("Expected stringOrFieldPath to be a string or a FieldPath");l=AS(t,h)}if(!r.contains(l))throw new Bd(Vd.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=lv.fromSet(s),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=lv.fromArray(r.fieldMask),o=r.fieldTransforms;return new pS(a,i,o)},SS.prototype.parseUpdateData=function(o,t){var a=this,s=new wS(yS.Update,o,Fy.EMPTY_PATH);CS("Data must be an object, but it was:",s,t);var u=new dm(Fy.comparator),c=Tg.EMPTY;Gd(t,function(t,e){var n=AS(o,t),r=s.childContextForFieldPath(n);if((e=a.runPreConverter(e,r))instanceof JT)u=u.add(n);else{var i=a.parseData(e,r);null!=i&&(u=u.add(n),c=c.set(n,i))}});var e=lv.fromSet(u);return new vS(c,e,s.fieldTransforms)},SS.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new wS(yS.Update,t,Fy.EMPTY_PATH),o=[NS(t,e)],a=[n];if(r.length%2!=0)throw new Bd(Vd.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(NS(t,r[s])),a.push(r[s+1]);var u=new dm(Fy.comparator),c=Tg.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof JT)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=lv.fromSet(u);return new vS(c,d,i.fieldTransforms)},SS.prototype.parseQueryValue=function(t,e){var n=new wS(yS.Argument,t,Fy.EMPTY_PATH),r=this.parseData(e,n);return xd(null!=r,"Parsed data should not be null."),xd(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},SS.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=kS(t);throw e.createError(n)}},SS.prototype.parseData=function(t,e){if(IS(t=this.runPreConverter(t,e)))return CS("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof zT)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},SS.prototype.parseObject=function(t,r){var i=this,o=new am(yy);return zd(t)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):Gd(t,function(t,e){var n=i.parseData(e,r.childContextForField(t));null!=n&&(o=o.insert(t,n))}),new Tg(o)},SS.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=Wv.INSTANCE),n.push(s),r++}return new Cg(n)},SS.prototype.parseSentinelFieldValue=function(t,e){if(!bS(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof JT){if(e.dataSource!==yS.MergeSet)throw e.dataSource===yS.Update?(xd(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof tS)e.fieldTransforms.push(new pv(e.path,TE.instance));else if(t instanceof rS){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new IE(n);e.fieldTransforms.push(new pv(e.path,r))}else if(t instanceof aS){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new NE(n);e.fieldTransforms.push(new pv(e.path,i))}else if(t instanceof cS){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new kE(o);e.fieldTransforms.push(new pv(e.path,a))}else Md("Unknown FieldValue type: "+t)},SS.prototype.parseScalarValue=function(t,e){if(null===t)return Wv.INSTANCE;if("number"==typeof t)return jw(t)?new Zv(t):new ng(t);if("boolean"==typeof t)return Hv.of(t);if("string"==typeof t)return new og(t);if(t instanceof Date)return new ug(nm.fromDate(t));if(t instanceof nm)return new ug(new nm(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof Q_)return new wg(t);if(t instanceof wy)return new dg(t);if(t instanceof ES)return new vg(t.databaseId,t.key);throw e.createError("Unsupported field value: "+sy(t))},SS.prototype.parseArrayTransformElements=function(r,t){var i=this;return t.map(function(t,e){var n=new wS(yS.Argument,r,Fy.EMPTY_PATH);return i.parseData(t,n.childContextForArray(e))})},SS);function SS(t){this.preConverter=t}function IS(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof nm||t instanceof Q_||t instanceof wy||t instanceof ES||t instanceof zT)}function CS(t,e,n){if(!IS(n)||!ay(n)){var r=sy(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function NS(t,e){if(e instanceof xT)return e._internalPath;if("string"==typeof e)return AS(t,e);throw new Bd(Vd.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function AS(e,t){try{return function(e){if(0<=e.search(FT))throw new Bd(Vd.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(xT.bind.apply(xT,[void 0].concat(e.split("."))))}catch(t){throw new Bd(Vd.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(t)._internalPath}catch(t){var n=kS(t);throw new Bd(Vd.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function kS(t){return t instanceof Error?t.message:t.toString()}var DS=zb.COLLECTION_DISABLED,RS=(OS.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},OS);function OS(t){if(void 0===t.host){if(void 0!==t.ssl)throw new Bd(Vd.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else ey("settings","non-empty string","host",t.host),this.host=t.host,ny("settings","boolean","ssl",t.ssl),this.ssl=Kd(t.ssl,!0);if(cy("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),ny("settings","object","credentials",t.credentials),this.credentials=t.credentials,ny("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Od("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Od("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=Kd(t.timestampsInSnapshots,!0),ny("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=zb.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==DS&&t.cacheSizeBytes<zb.MINIMUM_CACHE_SIZE_BYTES)throw new Bd(Vd.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+zb.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}ny("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}var PS=(MS.prototype.settings=function(t){if(Xd("Firestore.settings",arguments,1),Zd("Firestore.settings","object",1,t),Qd(t,"persistence"))throw new Bd(Vd.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new RS(t);if(this._firestoreClient&&!this._settings.isEqual(e))throw new Bd(Vd.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this._settings=e).credentials&&(this._credentials=function(t){if(!t)return new qT;switch(t.type){case"gapi":var e=t.client;return xd(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new KT(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Bd(Vd.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},MS.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},MS.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},MS.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new Bd(Vd.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Od("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=Kd(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new AT(this._settings.cacheSizeBytes,e))},MS.prototype.clearPersistence=function(){var t=this,n=aw.buildStoragePrefix(this.makeDatabaseInfo()),r=new Wy;return this._queue.enqueueAndForgetEvenAfterShutdown(function(){return hi(t,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientTerminated)throw new Bd(Vd.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,aw.clearPersistence(n)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise},MS.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(MS.prototype,"_isTerminated",{get:function(){return this.ensureClientConfigured(),this._firestoreClient.clientTerminated},enumerable:!0,configurable:!0}),MS.prototype.waitForPendingWrites=function(){return this.ensureClientConfigured(),this._firestoreClient.waitForPendingWrites()},MS.prototype._onSnapshotsInSync=function(t){if(this.ensureClientConfigured(),GT(t))return this.onSnapshotsInSyncInternal(t);Zd("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.onSnapshotsInSyncInternal(e)},MS.prototype.onSnapshotsInSyncInternal=function(t){var e=this,n=new PT({next:function(){t.next&&t.next()},error:function(t){throw Md("Uncaught Error in onSnapshotsInSync")}});return this._firestoreClient.addSnapshotsInSyncListener(n),function(){n.mute(),e._firestoreClient.removeSnapshotsInSyncListener(n)}},MS.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new DT),this._firestoreClient},MS.prototype.makeDatabaseInfo=function(){return new Ty(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)},MS.prototype.configureClient=function(t){xd(!!this._settings.host,"FirestoreSettings.host is not set"),xd(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._firestoreClient=new RT(Ld.getPlatform(),e,this._credentials,this._queue),this._firestoreClient.start(t)},MS.prototype.createDataConverter=function(r){return new TS(function(t){if(t instanceof qS){var e=r,n=t.firestore._databaseId;if(!n.isEqual(e))throw new Bd(Vd.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new ES(r,t._key)}return t})},MS.databaseIdFromApp=function(t){var e=t.options;if(!Qd(e,"projectId"))throw new Bd(Vd.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new Bd(Vd.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Iy(n)},Object.defineProperty(MS.prototype,"app",{get:function(){if(!this._firebaseApp)throw new Bd(Vd.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._firebaseApp},enumerable:!0,configurable:!0}),MS.prototype.collection=function(t){return Xd("Firestore.collection",arguments,1),Zd("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new ZS(Py.fromString(t),this)},MS.prototype.doc=function(t){return Xd("Firestore.doc",arguments,1),Zd("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),qS.forPath(Py.fromString(t),this)},MS.prototype.collectionGroup=function(t){if(Xd("Firestore.collectionGroup",arguments,1),Zd("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Bd(Vd.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new zS(new H_(Py.EMPTY_PATH,t),this)},MS.prototype.runTransaction=function(e){var n=this;return Xd("Firestore.runTransaction",arguments,1),Zd("Firestore.runTransaction","function",1,e),this.ensureClientConfigured().transaction(function(t){return e(new xS(n,t))})},MS.prototype.batch=function(){return this.ensureClientConfigured(),new FS(this)},Object.defineProperty(MS,"logLevel",{get:function(){switch(kd()){case bd.DEBUG:return"debug";case bd.ERROR:return"error";case bd.SILENT:return"silent";default:return Md("Unknown log level: "+kd())}},enumerable:!0,configurable:!0}),MS.setLogLevel=function(t){switch(Xd("Firestore.setLogLevel",arguments,1),Zd("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Dd(bd.DEBUG);break;case"error":Dd(bd.ERROR);break;case"silent":Dd(bd.SILENT);break;default:throw new Bd(Vd.INVALID_ARGUMENT,"Invalid log level: "+t)}},MS.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots},MS);function MS(t){var e=this;if(this._firebaseApp=null,this._queue=new Hy,this.INTERNAL={delete:function(){return hi(e,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var n=t;this._firebaseApp=n,this._databaseId=MS.databaseIdFromApp(n),this._persistenceKey=n.name,this._credentials=new BT(n)}else{var r=t;if(!r.projectId)throw new Bd(Vd.INVALID_ARGUMENT,"Must provide projectId");this._databaseId=new Iy(r.projectId,r.database),this._persistenceKey="[DEFAULT]",this._credentials=new qT}this._settings=new RS({}),this._dataConverter=this.createDataConverter(this._databaseId)}var xS=(LS.prototype.get=function(t){var n=this;Xd("Transaction.get",arguments,1);var r=iI("Transaction.get",t,this._firestore);return this._transaction.lookup([r._key]).then(function(t){if(!t||1!==t.length)return Md("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof Mg)return new WS(n._firestore,r._key,null,!1,!1);if(e instanceof Rg)return new WS(n._firestore,r._key,e,!1,!1);throw Md("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},LS.prototype.set=function(t,e,n){$d("Transaction.set",arguments,2,3);var r=iI("Transaction.set",t,this._firestore),i=(n=eI("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},LS.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return i="string"==typeof e||e instanceof xT?(Jd("Transaction.update",arguments,3),r=iI("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(Xd("Transaction.update",arguments,2),r=iI("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},LS.prototype.delete=function(t){Xd("Transaction.delete",arguments,1);var e=iI("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},LS);function LS(t,e){this._firestore=t,this._transaction=e}var FS=(US.prototype.set=function(t,e,n){$d("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=iI("WriteBatch.set",t,this._firestore),i=(n=eI("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,gv.NONE)),this},US.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),i="string"==typeof e||e instanceof xT?(Jd("WriteBatch.update",arguments,3),r=iI("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(Xd("WriteBatch.update",arguments,2),r=iI("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,gv.exists(!0))),this},US.prototype.delete=function(t){Xd("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=iI("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new Lv(e._key,gv.NONE)),this},US.prototype.commit=function(){return hi(this,void 0,void 0,function(){return li(this,function(t){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},US.prototype.verifyNotCommitted=function(){if(this._committed)throw new Bd(Vd.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},US);function US(t){this._firestore=t,this._mutations=[],this._committed=!1}var qS=(VS.forPath=function(t,e){if(t.length%2!=0)throw new Bd(Vd.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new VS(new qy(t),e)},Object.defineProperty(VS.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(VS.prototype,"parent",{get:function(){return new ZS(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(VS.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),VS.prototype.collection=function(t){if(Xd("DocumentReference.collection",arguments,1),Zd("DocumentReference.collection","non-empty string",1,t),!t)throw new Bd(Vd.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Py.fromString(t);return new ZS(this._key.path.child(e),this.firestore)},VS.prototype.isEqual=function(t){if(!(t instanceof VS))throw hy("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this._key.isEqual(t._key)},VS.prototype.set=function(t,e){$d("DocumentReference.set",arguments,1,2);var n=(e=eI("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,gv.NONE))},VS.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof xT?(Jd("DocumentReference.update",arguments,2),this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(Xd("DocumentReference.update",arguments,1),this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,gv.exists(!0)))},VS.prototype.delete=function(){return Xd("DocumentReference.delete",arguments,0),this._firestoreClient.write([new Lv(this._key,gv.NONE)])},VS.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];$d("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||GT(t[i])||(cy("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),ny("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=GT(t[i])?t[i]:(Zd("DocumentReference.onSnapshot","function",i,t[i]),ty("DocumentReference.onSnapshot","function",i+1,t[i+1]),ty("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},VS.prototype.onSnapshotInternal=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new PT({next:function(t){if(n.next){xd(t.docs.size<=1,"Too many documents returned on a document query");var e=t.docs.get(r._key);n.next(new WS(r.firestore,r._key,e,t.fromCache,t.hasPendingWrites))}},error:e}),o=this._firestoreClient.listen(H_.atPath(this._key.path),i,t);return function(){i.mute(),r._firestoreClient.unlisten(o)}},VS.prototype.get=function(n){var r=this;return $d("DocumentReference.get",arguments,0,1),rI("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentFromLocalCache(r._key).then(function(t){e(new WS(r.firestore,r._key,t,!0,t instanceof Rg&&t.hasLocalMutations))},t):r.getViaSnapshotListener(e,t,n)})},VS.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new Bd(Vd.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new Bd(Vd.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},VS);function VS(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}var BS=(jS.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},jS);function jS(t,e){this.hasPendingWrites=t,this.fromCache=e}var WS=(QS.prototype.data=function(t){return $d("DocumentSnapshot.data",arguments,0,1),t=nI("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data(),Uv.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},QS.prototype.get=function(t,e){if($d("DocumentSnapshot.get",arguments,1,2),e=nI("DocumentSnapshot.get",e),this._document){var n=this._document.data().field(NS("DocumentSnapshot.get",t));if(null!==n)return this.convertValue(n,Uv.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(QS.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(QS.prototype,"ref",{get:function(){return new qS(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(QS.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(QS.prototype,"metadata",{get:function(){return new BS(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),QS.prototype.isEqual=function(t){if(!(t instanceof QS))throw hy("isEqual","DocumentSnapshot",1,t);return this._firestore===t._firestore&&this._fromCache===t._fromCache&&this._key.isEqual(t._key)&&(null===this._document?null===t._document:this._document.isEqual(t._document))},QS.prototype.convertObject=function(t,n){var r=this,i={};return t.forEach(function(t,e){i[t]=r.convertValue(e,n)}),i},QS.prototype.convertValue=function(t,e){if(t instanceof Tg)return this.convertObject(t,e);if(t instanceof Cg)return this.convertArray(t,e);if(t instanceof vg){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||Od("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new qS(n,this._firestore)}return t.value(e)},QS.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},QS);function QS(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}var KS,HS=(ui(GS,KS=WS),GS.prototype.data=function(t){var e=KS.prototype.data.call(this,t);return xd("object"==typeof e,"Document in a QueryDocumentSnapshot should exist"),e},GS);function GS(){return null!==KS&&KS.apply(this,arguments)||this}var zS=(YS.prototype.where=function(t,e,n){Xd("Query.where",arguments,3),uy("Query.where",3,n),"in"!==e&&"array-contains-any"!==e&&function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new Bd(Vd.INVALID_ARGUMENT,"Invalid value "+sy(r)+" provided to function "+t+"() for its "+ly(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains"],2,e);var r,i=NS("Query.where",t),o=Y_.fromString(e);if(i.isKeyField()){if(o===Y_.ARRAY_CONTAINS||o===Y_.ARRAY_CONTAINS_ANY)throw new Bd(Vd.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===Y_.IN){this.validateDisjunctiveFilterElements(n,o);for(var a=[],s=0,u=n;s<u.length;s++){var c=u[s];a.push(this.parseDocumentIdValue(c))}r=new Cg(a)}else r=this.parseDocumentIdValue(n)}else o!==Y_.IN&&o!==Y_.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(n,o),r=this.firestore._dataConverter.parseQueryValue("Query.where",n);var h=$_.create(i,o,r);return this.validateNewFilter(h),new YS(this._query.addFilter(h),this.firestore)},YS.prototype.orderBy=function(t,e){var n;if($d("Query.orderBy",arguments,1,2),ty("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=yE.ASCENDING;else{if("desc"!==e)throw new Bd(Vd.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=yE.DESCENDING}if(null!==this._query.startAt)throw new Bd(Vd.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new Bd(Vd.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=NS("Query.orderBy",t),i=new bE(r,n);return this.validateNewOrderBy(i),new YS(this._query.addOrderBy(i),this.firestore)},YS.prototype.limit=function(t){if(Xd("Query.limit",arguments,1),Zd("Query.limit","number",1,t),t<=0)throw new Bd(Vd.INVALID_ARGUMENT,"Invalid Query. Query limit ("+t+") is invalid. Limit must be positive.");return new YS(this._query.withLimit(t),this.firestore)},YS.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Jd("Query.startAt",arguments,1);var r=this.boundFromDocOrFields("Query.startAt",t,e,!0);return new YS(this._query.withStartAt(r),this.firestore)},YS.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Jd("Query.startAfter",arguments,1);var r=this.boundFromDocOrFields("Query.startAfter",t,e,!1);return new YS(this._query.withStartAt(r),this.firestore)},YS.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Jd("Query.endBefore",arguments,1);var r=this.boundFromDocOrFields("Query.endBefore",t,e,!0);return new YS(this._query.withEndAt(r),this.firestore)},YS.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Jd("Query.endAt",arguments,1);var r=this.boundFromDocOrFields("Query.endAt",t,e,!1);return new YS(this._query.withEndAt(r),this.firestore)},YS.prototype.isEqual=function(t){if(!(t instanceof YS))throw hy("isEqual","Query",1,t);return this.firestore===t.firestore&&this._query.isEqual(t._query)},YS.prototype.boundFromDocOrFields=function(t,e,n,r){if(uy(t,1,e),e instanceof WS){if(0<n.length)throw new Bd(Vd.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Bd(Vd.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},YS.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new vg(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof lg)throw new Bd(Vd.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new Bd(Vd.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new vE(r,n)},YS.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new Bd(Vd.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new Bd(Vd.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new Bd(Vd.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(Py.fromString(a));if(!qy.isDocumentKey(s))throw new Bd(Vd.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new qy(s);i.push(new vg(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new vE(i,n)},YS.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];$d("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||GT(t[i])||(cy("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),ny("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=GT(t[i])?t[i]:(Zd("Query.onSnapshot","function",i,t[i]),ty("Query.onSnapshot","function",i+1,t[i+1]),ty("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(r,n)},YS.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new PT({next:function(t){e.next&&e.next(new XS(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},YS.prototype.get=function(n){var r=this;return $d("Query.get",arguments,0,1),rI("Query.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentsFromLocalCache(r._query).then(function(t){e(new XS(r.firestore,r._query,t))},t):r.getViaSnapshotListener(e,t,n)})},YS.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new Bd(Vd.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},YS.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new Bd(Vd.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new Bd(Vd.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(Py.fromString(t));if(!qy.isDocumentKey(e))throw new Bd(Vd.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new vg(this.firestore._databaseId,new qy(e))}if(t instanceof qS){var n=t;return new vg(this.firestore._databaseId,n._key)}throw new Bd(Vd.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+sy(t)+".")},YS.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Bd(Vd.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Bd(Vd.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Bd(Vd.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Bd(Vd.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},YS.prototype.validateNewFilter=function(t){if(t instanceof $_){var e=[Y_.ARRAY_CONTAINS,Y_.ARRAY_CONTAINS_ANY],n=[Y_.IN,Y_.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new Bd(Vd.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new Bd(Vd.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Bd(Vd.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},YS.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},YS.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new Bd(Vd.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},YS);function YS(t,e){this._query=t,this.firestore=e}var XS=(Object.defineProperty(JS.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(JS.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(JS.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),JS.prototype.forEach=function(e,n){var r=this;$d("QuerySnapshot.forEach",arguments,1,2),Zd("QuerySnapshot.forEach","function",1,e),this._snapshot.docs.forEach(function(t){e.call(n,r.convertToDocumentImpl(t))})},Object.defineProperty(JS.prototype,"query",{get:function(){return new zS(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),JS.prototype.docChanges=function(t){t&&(cy("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),ny("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new Bd(Vd.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,e,o){if(o.oldDocs.isEmpty()){var n,r=0;return o.docChanges.map(function(t){var e=new HS(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key));return xd(t.type===m_.Added,"Invalid event type for first snapshot"),xd(!n||o.query.docComparator(n,t.doc)<0,"Got added events in wrong order"),n=t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:r++}})}var a=o.oldDocs;return o.docChanges.filter(function(t){return e||t.type!==m_.Metadata}).map(function(t){var e=new HS(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key)),n=-1,r=-1;return t.type!==m_.Added&&(xd(0<=(n=a.indexOf(t.doc.key)),"Index for document not found"),a=a.delete(t.doc.key)),t.type!==m_.Removed&&(r=(a=a.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case m_.Added:return"added";case m_.Modified:case m_.Metadata:return"modified";case m_.Removed:return"removed";default:return Md("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},JS.prototype.isEqual=function(t){if(!(t instanceof JS))throw hy("isEqual","QuerySnapshot",1,t);return this._firestore===t._firestore&&this._originalQuery.isEqual(t._originalQuery)&&this._snapshot.isEqual(t._snapshot)},JS.prototype.convertToDocumentImpl=function(t){return new HS(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},JS);function JS(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new BS(n.hasPendingWrites,n.fromCache)}["length","forEach","map"].concat("undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(XS.prototype.docChanges,t,{get:function(){return function(){throw new Bd(Vd.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var $S,ZS=(ui(tI,$S=zS),Object.defineProperty(tI.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(tI.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new qS(new qy(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(tI.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),tI.prototype.doc=function(t){if($d("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=py.newId()),Zd("CollectionReference.doc","non-empty string",1,t),""===t)throw new Bd(Vd.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Py.fromString(t);return qS.forPath(this._query.path.child(e),this.firestore)},tI.prototype.add=function(t){Xd("CollectionReference.add",arguments,1),Zd("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},tI);function tI(t,e){var n=$S.call(this,H_.atPath(t),e)||this;if(t.length%2!=1)throw new Bd(Vd.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.canonicalString()+" has "+t.length);return n}function eI(t,e){if(void 0===e)return{merge:!1};if(cy(t,e,["merge","mergeFields"]),ny(t,"boolean","merge",e.merge),ry(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof xT}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Bd(Vd.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function nI(t,e){return void 0===e?{}:(cy(t,e,["serverTimestamps"]),iy(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function rI(t,e){ty(t,"object",1,e),e&&(cy(t,e,["source"]),iy(t,0,"source",e.source,["default","server","cache"]))}function iI(t,e,n){if(e instanceof qS){if(e.firestore!==n)throw new Bd(Vd.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw hy(t,"DocumentReference",1,e)}var oI=Wd(PS,"Use firebase.firestore() instead."),aI=Wd(xS,"Use firebase.firestore().runTransaction() instead."),sI=Wd(FS,"Use firebase.firestore().batch() instead."),uI=Wd(qS,"Use firebase.firestore().doc() instead."),cI=Wd(WS),hI=Wd(HS),lI=Wd(zS),fI=Wd(XS),pI=Wd(ZS,"Use firebase.firestore().collection() instead."),dI={Firestore:oI,GeoPoint:Q_,Timestamp:nm,Blob:Ey,Transaction:aI,WriteBatch:sI,DocumentReference:uI,DocumentSnapshot:cI,Query:lI,QueryDocumentSnapshot:hI,QuerySnapshot:fI,CollectionReference:pI,FieldPath:xT,FieldValue:lS,setLogLevel:PS.setLogLevel,CACHE_SIZE_UNLIMITED:DS};function yI(t){t.INTERNAL.registerService("firestore",function(t){return new PS(t)},function(t){xd(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(dI))}var mI=(vI.prototype.addCallback=function(t){},vI.prototype.shutdown=function(){},vI);function vI(){}var gI="ConnectivityMonitor",bI=(wI.prototype.addCallback=function(t){this.callbacks.push(t)},wI.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},wI.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},wI.prototype.onNetworkAvailable=function(){Rd(gI,"Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(0)},wI.prototype.onNetworkUnavailable=function(){Rd(gI,"Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(1)},wI.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},wI);function wI(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}var _I=(EI.prototype.onOpen=function(t){xd(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},EI.prototype.onClose=function(t){xd(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},EI.prototype.onMessage=function(t){xd(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},EI.prototype.close=function(){this.closeFn()},EI.prototype.send=function(t){this.sendFn(t)},EI.prototype.callOnOpen=function(){xd(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},EI.prototype.callOnClose=function(t){xd(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},EI.prototype.callOnMessage=function(t){xd(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},EI);function EI(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}var TI="Connection",SI={BatchGetDocuments:"batchGet",Commit:"commit"},II="gl-js/ fire/"+Nd,CI=(NI.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=II},NI.prototype.invokeRPC=function(s,n,r){var u=this,c=this.makeUrl(s);return new Promise(function(i,o){var a=new Cd;a.listenOnce(Sd.COMPLETE,function(){try{switch(a.getLastErrorCode()){case Td.NO_ERROR:var t=a.getResponseJson();Rd(TI,"XHR received:",JSON.stringify(t)),i(t);break;case Td.TIMEOUT:Rd(TI,'RPC "'+s+'" timed out'),o(new Bd(Vd.DEADLINE_EXCEEDED,"Request time out"));break;case Td.HTTP_ERROR:var e=a.getStatus();if(Rd(TI,'RPC "'+s+'" failed with status:',e,"response text:",a.getResponseText()),0<e){var n=a.getResponseJson().error;if(n&&n.status&&n.message){var r=function(t){var e=t.toLowerCase().replace("_","-");return 0<=Object.values(Vd).indexOf(e)?e:Vd.UNKNOWN}(n.status);o(new Bd(r,n.message))}else o(new Bd(Vd.UNKNOWN,"Server responded with status "+a.getStatus()))}else Rd(TI,'RPC "'+s+'" failed'),o(new Bd(Vd.UNAVAILABLE,"Connection failed."));break;default:Md('RPC "'+s+'" failed with unanticipated webchannel error '+a.getLastErrorCode()+": "+a.getLastError()+", giving up.")}}finally{Rd(TI,'RPC "'+s+'" completed.')}});var t=JSON.stringify(n);Rd(TI,"XHR sending: ",c+" "+t);var e={"Content-Type":"text/plain"};u.modifyHeadersForRequest(e,r),a.send(c,"POST",t,e,15)})},NI.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},NI.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Ed(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),Ni()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function a(t,e){s.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Rd(TI,"Creating WebChannel: "+o+" "+i);var s=r.createWebChannel(o,i),u=!1,c=!1,h=new _I({sendFn:function(t){c?Rd(TI,"Not sending because WebChannel is closed:",t):(u||(Rd(TI,"Opening WebChannel transport."),s.open(),u=!0),Rd(TI,"WebChannel sending:",t),s.send(t))},closeFn:function(){return s.close()}});return a(Id.EventType.OPEN,function(){c||Rd(TI,"WebChannel transport opened.")}),a(Id.EventType.CLOSE,function(){c||(c=!0,Rd(TI,"WebChannel transport closed"),h.callOnClose())}),a(Id.EventType.ERROR,function(t){c||(c=!0,Rd(TI,"WebChannel transport errored:",t),h.callOnClose(new Bd(Vd.UNAVAILABLE,"The operation could not be completed")))}),a(Id.EventType.MESSAGE,function(t){if(!c){var e=t.data[0];xd(!!e,"Got a webchannel message without data.");var n=e,r=n.error||n[0]&&n[0].error;if(r){Rd(TI,"WebChannel received error:",r);var i=r.status,o=function(t){var e=h_[t];if(void 0!==e)return y_(e)}(i),a=r.message;void 0===o&&(o=Vd.INTERNAL,a="Unknown error status: "+i+" with message "+r.message),c=!0,h.callOnClose(new Bd(o,a)),s.close()}else Rd(TI,"WebChannel received:",e),h.callOnMessage(e)}}),setTimeout(function(){h.callOnOpen()},0),h},NI.prototype.makeUrl=function(t){var e=SI[t];xd(void 0!==e,"Unknown REST mapping for: "+t);var n=[this.baseUrl,"/","v1"];return n.push("/projects/"),n.push(this.databaseId.projectId),n.push("/databases/"),n.push(this.databaseId.database),n.push("/documents"),n.push(":"),n.push(e),n.join("")},NI);function NI(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}var AI=(Object.defineProperty(kI.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(kI.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),kI.prototype.loadConnection=function(t){return Promise.resolve(new CI(t))},kI.prototype.newConnectivityMonitor=function(){return bI.isAvailable()?new bI:new mI},kI.prototype.newSerializer=function(t){return new BE(t,{useProto3Json:!0})},kI.prototype.formatJSON=function(t){return JSON.stringify(t)},kI.prototype.atob=function(t){return atob(t)},kI.prototype.btoa=function(t){return btoa(t)},kI);function kI(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}Ld.setPlatform(new AI),yI(fl);var DI,RI={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},OI=(ui(PI,DI=Error),PI);function PI(t,e,n){var r=DI.call(this,e)||this;return Object.setPrototypeOf(r,PI.prototype),r.code=t,r.details=n,r}var MI=(xI.prototype.getAuthToken=function(){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.app.INTERNAL.getToken()];case 1:return(e=t.sent())?[2,e.accessToken]:[2,void 0];case 2:return t.sent(),[2,void 0];case 3:return[2]}})})},xI.prototype.getInstanceIdToken=function(){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this.app.messaging?[4,this.app.messaging().getToken()]:[2,void 0];case 1:return(e=t.sent())?[2,e]:[2,void 0];case 2:return t.sent(),[2,void 0];case 3:return[2]}})})},xI.prototype.getContext=function(){return hi(this,void 0,void 0,function(){var e,n;return li(this,function(t){switch(t.label){case 0:return[4,this.getAuthToken()];case 1:return e=t.sent(),[4,this.getInstanceIdToken()];case 2:return n=t.sent(),[2,{authToken:e,instanceIdToken:n}]}})})},xI);function xI(t){this.app=t}function LI(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var FI=(UI.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map(function(t){return e.encode(t)});if("function"==typeof t||"object"==typeof t)return LI(t,function(t){return e.encode(t)});throw new Error("Data cannot be encoded in JSON: "+t)},UI.prototype.decode=function(t){var e=this;if(null==t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return e.decode(t)}):"function"==typeof t||"object"==typeof t?LI(t,function(t){return e.decode(t)}):t},UI);function UI(){}var qI=(Object.defineProperty(VI.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),VI.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null===this.emulatorOrigin?"https://"+n+"-"+e+".cloudfunctions.net/"+t:this.emulatorOrigin+"/"+e+"/"+n+"/"+t},VI.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},VI.prototype.httpsCallable=function(e,n){var r=this;return function(t){return r.call(e,t,n||{})}},VI.prototype.postJSON=function(r,i,o){return hi(this,void 0,void 0,function(){var e,n;return li(this,function(t){switch(t.label){case 0:o.append("Content-Type","application/json"),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,fetch(r,{method:"POST",body:JSON.stringify(i),headers:o})];case 2:return e=t.sent(),[3,4];case 3:return t.sent(),[2,{status:0,json:null}];case 4:n=null,t.label=5;case 5:return t.trys.push([5,7,,8]),[4,e.json()];case 6:return n=t.sent(),[3,8];case 7:return t.sent(),[3,8];case 8:return[2,{status:e.status,json:n}]}})})},VI.prototype.call=function(c,h,l){return hi(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u;return li(this,function(t){switch(t.label){case 0:return e=this._url(c),h=this.serializer.encode(h),n={data:h},r=new Headers,[4,this.contextProvider.getContext()];case 1:return(i=t.sent()).authToken&&r.append("Authorization","Bearer "+i.authToken),i.instanceIdToken&&r.append("Firebase-Instance-ID-Token",i.instanceIdToken),o=l.timeout||7e4,[4,Promise.race([this.postJSON(e,n,r),function(n){return new Promise(function(t,e){setTimeout(function(){e(new OI("deadline-exceeded","deadline-exceeded"))},n)})}(o),this.cancelAllRequests])];case 2:if(!(a=t.sent()))throw new OI("cancelled","Firebase Functions instance was deleted.");if(s=function(t,e,n){var r=function(t){if(200<=t&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var a=e&&e.error;if(a){var s=a.status;if("string"==typeof s){if(!RI[s])return new OI("internal","internal");r=RI[s],i=s}var u=a.message;"string"==typeof u&&(i=u),void 0!==(o=a.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new OI(r,i,o)}(a.status,a.json,this.serializer))throw s;if(!a.json)throw new OI("internal","Response is not valid JSON object.");if(void 0===(u=a.json.data)&&(u=a.json.result),void 0===u)throw new OI("internal","Response is missing data field.");return[2,{data:this.serializer.decode(u)}]}})})},VI);function VI(t,e){var n=this;void 0===e&&(e="us-central1"),this.app_=t,this.region_=e,this.serializer=new FI,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return n.deleteService()}},this.contextProvider=new MI(t),this.cancelAllRequests=new Promise(function(t){n.deleteService=function(){return t()}})}var BI,jI;function WI(t,e,n){return new qI(t,n)}BI={Functions:qI},fl.INTERNAL.registerService("functions",WI,BI,void 0,!0);var QI,KI,HI,GI,zI=((jI={})["only-available-in-window"]="This method is available in a Window context.",jI["only-available-in-sw"]="This method is available in a service worker context.",jI["should-be-overriden"]="This method should be overriden by extended classes.",jI["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",jI["permission-default"]="The required permissions were not granted and dismissed instead.",jI["permission-blocked"]="The required permissions were not granted and blocked instead.",jI["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",jI["notifications-blocked"]="Notifications have been blocked.",jI["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",jI["sw-registration-expected"]="A service worker registration was the expected input.",jI["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",jI["invalid-saved-token"]="Unable to access details of the saved token.",jI["sw-reg-redundant"]="The service worker being used for push was made redundant.",jI["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",jI["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",jI["token-subscribe-no-push-set"]="FCM returned an invalid response when getting an FCM token.",jI["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",jI["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",jI["token-update-no-token"]="FCM returned no token when updating the user to push.",jI["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",jI["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",jI["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",jI["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",jI["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",jI["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",jI["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}",jI["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",jI["failed-to-delete-token"]="Unable to delete the currently saved token.",jI["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",jI["bad-scope"]="The service worker scope must be a string with at least one character.",jI["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",jI["bad-subscription"]="The subscription must be a valid PushSubscription.",jI["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",jI["bad-push-set"]="The FCM push set used for storage / lookup was not not a valid push set string.",jI["failed-delete-vapid-key"]="The VAPID key could not be deleted.",jI["invalid-public-vapid-key"]="The public VAPID key must be a string.",jI["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",jI["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",jI),YI=new Oi("messaging","Messaging",zI),XI=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),JI="https://fcm.googleapis.com";function $I(t,e){if(null==t||null==e)return!1;if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=new DataView(t),r=new DataView(e),i=0;i<t.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function ZI(t){return function(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(String,di(e)))}(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(KI=QI=QI||{}).TYPE_OF_MSG="firebase-messaging-msg-type",KI.DATA="firebase-messaging-msg-data",(GI=HI=HI||{}).PUSH_MSG_RECEIVED="push-msg-received",GI.NOTIFICATION_CLICKED="notification-clicked";var tC=(eC.prototype.getToken=function(h,l,f){return hi(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c;return li(this,function(t){switch(t.label){case 0:e=ZI(l.getKey("p256dh")),n=ZI(l.getKey("auth")),r="authorized_entity="+h+"&endpoint="+l.endpoint+"&encryption_key="+e+"&encryption_auth="+n,$I(f.buffer,XI.buffer)||(i=ZI(f),r+="&application_pub_key="+i),(o=new Headers).append("Content-Type","application/x-www-form-urlencoded"),a={method:"POST",headers:o,body:r},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(JI+"/fcm/connect/subscribe",a)];case 2:return[4,t.sent().json()];case 3:return s=t.sent(),[3,5];case 4:throw u=t.sent(),YI.create("token-subscribe-failed",{errorInfo:u});case 5:if(s.error)throw c=s.error.message,YI.create("token-subscribe-failed",{errorInfo:c});if(!s.token)throw YI.create("token-subscribe-no-token");if(!s.pushSet)throw YI.create("token-subscribe-no-push-set");return[2,{token:s.token,pushSet:s.pushSet}]}})})},eC.prototype.updateToken=function(h,l,f,p,d){return hi(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c;return li(this,function(t){switch(t.label){case 0:e=ZI(p.getKey("p256dh")),n=ZI(p.getKey("auth")),r="push_set="+f+"&token="+l+"&authorized_entity="+h+"&endpoint="+p.endpoint+"&encryption_key="+e+"&encryption_auth="+n,$I(d.buffer,XI.buffer)||(i=ZI(d),r+="&application_pub_key="+i),(o=new Headers).append("Content-Type","application/x-www-form-urlencoded"),a={method:"POST",headers:o,body:r},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(JI+"/fcm/connect/subscribe",a)];case 2:return[4,t.sent().json()];case 3:return s=t.sent(),[3,5];case 4:throw u=t.sent(),YI.create("token-update-failed",{errorInfo:u});case 5:if(s.error)throw c=s.error.message,YI.create("token-update-failed",{errorInfo:c});if(!s.token)throw YI.create("token-update-no-token");return[2,s.token]}})})},eC.prototype.deleteToken=function(s,u,c){return hi(this,void 0,void 0,function(){var e,n,r,i,o,a;return li(this,function(t){switch(t.label){case 0:e="authorized_entity="+s+"&token="+u+"&pushSet="+c,(n=new Headers).append("Content-Type","application/x-www-form-urlencoded"),r={method:"POST",headers:n,body:e},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(JI+"/fcm/connect/unsubscribe",r)];case 2:return[4,t.sent().json()];case 3:if((i=t.sent()).error)throw o=i.error.message,YI.create("token-unsubscribe-failed",{errorInfo:o});return[3,5];case 4:throw a=t.sent(),YI.create("token-unsubscribe-failed",{errorInfo:a});case 5:return[2]}})})},eC);function eC(){}function nC(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var rC="undefined",iC="fcm_token_object_Store";function oC(){var e=indexedDB.open(rC);e.onerror=function(t){},e.onsuccess=function(t){!function(n){if(n.objectStoreNames.contains(iC)){var t=n.transaction(iC).objectStore(iC),r=new tC,i=t.openCursor();i.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},i.onsuccess=function(){var t=i.result;if(t){var e=t.value;r.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet),t.continue()}else n.close(),indexedDB.deleteDatabase(rC)}}}(e.result)}}var aC=(sC.prototype.get=function(e){return this.createTransaction(function(t){return t.get(e)})},sC.prototype.getIndex=function(e,n){return this.createTransaction(function(t){return t.index(e).get(n)})},sC.prototype.put=function(e){return this.createTransaction(function(t){return t.put(e)},"readwrite")},sC.prototype.delete=function(e){return this.createTransaction(function(t){return t.delete(e)},"readwrite")},sC.prototype.closeDatabase=function(){return hi(this,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}})})},sC.prototype.createTransaction=function(o,a){return void 0===a&&(a="readonly"),hi(this,void 0,void 0,function(){var e,n,r,i;return li(this,function(t){switch(t.label){case 0:return[4,this.getDb()];case 1:return e=t.sent(),n=e.transaction(this.objectStoreName,a),r=n.objectStore(this.objectStoreName),[4,function(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}(o(r))];case 2:return i=t.sent(),[2,new Promise(function(t,e){n.oncomplete=function(){t(i)},n.onerror=function(){e(n.error)}})]}})})},sC.prototype.getDb=function(){var r=this;return this.dbPromise||(this.dbPromise=new Promise(function(t,e){var n=indexedDB.open(r.dbName,r.dbVersion);n.onsuccess=function(){t(n.result)},n.onerror=function(){r.dbPromise=null,e(n.error)},n.onupgradeneeded=function(t){return r.onDbUpgrade(n,t)}})),this.dbPromise},sC);function sC(){this.dbPromise=null}var uC,cC=(ui(hC,uC=aC),hC.prototype.onDbUpgrade=function(t,e){var n=t.result;switch(e.oldVersion){case 0:(r=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),r.createIndex("fcmToken","fcmToken",{unique:!0});case 1:oC();case 2:var r,i=(r=t.transaction.objectStore(this.objectStoreName)).openCursor();i.onsuccess=function(){var t=i.result;if(t){var e=t.value,n=ci({},e);e.createTime||(n.createTime=Date.now()),"string"==typeof e.vapidKey&&(n.vapidKey=nC(e.vapidKey)),"string"==typeof e.auth&&(n.auth=nC(e.auth).buffer),"string"==typeof e.auth&&(n.p256dh=nC(e.p256dh).buffer),t.update(n),t.continue()}}}},hC.prototype.getTokenDetailsFromToken=function(e){return hi(this,void 0,void 0,function(){return li(this,function(t){if(!e)throw YI.create("bad-token");return lC({fcmToken:e}),[2,this.getIndex("fcmToken",e)]})})},hC.prototype.getTokenDetailsFromSWScope=function(e){return hi(this,void 0,void 0,function(){return li(this,function(t){if(!e)throw YI.create("bad-scope");return lC({swScope:e}),[2,this.get(e)]})})},hC.prototype.saveTokenDetails=function(e){return hi(this,void 0,void 0,function(){return li(this,function(t){if(!e.swScope)throw YI.create("bad-scope");if(!e.vapidKey)throw YI.create("bad-vapid-key");if(!e.endpoint||!e.auth||!e.p256dh)throw YI.create("bad-subscription");if(!e.fcmSenderId)throw YI.create("bad-sender-id");if(!e.fcmToken)throw YI.create("bad-token");if(!e.fcmPushSet)throw YI.create("bad-push-set");return lC(e),[2,this.put(e)]})})},hC.prototype.deleteToken=function(n){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:return"string"!=typeof n||0===n.length?[2,Promise.reject(YI.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(n)];case 1:if(!(e=t.sent()))throw YI.create("delete-token-not-found");return[4,this.delete(e.swScope)];case 2:return t.sent(),[2,e]}})})},hC);function hC(){var t=null!==uC&&uC.apply(this,arguments)||this;return t.dbName="fcm_token_details_db",t.dbVersion=3,t.objectStoreName="fcm_token_object_Store",t}function lC(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw YI.create("bad-token");if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw YI.create("bad-scope");if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw YI.create("bad-vapid-key");if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw YI.create("bad-subscription");if(t.auth&&!(t.auth instanceof ArrayBuffer))throw YI.create("bad-subscription");if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw YI.create("bad-subscription");if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw YI.create("bad-sender-id");if(t.fcmPushSet&&("string"!=typeof t.fcmPushSet||0===t.fcmPushSet.length))throw YI.create("bad-push-set")}var fC,pC=(ui(dC,fC=aC),dC.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},dC.prototype.getVapidFromSWScope=function(n){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:if("string"!=typeof n||0===n.length)throw YI.create("bad-scope");return[4,this.get(n)];case 1:return[2,(e=t.sent())?e.vapidKey:void 0]}})})},dC.prototype.saveVapidDetails=function(n,r){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){if("string"!=typeof n||0===n.length)throw YI.create("bad-scope");if(null===r||65!==r.length)throw YI.create("bad-vapid-key");return e={swScope:n,vapidKey:r},[2,this.put(e)]})})},dC.prototype.deleteVapidDetails=function(n){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:return[4,this.getVapidFromSWScope(n)];case 1:if(!(e=t.sent()))throw YI.create("delete-scope-not-found");return[4,this.delete(n)];case 2:return t.sent(),[2,e]}})})},dC);function dC(){var t=null!==fC&&fC.apply(this,arguments)||this;return t.dbName="fcm_vapid_details_db",t.dbVersion=1,t.objectStoreName="fcm_vapid_object_Store",t}var yC="messagingSenderId",mC=(vC.prototype.getToken=function(){return hi(this,void 0,void 0,function(){var e,n,r,i,o;return li(this,function(t){switch(t.label){case 0:if("denied"===(e=this.getNotificationPermission_()))throw YI.create("notifications-blocked");return"granted"!==e?[2,null]:[4,this.getSWRegistration_()];case 1:return n=t.sent(),[4,this.getPublicVapidKey_()];case 2:return r=t.sent(),[4,this.getPushSubscription(n,r)];case 3:return i=t.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(n.scope)];case 4:return(o=t.sent())?[2,this.manageExistingToken(n,i,r,o)]:[2,this.getNewToken(n,i,r)]}})})},vC.prototype.manageExistingToken=function(e,n,r,i){return hi(this,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return function(t,e,n){if(!n.vapidKey||!$I(e.buffer,n.vapidKey.buffer))return!1;var r=t.endpoint===n.endpoint,i=$I(t.getKey("auth"),n.auth),o=$I(t.getKey("p256dh"),n.p256dh);return r&&i&&o}(n,r,i)?Date.now()<i.createTime+6048e5?[2,i.fcmToken]:[2,this.updateToken(e,n,r,i)]:[4,this.deleteTokenFromDB(i.fcmToken)];case 1:return t.sent(),[2,this.getNewToken(e,n,r)]}})})},vC.prototype.updateToken=function(i,o,a,s){return hi(this,void 0,void 0,function(){var e,n,r;return li(this,function(t){switch(t.label){case 0:return t.trys.push([0,4,,6]),[4,this.iidModel.updateToken(this.messagingSenderId,s.fcmToken,s.fcmPushSet,o,a)];case 1:return e=t.sent(),n={swScope:i.scope,vapidKey:a,fcmSenderId:this.messagingSenderId,fcmToken:e,fcmPushSet:s.fcmPushSet,createTime:Date.now(),endpoint:o.endpoint,auth:o.getKey("auth"),p256dh:o.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(i.scope,a)];case 3:return t.sent(),[2,e];case 4:return r=t.sent(),[4,this.deleteToken(s.fcmToken)];case 5:throw t.sent(),r;case 6:return[2]}})})},vC.prototype.getNewToken=function(r,i,o){return hi(this,void 0,void 0,function(){var e,n;return li(this,function(t){switch(t.label){case 0:return[4,this.iidModel.getToken(this.messagingSenderId,i,o)];case 1:return e=t.sent(),n={swScope:r.scope,vapidKey:o,fcmSenderId:this.messagingSenderId,fcmToken:e.token,fcmPushSet:e.pushSet,createTime:Date.now(),endpoint:i.endpoint,auth:i.getKey("auth"),p256dh:i.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(r.scope,o)];case 3:return t.sent(),[2,e.token]}})})},vC.prototype.deleteToken=function(r){return hi(this,void 0,void 0,function(){var e,n;return li(this,function(t){switch(t.label){case 0:return[4,this.deleteTokenFromDB(r)];case 1:return t.sent(),[4,this.getSWRegistration_()];case 2:return(e=t.sent())?[4,e.pushManager.getSubscription()]:[3,4];case 3:if(n=t.sent())return[2,n.unsubscribe()];t.label=4;case 4:return[2,!0]}})})},vC.prototype.deleteTokenFromDB=function(n){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:return[4,this.tokenDetailsModel.deleteToken(n)];case 1:return e=t.sent(),[4,this.iidModel.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet)];case 2:return t.sent(),[2]}})})},vC.prototype.getPushSubscription=function(e,n){return e.pushManager.getSubscription().then(function(t){return t||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n})})},vC.prototype.requestPermission=function(){throw YI.create("only-available-in-window")},vC.prototype.useServiceWorker=function(t){throw YI.create("only-available-in-window")},vC.prototype.usePublicVapidKey=function(t){throw YI.create("only-available-in-window")},vC.prototype.onMessage=function(t,e,n){throw YI.create("only-available-in-window")},vC.prototype.onTokenRefresh=function(t,e,n){throw YI.create("only-available-in-window")},vC.prototype.setBackgroundMessageHandler=function(t){throw YI.create("only-available-in-sw")},vC.prototype.delete=function(){return hi(this,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}})})},vC.prototype.getNotificationPermission_=function(){return Notification.permission},vC.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},vC.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},vC.prototype.getIidModel=function(){return this.iidModel},vC);function vC(t){var e=this;if(!t.options[yC]||"string"!=typeof t.options[yC])throw YI.create("bad-sender-id");this.messagingSenderId=t.options[yC],this.tokenDetailsModel=new cC,this.vapidDetailsModel=new pC,this.iidModel=new tC,this.app=t,this.INTERNAL={delete:function(){return e.delete()}}}var gC,bC="FCM_MSG",wC=(ui(_C,gC=mC),_C.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},_C.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},_C.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},_C.prototype.onPush_=function(s){return hi(this,void 0,void 0,function(){var e,n,r,i,o,a;return li(this,function(t){switch(t.label){case 0:if(!s.data)return[2];try{e=s.data.json()}catch(t){return[2]}return[4,this.hasVisibleClients_()];case 1:return t.sent()?[2,this.sendMessageToWindowClients_(e)]:(n=this.getNotificationData_(e))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=t.sent(),o=n.actions,a=Notification.maxActions,o&&a&&o.length>a&&console.warn("This browser only supports "+a+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:return t.sent(),[2];case 5:return[2]}})})},_C.prototype.onSubChange_=function(t){return hi(this,void 0,void 0,function(){var e,n,r,i;return li(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return e=t.sent(),[3,3];case 2:throw n=t.sent(),YI.create("unable-to-resubscribe",{errorInfo:n});case 3:return t.trys.push([3,5,,8]),[4,e.pushManager.getSubscription()];case 4:return t.sent(),[3,8];case 5:return r=t.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(e.scope)];case 6:if(!(i=t.sent()))throw r;return[4,this.deleteToken(i.fcmToken)];case 7:throw t.sent(),r;case 8:return[2]}})})},_C.prototype.onNotificationClick_=function(o){return hi(this,void 0,void 0,function(){var e,n,r,i;return li(this,function(t){switch(t.label){case 0:return o.notification&&o.notification.data&&o.notification.data[bC]?o.action?[2]:(o.stopImmediatePropagation(),o.notification.close(),(e=o.notification.data[bC]).notification&&(n=e.fcmOptions&&e.fcmOptions.link||e.notification.click_action)?[4,this.getWindowClient_(n)]:[2]):[2];case 1:return(r=t.sent())?[3,3]:[4,self.clients.openWindow(n)];case 2:return r=t.sent(),[3,5];case 3:return[4,r.focus()];case 4:r=t.sent(),t.label=5;case 5:return r?(delete e.notification,delete e.fcmOptions,i=TC(HI.NOTIFICATION_CLICKED,e),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},_C.prototype.getNotificationData_=function(t){var e;if(t&&"object"==typeof t.notification){var n=ci({},t.notification);return n.data=ci({},t.notification.data,((e={})[bC]=t,e)),n}},_C.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw YI.create("bg-handler-function-expected");this.bgMessageHandler=t},_C.prototype.getWindowClient_=function(o){return hi(this,void 0,void 0,function(){var e,n,r,i;return li(this,function(t){switch(t.label){case 0:return e=new URL(o,self.location.href).href,[4,EC()];case 1:for(n=t.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===e){r=n[i];break}return[2,r]}})})},_C.prototype.attemptToMessageClient_=function(e,n){return hi(this,void 0,void 0,function(){return li(this,function(t){if(!e)throw YI.create("no-window-client-to-msg");return e.postMessage(n),[2]})})},_C.prototype.hasVisibleClients_=function(){return hi(this,void 0,void 0,function(){return li(this,function(t){switch(t.label){case 0:return[4,EC()];case 1:return[2,t.sent().some(function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")})]}})})},_C.prototype.sendMessageToWindowClients_=function(i){return hi(this,void 0,void 0,function(){var e,n,r=this;return li(this,function(t){switch(t.label){case 0:return[4,EC()];case 1:return e=t.sent(),n=TC(HI.PUSH_MSG_RECEIVED,i),[4,Promise.all(e.map(function(t){return r.attemptToMessageClient_(t,n)}))];case 2:return t.sent(),[2]}})})},_C.prototype.getSWRegistration_=function(){return hi(this,void 0,void 0,function(){return li(this,function(t){return[2,self.registration]})})},_C.prototype.getPublicVapidKey_=function(){return hi(this,void 0,void 0,function(){var e,n;return li(this,function(t){switch(t.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(e=t.sent()))throw YI.create("sw-registration-expected");return[4,this.getVapidDetailsModel().getVapidFromSWScope(e.scope)];case 2:return null==(n=t.sent())?[2,XI]:[2,n]}})})},_C);function _C(t){var e=gC.call(this,t)||this;return e.bgMessageHandler=null,self.addEventListener("push",function(t){e.onPush(t)}),self.addEventListener("pushsubscriptionchange",function(t){e.onSubChange(t)}),self.addEventListener("notificationclick",function(t){e.onNotificationClick(t)}),e}function EC(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function TC(t,e){var n;return(n={})[QI.TYPE_OF_MSG]=t,n[QI.DATA]=e,n}var SC,IC,CC=(ui(NC,SC=mC),NC.prototype.requestPermission=function(){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(e=t.sent()))return[2];throw"denied"===e?YI.create("permission-blocked"):YI.create("permission-default")}})})},NC.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw YI.create("sw-registration-expected");if(null!=this.registrationToUse)throw YI.create("use-sw-before-get-token");this.registrationToUse=t},NC.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw YI.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw YI.create("use-public-key-before-get-token");var e=nC(t);if(65!==e.length)throw YI.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=e},NC.prototype.onMessage=function(t,e,n){return"function"==typeof t?this.onMessageInternal(t,e,n):this.onMessageInternal(t)},NC.prototype.onTokenRefresh=function(t,e,n){return"function"==typeof t?this.onTokenRefreshInternal(t,e,n):this.onTokenRefreshInternal(t)},NC.prototype.waitForRegistrationToActivate_=function(r){var i=r.installing||r.waiting||r.active;return new Promise(function(t,e){if(i)if("activated"!==i.state)if("redundant"!==i.state){var n=function(){if("activated"===i.state)t(r);else{if("redundant"!==i.state)return;e(YI.create("sw-reg-redundant"))}i.removeEventListener("statechange",n)};i.addEventListener("statechange",n)}else e(YI.create("sw-reg-redundant"));else t(r);else e(YI.create("no-sw-in-reg"))})},NC.prototype.getSWRegistration_=function(){var e=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(t){throw YI.create("failed-serviceworker-registration",{browserErrorMessage:t.message})}).then(function(t){return e.waitForRegistrationToActivate_(t).then(function(){return(e.registrationToUse=t).update(),t})}))},NC.prototype.getPublicVapidKey_=function(){return hi(this,void 0,void 0,function(){return li(this,function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,XI]})})},NC.prototype.setupSWMessageListener_=function(){var r=this;navigator.serviceWorker.addEventListener("message",function(t){if(t.data&&t.data[QI.TYPE_OF_MSG]){var e=t.data;switch(e[QI.TYPE_OF_MSG]){case HI.PUSH_MSG_RECEIVED:case HI.NOTIFICATION_CLICKED:var n=e[QI.DATA];r.messageObserver&&r.messageObserver.next(n)}}},!1)},NC);function NC(t){var e=SC.call(this,t)||this;return e.registrationToUse=null,e.publicVapidKeyToUse=null,e.messageObserver=null,e.tokenRefreshObserver=null,e.onMessageInternal=Qi(function(t){e.messageObserver=t}),e.onTokenRefreshInternal=Qi(function(t){e.tokenRefreshObserver=t}),e.setupSWMessageListener_(),e}function AC(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}IC={isSupported:AC},fl.INTERNAL.registerService("messaging",function(t){if(!AC())throw YI.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new wC(t):new CC(t)},IC);var kC="firebasestorage.googleapis.com",DC="storageBucket",RC=(OC.prototype.codeProp=function(){return this.code},OC.prototype.codeEquals=function(t){return MC(t)===this.codeProp()},OC.prototype.serverResponseProp=function(){return this.serverResponse_},OC.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(OC.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(OC.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(OC.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(OC.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),OC);function OC(t,e){this.code_=MC(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}var PC={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function MC(t){return"storage/"+t}function xC(){return new RC(PC.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function LC(){return new RC(PC.CANCELED,"User canceled the upload/download.")}function FC(){return new RC(PC.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function UC(t,e,n){return new RC(PC.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function qC(){return new RC(PC.APP_DELETED,"The Firebase app was deleted.")}function VC(t,e){return new RC(PC.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function BC(t){throw new RC(PC.INTERNAL_ERROR,"Internal error: "+t)}var jC={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function WC(t){switch(t){case jC.RAW:case jC.BASE64:case jC.BASE64URL:case jC.DATA_URL:return;default:throw"Expected one of the event types: ["+jC.RAW+", "+jC.BASE64+", "+jC.BASE64URL+", "+jC.DATA_URL+"]."}}var QC=function(t,e){this.data=t,this.contentType=e||null};function KC(t,e){switch(t){case jC.RAW:return new QC(HC(e));case jC.BASE64:case jC.BASE64URL:return new QC(GC(t,e));case jC.DATA_URL:return new QC(function(t){var e=new zC(t);return e.base64?GC(jC.BASE64,e.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw VC(jC.DATA_URL,"Malformed data URL.")}return HC(e)}(e.rest)}(e),function(t){return new zC(t).contentType}(e))}throw xC()}function HC(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function GC(e,t){switch(e){case jC.BASE64:var n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw VC(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case jC.BASE64URL:var i=-1!==t.indexOf("+"),o=-1!==t.indexOf("/");if(i||o)throw VC(e,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(t)}catch(t){throw VC(e,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var zC=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw VC(jC.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=e[1]||null;null!=n&&(this.base64=function(t,e){return t.length>=e.length&&t.substring(t.length-e.length)===e}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=t.substring(t.indexOf(",")+1)};var YC,XC,JC={STATE_CHANGED:"state_changed"},$C="running",ZC="pausing",tN="paused",eN="success",nN="canceling",rN="canceled",iN="error",oN={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function aN(t){switch(t){case $C:case ZC:case nN:return oN.RUNNING;case tN:return oN.PAUSED;case eN:return oN.SUCCESS;case rN:return oN.CANCELED;case iN:default:return oN.ERROR}}function sN(t){return null!=t}function uN(t){return void 0!==t}function cN(t){return"function"==typeof t}function hN(t){return"object"==typeof t}function lN(t){return"string"==typeof t||t instanceof String}function fN(t){return"number"==typeof t||t instanceof Number}function pN(t){return dN()&&t instanceof Blob}function dN(){return"undefined"!=typeof Blob}(XC=YC=YC||{})[XC.NO_ERROR=0]="NO_ERROR",XC[XC.NETWORK_ERROR=1]="NETWORK_ERROR",XC[XC.ABORT=2]="ABORT";var yN=(mN.prototype.send=function(t,e,n,r){if(this.sent_)throw BC("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),sN(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return sN(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},mN.prototype.getErrorCode=function(){if(!this.sent_)throw BC("cannot .getErrorCode() before sending");return this.errorCode_},mN.prototype.getStatus=function(){if(!this.sent_)throw BC("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},mN.prototype.getResponseText=function(){if(!this.sent_)throw BC("cannot .getResponseText() before sending");return this.xhr_.responseText},mN.prototype.abort=function(){this.xhr_.abort()},mN.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},mN.prototype.addUploadProgressListener=function(t){sN(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},mN.prototype.removeUploadProgressListener=function(t){sN(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},mN);function mN(){var e=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=YC.NO_ERROR,this.sendPromise_=new Promise(function(t){e.xhr_.addEventListener("abort",function(){e.errorCode_=YC.ABORT,t(e)}),e.xhr_.addEventListener("error",function(){e.errorCode_=YC.NETWORK_ERROR,t(e)}),e.xhr_.addEventListener("load",function(){t(e)})})}var vN=(gN.prototype.createXhrIo=function(){return new yN},gN);function gN(){}function bN(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(dN())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}var wN=(_N.prototype.size=function(){return this.size_},_N.prototype.type=function(){return this.type_},_N.prototype.slice=function(t,e){if(pN(this.data_)){var n=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}(this.data_,t,e);return null===n?null:new _N(n)}return new _N(new Uint8Array(this.data_.buffer,t,e-t),!0)},_N.getBlob=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(dN()){var n=t.map(function(t){return t instanceof _N?t.data_:t});return new _N(bN.apply(null,n))}var r=t.map(function(t){return lN(t)?KC(jC.RAW,t).data:t.data_}),i=0;r.forEach(function(t){i+=t.byteLength});var o=new Uint8Array(i),a=0;return r.forEach(function(t){for(var e=0;e<t.length;e++)o[a++]=t[e]}),new _N(o,!0)},_N.prototype.uploadData=function(){return this.data_},_N);function _N(t,e){var n=0,r="";pN(t)?(n=(this.data_=t).size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}var EN=(Object.defineProperty(TN.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(TN.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),TN.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},TN.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},TN.makeFromBucketSpec=function(e){var t;try{t=TN.makeFromUrl(e)}catch(t){return new TN(e,"")}if(""===t.path)return t;throw function(t){return new RC(PC.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}(e)},TN.makeFromUrl=function(t){for(var e=null,n="([A-Za-z0-9.\\-_]+)",r=new RegExp("^gs://"+n+"(/(.*))?$","i"),i=kC.replace(/[.]/g,"\\."),o=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+i+"/v[A-Za-z0-9_]+/b/"+n+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],a=0;a<o.length;a++){var s=o[a],u=s.regex.exec(t);if(u){var c=u[s.indices.bucket],h=u[s.indices.path];e=new TN(c,h=h||""),s.postModify(e);break}}if(null==e)throw function(t){return new RC(PC.INVALID_URL,"Invalid URL '"+t+"'.")}(t);return e},TN);function TN(t,e){this.bucket=t,this.path_=e}function SN(t){var e;try{e=JSON.parse(t)}catch(t){return null}return function(t){return hN(t)&&!Array.isArray(t)}(e)?e:null}function IN(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function CN(t){return"https://"+kC+"/v0"+t}function NN(t){var e=encodeURIComponent,n="?";for(var r in t){if(t.hasOwnProperty(r))n=n+(e(r)+"="+e(t[r]))+"&"}return n=n.slice(0,-1)}function AN(t,e){return e}var kN=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||AN},DN=null;function RN(){if(DN)return DN;var t=[];t.push(new kN("bucket")),t.push(new kN("generation")),t.push(new kN("metageneration")),t.push(new kN("name","fullPath",!0));var e=new kN("name");e.xform=function(t,e){return function(t){return!lN(t)||t.length<2?t:IN(t)}(e)},t.push(e);var n=new kN("size");return n.xform=function(t,e){return sN(e)?Number(e):e},t.push(n),t.push(new kN("timeCreated")),t.push(new kN("updated")),t.push(new kN("md5Hash",null,!0)),t.push(new kN("cacheControl",null,!0)),t.push(new kN("contentDisposition",null,!0)),t.push(new kN("contentEncoding",null,!0)),t.push(new kN("contentLanguage",null,!0)),t.push(new kN("contentType",null,!0)),t.push(new kN("metadata","customMetadata",!0)),DN=t}function ON(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var a=n[o];r[a.local]=a.xform(r,e[a.server])}return function(r,i){Object.defineProperty(r,"ref",{get:function(){var t=r.bucket,e=r.fullPath,n=new EN(t,e);return i.makeStorageReference(n)}})}(r,t),r}function PN(t,e,n){var r=SN(e);return null===r?null:ON(t,r,n)}function MN(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function xN(t){if(!hN(t)||!t)throw"Expected Metadata object.";for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if("customMetadata"===e){if(!hN(n))throw"Expected object for 'customMetadata' mapping."}else if(hN(r=n)&&null!==r)throw"Mapping for '"+e+"' cannot be an object."}var r}var LN="maxResults",FN=1e3,UN="pageToken",qN="prefixes",VN="items";function BN(t,e){var n={prefixes:[],items:[],nextPageToken:e.nextPageToken},r=t.bucket();if(null===r)throw new RC(PC.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+DC+"' property when initializing the app?");if(e[qN])for(var i=0,o=e[qN];i<o.length;i++){var a=o[i].replace(/\/$/,""),s=t.makeStorageReference(new EN(r,a));n.prefixes.push(s)}if(e[VN])for(var u=0,c=e[VN];u<c.length;u++){var h=c[u];s=t.makeStorageReference(new EN(r,h.name));n.items.push(s)}return n}function jN(t){if(!hN(t)||!t)throw"Expected ListOptions object.";for(var e in t)if(e===LN){if(!fN(n=t[LN])||!Number.isInteger(n)||t[LN]<=0)throw"Expected maxResults to be a positive number.";if(1e3<t[LN])throw"Expected maxResults to be less than or equal to "+FN+"."}else{if(e!==UN)throw"Unknown option: "+e;if(t[UN]&&!lN(t[UN]))throw"Expected pageToken to be string."}var n}var WN=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function QN(t){if(!t)throw xC()}function KN(r,i){return function(t,e){var n=PN(r,e,i);return QN(null!==n),n}}function HN(r){return function(t,e){var n=function(t,e){var n=SN(e);return null===n?null:BN(t,n)}(r,e);return QN(null!==n),n}}function GN(r,i){return function(t,e){var n=PN(r,e,i);return QN(null!==n),function(r,t){var e=SN(t);if(null===e)return null;if(!lN(e.downloadTokens))return null;var n=e.downloadTokens;if(0===n.length)return null;var i=encodeURIComponent;return n.split(",").map(function(t){var e=r.bucket,n=r.fullPath;return CN("/b/"+i(e)+"/o/"+i(n))+NN({alt:"media",token:t})})[0]}(n,e)}}function zN(r){return function(t,e){var n;return(n=401===t.getStatus()?new RC(PC.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?function(t){return new RC(PC.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(r.bucket):403===t.getStatus()?function(t){return new RC(PC.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}(r.path):e).setServerResponseProp(e.serverResponseProp()),n}}function YN(r){var i=zN(r);return function(t,e){var n=i(t,e);return 404===t.getStatus()&&(n=function(t){return new RC(PC.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}(r.path)),n.setServerResponseProp(e.serverResponseProp()),n}}function XN(t,e,n){var r=CN(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new WN(r,"GET",KN(t,n),i);return o.errorHandler=YN(e),o}function JN(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}(null,e)),r}var $N=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function ZN(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){QN(!1)}return QN(!!n&&-1!==(e||["active"]).indexOf(n)),n}function tA(t,a,e,s,n,u,r,i){var c=new $N(0,0);if(r?(c.current=r.current,c.total=r.total):(c.current=0,c.total=s.size()),s.size()!==c.total)throw new RC(PC.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var o=c.total-c.current,h=o;0<n&&(h=Math.min(h,n));var l=c.current,f=l+h,p={"X-Goog-Upload-Command":h===o?"upload, finalize":"upload","X-Goog-Upload-Offset":c.current},d=s.slice(l,f);if(null===d)throw FC();var y=a.maxUploadRetryTime(),m=new WN(e,"POST",function(t,e){var n,r=ZN(t,["active","final"]),i=c.current+h,o=s.size();return n="final"===r?KN(a,u)(t,e):null,new $N(i,o,"final"===r,n)},y);return m.headers=p,m.body=d.uploadData(),m.progressCallback=i||null,m.errorHandler=zN(t),m}var eA=function(t,e,n){if(cN(t)||sN(e)||sN(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},nA=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};function rA(e,t,n){for(var r=t.length,i=t.length,o=0;o<t.length;o++)if(t[o].optional){r=o;break}if(!(r<=n.length&&n.length<=i))throw function(t,e,n,r){var i,o;return o=t===e?1===(i=t)?"argument":"arguments":(i="between "+t+" and "+e,"arguments"),new RC(PC.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+n+"`: Expected "+i+" "+o+", received "+r+".")}(r,i,e,n.length);for(o=0;o<n.length;o++)try{t[o].validator(n[o])}catch(t){throw t instanceof Error?UC(o,e,t.message):UC(o,e,t)}}var iA=function(e,t){var n=this;this.validator=function(t){n.optional&&!uN(t)||e(t)},this.optional=!!t};function oA(t,e){function n(t){if(!lN(t))throw"Expected string."}var r;return r=t?function(e,n){return function(t){e(t),n(t)}}(n,t):n,new iA(r,e)}function aA(t){return new iA(xN,t)}function sA(){return new iA(function(t){if(!(fN(t)&&0<=t))throw"Expected a number 0 or greater."})}function uA(e,t){return new iA(function(t){if(!(null===t||sN(t)&&t instanceof Object))throw"Expected an Object.";null!=e&&e(t)},t)}function cA(t){return new iA(function(t){if(!(null===t||cN(t)))throw"Expected a Function."},t)}function hA(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Promise.resolve().then(function(){return n.apply(void 0,t)})}}var lA=(fA.prototype.makeProgressCallback_=function(){var e=this,n=this.transferred_;return function(t){return e.updateProgress_(n+t)}},fA.prototype.shouldDoResumable_=function(t){return 262144<t.size()},fA.prototype.start_=function(){this.state_===$C&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},fA.prototype.resolveToken_=function(e){var n=this;this.authWrapper_.getAuthToken().then(function(t){switch(n.state_){case $C:e(t);break;case nN:n.transition_(rN);break;case ZC:n.transition_(tN)}})},fA.prototype.createResumable_=function(){var r=this;this.resolveToken_(function(t){var e=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a=JN(e,r,i),s={name:a.fullPath},u=CN(o),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},h=MN(a,n),l=t.maxUploadRetryTime(),f=new WN(u,"POST",function(t){var e;ZN(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){QN(!1)}return QN(lN(e)),e},l);return f.urlParams=s,f.headers=c,f.body=h,f.errorHandler=zN(e),f}(r.authWrapper_,r.location_,r.mappings_,r.blob_,r.metadata_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.uploadUrl_=t,r.needToFetchStatus_=!1,r.completeTransitions_()},r.errorHandler_)})},fA.prototype.fetchStatus_=function(){var r=this,i=this.uploadUrl_;this.resolveToken_(function(t){var e=function(t,e,n,i){var r=t.maxUploadRetryTime(),o=new WN(n,"POST",function(t){var e=ZN(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){QN(!1)}n||QN(!1);var r=Number(n);return QN(!isNaN(r)),new $N(r,i.size(),"final"===e)},r);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=zN(e),o}(r.authWrapper_,r.location_,i,r.blob_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){t=t,r.request_=null,r.updateProgress_(t.current),r.needToFetchStatus_=!1,t.finalized&&(r.needToFetchMetadata_=!0),r.completeTransitions_()},r.errorHandler_)})},fA.prototype.continueUpload_=function(){var r=this,i=262144*this.chunkMultiplier_,o=new $N(this.transferred_,this.blob_.size()),a=this.uploadUrl_;this.resolveToken_(function(t){var e;try{e=tA(r.location_,r.authWrapper_,a,r.blob_,i,r.mappings_,o,r.makeProgressCallback_())}catch(t){return r.error_=t,void r.transition_(iN)}var n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.increaseMultiplier_(),r.request_=null,r.updateProgress_(t.current),t.finalized?(r.metadata_=t.metadata,r.transition_(eN)):r.completeTransitions_()},r.errorHandler_)})},fA.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},fA.prototype.fetchMetadata_=function(){var r=this;this.resolveToken_(function(t){var e=XN(r.authWrapper_,r.location_,r.mappings_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.transition_(eN)},r.metadataErrorHandler_)})},fA.prototype.oneShotUpload_=function(){var r=this;this.resolveToken_(function(t){var e=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=JN(e,r,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+MN(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+s+"--",l=wN.getBlob(c,r,h);if(null===l)throw FC();var f={name:u.fullPath},p=CN(o),d=t.maxUploadRetryTime(),y=new WN(p,"POST",KN(t,n),d);return y.urlParams=f,y.headers=a,y.body=l.uploadData(),y.errorHandler=zN(e),y}(r.authWrapper_,r.location_,r.mappings_,r.blob_,r.metadata_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.updateProgress_(r.blob_.size()),r.transition_(eN)},r.errorHandler_)})},fA.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},fA.prototype.transition_=function(t){if(this.state_!==t)switch(t){case nN:case ZC:this.state_=t,null!==this.request_&&this.request_.cancel();break;case $C:var e=this.state_===tN;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case tN:this.state_=t,this.notifyObservers_();break;case rN:this.error_=LC(),this.state_=t,this.notifyObservers_();break;case iN:case eN:this.state_=t,this.notifyObservers_()}},fA.prototype.completeTransitions_=function(){switch(this.state_){case ZC:this.transition_(tN);break;case nN:this.transition_(rN);break;case $C:this.start_()}},Object.defineProperty(fA.prototype,"snapshot",{get:function(){var t=aN(this.state_);return new nA(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),fA.prototype.on=function(t,e,n,o){var r="Expected a function or an Object with one of `next`, `error`, `complete` properties.",i=cA(!0).validator,a=uA(null,!0).validator;function s(t){try{return void i(t)}catch(t){}try{if(a(t),!(uN(t.next)||uN(t.error)||uN(t.complete)))throw"";return}catch(t){throw r}}rA("on",[oA(function(){if(t!==JC.STATE_CHANGED)throw"Expected one of the event types: ["+JC.STATE_CHANGED+"]."}),uA(s,!0),cA(!0),cA(!0)],arguments);var u=this;function c(i){return function(t,e,n){null!==i&&rA("on",i,arguments);var r=new eA(t,e,o);return u.addObserver_(r),function(){u.removeObserver_(r)}}}var h=[uA(function(t){if(null===t)throw r;s(t)}),cA(!0),cA(!0)];return uN(e)||uN(n)||uN(o)?c(null)(e,n,o):c(h)},fA.prototype.then=function(t,e){return this.promise_.then(t,e)},fA.prototype.catch=function(t){return this.then(null,t)},fA.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},fA.prototype.removeObserver_=function(t){var e=this.observers_.indexOf(t);-1!==e&&this.observers_.splice(e,1)},fA.prototype.notifyObservers_=function(){var e=this;this.finishPromise_(),this.observers_.slice().forEach(function(t){e.notifyObserver_(t)})},fA.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(aN(this.state_)){case oN.SUCCESS:hA(this.resolve_.bind(null,this.snapshot))();break;case oN.CANCELED:case oN.ERROR:hA(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},fA.prototype.notifyObserver_=function(t){switch(aN(this.state_)){case oN.RUNNING:case oN.PAUSED:t.next&&hA(t.next.bind(t,this.snapshot))();break;case oN.SUCCESS:t.complete&&hA(t.complete.bind(t))();break;case oN.CANCELED:case oN.ERROR:t.error&&hA(t.error.bind(t,this.error_))();break;default:t.error&&hA(t.error.bind(t,this.error_))()}},fA.prototype.resume=function(){rA("resume",[],arguments);var t=this.state_===tN||this.state_===ZC;return t&&this.transition_($C),t},fA.prototype.pause=function(){rA("pause",[],arguments);var t=this.state_===$C;return t&&this.transition_(ZC),t},fA.prototype.cancel=function(){rA("cancel",[],arguments);var t=this.state_===$C||this.state_===ZC;return t&&this.transition_(nN),t},fA);function fA(t,e,n,r,i,o){var a=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=$C,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals(PC.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(iN))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals(PC.CANCELED)?a.completeTransitions_():(a.error_=t,a.transition_(iN))},this.promise_=new Promise(function(t,e){a.resolve_=t,a.reject_=e,a.start_()}),this.promise_.then(null,function(){})}var pA=(dA.prototype.toString=function(){return rA("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},dA.prototype.newRef=function(t,e){return new dA(t,e)},dA.prototype.mappings=function(){return RN()},dA.prototype.child=function(t){rA("child",[oA()],arguments);var e=function(t,e){var n=e.split("/").filter(function(t){return 0<t.length}).join("/");return 0===t.length?n:t+"/"+n}(this.location.path,t),n=new EN(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(dA.prototype,"parent",{get:function(){var t=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new EN(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(dA.prototype,"root",{get:function(){var t=new EN(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(dA.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(dA.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(dA.prototype,"name",{get:function(){return IN(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(dA.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),dA.prototype.put=function(t,e){return void 0===e&&(e=null),rA("put",[new iA(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||dN()&&t instanceof Blob))throw"Expected Blob or File."}),aA(!0)],arguments),this.throwIfRoot_("put"),new lA(this,this.authWrapper,this.location,this.mappings(),new wN(t),e)},dA.prototype.putString=function(t,e,n){void 0===e&&(e=jC.RAW),rA("putString",[oA(),oA(WC,!0),aA(!0)],arguments),this.throwIfRoot_("putString");var r=KC(e,t),i=Object.assign({},n);return!sN(i.contentType)&&sN(r.contentType)&&(i.contentType=r.contentType),new lA(this,this.authWrapper,this.location,this.mappings(),new wN(r.data,!0),i)},dA.prototype.delete=function(){var n=this;return rA("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e){var n=CN(e.fullServerUrl()),r=t.maxOperationRetryTime(),i=new WN(n,"DELETE",function(t,e){},r);return i.successCodes=[200,204],i.errorHandler=YN(e),i}(n.authWrapper,n.location);return n.authWrapper.makeRequest(e,t).getPromise()})},dA.prototype.listAll=function(){rA("listAll",[],arguments);var t={prefixes:[],items:[]};return this.listAllHelper(t).then(function(){return t})},dA.prototype.listAllHelper=function(o,a){return hi(this,void 0,void 0,function(){var e,n,r,i;return li(this,function(t){switch(t.label){case 0:return e={pageToken:a},[4,this.list(e)];case 1:return n=t.sent(),(r=o.prefixes).push.apply(r,n.prefixes),(i=o.items).push.apply(i,n.items),null==n.nextPageToken?[3,3]:[4,this.listAllHelper(o,n.nextPageToken)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},dA.prototype.list=function(r){rA("list",[function(t){return new iA(jN,t)}(!0)],arguments);var i=this;return this.authWrapper.getAuthToken().then(function(t){var e=r||{},n=function(t,e,n,r,i){var o={};e.isRoot?o.prefix="":o.prefix=e.path+"/",n&&0<n.length&&(o.delimiter=n),r&&(o.pageToken=r),i&&(o.maxResults=i);var a=CN(e.bucketOnlyServerUrl()),s=t.maxOperationRetryTime(),u=new WN(a,"GET",HN(t),s);return u.urlParams=o,u.errorHandler=zN(e),u}(i.authWrapper,i.location,"/",e.pageToken,e.maxResults);return i.authWrapper.makeRequest(n,t).getPromise()})},dA.prototype.getMetadata=function(){var n=this;return rA("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then(function(t){var e=XN(n.authWrapper,n.location,n.mappings());return n.authWrapper.makeRequest(e,t).getPromise()})},dA.prototype.updateMetadata=function(n){var r=this;return rA("updateMetadata",[aA()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e,n,r){var i=CN(e.fullServerUrl()),o=MN(n,r),a=t.maxOperationRetryTime(),s=new WN(i,"PATCH",KN(t,r),a);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=o,s.errorHandler=YN(e),s}(r.authWrapper,r.location,n,r.mappings());return r.authWrapper.makeRequest(e,t).getPromise()})},dA.prototype.getDownloadURL=function(){var n=this;return rA("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e,n){var r=CN(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new WN(r,"GET",GN(t,n),i);return o.errorHandler=YN(e),o}(n.authWrapper,n.location,n.mappings());return n.authWrapper.makeRequest(e,t).getPromise().then(function(t){if(null===t)throw new RC(PC.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t})})},dA.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new RC(PC.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},dA);function dA(t,e){this.authWrapper=t,this.location=e instanceof EN?e:EN.makeFromUrl(e)}var yA=(mA.prototype.getPromise=function(){return this.promise_},mA.prototype.cancel=function(t){},mA);function mA(t){this.promise_=Promise.reject(t)}var vA=(gA.prototype.addRequest=function(t){var e=this,n=this.id;this.id++,this.map.set(n,t),t.getPromise().then(function(){return e.map.delete(n)},function(){return e.map.delete(n)})},gA.prototype.clear=function(){this.map.forEach(function(t){t&&t.cancel(!0)}),this.map.clear()},gA);function gA(){this.map=new Map,this.id=-9007199254740991}var bA=(wA.extractBucket_=function(t){var e=t[DC]||null;return null==e?null:EN.makeFromBucketSpec(e).bucket},wA.prototype.getAuthToken=function(){return null!==this.app_&&sN(this.app_.INTERNAL)&&sN(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(t){return null!==t?t.accessToken:null},function(){return null}):Promise.resolve(null)},wA.prototype.bucket=function(){if(this.deleted_)throw qC();return this.bucket_},wA.prototype.service=function(){return this.service_},wA.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},wA.prototype.makeRequest=function(t,e){if(this.deleted_)return new yA(qC());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},wA.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},wA.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},wA.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},wA.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},wA.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},wA);function wA(t,e,n,r,i){if(this.bucket_=null,this.deleted_=!1,this.app_=t,null!==this.app_){var o=this.app_.options;sN(o)&&(this.bucket_=wA.extractBucket_(o))}this.storageRefMaker_=e,this.requestMaker_=n,this.pool_=i,this.service_=r,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e4,this.requestMap_=new vA}var _A=(EA.prototype.start_=function(){var s=this;function t(t,e){var n,r=s.resolve_,i=s.reject_,o=e.xhr;if(e.wasSuccessCode)try{var a=s.callback_(o,o.getResponseText());uN(a)?r(a):r()}catch(t){i(t)}else null!==o?((n=xC()).setServerResponseProp(o.getResponseText()),s.errorCallback_?i(s.errorCallback_(o,n)):i(n)):e.canceled?i(n=s.appDelete_?qC():LC()):i(n=new RC(PC.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?t(0,new TA(!1,null,!0)):this.backoffId_=function(e,n,t){var r=1,i=null,o=!1,a=0;function s(){return 2===a}var u=!1;function c(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];u||(u=!0,n.apply(null,t))}function h(t){i=setTimeout(function(){i=null,e(l,s())},t)}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];u||(t?c.call.apply(c,[null,t].concat(e)):s()||o?c.call.apply(c,[null,t].concat(e)):(r<64&&(r*=2),h(1===a?(a=2,0):1e3*(r+Math.random()))))}var f=!1;function p(t){f||(f=!0,u||(null!==i?(t||(a=2),clearTimeout(i),h(0)):t||(a=1)))}return h(0),setTimeout(function(){p(o=!0)},t),p}(function(o,t){if(t)o(!1,new TA(!1,null,!0));else{var e=s.pool_.createXhrIo();s.pendingXhr_=e,null!==s.progressCallback_&&e.addUploadProgressListener(a),e.send(s.url_,s.method_,s.body_,s.headers_).then(function(t){null!==s.progressCallback_&&t.removeUploadProgressListener(a),s.pendingXhr_=null;var e=(t=t).getErrorCode()===YC.NO_ERROR,n=t.getStatus();if(e&&!s.isRetryStatusCode_(n)){var r=-1!==s.successCodes_.indexOf(n);o(!0,new TA(r,t))}else{var i=t.getErrorCode()===YC.ABORT;o(!1,new TA(!1,null,i))}})}function a(t){var e=t.loaded,n=t.lengthComputable?t.total:-1;null!==s.progressCallback_&&s.progressCallback_(e,n)}},t,this.timeout_)},EA.prototype.getPromise=function(){return this.promise_},EA.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&function(t){t(!1)}(this.backoffId_),null!==this.pendingXhr_&&this.pendingXhr_.abort()},EA.prototype.isRetryStatusCode_=function(t){var e=500<=t&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},EA);function EA(t,e,n,r,i,o,a,s,u,c,h){var l=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=h,this.promise_=new Promise(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}var TA=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function SA(t,e,n){var r=NN(t.urlParams),i=t.url+r,o=Object.assign({},t.headers);return function(t,e){null!==e&&0<e.length&&(t.Authorization="Firebase "+e)}(o,e),function(t){var e=void 0!==fl?fl.SDK_VERSION:"AppManager";t["X-Firebase-Storage-Version"]="webjs/"+e}(o),new _A(i,t.method,o,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var IA=(CA.prototype.ref=function(t){if(rA("ref",[oA(function(t){if("string"!=typeof t)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new pA(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},CA.prototype.refFromURL=function(t){return rA("refFromURL",[oA(function(t){if("string"!=typeof t)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{EN.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new pA(this.authWrapper_,t)},Object.defineProperty(CA.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),CA.prototype.setMaxUploadRetryTime=function(t){rA("setMaxUploadRetryTime",[sA()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},CA.prototype.setMaxOperationRetryTime=function(t){rA("setMaxOperationRetryTime",[sA()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(CA.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(CA.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),CA);function CA(t,e,n){if(this.bucket_=null,this.authWrapper_=new bA(t,function(t,e){return new pA(t,e)},SA,this,e),this.app_=t,null!=n)this.bucket_=EN.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new EN(r,""))}this.internals_=new NA(this)}var NA=(AA.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},AA);function AA(t){this.service_=t}var kA;function DA(t,e,n){return new IA(t,new vN,n)}function RA(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function OA(n,r,i){var o,t=new Promise(function(t,e){RA(o=n[r].apply(n,i)).then(t,e)});return t.request=o,t}function PA(t,n,e){e.forEach(function(e){Object.defineProperty(t.prototype,e,{get:function(){return this[n][e]},set:function(t){this[n][e]=t}})})}function MA(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return OA(this[n],t,arguments)})})}function xA(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return this[n][t].apply(this[n],arguments)})})}function LA(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return function(t,e,n){var r=OA(t,e,n);return r.then(function(t){if(t)return new UA(t,r.request)})}(this[n],t,arguments)})})}function FA(t){this._index=t}function UA(t,e){this._cursor=t,this._request=e}function qA(t){this._store=t}function VA(n){this._tx=n,this.complete=new Promise(function(t,e){n.oncomplete=function(){t()},n.onerror=function(){e(n.error)},n.onabort=function(){e(n.error)}})}function BA(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new VA(n)}function jA(t){this._db=t}kA={TaskState:oN,TaskEvent:JC,StringFormat:jC,Storage:IA,Reference:pA},fl.INTERNAL.registerService("storage",DA,kA,void 0,!0),PA(FA,"_index",["name","keyPath","multiEntry","unique"]),MA(FA,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),LA(FA,"_index",IDBIndex,["openCursor","openKeyCursor"]),PA(UA,"_cursor",["direction","key","primaryKey","value"]),MA(UA,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(UA.prototype[n]=function(){var e=this,t=arguments;return Promise.resolve().then(function(){return e._cursor[n].apply(e._cursor,t),RA(e._request).then(function(t){if(t)return new UA(t,e._request)})})})}),qA.prototype.createIndex=function(){return new FA(this._store.createIndex.apply(this._store,arguments))},qA.prototype.index=function(){return new FA(this._store.index.apply(this._store,arguments))},PA(qA,"_store",["name","keyPath","indexNames","autoIncrement"]),MA(qA,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),LA(qA,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),xA(qA,"_store",IDBObjectStore,["deleteIndex"]),VA.prototype.objectStore=function(){return new qA(this._tx.objectStore.apply(this._tx,arguments))},PA(VA,"_tx",["objectStoreNames","mode"]),xA(VA,"_tx",IDBTransaction,["abort"]),BA.prototype.createObjectStore=function(){return new qA(this._db.createObjectStore.apply(this._db,arguments))},PA(BA,"_db",["name","version","objectStoreNames"]),xA(BA,"_db",IDBDatabase,["deleteObjectStore","close"]),jA.prototype.transaction=function(){return new VA(this._db.transaction.apply(this._db,arguments))},PA(jA,"_db",["name","version","objectStoreNames"]),xA(jA,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(i){[qA,FA].forEach(function(t){i in t.prototype&&(t.prototype[i.replace("open","iterate")]=function(){var t=function(t){return Array.prototype.slice.call(t)}(arguments),e=t[t.length-1],n=this._store||this._index,r=n[i].apply(n,t.slice(0,-1));r.onsuccess=function(){e(r.result)}})})}),[FA,qA].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,n){var r=this,i=[];return new Promise(function(e){r.iterateCursor(t,function(t){t?(i.push(t.value),void 0===n||i.length!=n?t.continue():e(i)):e(i)})})})});var WA,QA=1e4,KA="w:0.2.6",HA="FIS_v2",GA="https://firebaseinstallations.googleapis.com/v1",zA=36e5,YA=((WA={})["missing-app-config-values"]="Missing App configuration values.",WA["create-installation-failed"]="Could not register Firebase Installation.",WA["generate-token-failed"]="Could not generate Auth Token.",WA["not-registered"]="Firebase Installation is not registered.",WA["installation-not-found"]="Firebase Installation not found.",WA["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',WA["app-offline"]="Could not process request. Application offline.",WA["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",WA),XA=new Oi("installations","Installations",YA);function JA(t){return t instanceof Di&&t.code.includes("request-failed")}function $A(t){if(!t||!t.options)throw XA.create("missing-app-config-values");var e=t.name,n=t.options,r=n.projectId,i=n.apiKey,o=n.appId;if(!(e&&r&&i&&o))throw XA.create("missing-app-config-values");return{appName:e,projectId:r,apiKey:i,appId:o}}function ZA(t){var e=t.projectId;return GA+"/projects/"+e+"/installations"}function tk(t){return{token:t.token,requestStatus:2,expiresIn:function(t){return Number(t.replace("s","000"))}(t.expiresIn),creationTime:Date.now()}}function ek(r,i){return hi(this,void 0,void 0,function(){var e,n;return li(this,function(t){switch(t.label){case 0:return[4,i.json()];case 1:return e=t.sent(),n=e.error,[2,XA.create("request-failed",{requestName:r,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})]}})})}function nk(t){var e=t.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function rk(t,e){var n=e.refreshToken,r=nk(t);return r.append("Authorization",function(t){return HA+" "+t}(n)),r}function ik(n){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:return[4,n()];case 1:return 500<=(e=t.sent()).status&&e.status<600?[2,n()]:[2,e]}})})}function ok(e){return new Promise(function(t){setTimeout(t,e)})}var ak=/^[cdef][\w-]{21}$/,sk="";function uk(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){return function(t){return btoa(String.fromCharCode.apply(String,di(t))).replace(/\+/g,"-").replace(/\//g,"_")}(t).substr(0,22)}(t);return ak.test(e)?e:sk}catch(t){return sk}}var ck="firebase-installations-database",hk=1,lk="firebase-installations-store",fk=null;function pk(){return fk=fk||function(t,e,n){var r=OA(indexedDB,"open",[t,e]),i=r.request;return i&&(i.onupgradeneeded=function(t){n&&n(new BA(i.result,t.oldVersion,i.transaction))}),r.then(function(t){return new jA(t)})}(ck,hk,function(t){switch(t.oldVersion){case 0:t.createObjectStore(lk)}})}function dk(i,o){return hi(this,void 0,void 0,function(){var e,n,r;return li(this,function(t){switch(t.label){case 0:return e=vk(i),[4,pk()];case 1:return n=t.sent(),[4,(r=n.transaction(lk,"readwrite")).objectStore(lk).put(o,e)];case 2:return t.sent(),[4,r.complete];case 3:return t.sent(),[2,o]}})})}function yk(i){return hi(this,void 0,void 0,function(){var e,n,r;return li(this,function(t){switch(t.label){case 0:return e=vk(i),[4,pk()];case 1:return n=t.sent(),[4,(r=n.transaction(lk,"readwrite")).objectStore(lk).delete(e)];case 2:return t.sent(),[4,r.complete];case 3:return t.sent(),[2]}})})}function mk(s,u){return hi(this,void 0,void 0,function(){var e,n,r,i,o,a;return li(this,function(t){switch(t.label){case 0:return e=vk(s),[4,pk()];case 1:return n=t.sent(),r=n.transaction(lk,"readwrite"),[4,(i=r.objectStore(lk)).get(e)];case 2:return o=t.sent(),(a=u(o))===o?[2,a]:void 0!==a?[3,4]:[4,i.delete(e)];case 3:return t.sent(),[3,6];case 4:return[4,i.put(a,e)];case 5:t.sent(),t.label=6;case 6:return[4,r.complete];case 7:return t.sent(),[2,a]}})})}function vk(t){return t.appName+"!"+t.appId}function gk(i){return hi(this,void 0,void 0,function(){var r,e,n;return li(this,function(t){switch(t.label){case 0:return[4,mk(i,function(t){var e=function(t){var e=t||{fid:uk(),registrationStatus:0};if(wk(e))return{fid:e.fid,registrationStatus:0};return e}(t),n=function(t,e){{if(0!==e.registrationStatus)return 1===e.registrationStatus?{installationEntry:e,registrationPromise:function(n){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:return[4,bk(n)];case 1:e=t.sent(),t.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,ok(100)];case 3:return t.sent(),[4,bk(n)];case 4:return e=t.sent(),[3,2];case 5:if(0===e.registrationStatus)throw XA.create("create-installation-failed");return[2,e]}})})}(t)}:{installationEntry:e};if(!navigator.onLine){var n=Promise.reject(XA.create("app-offline"));return{installationEntry:e,registrationPromise:n}}var r={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=function(r,i){return hi(this,void 0,void 0,function(){var e,n;return li(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,7]),[4,function(s,t){var u=t.fid;return hi(this,void 0,void 0,function(){var e,n,r,i,o,a;return li(this,function(t){switch(t.label){case 0:return e=ZA(s),n=nk(s),r={fid:u,authVersion:HA,appId:s.appId,sdkVersion:KA},i={method:"POST",headers:n,body:JSON.stringify(r)},[4,ik(function(){return fetch(e,i)})];case 1:return(o=t.sent()).ok?[4,o.json()]:[3,3];case 2:return a=t.sent(),[2,{fid:a.fid||u,registrationStatus:2,refreshToken:a.refreshToken,authToken:tk(a.authToken)}];case 3:return[4,ek("Create Installation",o)];case 4:throw t.sent()}})})}(r,i)];case 1:return e=t.sent(),[2,dk(r,e)];case 2:return JA(n=t.sent())&&409===n.serverCode?[4,yk(r)]:[3,4];case 3:return t.sent(),[3,6];case 4:return[4,dk(r,{fid:i.fid,registrationStatus:0})];case 5:t.sent(),t.label=6;case 6:throw n;case 7:return[2]}})})}(t,r);return{installationEntry:r,registrationPromise:i}}}(i,e);return r=n.registrationPromise,n.installationEntry})];case 1:return(e=t.sent()).fid!==sk?[3,3]:(n={},[4,r]);case 2:return[2,(n.installationEntry=t.sent(),n)];case 3:return[2,{installationEntry:e,registrationPromise:r}]}})})}function bk(t){return mk(t,function(t){if(!t)throw XA.create("installation-not-found");return wk(t)?{fid:t.fid,registrationStatus:0}:t})}function wk(t){return 1===t.registrationStatus&&t.registrationTime+QA<Date.now()}function _k(s,u){return hi(this,void 0,void 0,function(){var e,n,r,i,o,a;return li(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=e.fid;return ZA(t)+"/"+n+"/authTokens:generate"}(s,u),n=rk(s,u),r={installation:{sdkVersion:KA}},i={method:"POST",headers:n,body:JSON.stringify(r)},[4,ik(function(){return fetch(e,i)})];case 1:return(o=t.sent()).ok?[4,o.json()]:[3,3];case 2:return a=t.sent(),[2,tk(a)];case 3:return[4,ek("Generate Auth Token",o)];case 4:throw t.sent()}})})}function Ek(i){return hi(this,void 0,void 0,function(){var r,e,n;return li(this,function(t){switch(t.label){case 0:return[4,mk(i,function(t){if(!Sk(t))throw XA.create("not-registered");var e=t.authToken;if(function(t){return 2===t.requestStatus&&!function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+zA}(t)}(e))return t;if(1===e.requestStatus)return r=function(r){return hi(this,void 0,void 0,function(){var e,n;return li(this,function(t){switch(t.label){case 0:return[4,Tk(r)];case 1:e=t.sent(),t.label=2;case 2:return 1!==e.authToken.requestStatus?[3,5]:[4,ok(100)];case 3:return t.sent(),[4,Tk(r)];case 4:return e=t.sent(),[3,2];case 5:if(0===(n=e.authToken).requestStatus)throw XA.create("generate-token-failed");return[2,n]}})})}(i),t;if(!navigator.onLine)throw XA.create("app-offline");var n=function(t){var e={requestStatus:1,requestTime:Date.now()};return ci({},t,{authToken:e})}(t);return r=function(i,o){return hi(this,void 0,void 0,function(){var e,n,r;return li(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,8]),[4,_k(i,o)];case 1:return e=t.sent(),r=ci({},o,{authToken:e}),[4,dk(i,r)];case 2:return t.sent(),[2,e];case 3:return!JA(n=t.sent())||401!==n.serverCode&&404!==n.serverCode?[3,5]:[4,yk(i)];case 4:return t.sent(),[3,7];case 5:return r=ci({},o,{authToken:{requestStatus:0}}),[4,dk(i,r)];case 6:t.sent(),t.label=7;case 7:throw n;case 8:return[2]}})})}(i,n),n})];case 1:return e=t.sent(),r?[4,r]:[3,3];case 2:return n=t.sent(),[3,4];case 3:n=e.authToken,t.label=4;case 4:return[2,n.token]}})})}function Tk(t){return mk(t,function(t){if(!Sk(t))throw XA.create("not-registered");return function(t){return 1===t.requestStatus&&t.requestTime+QA<Date.now()}(t.authToken)?ci({},t,{authToken:{requestStatus:0}}):t})}function Sk(t){return void 0!==t&&2===t.registrationStatus}function Ik(n){return hi(this,void 0,void 0,function(){var e;return li(this,function(t){switch(t.label){case 0:return[4,function(i){return hi(this,void 0,void 0,function(){var e,n,r;return li(this,function(t){switch(t.label){case 0:return[4,gk(i)];case 1:return e=t.sent(),n=e.installationEntry,(r=e.registrationPromise)?[4,r]:[3,3];case 2:return t.sent(),[3,4];case 3:if(2!==n.registrationStatus)throw XA.create("create-installation-failed");t.label=4;case 4:return[2]}})})}(e=$A(n))];case 1:return t.sent(),[2,Ek(e)]}})})}function Ck(o,a){return hi(this,void 0,void 0,function(){var e,n,r,i;return li(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=e.fid;return ZA(t)+"/"+n}(o,a),n=rk(o,a),r={method:"DELETE",headers:n},[4,ik(function(){return fetch(e,r)})];case 1:return(i=t.sent()).ok?[3,3]:[4,ek("Delete Installation",i)];case 2:throw t.sent();case 3:return[2]}})})}fl.INTERNAL.registerService("installations",function(t){return $A(t),{app:t,getId:function(){return function(o){return hi(this,void 0,void 0,function(){var e,n,r,i;return li(this,function(t){switch(t.label){case 0:return[4,gk(e=$A(o))];case 1:return n=t.sent(),r=n.installationEntry,(i=n.registrationPromise)&&i.catch(function(){}),2===r.registrationStatus&&Ek(e).catch(function(){}),[2,r.fid]}})})}(t)},getToken:function(){return Ik(t)},delete:function(){return function(r){return hi(this,void 0,void 0,function(){var e,n;return li(this,function(t){switch(t.label){case 0:return[4,mk(e=$A(r),function(t){if(!t||0!==t.registrationStatus)return t})];case 1:if(!(n=t.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw XA.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw XA.create("app-offline");case 3:return[4,Ck(e,n)];case 4:return t.sent(),[4,yk(e)];case 5:t.sent(),t.label=6;case 6:return[2]}})})}(t)}}});var Nk,Ak,kk,Dk,Rk="0.2.18",Ok="FB-PERF-TRACE-MEASURE",Pk="@firebase/performance/config",Mk="@firebase/performance/configexpire",xk="Performance",Lk=((Nk={})["trace started"]="Trace {$traceName} was started before.",Nk["trace stopped"]="Trace {$traceName} is not running.",Nk["no window"]="Window is not available.",Nk["no app id"]="App id is not available.",Nk["no project id"]="Project id is not available.",Nk["no api key"]="Api key is not available.",Nk["invalid cc log"]="Attempted to queue invalid cc event",Nk["FB not default"]="Performance can only start when Firebase app instance is the default one.",Nk["RC response not ok"]="RC response is not ok",Nk["invalid attribute name"]="Attribute name {$attributeName} is invalid.",Nk["invalid attribute value"]="Attribute value {$attributeValue} is invalid.",Nk["invalide custom metric name"]="Custom metric name {$customMetricName} is invalid",Nk),Fk=new Oi("performance",xk,Lk),Uk=(qk.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},qk.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},qk.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},qk.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},qk.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},qk.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},qk.prototype.requiredApisAvailable=function(){return!!(fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled)},qk.prototype.setupObserver=function(t,i){this.PerformanceObserver&&new this.PerformanceObserver(function(t){for(var e=0,n=t.getEntries();e<n.length;e++){var r=n[e];i(r)}}).observe({entryTypes:[t]})},qk.getInstance=function(){return void 0===Ak&&(Ak=new qk(kk)),Ak},qk);function qk(t){if(!t)throw Fk.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}var Vk,Bk,jk,Wk=(Qk.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw Fk.create("no app id");return t},Qk.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw Fk.create("no project id");return t},Qk.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw Fk.create("no api key");return t},Qk.getInstance=function(){return void 0===Dk&&(Dk=new Qk),Dk},Qk);function Qk(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}function Kk(){return Vk}(jk=Bk=Bk||{})[jk.UNKNOWN=0]="UNKNOWN",jk[jk.VISIBLE=1]="VISIBLE",jk[jk.HIDDEN=2]="HIDDEN",jk[jk.PRERENDER=3]="PRERENDER",jk[jk.UNLOADED=4]="UNLOADED";var Hk=["firebase_","google_","ga_"],Gk=new RegExp("^[a-zA-Z]\\w*$");function zk(){switch(Uk.getInstance().document.visibilityState){case"visible":return Bk.VISIBLE;case"hidden":return Bk.HIDDEN;case"prerender":return Bk.PRERENDER;default:return Bk.UNKNOWN}}var Yk=new io(xk);Yk.logLevel=Zi.INFO;var Xk="0.0.1",Jk={loggingEnabled:!0},$k="FIREBASE_INSTALLATIONS_AUTH";function Zk(t){var e=function(){var t=Uk.getInstance().localStorage,e=t.getItem(Mk);if(!e||!function(t){return Number(t)>Date.now()}(e))return;var n=t.getItem(Pk);if(!n)return;try{return JSON.parse(n)}catch(t){return}}();return e?(eD(e),Promise.resolve()):function(r){return function(){var t=Wk.getInstance().firebaseAppInstance.installations().getToken();return t.then(function(t){}),t}().then(function(t){var e="https://firebaseremoteconfig.googleapis.com/v1/projects/"+Wk.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+Wk.getInstance().getApiKey(),n=new Request(e,{method:"POST",headers:{Authorization:$k+" "+t},body:JSON.stringify({app_instance_id:r,app_instance_id_token:t,app_id:Wk.getInstance().getAppId(),app_version:Rk,sdk_version:Xk})});return fetch(n).then(function(t){if(t.ok)return t.json();throw Fk.create("RC response not ok")})}).catch(function(){Yk.info(tD)})}(t).then(function(t){return eD(t)}).then(function(t){return function(t){if(!t)return;var e=Uk.getInstance().localStorage;e.setItem(Pk,JSON.stringify(t)),e.setItem(Mk,String(Date.now()+60*Wk.getInstance().configTimeToLive*60*1e3))}(t)},function(){})}var tD="Could not fetch config, will use default configs";function eD(t){if(!t)return t;var e=Wk.getInstance(),n=t.entries||{};return void 0!==n.fpr_enabled?e.loggingEnabled="true"===String(n.fpr_enabled):e.loggingEnabled=Jk.loggingEnabled,n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=nD(e.tracesSamplingRate),e.logNetworkAfterSampling=nD(e.networkRequestsSamplingRate),t}function nD(t){return Math.random()<=t}var rD,iD=1;function oD(){return iD=2,rD=rD||function(){var n=Uk.getInstance().document;return new Promise(function(t){if(n&&"complete"!==n.readyState){var e=function(){"complete"===n.readyState&&(n.removeEventListener("readystatechange",e),t())};n.addEventListener("readystatechange",e)}else t()})}().then(function(){return function(){var t=Wk.getInstance().firebaseAppInstance.installations().getId();return t.then(function(t){Vk=t}),t}()}).then(function(t){return Zk(t)}).then(function(){return aD()},function(){return aD()})}function aD(){iD=3}var sD,uD=1e4,cD=3,hD=cD,lD=[];function fD(i){return function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];!function(t){if(!t.eventTime||!t.message)throw Fk.create("invalid cc log");lD=lD.concat([t])}({message:i.apply(void 0,n),eventTime:Date.now()})}}function pD(){if(sD)return sD;var t=fD(mD);return(sD=new io("@firebase/performance/cc")).logHandler=t,sD}function dD(t){var e=Wk.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&Uk.getInstance().requiredApisAvailable()&&(t.isAuto&&zk()!==Bk.VISIBLE||e.loggingEnabled&&e.logTraceAfterSampling&&(3===iD?yD(t):oD().then(function(){return yD(t)},function(){return yD(t)})))}function yD(t){Kk()&&setTimeout(function(){return pD().log(t,1)},0)}function mD(t,e){return 0===e?function(t){var e={url:t.url,http_method:t.httpMethod||0,http_response_code:200,response_payload_bytes:t.responsePayloadBytes,client_start_time_us:t.startTimeUs,time_to_response_initiated_us:t.timeToResponseInitiatedUs,time_to_response_completed_us:t.timeToResponseCompletedUs},n={application_info:vD(),network_request_metric:e};return JSON.stringify(n)}(t):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=gD(t.counters));var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=gD(n));var r={application_info:vD(),trace_metric:e};return JSON.stringify(r)}(t)}function vD(){return{google_app_id:Wk.getInstance().getAppId(),app_instance_id:Kk(),web_app_info:{sdk_version:Rk,page_url:Uk.getInstance().getUrl(),service_worker_status:function(){var t=Uk.getInstance().navigator;return"serviceWorker"in t?t.serviceWorker.controller?2:3:1}(),visibility_state:zk(),effective_connection_type:function(){var t=Uk.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0}}function gD(e){return Object.keys(e).map(function(t){return{key:t,value:e[t]}})}!function r(t){setTimeout(function(){if(0!==hD){if(!lD.length)return r(uD);var t=lD.slice();lD=[];var e=t.map(function(t){return{source_extension_json:t.message,event_time_ms:String(t.eventTime)}}),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:Wk.getInstance().logSource,log_event:e};fetch(Wk.getInstance().logEndPointUrl,{method:"POST",body:JSON.stringify(n)}).then(function(t){return t.ok||Yk.info("Call to Firebase backend failed."),t.json()}).then(function(t){var e=Number(t.next_request_wait_millis),n=isNaN(e)?uD:Math.max(uD,e);hD=cD,r(n)}).catch(function(){lD=t.concat(lD),hD--,Yk.info("Tries left: "+hD+"."),r(uD)})}},t)}(5500);var bD=["_fp","_fcp","_fid"];var wD=(_D.prototype.start=function(){if(1!==this.state)throw Fk.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},_D.prototype.stop=function(){if(2!==this.state)throw Fk.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),dD(this)},_D.prototype.record=function(t,e,n){if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=ci({},n.attributes)),n&&n.metrics)for(var r=0,i=Object.keys(n.metrics);r<i.length;r++){var o=i[r];isNaN(Number(n.metrics[o]))||(this.counters[o]=Number(Math.floor(n.metrics[o])))}dD(this)},_D.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),void 0===this.counters[t]&&this.putMetric(t,0),this.counters[t]+=e},_D.prototype.putMetric=function(t,e){if(!function(t,e){return!(0===t.length||100<t.length)&&(e&&e.startsWith("_wt_")&&-1<bD.indexOf(t)||!t.startsWith("_"))}(t,this.name))throw Fk.create("invalide custom metric name",{customMetricName:t});this.counters[t]=e},_D.prototype.getMetric=function(t){return this.counters[t]||0},_D.prototype.putAttribute=function(t,e){var n=function(e){return!(0===e.length||40<e.length||Hk.some(function(t){return e.startsWith(t)})||!e.match(Gk))}(t),r=function(t){return 0!==t.length&&t.length<=100}(e);if(n&&r)this.customAttributes[t]=e;else{if(!n)throw Fk.create("invalid attribute name",{attributeName:t});if(!r)throw Fk.create("invalid attribute value",{attributeValue:e})}},_D.prototype.getAttribute=function(t){return this.customAttributes[t]},_D.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},_D.prototype.getAttributes=function(){return ci({},this.customAttributes)},_D.prototype.setStartTime=function(t){this.startTimeUs=t},_D.prototype.setDuration=function(t){this.durationUs=t},_D.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},_D.createOobTrace=function(t,e,n){var r=Uk.getInstance().getUrl();if(r){var i=new _D("_wt_"+r,!0),o=Math.floor(1e3*Uk.getInstance().getTimeOrigin());if(i.setStartTime(o),t&&t[0]&&(i.setDuration(Math.floor(1e3*t[0].duration)),i.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),i.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),i.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),e){var a=e.find(function(t){return"first-paint"===t.name});a&&a.startTime&&i.putMetric("_fp",Math.floor(1e3*a.startTime));var s=e.find(function(t){return"first-contentful-paint"===t.name});s&&s.startTime&&i.putMetric("_fcp",Math.floor(1e3*s.startTime)),n&&i.putMetric("_fid",Math.floor(1e3*n))}dD(i)}},_D.createUserTimingTrace=function(t){dD(new _D(t,!1,t))},_D);function _D(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=Uk.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||Ok+"-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}function ED(t){var e=t;if(e&&void 0!==e.responseStart){var n=Uk.getInstance().getTimeOrigin(),r=Math.floor(1e3*(e.startTime+n)),i=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,o=Math.floor(1e3*(e.responseEnd-e.startTime));!function(t){var e=Wk.getInstance();e.instrumentationEnabled&&t.url!==e.logEndPointUrl.split("?")[0]&&e.loggingEnabled&&e.logNetworkAfterSampling&&setTimeout(function(){return pD().log(t,0)},0)}({url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:o})}}var TD=5e3;function SD(){Kk()&&(setTimeout(function(){return function(){var t=Uk.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout(function(){wD.createOobTrace(e,n),r=void 0},TD);t.onFirstInputDelay(function(t){r&&(clearTimeout(r),wD.createOobTrace(e,n,t))})}else wD.createOobTrace(e,n)}()},0),setTimeout(function(){return function(){for(var t=Uk.getInstance(),e=t.getEntriesByType("resource"),n=0,r=e;n<r.length;n++){ED(r[n])}t.setupObserver("resource",ED)}()},0),setTimeout(function(){return function(){for(var t=Uk.getInstance(),e=t.getEntriesByType("measure"),n=0,r=e;n<r.length;n++){ID(r[n])}t.setupObserver("measure",ID)}()},0))}function ID(t){var e=t.name;e.substring(0,Ok.length)!==Ok&&wD.createUserTimingTrace(e)}var CD=(ND.prototype.trace=function(t){return new wD(t)},Object.defineProperty(ND.prototype,"instrumentationEnabled",{get:function(){return Wk.getInstance().instrumentationEnabled},set:function(t){Wk.getInstance().instrumentationEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(ND.prototype,"dataCollectionEnabled",{get:function(){return Wk.getInstance().dataCollectionEnabled},set:function(t){Wk.getInstance().dataCollectionEnabled=t},enumerable:!0,configurable:!0}),ND);function ND(t){this.app=t,Uk.getInstance().requiredApisAvailable()?oD().then(SD,SD):Yk.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.")}return fl.INTERNAL.registerService("performance",function(t){if("[DEFAULT]"!==t.name)throw Fk.create("FB not default");if("undefined"==typeof window)throw Fk.create("no window");return function(t){kk=t}(window),Wk.getInstance().firebaseAppInstance=t,new CD(t)},{}),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),fl});
//# sourceMappingURL=firebase.js.map
